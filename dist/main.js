"use strict";(self.webpackChunkstory_app=self.webpackChunkstory_app||[]).push([[792],{7427:(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__)=>{eval('\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\nvar asyncToGenerator = __webpack_require__(467);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.js\nvar es_symbol = __webpack_require__(2675);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.description.js\nvar es_symbol_description = __webpack_require__(9463);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.concat.js\nvar es_array_concat = __webpack_require__(8706);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.map.js\nvar es_array_map = __webpack_require__(2062);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.function.name.js\nvar es_function_name = __webpack_require__(2010);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.to-string.js\nvar es_object_to_string = __webpack_require__(6099);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.promise.js\nvar es_promise = __webpack_require__(3362);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.timers.js\nvar web_timers = __webpack_require__(6031);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/regenerator/index.js\nvar regenerator = __webpack_require__(4756);\nvar regenerator_default = /*#__PURE__*/__webpack_require__.n(regenerator);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.for-each.js\nvar es_array_for_each = __webpack_require__(1629);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.for-each.js\nvar web_dom_collections_for_each = __webpack_require__(3500);\n;// ./src/components/Header.js\n\n\n\nvar currentAuthState = false;\nvar updateAuthUI = function updateAuthUI(isLoggedIn) {\n  currentAuthState = isLoggedIn;\n  var logoutLi = document.getElementById("logout-li");\n  if (logoutLi) {\n    logoutLi.style.display = isLoggedIn ? "block" : "none";\n  }\n};\nvar Header = function Header() {\n  var _header$querySelector;\n  var header = document.createElement("header");\n  header.innerHTML = "\\n <nav>\\n      <ul>\\n        <li><a href=\\"#/stories\\" data-navigo>Stories</a></li>\\n        <li><a href=\\"#/add-story\\" data-navigo>Add Story</a></li>\\n        <li id=\\"install-li\\" style=\\"display: none;\\">\\n  <a href=\\"#\\" id=\\"install-button\\" class=\\"btn\\" data-navigo>Install App</a>\\n</li>\\n<li id=\\"logout-li\\" style=\\"display: ".concat(currentAuthState ? "block" : "none", "\\">\\n  <a href=\\"#\\" id=\\"logout-button\\" class=\\"btn\\" data-navigo>Logout</a>\\n</li>\\n\\n      </ul>\\n    </nav>\\n  ");\n\n  // Logout handler\n  (_header$querySelector = header.querySelector("#logout-button")) === null || _header$querySelector === void 0 || _header$querySelector.addEventListener("click", function () {\n    window.dispatchEvent(new CustomEvent("logout"));\n  });\n\n  // Navigation handler\n  var navLinks = header.querySelectorAll("a[data-navigo]");\n  navLinks.forEach(function (link) {\n    link.addEventListener("click", function () {\n      window.dispatchEvent(new CustomEvent("header-navigation"));\n    });\n  });\n  return header;\n};\n// EXTERNAL MODULE: ./public/assets/styles/main.css\nvar main = __webpack_require__(7478);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/classCallCheck.js\nvar classCallCheck = __webpack_require__(3029);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/createClass.js\nvar createClass = __webpack_require__(2901);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.find.js\nvar es_array_find = __webpack_require__(113);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.includes.js\nvar es_array_includes = __webpack_require__(4423);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.slice.js\nvar es_array_slice = __webpack_require__(4782);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.starts-with.js\nvar es_string_starts_with = __webpack_require__(1392);\n;// ./src/utils/view-transition.js\nvar startViewTransition = function startViewTransition(callback) {\n  if (!document.startViewTransition) {\n    callback();\n    return;\n  }\n  document.startViewTransition(function () {\n    callback();\n  });\n};\ndocument.dispatchEvent(new CustomEvent(\'view-transition-start\'));\n\n// Around where your transition completes\ndocument.dispatchEvent(new CustomEvent(\'view-transition-end\'));\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-string.js\nvar es_date_to_string = __webpack_require__(3288);\n;// ./src/components/Footer.js\n\nvar Footer = function Footer() {\n  var footer = document.createElement("footer");\n  footer.innerHTML = "\\n      <p>&copy; ".concat(new Date().getFullYear(), " Story App. All rights reserved.</p>\\n    ");\n  return footer;\n};\n;// ./src/views/ErrorView.js\nvar ErrorView = function ErrorView() {\n  var view = document.createElement(\'main\');\n  view.id = \'main-content\';\n  view.innerHTML = "\\n    <div class=\\"error-message\\">\\n      <h1>404 Not Found</h1>\\n      <p>The page you\'re looking for doesn\'t exist.</p>\\n      <a href=\\"#/\\">Go to Home</a>\\n    </div>\\n  ";\n  return {\n    getView: function getView() {\n      return view;\n    }\n  };\n};\n;// ./src/router.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar Router = /*#__PURE__*/function () {\n  function Router(routes) {\n    (0,classCallCheck/* default */.A)(this, Router);\n    this.routes = routes;\n    this.rootElem = document.getElementById("app");\n    this.currentPresenter = null;\n    this.init();\n  }\n  return (0,createClass/* default */.A)(Router, [{\n    key: "init",\n    value: function init() {\n      var _this = this;\n      window.addEventListener("hashchange", function () {\n        return _this.handleRouting();\n      });\n      window.addEventListener("load", function () {\n        return _this.handleRouting();\n      });\n    }\n  }, {\n    key: "handleRouting",\n    value: function () {\n      var _handleRouting = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n        var _this$currentPresente,\n          _this2 = this;\n        var url, params, route;\n        return regenerator_default().wrap(function (_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              url = window.location.hash.slice(1) || "/";\n              params = {};\n              route = this.findMatchingRoute(url, params) || this.routes.find(function (r) {\n                return r.path === "*";\n              }); // Clean up previous view\n              if ((_this$currentPresente = this.currentPresenter) !== null && _this$currentPresente !== void 0 && _this$currentPresente.cleanup) {\n                this.currentPresenter.cleanup();\n              }\n              _context2.next = 1;\n              return startViewTransition(/*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n                var _view$getView, _footer$getView, _header$getView, header, headerElement, view, viewElement, mainContent, footer, footerElement, _this2$currentPresent, _this2$currentPresent2, errorView, _t;\n                return regenerator_default().wrap(function (_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.prev = 0;\n                      _this2.rootElem.innerHTML = "";\n\n                      // Add header if authenticated\n                      if (!["/login", "/register"].includes(url)) {\n                        header = Header();\n                        headerElement = ((_header$getView = header.getView) === null || _header$getView === void 0 ? void 0 : _header$getView.call(header)) || header;\n                        if (headerElement instanceof Node) {\n                          _this2.rootElem.appendChild(headerElement);\n                        }\n                      }\n\n                      // Load view\n                      _context.next = 1;\n                      return route.view(params);\n                    case 1:\n                      view = _context.sent;\n                      viewElement = ((_view$getView = view.getView) === null || _view$getView === void 0 ? void 0 : _view$getView.call(view)) || view;\n                      if (viewElement instanceof Node) {\n                        _context.next = 2;\n                        break;\n                      }\n                      throw new Error("View is not a valid DOM node");\n                    case 2:\n                      // Ensure main content exists\n                      mainContent = viewElement.querySelector(\'main\') || viewElement;\n                      if (!mainContent.id) {\n                        mainContent.id = "main-content";\n                      }\n                      _this2.rootElem.appendChild(viewElement);\n\n                      // Add footer\n                      footer = Footer();\n                      footerElement = ((_footer$getView = footer.getView) === null || _footer$getView === void 0 ? void 0 : _footer$getView.call(footer)) || footer;\n                      if (footerElement instanceof Node) {\n                        _this2.rootElem.appendChild(footerElement);\n                      }\n\n                      // Set focus to first focusable element\n                      setTimeout(function () {\n                        var firstFocusable = _this2.rootElem.querySelector(\'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])\');\n                        firstFocusable === null || firstFocusable === void 0 || firstFocusable.focus();\n                      }, 100);\n\n                      // Store presenter\n                      if (route.presenter) {\n                        _this2.currentPresenter = route.presenter;\n                        (_this2$currentPresent = (_this2$currentPresent2 = _this2.currentPresenter).afterRender) === null || _this2$currentPresent === void 0 || _this2$currentPresent.call(_this2$currentPresent2);\n                      }\n                      _context.next = 4;\n                      break;\n                    case 3:\n                      _context.prev = 3;\n                      _t = _context["catch"](0);\n                      console.error("Routing error:", _t);\n                      errorView = ErrorView();\n                      _this2.rootElem.innerHTML = "";\n                      _this2.rootElem.appendChild(errorView.getView());\n                    case 4:\n                    case "end":\n                      return _context.stop();\n                  }\n                }, _callee, null, [[0, 3]]);\n              })));\n            case 1:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function handleRouting() {\n        return _handleRouting.apply(this, arguments);\n      }\n      return handleRouting;\n    }()\n  }, {\n    key: "findMatchingRoute",\n    value: function findMatchingRoute(url, params) {\n      return this.routes.find(function (route) {\n        var routeParts = route.path.split("/");\n        var urlParts = url.split("/");\n        if (routeParts.length !== urlParts.length) return false;\n        for (var i = 0; i < routeParts.length; i++) {\n          var routePart = routeParts[i];\n          var urlPart = urlParts[i];\n          if (routePart.startsWith(":")) {\n            var paramName = routePart.slice(1);\n            params[paramName] = urlPart;\n          } else if (routePart !== urlPart) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n  }, {\n    key: "navigateTo",\n    value: function navigateTo(path) {\n      var currentPath = window.location.hash.slice(1) || "/";\n      if (currentPath === "/add-story" && this.currentPresenter) {\n        this.currentPresenter.cleanup();\n      }\n      window.location.hash = path;\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-json.js\nvar es_date_to_json = __webpack_require__(739);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.keys.js\nvar es_object_keys = __webpack_require__(9432);\n;// ./src/services/authApi.js\n\n\n\n\n\nvar API_BASE_URL = \'https://story-api.dicoding.dev/v1\';\nvar authApi_login = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(email, password) {\n    var response;\n    return regenerator_default().wrap(function (_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 1;\n          return fetch("".concat(API_BASE_URL, "/login"), {\n            method: \'POST\',\n            headers: {\n              \'Content-Type\': \'application/json\'\n            },\n            body: JSON.stringify({\n              email: email,\n              password: password\n            })\n          });\n        case 1:\n          response = _context.sent;\n          return _context.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function login(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar authApi_register = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(name, email, password) {\n    var response;\n    return regenerator_default().wrap(function (_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 1;\n          return fetch("".concat(API_BASE_URL, "/register"), {\n            method: \'POST\',\n            headers: {\n              \'Content-Type\': \'application/json\'\n            },\n            body: JSON.stringify({\n              name: name,\n              email: email,\n              password: password\n            })\n          });\n        case 1:\n          response = _context2.sent;\n          return _context2.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function register(_x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n;// ./src/models/AuthModel.js\n\n\n\n\n\n\n\n\nvar AuthModel = /*#__PURE__*/function () {\n  function AuthModel() {\n    (0,classCallCheck/* default */.A)(this, AuthModel);\n    this.token = localStorage.getItem("token") || null;\n    this.user = JSON.parse(localStorage.getItem("user")) || null;\n  }\n  return (0,createClass/* default */.A)(AuthModel, [{\n    key: "login",\n    value: function () {\n      var _login2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(email, password) {\n        var response, _t;\n        return regenerator_default().wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 1;\n              return authApi_login(email, password);\n            case 1:\n              response = _context.sent;\n              if (response.error) {\n                _context.next = 2;\n                break;\n              }\n              this.token = response.loginResult.token;\n              this.user = {\n                userId: response.loginResult.userId,\n                name: response.loginResult.name\n              };\n              localStorage.setItem("token", this.token);\n              localStorage.setItem("user", JSON.stringify(this.user));\n              return _context.abrupt("return", {\n                success: true,\n                user: this.user\n              });\n            case 2:\n              return _context.abrupt("return", {\n                success: false,\n                message: response.message\n              });\n            case 3:\n              _context.prev = 3;\n              _t = _context["catch"](0);\n              console.error("Login error:", _t);\n              return _context.abrupt("return", {\n                success: false,\n                message: "Login failed. Please try again."\n              });\n            case 4:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[0, 3]]);\n      }));\n      function login(_x, _x2) {\n        return _login2.apply(this, arguments);\n      }\n      return login;\n    }()\n  }, {\n    key: "register",\n    value: function () {\n      var _register2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(name, email, password) {\n        var response, _t2;\n        return regenerator_default().wrap(function (_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 1;\n              return authApi_register(name, email, password);\n            case 1:\n              response = _context2.sent;\n              if (response.error) {\n                _context2.next = 2;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: true\n              });\n            case 2:\n              return _context2.abrupt("return", {\n                success: false,\n                message: response.message\n              });\n            case 3:\n              _context2.prev = 3;\n              _t2 = _context2["catch"](0);\n              console.error("Registration error:", _t2);\n              return _context2.abrupt("return", {\n                success: false,\n                message: "Registration failed. Please try again."\n              });\n            case 4:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 3]]);\n      }));\n      function register(_x3, _x4, _x5) {\n        return _register2.apply(this, arguments);\n      }\n      return register;\n    }()\n  }, {\n    key: "logout",\n    value: function logout() {\n      this.token = null;\n      this.user = null;\n      localStorage.removeItem("token");\n      localStorage.removeItem("user");\n    }\n  }, {\n    key: "isAuthenticated",\n    value: function isAuthenticated() {\n      return !!this.token;\n    }\n  }, {\n    key: "getUser",\n    value: function getUser() {\n      return this.user;\n    }\n  }, {\n    key: "getToken",\n    value: function getToken() {\n      // console.log("AuthModel.getToken called");\n      // console.log("AuthModel type:", typeof AuthModel);\n      // console.log("AuthModel:", AuthModel);\n      return this.token;\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/defineProperty.js\nvar defineProperty = __webpack_require__(4467);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.iterator.js\nvar es_symbol_iterator = __webpack_require__(2259);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.filter.js\nvar es_array_filter = __webpack_require__(2008);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.from.js\nvar es_array_from = __webpack_require__(3418);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.is-array.js\nvar es_array_is_array = __webpack_require__(4346);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.iterator.js\nvar es_array_iterator = __webpack_require__(3792);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.sort.js\nvar es_array_sort = __webpack_require__(6910);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.now.js\nvar es_date_now = __webpack_require__(9089);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-iso-string.js\nvar es_date_to_iso_string = __webpack_require__(1688);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.define-properties.js\nvar es_object_define_properties = __webpack_require__(7945);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.define-property.js\nvar es_object_define_property = __webpack_require__(4185);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\nvar es_object_get_own_property_descriptor = __webpack_require__(3851);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.get-own-property-descriptors.js\nvar es_object_get_own_property_descriptors = __webpack_require__(1278);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.regexp.exec.js\nvar es_regexp_exec = __webpack_require__(7495);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.regexp.to-string.js\nvar es_regexp_to_string = __webpack_require__(8781);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.iterator.js\nvar es_string_iterator = __webpack_require__(7764);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.iterator.js\nvar web_dom_collections_iterator = __webpack_require__(2953);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url.js\nvar web_url = __webpack_require__(3296);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url.to-json.js\nvar web_url_to_json = __webpack_require__(7208);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url-search-params.js\nvar web_url_search_params = __webpack_require__(8408);\n;// ./src/data/api.js\n\n\n\n\n\n\n\n\nvar api_API_BASE_URL = "https://story-api.dicoding.dev/v1";\nvar register = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(name, email, password) {\n    var response;\n    return _regeneratorRuntime.wrap(function (_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/register"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json"\n            },\n            body: JSON.stringify({\n              name: name,\n              email: email,\n              password: password\n            })\n          });\n        case 1:\n          response = _context.sent;\n          return _context.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function register(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}()));\nvar login = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n    var response;\n    return _regeneratorRuntime.wrap(function (_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/login"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json"\n            },\n            body: JSON.stringify({\n              email: email,\n              password: password\n            })\n          });\n        case 1:\n          response = _context2.sent;\n          return _context2.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function login(_x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}()));\nvar api_getAllStories = /*#__PURE__*/function () {\n  var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(token, page, size, withLocation) {\n    var response, data, _t;\n    return regenerator_default().wrap(function (_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/stories?page=").concat(page, "&size=").concat(size, "&location=").concat(withLocation ? 1 : 0), {\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            }\n          });\n        case 1:\n          response = _context3.sent;\n          _context3.next = 2;\n          return response.json();\n        case 2:\n          data = _context3.sent;\n          console.log(\'API Response:\', data); // Debug log\n          if (response.ok) {\n            _context3.next = 3;\n            break;\n          }\n          throw new Error(data.message || \'Failed to fetch\');\n        case 3:\n          return _context3.abrupt("return", data);\n        case 4:\n          _context3.prev = 4;\n          _t = _context3["catch"](0);\n          console.error(\'API Error:\', _t);\n          throw _t;\n        case 5:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[0, 4]]);\n  }));\n  return function getAllStories(_x6, _x7, _x8, _x9) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nvar api_getStoryDetail = /*#__PURE__*/function () {\n  var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(id, token) {\n    var response;\n    return regenerator_default().wrap(function (_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/stories/").concat(id), {\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            }\n          });\n        case 1:\n          response = _context4.sent;\n          return _context4.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return function getStoryDetail(_x0, _x1) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nvar api_addStory = /*#__PURE__*/function () {\n  var _ref5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(data, token) {\n    var formData, response;\n    return regenerator_default().wrap(function (_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          formData = new FormData();\n          formData.append("description", data.description);\n          formData.append("photo", data.photo);\n          if (data.lat && data.lon) {\n            formData.append("lat", data.lat);\n            formData.append("lon", data.lon);\n          }\n          _context5.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/stories"), {\n            method: "POST",\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            },\n            body: formData\n          });\n        case 1:\n          response = _context5.sent;\n          return _context5.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context5.stop();\n      }\n    }, _callee5);\n  }));\n  return function addStory(_x10, _x11) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nvar addStoryGuest = /*#__PURE__*/function () {\n  var _ref6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(data) {\n    var formData, response;\n    return regenerator_default().wrap(function (_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          formData = new FormData();\n          formData.append("description", data.description);\n          formData.append("photo", data.photo);\n          if (data.lat && data.lon) {\n            formData.append("lat", data.lat);\n            formData.append("lon", data.lon);\n          }\n          _context6.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/stories/guest"), {\n            method: "POST",\n            body: formData\n          });\n        case 1:\n          response = _context6.sent;\n          return _context6.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context6.stop();\n      }\n    }, _callee6);\n  }));\n  return function addStoryGuest(_x12) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nvar subscribeToNotifications = /*#__PURE__*/function () {\n  var _ref7 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(subscription, token) {\n    var response;\n    return regenerator_default().wrap(function (_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/notifications/subscribe"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json",\n              Authorization: "Bearer ".concat(token)\n            },\n            body: JSON.stringify(subscription)\n          });\n        case 1:\n          response = _context7.sent;\n          return _context7.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return function subscribeToNotifications(_x13, _x14) {\n    return _ref7.apply(this, arguments);\n  };\n}();\nvar unsubscribeFromNotifications = /*#__PURE__*/function () {\n  var _ref8 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(endpoint, token) {\n    var response;\n    return regenerator_default().wrap(function (_context8) {\n      while (1) switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/notifications/subscribe"), {\n            method: "DELETE",\n            headers: {\n              "Content-Type": "application/json",\n              Authorization: "Bearer ".concat(token)\n            },\n            body: JSON.stringify({\n              endpoint: endpoint\n            })\n          });\n        case 1:\n          response = _context8.sent;\n          return _context8.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context8.stop();\n      }\n    }, _callee8);\n  }));\n  return function unsubscribeFromNotifications(_x15, _x16) {\n    return _ref8.apply(this, arguments);\n  };\n}();\nvar bookmarkStory = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref9 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(storyId, token) {\n    var response;\n    return _regeneratorRuntime.wrap(function (_context9) {\n      while (1) switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/bookmarks"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json",\n              Authorization: "Bearer ".concat(token)\n            },\n            body: JSON.stringify({\n              storyId: storyId\n            })\n          });\n        case 1:\n          response = _context9.sent;\n          return _context9.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context9.stop();\n      }\n    }, _callee9);\n  }));\n  return function bookmarkStory(_x17, _x18) {\n    return _ref9.apply(this, arguments);\n  };\n}()));\nvar unbookmarkStory = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref0 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee0(storyId, token) {\n    var response;\n    return _regeneratorRuntime.wrap(function (_context0) {\n      while (1) switch (_context0.prev = _context0.next) {\n        case 0:\n          _context0.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/bookmarks/").concat(storyId), {\n            method: "DELETE",\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            }\n          });\n        case 1:\n          response = _context0.sent;\n          return _context0.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context0.stop();\n      }\n    }, _callee0);\n  }));\n  return function unbookmarkStory(_x19, _x20) {\n    return _ref0.apply(this, arguments);\n  };\n}()));\nvar getBookmarkedStories = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref1 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee1(token) {\n    var response;\n    return _regeneratorRuntime.wrap(function (_context1) {\n      while (1) switch (_context1.prev = _context1.next) {\n        case 0:\n          _context1.next = 1;\n          return fetch("".concat(api_API_BASE_URL, "/bookmarks"), {\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            }\n          });\n        case 1:\n          response = _context1.sent;\n          return _context1.abrupt("return", response.json());\n        case 2:\n        case "end":\n          return _context1.stop();\n      }\n    }, _callee1);\n  }));\n  return function getBookmarkedStories(_x21) {\n    return _ref1.apply(this, arguments);\n  };\n}()));\n;// ./src/data/database.js\n\n\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar initDB = function initDB() {\n  return new Promise(function (resolve, reject) {\n    var request = indexedDB.open("StoryAppDB", 2);\n    request.onerror = function (event) {\n      console.error("Database error:", event.target.error);\n      reject("Database error");\n    };\n    request.onupgradeneeded = function (event) {\n      var db = event.target.result;\n      var oldVersion = event.oldVersion;\n      var newVersion = event.newVersion;\n      console.log("Upgrading DB from v".concat(oldVersion, " to v").concat(newVersion));\n      if (!db.objectStoreNames.contains("stories")) {\n        var storiesStore = db.createObjectStore("stories", {\n          keyPath: "id"\n        });\n        storiesStore.createIndex("createdAt", "createdAt", {\n          unique: false\n        });\n      }\n      if (!db.objectStoreNames.contains("user")) {\n        db.createObjectStore("user", {\n          keyPath: "id"\n        });\n      }\n      if (!db.objectStoreNames.contains("bookmarks")) {\n        var bookmarksStore = db.createObjectStore("bookmarks", {\n          keyPath: "id"\n        });\n        bookmarksStore.createIndex("storyId", "storyId", {\n          unique: true\n        });\n        bookmarksStore.createIndex("createdAt", "createdAt", {\n          unique: false\n        });\n      }\n    };\n    request.onsuccess = function (event) {\n      console.log("Database opened successfully");\n      resolve(event.target.result);\n    };\n  });\n};\nvar saveStories = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(stories) {\n    var db, transaction, store, _t;\n    return _regeneratorRuntime.wrap(function (_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 1;\n          return initDB();\n        case 1:\n          db = _context.sent;\n          transaction = db.transaction("stories", "readwrite");\n          store = transaction.objectStore("stories");\n          stories.forEach(function (story) {\n            store.put(story);\n          });\n          return _context.abrupt("return", new Promise(function (resolve) {\n            transaction.oncomplete = function () {\n              resolve(true);\n            };\n          }));\n        case 2:\n          _context.prev = 2;\n          _t = _context["catch"](0);\n          console.error("Failed to save stories:", _t);\n          return _context.abrupt("return", false);\n        case 3:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee, null, [[0, 2]]);\n  }));\n  return function saveStories(_x) {\n    return _ref.apply(this, arguments);\n  };\n}()));\nvar getStories = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n    var db, transaction, store, request, _t2;\n    return regenerator_default().wrap(function (_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 1;\n          return initDB();\n        case 1:\n          db = _context2.sent;\n          transaction = db.transaction("stories", "readonly");\n          store = transaction.objectStore("stories");\n          request = store.getAll();\n          return _context2.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result || []);\n            };\n          }));\n        case 2:\n          _context2.prev = 2;\n          _t2 = _context2["catch"](0);\n          console.error("Failed to get stories:", _t2);\n          return _context2.abrupt("return", []);\n        case 3:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[0, 2]]);\n  }));\n  return function getStories() {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar saveUserData = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userData) {\n    var db, transaction, store, _t3;\n    return _regeneratorRuntime.wrap(function (_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 1;\n          return initDB();\n        case 1:\n          db = _context3.sent;\n          transaction = db.transaction("user", "readwrite");\n          store = transaction.objectStore("user");\n          store.put(_objectSpread({\n            id: "currentUser"\n          }, userData));\n          return _context3.abrupt("return", new Promise(function (resolve) {\n            transaction.oncomplete = function () {\n              resolve(true);\n            };\n          }));\n        case 2:\n          _context3.prev = 2;\n          _t3 = _context3["catch"](0);\n          console.error("Failed to save user data:", _t3);\n          return _context3.abrupt("return", false);\n        case 3:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[0, 2]]);\n  }));\n  return function saveUserData(_x2) {\n    return _ref3.apply(this, arguments);\n  };\n}()));\nvar getUserData = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref4 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    var db, transaction, store, request, _t4;\n    return _regeneratorRuntime.wrap(function (_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.prev = 0;\n          _context4.next = 1;\n          return initDB();\n        case 1:\n          db = _context4.sent;\n          transaction = db.transaction("user", "readonly");\n          store = transaction.objectStore("user");\n          request = store.get("currentUser");\n          return _context4.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result || null);\n            };\n          }));\n        case 2:\n          _context4.prev = 2;\n          _t4 = _context4["catch"](0);\n          console.error("Failed to get user data:", _t4);\n          return _context4.abrupt("return", null);\n        case 3:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4, null, [[0, 2]]);\n  }));\n  return function getUserData() {\n    return _ref4.apply(this, arguments);\n  };\n}()));\nvar isWriting = false;\nvar _addStoryOffline = /*#__PURE__*/function () {\n  var _ref5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(story) {\n    var db, tx, store, _t5;\n    return regenerator_default().wrap(function (_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          if (!isWriting) {\n            _context5.next = 2;\n            break;\n          }\n          _context5.next = 1;\n          return new Promise(function (resolve) {\n            return setTimeout(resolve, 100);\n          });\n        case 1:\n          return _context5.abrupt("return", _addStoryOffline(story));\n        case 2:\n          isWriting = true;\n          _context5.prev = 3;\n          _context5.next = 4;\n          return initDB();\n        case 4:\n          db = _context5.sent;\n          tx = db.transaction("stories", "readwrite");\n          store = tx.objectStore("stories");\n          store.put(story);\n          return _context5.abrupt("return", new Promise(function (resolve) {\n            tx.oncomplete = function () {\n              return resolve(true);\n            };\n            tx.onerror = function () {\n              console.error("Transaction failed:", tx.error);\n              resolve(false);\n            };\n          }));\n        case 5:\n          _context5.prev = 5;\n          _t5 = _context5["catch"](3);\n          console.error("Failed to save story offline:", _t5);\n          return _context5.abrupt("return", false);\n        case 6:\n          _context5.prev = 6;\n          isWriting = false;\n          return _context5.finish(6);\n        case 7:\n        case "end":\n          return _context5.stop();\n      }\n    }, _callee5, null, [[3, 5, 6, 7]]);\n  }));\n  return function addStoryOffline(_x3) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nvar database_deleteStoryOffline = /*#__PURE__*/function () {\n  var _ref6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(id) {\n    var db, tx, store, _t6;\n    return regenerator_default().wrap(function (_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.prev = 0;\n          _context6.next = 1;\n          return initDB();\n        case 1:\n          db = _context6.sent;\n          tx = db.transaction("stories", "readwrite");\n          store = tx.objectStore("stories");\n          store["delete"](id);\n          return _context6.abrupt("return", new Promise(function (resolve) {\n            tx.oncomplete = function () {\n              return resolve(true);\n            };\n          }));\n        case 2:\n          _context6.prev = 2;\n          _t6 = _context6["catch"](0);\n          console.error("Failed to delete story:", _t6);\n          return _context6.abrupt("return", false);\n        case 3:\n        case "end":\n          return _context6.stop();\n      }\n    }, _callee6, null, [[0, 2]]);\n  }));\n  return function deleteStoryOffline(_x4) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nvar getOfflineStories = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref7 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n    var db, tx, store, request;\n    return _regeneratorRuntime.wrap(function (_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 1;\n          return initDB();\n        case 1:\n          db = _context7.sent;\n          tx = db.transaction("stories", "readonly");\n          store = tx.objectStore("stories");\n          request = store.getAll();\n          return _context7.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result.filter(function (story) {\n                return story.isOffline;\n              }));\n            };\n          }));\n        case 2:\n        case "end":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return function getOfflineStories() {\n    return _ref7.apply(this, arguments);\n  };\n}()));\nvar addBookmark = /*#__PURE__*/function () {\n  var _ref8 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(storyId) {\n    var db, tx, store, bookmark, _t7;\n    return regenerator_default().wrap(function (_context8) {\n      while (1) switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.prev = 0;\n          _context8.next = 1;\n          return initDB();\n        case 1:\n          db = _context8.sent;\n          tx = db.transaction("bookmarks", "readwrite");\n          store = tx.objectStore("bookmarks");\n          bookmark = {\n            id: "bookmark_".concat(Date.now()),\n            storyId: storyId,\n            createdAt: new Date().toISOString()\n          };\n          store.put(bookmark);\n          return _context8.abrupt("return", new Promise(function (resolve) {\n            tx.oncomplete = function () {\n              return resolve(true);\n            };\n            tx.onerror = function () {\n              console.error("Bookmark transaction failed:", tx.error);\n              resolve(false);\n            };\n          }));\n        case 2:\n          _context8.prev = 2;\n          _t7 = _context8["catch"](0);\n          console.error("Failed to add bookmark:", _t7);\n          return _context8.abrupt("return", false);\n        case 3:\n        case "end":\n          return _context8.stop();\n      }\n    }, _callee8, null, [[0, 2]]);\n  }));\n  return function addBookmark(_x5) {\n    return _ref8.apply(this, arguments);\n  };\n}();\nvar removeBookmark = /*#__PURE__*/function () {\n  var _ref9 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee9(storyId) {\n    var db, tx, store, index, request, _t8;\n    return regenerator_default().wrap(function (_context9) {\n      while (1) switch (_context9.prev = _context9.next) {\n        case 0:\n          _context9.prev = 0;\n          _context9.next = 1;\n          return initDB();\n        case 1:\n          db = _context9.sent;\n          tx = db.transaction("bookmarks", "readwrite");\n          store = tx.objectStore("bookmarks");\n          index = store.index("storyId");\n          request = index.get(storyId);\n          return _context9.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              if (request.result) {\n                store["delete"](request.result.id);\n              }\n              resolve(true);\n            };\n            request.onerror = function () {\n              console.error("Error finding bookmark:", request.error);\n              resolve(false);\n            };\n          }));\n        case 2:\n          _context9.prev = 2;\n          _t8 = _context9["catch"](0);\n          console.error("Failed to remove bookmark:", _t8);\n          return _context9.abrupt("return", false);\n        case 3:\n        case "end":\n          return _context9.stop();\n      }\n    }, _callee9, null, [[0, 2]]);\n  }));\n  return function removeBookmark(_x6) {\n    return _ref9.apply(this, arguments);\n  };\n}();\nvar getBookmarks = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref0 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee0() {\n    var db, tx, store, request, _t9;\n    return _regeneratorRuntime.wrap(function (_context0) {\n      while (1) switch (_context0.prev = _context0.next) {\n        case 0:\n          _context0.prev = 0;\n          _context0.next = 1;\n          return initDB();\n        case 1:\n          db = _context0.sent;\n          tx = db.transaction("bookmarks", "readonly");\n          store = tx.objectStore("bookmarks");\n          request = store.getAll();\n          return _context0.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result || []);\n            };\n            request.onerror = function () {\n              console.error("Error getting bookmarks:", request.error);\n              resolve([]);\n            };\n          }));\n        case 2:\n          _context0.prev = 2;\n          _t9 = _context0["catch"](0);\n          console.error("Failed to get bookmarks:", _t9);\n          return _context0.abrupt("return", []);\n        case 3:\n        case "end":\n          return _context0.stop();\n      }\n    }, _callee0, null, [[0, 2]]);\n  }));\n  return function getBookmarks() {\n    return _ref0.apply(this, arguments);\n  };\n}()));\nvar database_getBookmarkedStories = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref1 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee1() {\n    var db, bookmarks, storyIds, tx, store, stories, _t0;\n    return _regeneratorRuntime.wrap(function (_context1) {\n      while (1) switch (_context1.prev = _context1.next) {\n        case 0:\n          _context1.prev = 0;\n          _context1.next = 1;\n          return initDB();\n        case 1:\n          db = _context1.sent;\n          _context1.next = 2;\n          return getBookmarks();\n        case 2:\n          bookmarks = _context1.sent;\n          storyIds = bookmarks.map(function (b) {\n            return b.storyId;\n          });\n          if (!(storyIds.length === 0)) {\n            _context1.next = 3;\n            break;\n          }\n          return _context1.abrupt("return", []);\n        case 3:\n          tx = db.transaction("stories", "readonly");\n          store = tx.objectStore("stories");\n          _context1.next = 4;\n          return Promise.all(storyIds.map(function (id) {\n            return new Promise(function (resolve) {\n              var request = store.get(id);\n              request.onsuccess = function () {\n                return resolve(request.result);\n              };\n              request.onerror = function () {\n                return resolve(null);\n              };\n            });\n          }));\n        case 4:\n          stories = _context1.sent;\n          return _context1.abrupt("return", stories.filter(function (story) {\n            return story !== null;\n          }));\n        case 5:\n          _context1.prev = 5;\n          _t0 = _context1["catch"](0);\n          console.error("Failed to get bookmarked stories:", _t0);\n          return _context1.abrupt("return", []);\n        case 6:\n        case "end":\n          return _context1.stop();\n      }\n    }, _callee1, null, [[0, 5]]);\n  }));\n  return function getBookmarkedStories() {\n    return _ref1.apply(this, arguments);\n  };\n}()));\nvar isBookmarked = /*#__PURE__*/function () {\n  var _ref10 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee10(storyId) {\n    var db, tx, store, index, request, _t1;\n    return regenerator_default().wrap(function (_context10) {\n      while (1) switch (_context10.prev = _context10.next) {\n        case 0:\n          _context10.prev = 0;\n          _context10.next = 1;\n          return initDB();\n        case 1:\n          db = _context10.sent;\n          tx = db.transaction("bookmarks", "readonly");\n          store = tx.objectStore("bookmarks");\n          index = store.index("storyId");\n          request = index.get(storyId);\n          return _context10.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(!!request.result);\n            };\n            request.onerror = function () {\n              console.error("Error checking bookmark:", request.error);\n              resolve(false);\n            };\n          }));\n        case 2:\n          _context10.prev = 2;\n          _t1 = _context10["catch"](0);\n          console.error("Failed to check bookmark:", _t1);\n          return _context10.abrupt("return", false);\n        case 3:\n        case "end":\n          return _context10.stop();\n      }\n    }, _callee10, null, [[0, 2]]);\n  }));\n  return function isBookmarked(_x7) {\n    return _ref10.apply(this, arguments);\n  };\n}();\nvar clearAllBookmarks = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref11 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11() {\n    var db, tx, store, request, _t10;\n    return _regeneratorRuntime.wrap(function (_context11) {\n      while (1) switch (_context11.prev = _context11.next) {\n        case 0:\n          _context11.prev = 0;\n          _context11.next = 1;\n          return initDB();\n        case 1:\n          db = _context11.sent;\n          tx = db.transaction("bookmarks", "readwrite");\n          store = tx.objectStore("bookmarks");\n          request = store.clear();\n          return _context11.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              return resolve(true);\n            };\n            request.onerror = function () {\n              console.error("Error clearing bookmarks:", request.error);\n              resolve(false);\n            };\n          }));\n        case 2:\n          _context11.prev = 2;\n          _t10 = _context11["catch"](0);\n          console.error("Failed to clear bookmarks:", _t10);\n          return _context11.abrupt("return", false);\n        case 3:\n        case "end":\n          return _context11.stop();\n      }\n    }, _callee11, null, [[0, 2]]);\n  }));\n  return function clearAllBookmarks() {\n    return _ref11.apply(this, arguments);\n  };\n}()));\n;// ./src/models/StoryModel.js\n\n\n\n\nfunction StoryModel_ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction StoryModel_objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? StoryModel_ownKeys(Object(t), !0).forEach(function (r) { (0,defineProperty/* default */.A)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : StoryModel_ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar StoryModel = /*#__PURE__*/function () {\n  function StoryModel(authModel) {\n    (0,classCallCheck/* default */.A)(this, StoryModel);\n    this.authModel = authModel;\n  }\n  return (0,createClass/* default */.A)(StoryModel, [{\n    key: "getAllStories",\n    value: function () {\n      var _getAllStories2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var page,\n          size,\n          withLocation,\n          token,\n          response,\n          offlineStories,\n          _offlineStories,\n          _args = arguments,\n          _t;\n        return regenerator_default().wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              page = _args.length > 0 && _args[0] !== undefined ? _args[0] : 1;\n              size = _args.length > 1 && _args[1] !== undefined ? _args[1] : 10;\n              withLocation = _args.length > 2 && _args[2] !== undefined ? _args[2] : false;\n              _context.prev = 1;\n              token = this.authModel.getToken();\n              _context.next = 2;\n              return api_getAllStories(token, page, size, withLocation);\n            case 2:\n              response = _context.sent;\n              if (response.error) {\n                _context.next = 3;\n                break;\n              }\n              return _context.abrupt("return", {\n                success: true,\n                stories: response.listStory\n              });\n            case 3:\n              _context.next = 4;\n              return getStories();\n            case 4:\n              offlineStories = _context.sent;\n              return _context.abrupt("return", {\n                success: true,\n                stories: offlineStories,\n                isOffline: true\n              });\n            case 5:\n              _context.prev = 5;\n              _t = _context["catch"](1);\n              _context.next = 6;\n              return getStories();\n            case 6:\n              _offlineStories = _context.sent;\n              return _context.abrupt("return", {\n                success: !!_offlineStories.length,\n                stories: _offlineStories || [],\n                isOffline: true\n              });\n            case 7:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[1, 5]]);\n      }));\n      function getAllStories() {\n        return _getAllStories2.apply(this, arguments);\n      }\n      return getAllStories;\n    }()\n  }, {\n    key: "getStoryDetail",\n    value: function () {\n      var _getStoryDetail2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(id) {\n        var token, response, _t2;\n        return regenerator_default().wrap(function (_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              token = this.authModel.getToken();\n              if (token) {\n                _context2.next = 1;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: false,\n                message: "Authentication required"\n              });\n            case 1:\n              _context2.next = 2;\n              return api_getStoryDetail(id, token);\n            case 2:\n              response = _context2.sent;\n              if (response.error) {\n                _context2.next = 3;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: true,\n                story: response.story\n              });\n            case 3:\n              return _context2.abrupt("return", {\n                success: false,\n                message: response.message || "Failed to fetch story"\n              });\n            case 4:\n              _context2.prev = 4;\n              _t2 = _context2["catch"](0);\n              return _context2.abrupt("return", {\n                success: false,\n                message: _t2.message || "Network error while fetching story"\n              });\n            case 5:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 4]]);\n      }));\n      function getStoryDetail(_x) {\n        return _getStoryDetail2.apply(this, arguments);\n      }\n      return getStoryDetail;\n    }()\n  }, {\n    key: "addStory",\n    value: function () {\n      var _addStory2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(data) {\n        var token, response, _t3, _t4;\n        return regenerator_default().wrap(function (_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              token = this.authModel.getToken();\n              if (!(!(data !== null && data !== void 0 && data.description) || !(data !== null && data !== void 0 && data.photo))) {\n                _context3.next = 1;\n                break;\n              }\n              return _context3.abrupt("return", {\n                success: false,\n                message: "Description and photo are required"\n              });\n            case 1:\n              if (!token) {\n                _context3.next = 3;\n                break;\n              }\n              _context3.next = 2;\n              return api_addStory(data, token);\n            case 2:\n              _t3 = _context3.sent;\n              _context3.next = 5;\n              break;\n            case 3:\n              _context3.next = 4;\n              return addStoryGuest(data);\n            case 4:\n              _t3 = _context3.sent;\n            case 5:\n              response = _t3;\n              if (response.error) {\n                _context3.next = 6;\n                break;\n              }\n              return _context3.abrupt("return", {\n                success: true,\n                message: "Story added successfully",\n                data: response\n              });\n            case 6:\n              return _context3.abrupt("return", {\n                success: false,\n                message: response.message || "Failed to add story"\n              });\n            case 7:\n              _context3.prev = 7;\n              _t4 = _context3["catch"](0);\n              return _context3.abrupt("return", {\n                success: false,\n                message: _t4.message || "Network error while adding story"\n              });\n            case 8:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[0, 7]]);\n      }));\n      function addStory(_x2) {\n        return _addStory2.apply(this, arguments);\n      }\n      return addStory;\n    }()\n  }, {\n    key: "addStoryOffline",\n    value: function () {\n      var _addStoryOffline2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(data) {\n        var storyId, photoUrl, photoBase64, story, _t5;\n        return regenerator_default().wrap(function (_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              storyId = "offline_".concat(Date.now(), "_").concat(Math.floor(Math.random() * 1000));\n              photoUrl = "";\n              photoBase64 = "";\n              if (!(data.photo instanceof Blob || data.photo instanceof File)) {\n                _context4.next = 2;\n                break;\n              }\n              _context4.next = 1;\n              return this.readFileAsBase64(data.photo);\n            case 1:\n              photoBase64 = _context4.sent;\n              photoUrl = URL.createObjectURL(data.photo);\n            case 2:\n              story = {\n                id: storyId,\n                name: "You (Offline)",\n                description: data.description,\n                photoUrl: photoUrl || "/assets/images/placeholder-offline.jpg",\n                photoBase64: photoBase64,\n                createdAt: new Date().toISOString(),\n                updatedAt: new Date().toISOString(),\n                isOffline: true,\n                lat: data.lat,\n                lon: data.lon,\n                originalPhoto: data.photo\n              };\n              _context4.next = 3;\n              return _addStoryOffline(story);\n            case 3:\n              return _context4.abrupt("return", {\n                success: true,\n                story: story\n              });\n            case 4:\n              _context4.prev = 4;\n              _t5 = _context4["catch"](0);\n              console.error("Failed to save offline story:", _t5);\n              return _context4.abrupt("return", {\n                success: false,\n                error: _t5\n              });\n            case 5:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 4]]);\n      }));\n      function addStoryOffline(_x3) {\n        return _addStoryOffline2.apply(this, arguments);\n      }\n      return addStoryOffline;\n    }()\n  }, {\n    key: "syncOfflineStories",\n    value: function () {\n      var _syncOfflineStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(syncQueue) {\n        var offlineStories, token, toSync, syncedIds, _iterator, _step, story, photoBlob, response, _t6, _t7, _t8, _t9;\n        return regenerator_default().wrap(function (_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 1;\n              return this.getOfflineStories();\n            case 1:\n              offlineStories = _context5.sent;\n              token = this.authModel.getToken();\n              if (token) {\n                _context5.next = 2;\n                break;\n              }\n              console.log("No auth token - skipping sync");\n              return _context5.abrupt("return", {\n                success: false,\n                error: "Authentication required"\n              });\n            case 2:\n              toSync = offlineStories.sort(function (a, b) {\n                return new Date(a.createdAt) - new Date(b.createdAt);\n              }).filter(function (story) {\n                return syncQueue.has(story.id);\n              });\n              if (!(toSync.length === 0)) {\n                _context5.next = 3;\n                break;\n              }\n              console.log("No stories to sync");\n              return _context5.abrupt("return", {\n                success: true,\n                syncedIds: []\n              });\n            case 3:\n              syncedIds = [];\n              _iterator = _createForOfIteratorHelper(toSync);\n              _context5.prev = 4;\n              _iterator.s();\n            case 5:\n              if ((_step = _iterator.n()).done) {\n                _context5.next = 15;\n                break;\n              }\n              story = _step.value;\n              _context5.prev = 6;\n              if (!story.photoBase64) {\n                _context5.next = 8;\n                break;\n              }\n              _context5.next = 7;\n              return this.base64ToBlob(story.photoBase64);\n            case 7:\n              _t6 = _context5.sent;\n              _context5.next = 9;\n              break;\n            case 8:\n              _t6 = story.originalPhoto;\n            case 9:\n              photoBlob = _t6;\n              _context5.next = 10;\n              return api_addStory({\n                description: story.description,\n                photo: photoBlob,\n                lat: story.lat,\n                lon: story.lon\n              }, token);\n            case 10:\n              response = _context5.sent;\n              if (response.error) {\n                _context5.next = 12;\n                break;\n              }\n              _context5.next = 11;\n              return database_deleteStoryOffline(story.id);\n            case 11:\n              syncedIds.push(story.id);\n            case 12:\n              _context5.next = 14;\n              break;\n            case 13:\n              _context5.prev = 13;\n              _t7 = _context5["catch"](6);\n              console.error("Failed to sync ".concat(story.id, ":"), _t7);\n            case 14:\n              _context5.next = 5;\n              break;\n            case 15:\n              _context5.next = 17;\n              break;\n            case 16:\n              _context5.prev = 16;\n              _t8 = _context5["catch"](4);\n              _iterator.e(_t8);\n            case 17:\n              _context5.prev = 17;\n              _iterator.f();\n              return _context5.finish(17);\n            case 18:\n              return _context5.abrupt("return", {\n                success: syncedIds.length > 0,\n                syncedIds: syncedIds\n              });\n            case 19:\n              _context5.prev = 19;\n              _t9 = _context5["catch"](0);\n              console.error("Sync error:", _t9);\n              return _context5.abrupt("return", {\n                success: false,\n                error: _t9\n              });\n            case 20:\n            case "end":\n              return _context5.stop();\n          }\n        }, _callee5, this, [[0, 19], [4, 16, 17, 18], [6, 13]]);\n      }));\n      function syncOfflineStories(_x4) {\n        return _syncOfflineStories.apply(this, arguments);\n      }\n      return syncOfflineStories;\n    }()\n  }, {\n    key: "bookmarkStory",\n    value: function () {\n      var _bookmarkStory = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(storyId) {\n        var isAlreadyBookmarked, success, _t0;\n        return regenerator_default().wrap(function (_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.prev = 0;\n              _context6.next = 1;\n              return isBookmarked(storyId);\n            case 1:\n              isAlreadyBookmarked = _context6.sent;\n              if (!isAlreadyBookmarked) {\n                _context6.next = 2;\n                break;\n              }\n              return _context6.abrupt("return", {\n                success: false,\n                message: "Story already bookmarked"\n              });\n            case 2:\n              _context6.next = 3;\n              return addBookmark(storyId);\n            case 3:\n              success = _context6.sent;\n              return _context6.abrupt("return", {\n                success: success,\n                message: success ? "Story bookmarked successfully" : "Failed to bookmark story"\n              });\n            case 4:\n              _context6.prev = 4;\n              _t0 = _context6["catch"](0);\n              console.error("Bookmark error:", _t0);\n              return _context6.abrupt("return", {\n                success: false,\n                message: _t0.message || "Failed to bookmark story"\n              });\n            case 5:\n            case "end":\n              return _context6.stop();\n          }\n        }, _callee6, null, [[0, 4]]);\n      }));\n      function bookmarkStory(_x5) {\n        return _bookmarkStory.apply(this, arguments);\n      }\n      return bookmarkStory;\n    }()\n  }, {\n    key: "unbookmarkStory",\n    value: function () {\n      var _unbookmarkStory = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(storyId) {\n        var success, _t1;\n        return regenerator_default().wrap(function (_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.prev = 0;\n              _context7.next = 1;\n              return removeBookmark(storyId);\n            case 1:\n              success = _context7.sent;\n              return _context7.abrupt("return", {\n                success: success,\n                message: success ? "Story removed from bookmarks" : "Failed to remove bookmark"\n              });\n            case 2:\n              _context7.prev = 2;\n              _t1 = _context7["catch"](0);\n              console.error("Unbookmark error:", _t1);\n              return _context7.abrupt("return", {\n                success: false,\n                message: _t1.message || "Failed to remove bookmark"\n              });\n            case 3:\n            case "end":\n              return _context7.stop();\n          }\n        }, _callee7, null, [[0, 2]]);\n      }));\n      function unbookmarkStory(_x6) {\n        return _unbookmarkStory.apply(this, arguments);\n      }\n      return unbookmarkStory;\n    }()\n  }, {\n    key: "toggleBookmark",\n    value: function () {\n      var _toggleBookmark = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(storyId) {\n        var currentlyBookmarked, _t10;\n        return regenerator_default().wrap(function (_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.prev = 0;\n              _context8.next = 1;\n              return isBookmarked(storyId);\n            case 1:\n              currentlyBookmarked = _context8.sent;\n              if (!currentlyBookmarked) {\n                _context8.next = 3;\n                break;\n              }\n              _context8.next = 2;\n              return this.unbookmarkStory(storyId);\n            case 2:\n              return _context8.abrupt("return", _context8.sent);\n            case 3:\n              _context8.next = 4;\n              return this.bookmarkStory(storyId);\n            case 4:\n              return _context8.abrupt("return", _context8.sent);\n            case 5:\n              _context8.next = 7;\n              break;\n            case 6:\n              _context8.prev = 6;\n              _t10 = _context8["catch"](0);\n              console.error("Toggle bookmark error:", _t10);\n              return _context8.abrupt("return", {\n                success: false,\n                message: _t10.message || "Failed to toggle bookmark"\n              });\n            case 7:\n            case "end":\n              return _context8.stop();\n          }\n        }, _callee8, this, [[0, 6]]);\n      }));\n      function toggleBookmark(_x7) {\n        return _toggleBookmark.apply(this, arguments);\n      }\n      return toggleBookmark;\n    }()\n  }, {\n    key: "getBookmarkedStories",\n    value: function () {\n      var _getBookmarkedStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee0() {\n        var _yield$this$getAllSto, stories, bookmarkedStories, _t16;\n        return regenerator_default().wrap(function (_context0) {\n          while (1) switch (_context0.prev = _context0.next) {\n            case 0:\n              _context0.prev = 0;\n              _context0.next = 1;\n              return this.getAllStories();\n            case 1:\n              _yield$this$getAllSto = _context0.sent;\n              stories = _yield$this$getAllSto.stories;\n              _context0.next = 2;\n              return Promise.all(stories.map(/*#__PURE__*/function () {\n                var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee9(story) {\n                  var _t11, _t12, _t13, _t14, _t15;\n                  return regenerator_default().wrap(function (_context9) {\n                    while (1) switch (_context9.prev = _context9.next) {\n                      case 0:\n                        _t11 = StoryModel_objectSpread;\n                        _t12 = StoryModel_objectSpread({}, story);\n                        _t13 = {};\n                        _context9.next = 1;\n                        return isBookmarked(story.id);\n                      case 1:\n                        _t14 = _context9.sent;\n                        _t15 = {\n                          isBookmarked: _t14\n                        };\n                        return _context9.abrupt("return", _t11(_t12, _t13, _t15));\n                      case 2:\n                      case "end":\n                        return _context9.stop();\n                    }\n                  }, _callee9);\n                }));\n                return function (_x8) {\n                  return _ref.apply(this, arguments);\n                };\n              }()));\n            case 2:\n              bookmarkedStories = _context0.sent;\n              return _context0.abrupt("return", {\n                success: true,\n                stories: bookmarkedStories.filter(function (s) {\n                  return s.isBookmarked;\n                }),\n                message: "Bookmarked stories loaded"\n              });\n            case 3:\n              _context0.prev = 3;\n              _t16 = _context0["catch"](0);\n              console.error("Get bookmarks error:", _t16);\n              return _context0.abrupt("return", {\n                success: false,\n                stories: [],\n                message: "Failed to load bookmarked stories"\n              });\n            case 4:\n            case "end":\n              return _context0.stop();\n          }\n        }, _callee0, this, [[0, 3]]);\n      }));\n      function getBookmarkedStories() {\n        return _getBookmarkedStories.apply(this, arguments);\n      }\n      return getBookmarkedStories;\n    }()\n  }, {\n    key: "checkIfBookmarked",\n    value: function () {\n      var _checkIfBookmarked = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee1(storyId) {\n        var bookmarked, _t17;\n        return regenerator_default().wrap(function (_context1) {\n          while (1) switch (_context1.prev = _context1.next) {\n            case 0:\n              _context1.prev = 0;\n              _context1.next = 1;\n              return isBookmarked(storyId);\n            case 1:\n              bookmarked = _context1.sent;\n              return _context1.abrupt("return", {\n                success: true,\n                bookmarked: bookmarked,\n                message: bookmarked ? "Story is bookmarked" : "Story is not bookmarked"\n              });\n            case 2:\n              _context1.prev = 2;\n              _t17 = _context1["catch"](0);\n              console.error("Check bookmark error:", _t17);\n              return _context1.abrupt("return", {\n                success: false,\n                bookmarked: false,\n                message: _t17.message || "Failed to check bookmark status"\n              });\n            case 3:\n            case "end":\n              return _context1.stop();\n          }\n        }, _callee1, null, [[0, 2]]);\n      }));\n      function checkIfBookmarked(_x9) {\n        return _checkIfBookmarked.apply(this, arguments);\n      }\n      return checkIfBookmarked;\n    }()\n  }, {\n    key: "readFileAsBase64",\n    value: function readFileAsBase64(file) {\n      return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          return resolve(reader.result);\n        };\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n      });\n    }\n  }, {\n    key: "base64ToBlob",\n    value: function () {\n      var _base64ToBlob = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee10(base64) {\n        var response;\n        return regenerator_default().wrap(function (_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              _context10.next = 1;\n              return fetch(base64);\n            case 1:\n              response = _context10.sent;\n              _context10.next = 2;\n              return response.blob();\n            case 2:\n              return _context10.abrupt("return", _context10.sent);\n            case 3:\n            case "end":\n              return _context10.stop();\n          }\n        }, _callee10);\n      }));\n      function base64ToBlob(_x0) {\n        return _base64ToBlob.apply(this, arguments);\n      }\n      return base64ToBlob;\n    }()\n  }, {\n    key: "getOfflineStories",\n    value: function () {\n      var _getOfflineStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee11() {\n        var allStories;\n        return regenerator_default().wrap(function (_context11) {\n          while (1) switch (_context11.prev = _context11.next) {\n            case 0:\n              _context11.next = 1;\n              return getStories();\n            case 1:\n              allStories = _context11.sent;\n              return _context11.abrupt("return", allStories.filter(function (story) {\n                return story.isOffline;\n              }));\n            case 2:\n            case "end":\n              return _context11.stop();\n          }\n        }, _callee11);\n      }));\n      function getOfflineStories() {\n        return _getOfflineStories.apply(this, arguments);\n      }\n      return getOfflineStories;\n    }()\n  }, {\n    key: "deleteStoryOffline",\n    value: function () {\n      var _deleteStoryOffline2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee12(id) {\n        return regenerator_default().wrap(function (_context12) {\n          while (1) switch (_context12.prev = _context12.next) {\n            case 0:\n              _context12.next = 1;\n              return database_deleteStoryOffline(id);\n            case 1:\n              return _context12.abrupt("return", _context12.sent);\n            case 2:\n            case "end":\n              return _context12.stop();\n          }\n        }, _callee12);\n      }));\n      function deleteStoryOffline(_x1) {\n        return _deleteStoryOffline2.apply(this, arguments);\n      }\n      return deleteStoryOffline;\n    }()\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.function.bind.js\nvar es_function_bind = __webpack_require__(4170);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array-buffer.constructor.js\nvar es_array_buffer_constructor = __webpack_require__(4743);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array-buffer.slice.js\nvar es_array_buffer_slice = __webpack_require__(1745);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.data-view.js\nvar es_data_view = __webpack_require__(8309);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.repeat.js\nvar es_string_repeat = __webpack_require__(2781);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.replace.js\nvar es_string_replace = __webpack_require__(5440);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.uint8-array.js\nvar es_typed_array_uint8_array = __webpack_require__(1489);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.copy-within.js\nvar es_typed_array_copy_within = __webpack_require__(1630);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.every.js\nvar es_typed_array_every = __webpack_require__(2170);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.fill.js\nvar es_typed_array_fill = __webpack_require__(5044);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.filter.js\nvar es_typed_array_filter = __webpack_require__(1920);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.find.js\nvar es_typed_array_find = __webpack_require__(1694);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.find-index.js\nvar es_typed_array_find_index = __webpack_require__(9955);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.for-each.js\nvar es_typed_array_for_each = __webpack_require__(3206);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.includes.js\nvar es_typed_array_includes = __webpack_require__(4496);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.index-of.js\nvar es_typed_array_index_of = __webpack_require__(6651);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.iterator.js\nvar es_typed_array_iterator = __webpack_require__(2887);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.join.js\nvar es_typed_array_join = __webpack_require__(9369);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.last-index-of.js\nvar es_typed_array_last_index_of = __webpack_require__(6812);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.map.js\nvar es_typed_array_map = __webpack_require__(8995);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reduce.js\nvar es_typed_array_reduce = __webpack_require__(1575);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reduce-right.js\nvar es_typed_array_reduce_right = __webpack_require__(6072);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reverse.js\nvar es_typed_array_reverse = __webpack_require__(8747);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.set.js\nvar es_typed_array_set = __webpack_require__(8845);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.slice.js\nvar es_typed_array_slice = __webpack_require__(9423);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.some.js\nvar es_typed_array_some = __webpack_require__(7301);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.sort.js\nvar es_typed_array_sort = __webpack_require__(373);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.subarray.js\nvar es_typed_array_subarray = __webpack_require__(6614);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.to-locale-string.js\nvar es_typed_array_to_locale_string = __webpack_require__(1405);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.to-string.js\nvar es_typed_array_to_string = __webpack_require__(3684);\n;// ./src/utils/config.js\nvar VAPID_PUBLIC_KEY = "BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk";\n;// ./src/utils/notification.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar requestNotificationPermission = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n    var permission;\n    return regenerator_default().wrap(function (_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if ("Notification" in window) {\n            _context.next = 1;\n            break;\n          }\n          console.log("This browser does not support notifications.");\n          return _context.abrupt("return", false);\n        case 1:\n          if (!(Notification.permission === "granted")) {\n            _context.next = 2;\n            break;\n          }\n          return _context.abrupt("return", true);\n        case 2:\n          _context.next = 3;\n          return Notification.requestPermission();\n        case 3:\n          permission = _context.sent;\n          return _context.abrupt("return", permission === "granted");\n        case 4:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function requestNotificationPermission() {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar subscribeUser = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(token) {\n    var registration, subscription, result, _t;\n    return regenerator_default().wrap(function (_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          if ("serviceWorker" in navigator) {\n            _context2.next = 1;\n            break;\n          }\n          console.log("Service Worker not supported");\n          return _context2.abrupt("return", null);\n        case 1:\n          _context2.next = 2;\n          return navigator.serviceWorker.ready;\n        case 2:\n          registration = _context2.sent;\n          _context2.next = 3;\n          return registration.pushManager.getSubscription();\n        case 3:\n          subscription = _context2.sent;\n          if (subscription) {\n            _context2.next = 11;\n            break;\n          }\n          _context2.prev = 4;\n          _context2.next = 5;\n          return registration.pushManager.subscribe({\n            userVisibleOnly: true,\n            applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n          });\n        case 5:\n          subscription = _context2.sent;\n          _context2.next = 6;\n          return subscribeToNotifications({\n            endpoint: subscription.endpoint,\n            keys: {\n              p256dh: arrayBufferToBase64(subscription.getKey(\'p256dh\')),\n              auth: arrayBufferToBase64(subscription.getKey(\'auth\'))\n            }\n          }, token);\n        case 6:\n          result = _context2.sent;\n          if (result.error) {\n            _context2.next = 7;\n            break;\n          }\n          console.log("User is subscribed.");\n          return _context2.abrupt("return", subscription);\n        case 7:\n          console.error("Subscription failed:", result.message);\n          _context2.next = 8;\n          return subscription.unsubscribe();\n        case 8:\n          return _context2.abrupt("return", null);\n        case 9:\n          _context2.next = 11;\n          break;\n        case 10:\n          _context2.prev = 10;\n          _t = _context2["catch"](4);\n          console.error("Error subscribing user:", _t);\n          return _context2.abrupt("return", null);\n        case 11:\n          return _context2.abrupt("return", subscription);\n        case 12:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[4, 10]]);\n  }));\n  return function subscribeUser(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar unsubscribeUser = /*#__PURE__*/function () {\n  var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(token) {\n    var registration, subscription, result, _t2;\n    return regenerator_default().wrap(function (_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 1;\n          return navigator.serviceWorker.ready;\n        case 1:\n          registration = _context3.sent;\n          _context3.next = 2;\n          return registration.pushManager.getSubscription();\n        case 2:\n          subscription = _context3.sent;\n          if (!subscription) {\n            _context3.next = 8;\n            break;\n          }\n          _context3.prev = 3;\n          _context3.next = 4;\n          return unsubscribeFromNotifications(subscription.endpoint, token);\n        case 4:\n          result = _context3.sent;\n          if (result.error) {\n            _context3.next = 6;\n            break;\n          }\n          _context3.next = 5;\n          return subscription.unsubscribe();\n        case 5:\n          console.log("User is unsubscribed.");\n          return _context3.abrupt("return", true);\n        case 6:\n          return _context3.abrupt("return", false);\n        case 7:\n          _context3.prev = 7;\n          _t2 = _context3["catch"](3);\n          console.error("Error unsubscribing user:", _t2);\n          return _context3.abrupt("return", false);\n        case 8:\n          return _context3.abrupt("return", false);\n        case 9:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[3, 7]]);\n  }));\n  return function unsubscribeUser(_x2) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nvar showNotificationPrompt = /*#__PURE__*/function () {\n  var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(callback) {\n    var permission;\n    return regenerator_default().wrap(function (_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          if ("Notification" in window) {\n            _context4.next = 1;\n            break;\n          }\n          console.log("This browser does not support notifications.");\n          if (callback) callback(false);\n          return _context4.abrupt("return", false);\n        case 1:\n          if (!(Notification.permission === "granted")) {\n            _context4.next = 2;\n            break;\n          }\n          if (callback) callback(true);\n          return _context4.abrupt("return", true);\n        case 2:\n          if (!(Notification.permission === "denied")) {\n            _context4.next = 3;\n            break;\n          }\n          console.log("Notification permission has been denied.");\n          if (callback) callback(false);\n          return _context4.abrupt("return", false);\n        case 3:\n          if (!(Notification.permission === "default")) {\n            _context4.next = 5;\n            break;\n          }\n          _context4.next = 4;\n          return Notification.requestPermission();\n        case 4:\n          permission = _context4.sent;\n          if (callback) callback(permission === "granted");\n          return _context4.abrupt("return", permission === "granted");\n        case 5:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return function showNotificationPrompt(_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nvar showNotification = function showNotification(message) {\n  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n  var _options$type = options.type,\n    type = _options$type === void 0 ? \'info\' : _options$type,\n    _options$autoClose = options.autoClose,\n    autoClose = _options$autoClose === void 0 ? 3000 : _options$autoClose;\n  var notification = document.createElement(\'div\');\n  notification.className = "notification notification-".concat(type);\n  notification.textContent = message;\n  notification.setAttribute(\'role\', \'alert\');\n  document.body.appendChild(notification);\n  if (autoClose) {\n    setTimeout(function () {\n      notification.classList.add(\'fade-out\');\n      setTimeout(function () {\n        return notification.remove();\n      }, 300);\n    }, autoClose);\n  }\n  return notification;\n};\nfunction urlBase64ToUint8Array(base64String) {\n  var padding = \'=\'.repeat((4 - base64String.length % 4) % 4);\n  var base64 = (base64String + padding).replace(/-/g, \'+\').replace(/_/g, \'/\');\n  var rawData = atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\nfunction arrayBufferToBase64(buffer) {\n  var binary = \'\';\n  var bytes = new Uint8Array(buffer);\n  for (var i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return btoa(binary);\n}\n;// ./src/presenters/AuthPresenter.js\n\n\n\n\n\n\n\nvar AuthPresenter = /*#__PURE__*/function () {\n  function AuthPresenter(authModel, authView, router) {\n    (0,classCallCheck/* default */.A)(this, AuthPresenter);\n    this.authModel = authModel;\n    this.authView = authView;\n    this.router = router;\n\n    // Initialize UI state\n    updateAuthUI(this.authModel.isAuthenticated());\n    if (authView.bindLogin) {\n      authView.bindLogin(this.handleLogin.bind(this));\n    }\n    if (authView.bindRegister) {\n      authView.bindRegister(this.handleRegister.bind(this));\n    }\n  }\n  return (0,createClass/* default */.A)(AuthPresenter, [{\n    key: "handleLogin",\n    value: function () {\n      var _handleLogin = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(email, password) {\n        var result, notificationPromise, _this$authView$showEr, _this$authView, _this$authView$showEr2, _this$authView2, _t2;\n        return regenerator_default().wrap(function (_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 1;\n              return this.authModel.login(email, password);\n            case 1:\n              result = _context2.sent;\n              if (!result.success) {\n                _context2.next = 3;\n                break;\n              }\n              updateAuthUI(true); // Update UI state immediately\n\n              // Start both operations but don\'t await notification setup\n              notificationPromise = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n                var permissionGranted, _t;\n                return regenerator_default().wrap(function (_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.prev = 0;\n                      _context.next = 1;\n                      return requestNotificationPermission();\n                    case 1:\n                      permissionGranted = _context.sent;\n                      if (!permissionGranted) {\n                        _context.next = 2;\n                        break;\n                      }\n                      _context.next = 2;\n                      return subscribeUser(result.token);\n                    case 2:\n                      _context.next = 4;\n                      break;\n                    case 3:\n                      _context.prev = 3;\n                      _t = _context["catch"](0);\n                      console.error("Notification error:", _t);\n                    case 4:\n                    case "end":\n                      return _context.stop();\n                  }\n                }, _callee, null, [[0, 3]]);\n              }))(); // Navigate immediately without waiting for notifications\n              this.router.navigateTo("/stories");\n\n              // Let notifications complete in background\n              _context2.next = 2;\n              return notificationPromise;\n            case 2:\n              _context2.next = 4;\n              break;\n            case 3:\n              (_this$authView$showEr = (_this$authView = this.authView).showError) === null || _this$authView$showEr === void 0 || _this$authView$showEr.call(_this$authView, result.message);\n            case 4:\n              _context2.next = 6;\n              break;\n            case 5:\n              _context2.prev = 5;\n              _t2 = _context2["catch"](0);\n              (_this$authView$showEr2 = (_this$authView2 = this.authView).showError) === null || _this$authView$showEr2 === void 0 || _this$authView$showEr2.call(_this$authView2, _t2.message);\n            case 6:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 5]]);\n      }));\n      function handleLogin(_x, _x2) {\n        return _handleLogin.apply(this, arguments);\n      }\n      return handleLogin;\n    }()\n  }, {\n    key: "handleLogout",\n    value: function () {\n      var _handleLogout = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n        var token, _t3;\n        return regenerator_default().wrap(function (_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              // Unsubscribe from notifications before logout\n              token = this.authModel.getToken();\n              if (!token) {\n                _context3.next = 1;\n                break;\n              }\n              _context3.next = 1;\n              return unsubscribeUser(token);\n            case 1:\n              _context3.next = 3;\n              break;\n            case 2:\n              _context3.prev = 2;\n              _t3 = _context3["catch"](0);\n              console.error("Error unsubscribing:", _t3);\n            case 3:\n              _context3.prev = 3;\n              this.authModel.logout();\n              updateAuthUI(false);\n              this.router.navigateTo("/login");\n              return _context3.finish(3);\n            case 4:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[0, 2, 3, 4]]);\n      }));\n      function handleLogout() {\n        return _handleLogout.apply(this, arguments);\n      }\n      return handleLogout;\n    }()\n  }, {\n    key: "handleRegister",\n    value: function () {\n      var _handleRegister = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(name, email, password) {\n        var result, _this$authView$showSu, _this$authView3, _this$authView$showEr3, _this$authView4, _this$authView$showEr4, _this$authView5, _t4;\n        return regenerator_default().wrap(function (_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 1;\n              return this.authModel.register(name, email, password);\n            case 1:\n              result = _context4.sent;\n              if (result.success) {\n                (_this$authView$showSu = (_this$authView3 = this.authView).showSuccess) === null || _this$authView$showSu === void 0 || _this$authView$showSu.call(_this$authView3, "Registration successful. Please login.");\n                this.router.navigateTo("/login");\n              } else {\n                (_this$authView$showEr3 = (_this$authView4 = this.authView).showError) === null || _this$authView$showEr3 === void 0 || _this$authView$showEr3.call(_this$authView4, result.message);\n              }\n              _context4.next = 3;\n              break;\n            case 2:\n              _context4.prev = 2;\n              _t4 = _context4["catch"](0);\n              (_this$authView$showEr4 = (_this$authView5 = this.authView).showError) === null || _this$authView$showEr4 === void 0 || _this$authView$showEr4.call(_this$authView5, _t4.message);\n            case 3:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 2]]);\n      }));\n      function handleRegister(_x3, _x4, _x5) {\n        return _handleRegister.apply(this, arguments);\n      }\n      return handleRegister;\n    }()\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.set.js\nvar es_set = __webpack_require__(1415);\n;// ./src/presenters/StoryPresenter.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar StoryPresenter = /*#__PURE__*/function () {\n  function StoryPresenter(storyModel, storyView, router) {\n    var _this$loadOfflineStor;\n    (0,classCallCheck/* default */.A)(this, StoryPresenter);\n    this.storyModel = storyModel;\n    this.storyView = storyView;\n    this.router = router;\n    this.currentStoryId = null;\n    this.isLoading = false;\n    this.showBookmarksOnly = false;\n    this.isSyncing = false;\n    this.syncQueue = new Set();\n    this.initializeEventBindings();\n    this.initializeSyncHandlers();\n    (_this$loadOfflineStor = this.loadOfflineStoriesIntoQueue) === null || _this$loadOfflineStor === void 0 || _this$loadOfflineStor.call(this);\n  }\n  return (0,createClass/* default */.A)(StoryPresenter, [{\n    key: "initializeEventBindings",\n    value: function initializeEventBindings() {\n      if (this.storyView.bindLoadStories) {\n        this.storyView.bindLoadStories(this.handleLoadStories.bind(this));\n      }\n      if (this.storyView.bindAddStory) {\n        this.storyView.bindAddStory(this.handleAddStory.bind(this));\n      }\n      if (this.storyView.bindLoadStoryDetail) {\n        this.storyView.bindLoadStoryDetail(this.handleLoadStoryDetail.bind(this));\n      }\n      if (this.storyView.bindToggleBookmarkFilter) {\n        this.storyView.bindToggleBookmarkFilter(this.toggleBookmarkFilter.bind(this));\n      }\n      if (this.storyView.bindBookmarkAction) {\n        this.storyView.bindBookmarkAction(this.handleBookmarkAction.bind(this));\n      }\n    }\n  }, {\n    key: "initializeSyncHandlers",\n    value: function initializeSyncHandlers() {\n      var _this = this;\n      window.addEventListener("online", function () {\n        return _this.handleOnline();\n      });\n      window.addEventListener("focus", function () {\n        if (navigator.onLine) {\n          _this.handleOnline();\n        }\n      });\n    }\n  }, {\n    key: "loadOfflineStoriesIntoQueue",\n    value: function loadOfflineStoriesIntoQueue() {\n      console.log("Offline sync queue loaded (stub)");\n    }\n  }, {\n    key: "toggleBookmarkFilter",\n    value: function () {\n      var _toggleBookmarkFilter = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var result, _t, _t2;\n        return regenerator_default().wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              this.showBookmarksOnly = !this.showBookmarksOnly;\n              _context.prev = 1;\n              if (!this.showBookmarksOnly) {\n                _context.next = 3;\n                break;\n              }\n              _context.next = 2;\n              return this.storyModel.getBookmarkedStories();\n            case 2:\n              _t = _context.sent;\n              _context.next = 5;\n              break;\n            case 3:\n              _context.next = 4;\n              return this.storyModel.getAllStories();\n            case 4:\n              _t = _context.sent;\n            case 5:\n              result = _t;\n              if (result.success) {\n                this.storyView.displayStories(result.stories);\n                if (typeof this.storyView.updateBookmarkFilterState === "function") {\n                  this.storyView.updateBookmarkFilterState(this.showBookmarksOnly);\n                }\n                showNotification(this.showBookmarksOnly ? "Showing bookmarked stories" : "Showing all stories", {\n                  type: "info",\n                  autoClose: 2000\n                });\n              } else {\n                showNotification(result.message || "Failed to load stories", {\n                  type: "error"\n                });\n              }\n              _context.next = 7;\n              break;\n            case 6:\n              _context.prev = 6;\n              _t2 = _context["catch"](1);\n              console.error("Bookmark filter error:", _t2);\n              showNotification("Failed to toggle bookmark filter", {\n                type: "error"\n              });\n            case 7:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[1, 6]]);\n      }));\n      function toggleBookmarkFilter() {\n        return _toggleBookmarkFilter.apply(this, arguments);\n      }\n      return toggleBookmarkFilter;\n    }()\n  }, {\n    key: "handleBookmarkAction",\n    value: function () {\n      var _handleBookmarkAction = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(storyId) {\n        var _yield$this$storyMode, success, message, _yield$this$storyMode2, _success, stories, _t3;\n        return regenerator_default().wrap(function (_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 1;\n              return this.storyModel.toggleBookmark(storyId);\n            case 1:\n              _yield$this$storyMode = _context2.sent;\n              success = _yield$this$storyMode.success;\n              message = _yield$this$storyMode.message;\n              if (!success) {\n                _context2.next = 4;\n                break;\n              }\n              if (!this.showBookmarksOnly) {\n                _context2.next = 3;\n                break;\n              }\n              _context2.next = 2;\n              return this.storyModel.getBookmarkedStories();\n            case 2:\n              _yield$this$storyMode2 = _context2.sent;\n              _success = _yield$this$storyMode2.success;\n              stories = _yield$this$storyMode2.stories;\n              if (_success) {\n                this.storyView.displayStories(stories);\n              }\n            case 3:\n              showNotification(message, {\n                type: "success",\n                autoClose: 2000\n              });\n              _context2.next = 5;\n              break;\n            case 4:\n              showNotification(message || "Failed to update bookmark", {\n                type: "error"\n              });\n            case 5:\n              _context2.next = 7;\n              break;\n            case 6:\n              _context2.prev = 6;\n              _t3 = _context2["catch"](0);\n              console.error("Bookmark action error:", _t3);\n              showNotification("Failed to update bookmark", {\n                type: "error"\n              });\n            case 7:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 6]]);\n      }));\n      function handleBookmarkAction(_x) {\n        return _handleBookmarkAction.apply(this, arguments);\n      }\n      return handleBookmarkAction;\n    }()\n  }, {\n    key: "handleLoadStories",\n    value: function () {\n      var _handleLoadStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n        var page,\n          size,\n          result,\n          _this$storyView$showO,\n          _this$storyView,\n          _this$storyView$showE,\n          _this$storyView2,\n          _this$storyView$showE2,\n          _this$storyView3,\n          _args3 = arguments,\n          _t4,\n          _t5;\n        return regenerator_default().wrap(function (_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              page = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : 1;\n              size = _args3.length > 1 && _args3[1] !== undefined ? _args3[1] : 10;\n              _context3.prev = 1;\n              if (!this.showBookmarksOnly) {\n                _context3.next = 3;\n                break;\n              }\n              _context3.next = 2;\n              return this.storyModel.getBookmarkedStories();\n            case 2:\n              _t4 = _context3.sent;\n              _context3.next = 5;\n              break;\n            case 3:\n              _context3.next = 4;\n              return this.storyModel.getAllStories(page, size);\n            case 4:\n              _t4 = _context3.sent;\n            case 5:\n              result = _t4;\n              if (result.isOffline) {\n                (_this$storyView$showO = (_this$storyView = this.storyView).showOfflineWarning) === null || _this$storyView$showO === void 0 || _this$storyView$showO.call(_this$storyView);\n              }\n              if (result.success) {\n                this.storyView.displayStories(result.stories || []);\n              } else {\n                (_this$storyView$showE = (_this$storyView2 = this.storyView).showError) === null || _this$storyView$showE === void 0 || _this$storyView$showE.call(_this$storyView2, result.message || "Failed to load stories");\n              }\n              _context3.next = 7;\n              break;\n            case 6:\n              _context3.prev = 6;\n              _t5 = _context3["catch"](1);\n              console.error("Load stories error:", _t5);\n              (_this$storyView$showE2 = (_this$storyView3 = this.storyView).showError) === null || _this$storyView$showE2 === void 0 || _this$storyView$showE2.call(_this$storyView3, "Failed to load stories. Please try again.");\n            case 7:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[1, 6]]);\n      }));\n      function handleLoadStories() {\n        return _handleLoadStories.apply(this, arguments);\n      }\n      return handleLoadStories;\n    }()\n  }, {\n    key: "handleLoadStoryDetail",\n    value: function () {\n      var _handleLoadStoryDetail = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(id) {\n        var _this$storyView$prepa, _this$storyView4, result, _this$storyView$displ, _this$storyView5, _this$storyView$showE3, _this$storyView6, _this$storyView$showE4, _this$storyView7, _t6;\n        return regenerator_default().wrap(function (_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              if (!(this.isLoading || this.currentStoryId === id)) {\n                _context4.next = 1;\n                break;\n              }\n              return _context4.abrupt("return");\n            case 1:\n              this.isLoading = true;\n              this.currentStoryId = id;\n              (_this$storyView$prepa = (_this$storyView4 = this.storyView).prepareMapContainer) === null || _this$storyView$prepa === void 0 || _this$storyView$prepa.call(_this$storyView4);\n              _context4.next = 2;\n              return this.storyModel.getStoryDetail(id);\n            case 2:\n              result = _context4.sent;\n              if (!result.success) {\n                _context4.next = 4;\n                break;\n              }\n              _context4.next = 3;\n              return new Promise(function (resolve) {\n                return requestAnimationFrame(resolve);\n              });\n            case 3:\n              (_this$storyView$displ = (_this$storyView5 = this.storyView).displayStoryDetail) === null || _this$storyView$displ === void 0 || _this$storyView$displ.call(_this$storyView5, result.story);\n              _context4.next = 5;\n              break;\n            case 4:\n              (_this$storyView$showE3 = (_this$storyView6 = this.storyView).showError) === null || _this$storyView$showE3 === void 0 || _this$storyView$showE3.call(_this$storyView6, result.message || "Story not found");\n              this.router.navigateTo("/stories");\n            case 5:\n              _context4.next = 7;\n              break;\n            case 6:\n              _context4.prev = 6;\n              _t6 = _context4["catch"](0);\n              console.error("Load story detail error:", _t6);\n              (_this$storyView$showE4 = (_this$storyView7 = this.storyView).showError) === null || _this$storyView$showE4 === void 0 || _this$storyView$showE4.call(_this$storyView7, "Failed to load story details");\n              this.router.navigateTo("/stories");\n            case 7:\n              _context4.prev = 7;\n              this.isLoading = false;\n              return _context4.finish(7);\n            case 8:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 6, 7, 8]]);\n      }));\n      function handleLoadStoryDetail(_x2) {\n        return _handleLoadStoryDetail.apply(this, arguments);\n      }\n      return handleLoadStoryDetail;\n    }()\n  }, {\n    key: "handleAddStory",\n    value: function () {\n      var _handleAddStory = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(data) {\n        var _this2 = this;\n        var result, _this$storyView$showS, _this$storyView8, _this$storyView$showE5, _this$storyView9, _t7;\n        return regenerator_default().wrap(function (_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 1;\n              return this.storyModel.addStory(data);\n            case 1:\n              result = _context5.sent;\n              if (!result.success) {\n                _context5.next = 3;\n                break;\n              }\n              (_this$storyView$showS = (_this$storyView8 = this.storyView).showSuccess) === null || _this$storyView$showS === void 0 || _this$storyView$showS.call(_this$storyView8, "Story added successfully!");\n              _context5.next = 2;\n              return showNotificationPrompt(function (granted) {\n                if (granted) {}\n              });\n            case 2:\n              this.cleanup();\n              setTimeout(function () {\n                _this2.handleLoadStories();\n                _this2.router.navigateTo("/stories");\n              }, 1500);\n              _context5.next = 6;\n              break;\n            case 3:\n              if (!(!result.success && !navigator.onLine)) {\n                _context5.next = 5;\n                break;\n              }\n              _context5.next = 4;\n              return this.handleOfflineAdd(data);\n            case 4:\n              _context5.next = 6;\n              break;\n            case 5:\n              (_this$storyView$showE5 = (_this$storyView9 = this.storyView).showError) === null || _this$storyView$showE5 === void 0 || _this$storyView$showE5.call(_this$storyView9, result.message || "Failed to add story");\n            case 6:\n              _context5.next = 8;\n              break;\n            case 7:\n              _context5.prev = 7;\n              _t7 = _context5["catch"](0);\n              this.handleAddError(_t7);\n            case 8:\n            case "end":\n              return _context5.stop();\n          }\n        }, _callee5, this, [[0, 7]]);\n      }));\n      function handleAddStory(_x3) {\n        return _handleAddStory.apply(this, arguments);\n      }\n      return handleAddStory;\n    }()\n  }, {\n    key: "handleOfflineAdd",\n    value: function () {\n      var _handleOfflineAdd = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(data) {\n        var _this3 = this;\n        var _this$storyView$showS2, _this$storyView0, offlineResult, _this$storyView$showE6, _this$storyView1, _t8;\n        return regenerator_default().wrap(function (_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.prev = 0;\n              _context6.next = 1;\n              return this.storyModel.addStoryOffline(data);\n            case 1:\n              offlineResult = _context6.sent;\n              this.syncQueue.add(offlineResult.story.id);\n              _context6.next = 2;\n              return showNotificationPrompt(function (granted) {\n                if (granted) {}\n              });\n            case 2:\n              (_this$storyView$showS2 = (_this$storyView0 = this.storyView).showSuccess) === null || _this$storyView$showS2 === void 0 || _this$storyView$showS2.call(_this$storyView0, "Story saved offline. Will sync when online!");\n              setTimeout(function () {\n                _this3.handleLoadStories();\n                _this3.router.navigateTo("/stories");\n              }, 1500);\n              _context6.next = 4;\n              break;\n            case 3:\n              _context6.prev = 3;\n              _t8 = _context6["catch"](0);\n              console.error("Offline save failed:", _t8);\n              (_this$storyView$showE6 = (_this$storyView1 = this.storyView).showError) === null || _this$storyView$showE6 === void 0 || _this$storyView$showE6.call(_this$storyView1, "Failed to save story offline.");\n            case 4:\n            case "end":\n              return _context6.stop();\n          }\n        }, _callee6, this, [[0, 3]]);\n      }));\n      function handleOfflineAdd(_x4) {\n        return _handleOfflineAdd.apply(this, arguments);\n      }\n      return handleOfflineAdd;\n    }()\n  }, {\n    key: "handleAddError",\n    value: function handleAddError(error) {\n      console.error("Add story error:", error);\n      if (!navigator.onLine) {\n        var _this$storyView$showE7, _this$storyView10;\n        (_this$storyView$showE7 = (_this$storyView10 = this.storyView).showError) === null || _this$storyView$showE7 === void 0 || _this$storyView$showE7.call(_this$storyView10, "You\'re offline. Please connect to submit stories.");\n      } else {\n        var _this$storyView$showE8, _this$storyView11;\n        (_this$storyView$showE8 = (_this$storyView11 = this.storyView).showError) === null || _this$storyView$showE8 === void 0 || _this$storyView$showE8.call(_this$storyView11, "Failed to add story. Please try again.");\n      }\n    }\n  }, {\n    key: "handleOnline",\n    value: function () {\n      var _handleOnline = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7() {\n        var _this4 = this;\n        var syncResult, _this$storyView$showS3, _this$storyView12, _t9;\n        return regenerator_default().wrap(function (_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              if (!(this.isSyncing || this.syncQueue.size === 0)) {\n                _context7.next = 1;\n                break;\n              }\n              return _context7.abrupt("return");\n            case 1:\n              this.isSyncing = true;\n              _context7.prev = 2;\n              _context7.next = 3;\n              return this.storyModel.syncOfflineStories(this.syncQueue);\n            case 3:\n              syncResult = _context7.sent;\n              if (syncResult.success && syncResult.syncedIds.length > 0) {\n                syncResult.syncedIds.forEach(function (id) {\n                  _this4.syncQueue["delete"](id);\n                });\n                (_this$storyView$showS3 = (_this$storyView12 = this.storyView).showSuccess) === null || _this$storyView$showS3 === void 0 || _this$storyView$showS3.call(_this$storyView12, "Synced ".concat(syncResult.syncedIds.length, " stories!"));\n                this.handleLoadStories();\n              }\n              _context7.next = 5;\n              break;\n            case 4:\n              _context7.prev = 4;\n              _t9 = _context7["catch"](2);\n              console.error("Sync failed:", _t9);\n            case 5:\n              _context7.prev = 5;\n              this.isSyncing = false;\n              if (this.syncQueue.size > 0) {\n                setTimeout(function () {\n                  return _this4.handleOnline();\n                }, 5000);\n              }\n              return _context7.finish(5);\n            case 6:\n            case "end":\n              return _context7.stop();\n          }\n        }, _callee7, this, [[2, 4, 5, 6]]);\n      }));\n      function handleOnline() {\n        return _handleOnline.apply(this, arguments);\n      }\n      return handleOnline;\n    }()\n  }, {\n    key: "cleanup",\n    value: function cleanup() {\n      var _this$storyView$clean, _this$storyView13;\n      (_this$storyView$clean = (_this$storyView13 = this.storyView).cleanup) === null || _this$storyView$clean === void 0 || _this$storyView$clean.call(_this$storyView13);\n      this.currentStoryId = null;\n      this.isLoading = false;\n      this.showBookmarksOnly = false;\n    }\n  }]);\n}();\n;// ./src/presenters/MapPresenter.js\n\n\n\n\n\n\nvar MapPresenter = /*#__PURE__*/function () {\n  function MapPresenter(mapView) {\n    (0,classCallCheck/* default */.A)(this, MapPresenter);\n    this.view = mapView;\n    this.currentPosition = null;\n  }\n  return (0,createClass/* default */.A)(MapPresenter, [{\n    key: "initializeMap",\n    value: function () {\n      var _initializeMap = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(containerId) {\n        var options,\n          _options$lat,\n          lat,\n          _options$lng,\n          lng,\n          _options$zoom,\n          zoom,\n          _args = arguments,\n          _t;\n        return regenerator_default().wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n              _context.prev = 1;\n              _options$lat = options.lat, lat = _options$lat === void 0 ? 0 : _options$lat, _options$lng = options.lng, lng = _options$lng === void 0 ? 0 : _options$lng, _options$zoom = options.zoom, zoom = _options$zoom === void 0 ? 10 : _options$zoom;\n              _context.next = 2;\n              return this.view.initMap(containerId, lat, lng, zoom);\n            case 2:\n              return _context.abrupt("return", true);\n            case 3:\n              _context.prev = 3;\n              _t = _context["catch"](1);\n              console.error(\'Map initialization failed:\', _t);\n              return _context.abrupt("return", false);\n            case 4:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[1, 3]]);\n      }));\n      function initializeMap(_x) {\n        return _initializeMap.apply(this, arguments);\n      }\n      return initializeMap;\n    }()\n  }, {\n    key: "getCurrentLocation",\n    value: function () {\n      var _getCurrentLocation = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n        var _this = this;\n        var options,\n          _args2 = arguments;\n        return regenerator_default().wrap(function (_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              options = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {};\n              return _context2.abrupt("return", new Promise(function (resolve, reject) {\n                if (!navigator.geolocation) {\n                  reject(new Error("Geolocation is not supported by your browser"));\n                  return;\n                }\n                navigator.geolocation.getCurrentPosition(function (position) {\n                  _this.currentPosition = {\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude,\n                    accuracy: position.coords.accuracy\n                  };\n                  resolve(_this.currentPosition);\n                }, function (error) {\n                  reject(error);\n                }, options);\n              }));\n            case 1:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      function getCurrentLocation() {\n        return _getCurrentLocation.apply(this, arguments);\n      }\n      return getCurrentLocation;\n    }()\n  }, {\n    key: "centerToCurrentLocation",\n    value: function () {\n      var _centerToCurrentLocation = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n        var zoom,\n          _args3 = arguments,\n          _t2;\n        return regenerator_default().wrap(function (_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              zoom = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : 15;\n              _context3.prev = 1;\n              if (this.currentPosition) {\n                _context3.next = 2;\n                break;\n              }\n              _context3.next = 2;\n              return this.getCurrentLocation();\n            case 2:\n              this.view.setView(this.currentPosition.lat, this.currentPosition.lng, zoom);\n              return _context3.abrupt("return", this.currentPosition);\n            case 3:\n              _context3.prev = 3;\n              _t2 = _context3["catch"](1);\n              console.error(\'Failed to center to current location:\', _t2);\n              throw _t2;\n            case 4:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[1, 3]]);\n      }));\n      function centerToCurrentLocation() {\n        return _centerToCurrentLocation.apply(this, arguments);\n      }\n      return centerToCurrentLocation;\n    }()\n  }, {\n    key: "addMarker",\n    value: function addMarker(lat, lng) {\n      var popupContent = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n      return this.view.addMarker(lat, lng, popupContent, options);\n    }\n  }, {\n    key: "addCurrentLocationMarker",\n    value: function addCurrentLocationMarker() {\n      var popupContent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";\n      if (!this.currentPosition) {\n        throw new Error(\'Current location not available\');\n      }\n      return this.addMarker(this.currentPosition.lat, this.currentPosition.lng, popupContent, {\n        title: \'Your Location\'\n      });\n    }\n  }, {\n    key: "clearMarkers",\n    value: function clearMarkers() {\n      this.view.clearMarkers();\n    }\n  }, {\n    key: "setOnMapClickHandler",\n    value: function setOnMapClickHandler(handler) {\n      this.view.onMapClick(function (e) {\n        handler(e.latlng.lat, e.latlng.lng);\n      });\n    }\n  }, {\n    key: "cleanup",\n    value: function cleanup() {\n      this.view.remove();\n    }\n  }, {\n    key: "handleLocationSelection",\n    value: function handleLocationSelection(lat, lng) {\n      this.clearMarkers(); // Clear existing markers\n      this.addMarker(lat, lng, "Selected Location", {\n        draggable: true,\n        color: \'red\'\n      });\n      this.view.setView(lat, lng, 15);\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.includes.js\nvar es_string_includes = __webpack_require__(1699);\n;// ./src/utils/SkipToContent.js\n\n\n\n\n\nvar currentSkipTarget = null;\nvar resetSkipToContent = function resetSkipToContent() {\n  if (currentSkipTarget) {\n    var _currentSkipTarget$cl;\n    (_currentSkipTarget$cl = currentSkipTarget.classList) === null || _currentSkipTarget$cl === void 0 || _currentSkipTarget$cl.remove(\'focus-visible\');\n    currentSkipTarget.removeAttribute(\'tabindex\');\n    currentSkipTarget = null;\n  }\n};\nvar handleSkipToContent = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n    var mainContent;\n    return regenerator_default().wrap(function (_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 1;\n          return new Promise(function (resolve) {\n            return requestAnimationFrame(resolve);\n          });\n        case 1:\n          mainContent = document.getElementById(\'main-content\');\n          if (mainContent) {\n            _context.next = 2;\n            break;\n          }\n          return _context.abrupt("return");\n        case 2:\n          resetSkipToContent();\n          mainContent.classList.add(\'focus-visible\');\n          mainContent.focus({\n            preventScroll: true\n          });\n          setTimeout(function () {\n            mainContent.classList.remove(\'focus-visible\');\n          }, 2000);\n        case 3:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function handleSkipToContent() {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar initializeSkipToContent = function initializeSkipToContent() {\n  var existingSkipLink = document.querySelector(\'.skip-link\');\n  if (existingSkipLink) existingSkipLink.remove();\n  var skipLink = document.createElement(\'a\');\n  skipLink.href = \'#main-content\';\n  skipLink.className = \'skip-link\';\n  skipLink.textContent = \'Skip to content\';\n  skipLink.style.cssText = "\\n    position: fixed;\\n    top: -40px;\\n    left: 1rem;\\n    background: #000;\\n    color: white;\\n    padding: 8px 12px;\\n    border-radius: 0 0 4px 4px;\\n    z-index: 9999;\\n    transition: top 0.3s ease;\\n  ";\n  skipLink.addEventListener(\'focus\', function () {\n    skipLink.style.top = \'0\';\n  });\n  skipLink.addEventListener(\'blur\', function () {\n    skipLink.style.top = \'-40px\';\n  });\n  skipLink.addEventListener(\'click\', /*#__PURE__*/function () {\n    var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(e) {\n      return regenerator_default().wrap(function (_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            e.preventDefault();\n            _context2.next = 1;\n            return handleSkipToContent();\n          case 1:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n  document.body.prepend(skipLink);\n  return function () {\n    skipLink.remove();\n    resetSkipToContent();\n  };\n};\n;// ./src/views/BaseView.js\n\n\n\n\n\n\n\n\n\nvar BaseView = function BaseView(htmlContent) {\n  var view = document.createElement(\'div\');\n  view.className = \'auth-form\';\n  view.innerHTML = htmlContent;\n\n  // Create a MutationObserver to detect when the view is removed\n  var observer = new MutationObserver(function (mutations) {\n    mutations.forEach(function (mutation) {\n      if (Array.from(mutation.removedNodes).includes(view)) {\n        cleanup();\n      }\n    });\n  });\n  var cleanup = function cleanup() {\n    resetSkipToContent();\n    observer.disconnect(); // Stop observing when cleaning up\n  };\n\n  // Start observing the view\'s parent for removal\n  if (view.parentNode) {\n    observer.observe(view.parentNode, {\n      childList: true\n    });\n  }\n  var getView = function getView() {\n    // When view is retrieved, ensure we observe its eventual parent\n    setTimeout(function () {\n      if (view.parentNode && !observer._isObserving) {\n        observer.observe(view.parentNode, {\n          childList: true\n        });\n        observer._isObserving = true;\n      }\n    }, 0);\n    return view;\n  };\n  var showError = function showError(message) {\n    var errorElement = view.querySelector(\'#error-message\') || view.querySelector(\'.error-message\');\n    if (errorElement) {\n      errorElement.textContent = message;\n      errorElement.style.display = message ? \'block\' : \'none\';\n    }\n  };\n  var showSuccess = function showSuccess(message) {\n    var successElement = view.querySelector(\'#success-message\') || view.querySelector(\'.success-message\');\n    if (successElement) {\n      successElement.textContent = message;\n      successElement.style.display = message ? \'block\' : \'none\';\n    }\n  };\n  return {\n    getView: getView,\n    showError: showError,\n    showSuccess: showSuccess,\n    cleanup: cleanup\n  };\n};\n;// ./src/views/auth/LoginView.js\n\n\n\nvar LoginView = function LoginView() {\n  var _document$querySelect;\n  (_document$querySelect = document.querySelector(\'header\')) === null || _document$querySelect === void 0 || _document$querySelect.remove();\n  var base = BaseView("\\n    <h2>Login</h2>\\n    <form id=\\"login-form\\">\\n      <div class=\\"form-group\\">\\n        <label for=\\"email\\">Email</label>\\n        <input type=\\"email\\" id=\\"email\\" name=\\"email\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"password\\">Password</label>\\n        <input type=\\"password\\" id=\\"password\\" name=\\"password\\" required minlength=\\"8\\">\\n      </div>\\n      <button type=\\"submit\\">Login</button>\\n    </form>\\n    <p>Don\'t have an account? <a href=\\"#/register\\">Register here</a></p>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n  ");\n  var bindLogin = function bindLogin(handler) {\n    var form = base.getView().querySelector(\'#login-form\');\n    var errorMessage = base.getView().querySelector(\'#error-message\');\n    form.addEventListener(\'submit\', /*#__PURE__*/function () {\n      var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(e) {\n        var email, password;\n        return regenerator_default().wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              email = form.email.value;\n              password = form.password.value;\n              errorMessage.style.display = \'none\';\n              _context.next = 1;\n              return handler(email, password);\n            case 1:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n  return {\n    getView: base.getView,\n    // Explicitly expose getView\n    showError: base.showError,\n    showSuccess: base.showSuccess,\n    bindLogin: bindLogin\n  };\n};\n;// ./src/views/auth/RegisterView.js\n\n\n\n\nvar RegisterView = function RegisterView() {\n  var base = BaseView("\\n    <h2>Register</h2>\\n    <form id=\\"register-form\\">\\n      <div class=\\"form-group\\">\\n        <label for=\\"name\\">Name</label>\\n        <input type=\\"text\\" id=\\"name\\" name=\\"name\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"email\\">Email</label>\\n        <input type=\\"email\\" id=\\"email\\" name=\\"email\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"password\\">Password</label>\\n        <input type=\\"password\\" id=\\"password\\" name=\\"password\\" required minlength=\\"8\\">\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"confirm-password\\">Confirm Password</label>\\n        <input type=\\"password\\" id=\\"confirm-password\\" name=\\"confirm-password\\" required minlength=\\"8\\">\\n      </div>\\n      <button type=\\"submit\\">Register</button>\\n    </form>\\n    <p>Already have an account? <a href=\\"#/login\\">Login here</a></p>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n    <div id=\\"success-message\\" class=\\"success-message\\" style=\\"display: none;\\"></div>\\n  ");\n  var bindRegister = function bindRegister(handler) {\n    var form = base.getView().querySelector(\'#register-form\');\n    var errorMessage = base.getView().querySelector(\'#error-message\');\n    form.addEventListener(\'submit\', /*#__PURE__*/function () {\n      var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(e) {\n        var name, email, password, confirmPassword;\n        return regenerator_default().wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              name = form.name.value;\n              email = form.email.value;\n              password = form.password.value;\n              confirmPassword = form[\'confirm-password\'].value;\n              errorMessage.style.display = \'none\';\n              if (!(password !== confirmPassword)) {\n                _context.next = 1;\n                break;\n              }\n              base.showError("Passwords don\'t match!");\n              return _context.abrupt("return");\n            case 1:\n              _context.next = 2;\n              return handler(name, email, password);\n            case 2:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n  return {\n    getView: base.getView,\n    showError: base.showError,\n    showSuccess: base.showSuccess,\n    bindRegister: bindRegister\n  };\n};\n;// ./src/views/stories/StoriesView.js\n\n\n\n\n\n\n\n\n\n\n\n\nvar StoriesView = function StoriesView() {\n  var view = document.createElement("main");\n  view.id = "main-content";\n  view.setAttribute("role", "main");\n  view.setAttribute("aria-label", "Stories list");\n  view.innerHTML = "\\n    <div class=\\"stories-header\\">\\n      <h1 id=\\"stories-heading\\">Stories</h1>\\n      <div class=\\"stories-controls\\">\\n        <button class=\\"bookmark-filter-btn\\" aria-label=\\"Show bookmarked stories\\" aria-pressed=\\"false\\">\\n          <svg width=\\"20\\" height=\\"20\\" viewBox=\\"0 0 24 24\\">\\n            <path d=\\"M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z\\"/>\\n          </svg>\\n          <span>Bookmarks</span>\\n        </button>\\n      </div>\\n    </div>\\n    <div class=\\"stories-grid\\" id=\\"stories-container\\" role=\\"list\\" aria-labelledby=\\"stories-heading\\"></div>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n    <div id=\\"loading-indicator\\" style=\\"display: none;\\">\\n      <div class=\\"spinner\\"></div>\\n      <span>Loading stories...</span>\\n    </div>\\n    <div id=\\"empty-state\\" class=\\"empty-state\\" style=\\"display: none;\\">\\n      <svg class=\\"empty-icon\\" viewBox=\\"0 0 24 24\\">\\n        <path d=\\"M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z\\"/>\\n      </svg>\\n      <p class=\\"empty-message\\">No stories found</p>\\n    </div>\\n  ";\n  var displayStories = function displayStories(stories) {\n    var container = view.querySelector("#stories-container");\n    var loading = view.querySelector("#loading-indicator");\n    var emptyState = view.querySelector("#empty-state");\n    loading.style.display = "none";\n    container.innerHTML = "";\n    if (!stories || stories.length === 0) {\n      emptyState.style.display = "flex";\n      container.style.display = "none";\n      return;\n    }\n    emptyState.style.display = "none";\n    container.style.display = "grid";\n    stories.forEach(function (story) {\n      var safeStory = {\n        id: story.id || "missing-id-".concat(Math.random().toString(36).substr(2, 9)),\n        name: story.name || "Unknown Author",\n        description: story.description || "",\n        photoUrl: story.photoUrl || "/assets/images/placeholder-offline.jpg",\n        createdAt: story.createdAt || new Date().toISOString(),\n        lat: story.lat,\n        lon: story.lon\n      };\n      var storyElement = document.createElement("article");\n      storyElement.className = "story-card";\n      storyElement.setAttribute("data-story-id", safeStory.id);\n      storyElement.setAttribute("tabindex", "0");\n      var formattedDate = new Date(safeStory.createdAt).toLocaleDateString("id-ID", {\n        year: "numeric",\n        month: "long",\n        day: "numeric",\n        hour: "2-digit",\n        minute: "2-digit"\n      });\n      var maxLength = 100;\n      var shortDescription = safeStory.description;\n      if (shortDescription.length > maxLength) {\n        shortDescription = shortDescription.substring(0, maxLength).replace(/\\s+\\S*$/, \'\') + \'...\';\n      }\n      storyElement.innerHTML = "\\n        <div class=\\"story-image-container\\">\\n          <img src=\\"".concat(safeStory.photoUrl, "\\" \\n               alt=\\"Story image by ").concat(safeStory.name, "\\" \\n               class=\\"story-image\\"\\n               loading=\\"lazy\\">\\n          <button class=\\"bookmark-button\\" aria-label=\\"Bookmark this story\\">\\n            <svg class=\\"bookmark-icon\\" viewBox=\\"0 0 24 24\\" width=\\"24\\" height=\\"24\\">\\n              <path d=\\"M17 3H7c-1.1 0-2 .9-2 2v16l7-3 7 3V5c0-1.1-.9-2-2-2z\\"/>\\n            </svg>\\n          </button>\\n        </div>\\n        <div class=\\"story-content\\">\\n          <h3 class=\\"story-title\\">").concat(safeStory.name, "</h3>\\n          <p class=\\"story-description\\">").concat(shortDescription, "</p>\\n          <time datetime=\\"").concat(new Date(safeStory.createdAt).toISOString(), "\\" \\n                class=\\"story-date\\">\\n            ").concat(formattedDate, "\\n          </time>\\n          <a href=\\"#/stories/").concat(safeStory.id, "\\" \\n             class=\\"read-more\\" \\n             aria-label=\\"Read more about ").concat(safeStory.name, "\\"\\n             tabindex=\\"0\\">\\n            Read more\\n          </a>\\n        </div>\\n      ");\n      storyElement.addEventListener("click", function (e) {\n        if (!e.target.closest(".bookmark-button")) {\n          window.location.hash = "#/stories/".concat(safeStory.id);\n        }\n      });\n      storyElement.addEventListener("keydown", function (e) {\n        if (e.key === "Enter" && e.target === storyElement) {\n          window.location.hash = "#/stories/".concat(safeStory.id);\n        }\n      });\n      container.appendChild(storyElement);\n    });\n  };\n  var showError = function showError(message) {\n    var errorEl = view.querySelector("#error-message");\n    errorEl.textContent = message;\n    errorEl.style.display = "block";\n    view.querySelector("#loading-indicator").style.display = "none";\n    view.querySelector("#empty-state").style.display = "none";\n  };\n  var showLoading = function showLoading() {\n    view.querySelector("#loading-indicator").style.display = "flex";\n    view.querySelector("#error-message").style.display = "none";\n    view.querySelector("#empty-state").style.display = "none";\n  };\n  var showOfflineWarning = function showOfflineWarning() {\n    var container = view.querySelector("#stories-container");\n    var existingWarning = view.querySelector(".offline-warning");\n    if (!existingWarning) {\n      var warning = document.createElement("div");\n      warning.className = "offline-warning";\n      warning.innerHTML = "\\n        <i class=\\"fas fa-wifi-slash\\"></i>\\n        <span>Showing offline data. Some stories may not be up-to-date.</span>\\n      ";\n      container.prepend(warning);\n    }\n  };\n  var updateBookmarkFilterState = function updateBookmarkFilterState(isActive) {\n    var filterBtn = view.querySelector(".bookmark-filter-btn");\n    if (filterBtn) {\n      filterBtn.classList.toggle("active", isActive);\n      filterBtn.setAttribute("aria-pressed", isActive);\n      var textSpan = filterBtn.querySelector("span");\n      if (textSpan) {\n        textSpan.textContent = isActive ? "All Stories" : "Bookmarks";\n      }\n    }\n  };\n  var bindToggleBookmarkFilter = function bindToggleBookmarkFilter(handler) {\n    var btn = view.querySelector(".bookmark-filter-btn");\n    btn === null || btn === void 0 || btn.addEventListener("click", handler);\n  };\n  var bindBookmarkAction = function bindBookmarkAction(handler) {\n    view.addEventListener("click", function (e) {\n      var bookmarkBtn = e.target.closest(".bookmark-button");\n      if (bookmarkBtn) {\n        var storyCard = bookmarkBtn.closest(".story-card");\n        var storyId = storyCard === null || storyCard === void 0 ? void 0 : storyCard.dataset.storyId;\n        if (storyId) {\n          e.preventDefault();\n          e.stopPropagation();\n          handler(storyId);\n        }\n      }\n    });\n  };\n  var bindLoadStories = function bindLoadStories(handler) {\n    showLoading();\n    handler()["catch"](function (error) {\n      showError(error.message || "Failed to load stories");\n    });\n  };\n  return {\n    getView: function getView() {\n      return view;\n    },\n    displayStories: displayStories,\n    showError: showError,\n    showLoading: showLoading,\n    showOfflineWarning: showOfflineWarning,\n    bindLoadStories: bindLoadStories,\n    updateBookmarkFilterState: updateBookmarkFilterState,\n    bindToggleBookmarkFilter: bindToggleBookmarkFilter,\n    bindBookmarkAction: bindBookmarkAction\n  };\n};\n// EXTERNAL MODULE: ./node_modules/leaflet/dist/leaflet.css\nvar leaflet = __webpack_require__(3093);\n// EXTERNAL MODULE: ./node_modules/leaflet/dist/leaflet-src.js\nvar leaflet_src = __webpack_require__(3481);\nvar leaflet_src_default = /*#__PURE__*/__webpack_require__.n(leaflet_src);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/leaflet.markercluster.js\nvar leaflet_markercluster = __webpack_require__(3866);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/MarkerCluster.css\nvar MarkerCluster = __webpack_require__(9500);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/MarkerCluster.Default.css\nvar MarkerCluster_Default = __webpack_require__(1081);\n;// ./src/views/stories/DetailStoryView.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Fix for default marker icons in Leaflet\ndelete (leaflet_src_default()).Icon.Default.prototype._getIconUrl;\nleaflet_src_default().Icon.Default.mergeOptions({\n  iconRetinaUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\',\n  iconUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\',\n  shadowUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\'\n});\nvar DetailStoryView = function DetailStoryView() {\n  var view = document.createElement(\'main\');\n  view.id = \'main-content\';\n  view.innerHTML = "\\n    <div class=\\"detail-story\\">\\n      <div class=\\"story-image-container\\">\\n        <img id=\\"story-image\\" class=\\"detail-story-image\\" alt=\\"Story image\\">\\n        <div class=\\"story-meta\\">\\n          <div class=\\"author-info\\">\\n            <i class=\\"fas fa-user-circle\\"></i>\\n            <span id=\\"story-author\\"></span>\\n          </div>\\n          <div class=\\"date-info\\">\\n            <i class=\\"far fa-calendar-alt\\"></i>\\n            <span id=\\"story-date\\"></span>\\n          </div>\\n        </div>\\n      </div>\\n      \\n      <div class=\\"story-content\\">\\n        <h1 id=\\"story-title\\" class=\\"story-title\\"></h1>\\n        <p id=\\"story-description\\" class=\\"story-description\\"></p>\\n        \\n        <div class=\\"location-section\\">\\n          <h3><i class=\\"fas fa-map-marker-alt\\"></i> Lokasi</h3>\\n          <div id=\\"story-map-container\\" class=\\"detail-map-container\\">\\n            <div id=\\"story-map\\" class=\\"detail-map\\"></div>\\n            <div class=\\"map-controls\\">\\n              <button id=\\"satellite-view\\" class=\\"map-control-btn\\">\\n                <i class=\\"fas fa-satellite\\"></i>\\n              </button>\\n              <button id=\\"street-view\\" class=\\"map-control-btn\\">\\n                <i class=\\"fas fa-road\\"></i>\\n              </button>\\n            </div>\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n    \\n    <div id=\\"error-message\\" class=\\"error-message\\">\\n      <i class=\\"fas fa-exclamation-circle\\"></i>\\n      <span class=\\"error-text\\"></span>\\n    </div>\\n  ";\n  var mapInstance = null;\n  var markerCluster = null;\n  var baseLayers = {};\n  var currentLayer = null;\n  var prepareMapContainer = function prepareMapContainer() {\n    var container = view.querySelector(\'#story-map-container\');\n    var mapDiv = view.querySelector(\'#story-map\');\n\n    // Completely recreate the map container\n    if (mapDiv) {\n      var newMapDiv = document.createElement(\'div\');\n      newMapDiv.id = \'story-map\';\n      newMapDiv.className = \'detail-map\';\n      container.replaceChild(newMapDiv, mapDiv);\n    }\n\n    // Clean up existing map instances\n    if (mapInstance) {\n      mapInstance.remove();\n      mapInstance = null;\n    }\n    if (markerCluster) {\n      markerCluster.clearLayers();\n      markerCluster = null;\n    }\n  };\n  var initMap = function initMap(lat, lng) {\n    try {\n      var _document$getElementB, _document$getElementB2;\n      // Check if map container exists and isn\'t already initialized\n      var mapElement = view.querySelector(\'#story-map\');\n      if (!mapElement || mapElement._leaflet_id) {\n        return null;\n      }\n\n      // Create new map instance\n      mapInstance = leaflet_src_default().map(mapElement, {\n        zoomControl: false,\n        preferCanvas: true\n      }).setView([lat, lng], 13);\n\n      // Add zoom control\n      leaflet_src_default().control.zoom({\n        position: \'bottomright\'\n      }).addTo(mapInstance);\n\n      // Define base layers\n      baseLayers = {\n        "Street View": leaflet_src_default().tileLayer(\'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\', {\n          attribution: \'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors\',\n          maxZoom: 19\n        }),\n        "Satellite View": leaflet_src_default().tileLayer(\'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\', {\n          attribution: \'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\',\n          maxZoom: 19\n        })\n      };\n\n      // Add default layer\n      baseLayers["Street View"].addTo(mapInstance);\n      currentLayer = "Street View";\n\n      // Add layer control\n      leaflet_src_default().control.layers(baseLayers, null, {\n        position: \'topright\',\n        collapsed: false\n      }).addTo(mapInstance);\n\n      // Initialize marker cluster\n      markerCluster = leaflet_src_default().markerClusterGroup({\n        spiderfyOnMaxZoom: true,\n        showCoverageOnHover: false,\n        zoomToBoundsOnClick: true,\n        maxClusterRadius: 40\n      });\n\n      // Add custom control button events\n      (_document$getElementB = document.getElementById(\'satellite-view\')) === null || _document$getElementB === void 0 || _document$getElementB.addEventListener(\'click\', function () {\n        switchLayer("Satellite View");\n      });\n      (_document$getElementB2 = document.getElementById(\'street-view\')) === null || _document$getElementB2 === void 0 || _document$getElementB2.addEventListener(\'click\', function () {\n        switchLayer("Street View");\n      });\n      return mapInstance;\n    } catch (error) {\n      console.error(\'Map initialization error:\', error);\n      return null;\n    }\n  };\n  var switchLayer = function switchLayer(layerName) {\n    if (mapInstance && currentLayer !== layerName) {\n      mapInstance.removeLayer(baseLayers[currentLayer]);\n      baseLayers[layerName].addTo(mapInstance);\n      currentLayer = layerName;\n\n      // Update active button state\n      document.querySelectorAll(\'.map-control-btn\').forEach(function (btn) {\n        btn.classList.remove(\'active\');\n      });\n      var activeBtn = document.getElementById("".concat(layerName.toLowerCase().replace(\' \', \'-\'), "-view"));\n      if (activeBtn) activeBtn.classList.add(\'active\');\n    }\n  };\n  var displayStoryDetail = /*#__PURE__*/function () {\n    var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(story) {\n      return regenerator_default().wrap(function (_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 1;\n            return startViewTransition(/*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n              var imageElement, mapContainer, map, marker;\n              return regenerator_default().wrap(function (_context) {\n                while (1) switch (_context.prev = _context.next) {\n                  case 0:\n                    // Prepare the view first\n                    imageElement = view.querySelector(\'#story-image\');\n                    imageElement.src = story.photoUrl;\n                    imageElement.alt = "Story by ".concat(story.name);\n                    view.querySelector(\'#story-title\').textContent = story.name;\n                    view.querySelector(\'#story-author\').textContent = story.name;\n                    view.querySelector(\'#story-description\').textContent = story.description;\n                    view.querySelector(\'#story-date\').textContent = new Date(story.createdAt).toLocaleString(\'id-ID\', {\n                      weekday: \'long\',\n                      year: \'numeric\',\n                      month: \'long\',\n                      day: \'numeric\',\n                      hour: \'2-digit\',\n                      minute: \'2-digit\'\n                    });\n\n                    // Handle map display\n                    mapContainer = view.querySelector(\'#story-map-container\');\n                    if (!(story.lat && story.lon)) {\n                      _context.next = 2;\n                      break;\n                    }\n                    mapContainer.style.display = \'block\';\n\n                    // Prepare the map container\n                    prepareMapContainer();\n\n                    // Wait for DOM to be ready\n                    _context.next = 1;\n                    return new Promise(function (resolve) {\n                      return requestAnimationFrame(resolve);\n                    });\n                  case 1:\n                    // Initialize map\n                    map = initMap(story.lat, story.lon);\n                    if (map) {\n                      // Add marker to the cluster\n                      marker = leaflet_src_default().marker([story.lat, story.lon]).bindPopup("\\n              <div class=\\"map-popup\\">\\n                <h4>".concat(story.name, "</h4>\\n                <p>").concat(story.description.substring(0, 100), "...</p>\\n                <small>").concat(new Date(story.createdAt).toLocaleDateString(), "</small>\\n              </div>\\n            "));\n                      markerCluster.addLayer(marker);\n                      map.addLayer(markerCluster);\n                      marker.openPopup();\n                    }\n                    _context.next = 3;\n                    break;\n                  case 2:\n                    mapContainer.style.display = \'none\';\n                  case 3:\n                  case "end":\n                    return _context.stop();\n                }\n              }, _callee);\n            })));\n          case 1:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    return function displayStoryDetail(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var showError = function showError(message) {\n    var errorElement = view.querySelector(\'#error-message\');\n    var errorText = errorElement.querySelector(\'.error-text\');\n    errorText.textContent = message;\n    errorElement.style.display = \'flex\';\n\n    // Animation for error message\n    errorElement.animate([{\n      opacity: 0,\n      transform: \'translateY(-10px)\'\n    }, {\n      opacity: 1,\n      transform: \'translateY(0)\'\n    }], {\n      duration: 300,\n      easing: \'ease-out\'\n    });\n  };\n  var cleanup = function cleanup() {\n    if (mapInstance) {\n      mapInstance.remove();\n      mapInstance = null;\n    }\n    if (markerCluster) {\n      markerCluster.clearLayers();\n      markerCluster = null;\n    }\n  };\n  return {\n    getView: function getView() {\n      return view;\n    },\n    displayStoryDetail: displayStoryDetail,\n    showError: showError,\n    cleanup: cleanup,\n    prepareMapContainer: prepareMapContainer\n  };\n};\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.number.to-fixed.js\nvar es_number_to_fixed = __webpack_require__(9868);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.parse-float.js\nvar es_parse_float = __webpack_require__(8459);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.trim.js\nvar es_string_trim = __webpack_require__(2762);\n;// ./src/views/stories/AddStoryView.js\n\n\nfunction AddStoryView_ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction AddStoryView_objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? AddStoryView_ownKeys(Object(t), !0).forEach(function (r) { (0,defineProperty/* default */.A)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : AddStoryView_ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar AddStoryView = function AddStoryView() {\n  var view = document.createElement("main");\n  view.id = "main-content";\n  view.setAttribute("role", "main");\n  view.setAttribute("aria-label", "Add new story form");\n  view.innerHTML = "\\n\\n    <div class=\\"add-story-form\\">\\n    <h2>Add New Story</h2> \\n    <div class=\\"notification-permission-info\\" style=\\"display: none;\\">\\n      <p>We\'d like to show notifications when you add stories. This helps you keep track of your contributions.</p>\\n      <button type=\\"button\\" id=\\"enable-notifications\\" class=\\"btn\\">Enable Notifications</button>\\n    </div>\\n      <form id=\\"story-form\\">\\n        <div class=\\"form-group\\">\\n          <label for=\\"description\\">Description</label>\\n          <textarea id=\\"description\\" name=\\"description\\" rows=\\"4\\" required></textarea>\\n        </div>\\n        \\n        <div class=\\"form-group camera-container\\">\\n          <label>Photo</label>\\n          <div class=\\"preview-container\\">\\n            <video id=\\"camera-preview\\" class=\\"media-preview\\" autoplay playsinline></video>\\n            <img id=\\"photo-preview\\" class=\\"media-preview\\" style=\\"display:none; object-fit:contain;\\" alt=\\"Captured photo\\">\\n          </div>\\n          <div class=\\"camera-controls\\">\\n            <button type=\\"button\\" id=\\"start-camera\\" class=\\"btn camera-btn\\">Start Camera</button>\\n            <select id=\\"camera-select\\" class=\\"camera-select\\" style=\\"display:none;\\"></select>\\n            <button type=\\"button\\" id=\\"capture-btn\\" class=\\"btn capture-btn\\" style=\\"display:none;\\">Capture Photo</button>\\n            <button type=\\"button\\" id=\\"stop-camera\\" class=\\"btn stop-btn\\" style=\\"display:none;\\">Stop Camera</button>\\n            <button type=\\"button\\" id=\\"retake-btn\\" class=\\"btn retake-btn\\" style=\\"display:none;\\">Retake Photo</button>\\n          </div>\\n          <canvas id=\\"canvas\\" style=\\"display:none;\\"></canvas>\\n        </div>\\n        \\n        <div class=\\"form-group\\">\\n          <label>Location</label>\\n          <div id=\\"map\\" class=\\"map-container\\"></div>\\n          <button type=\\"button\\" id=\\"get-location\\" class=\\"btn location-btn\\">Use Current Location</button>\\n          <input type=\\"hidden\\" id=\\"lat\\" name=\\"lat\\">\\n          <input type=\\"hidden\\" id=\\"lng\\" name=\\"lng\\">\\n          <p id=\\"location-status\\" class=\\"location-status\\">No location selected</p>\\n        </div>\\n        \\n        <button type=\\"submit\\" class=\\"btn submit-btn\\">Submit Story</button>\\n      </form>\\n      <div id=\\"error-message\\" class=\\"error-message\\"></div>\\n      <div id=\\"success-message\\" class=\\"success-message\\"></div>\\n    </div>\\n  ";\n\n  // State\n  var stream = null;\n  var photoFile = null;\n  var map = null;\n  var availableCameras = [];\n  var mapMarker = null;\n  var isViewActive = true;\n\n  // DOM Elements\n  var cameraPreview = view.querySelector("#camera-preview");\n  var photoPreview = view.querySelector("#photo-preview");\n  var startCameraBtn = view.querySelector("#start-camera");\n  var cameraSelect = view.querySelector("#camera-select");\n  var captureBtn = view.querySelector("#capture-btn");\n  var stopCameraBtn = view.querySelector("#stop-camera");\n  var retakeBtn = view.querySelector("#retake-btn");\n  var canvas = view.querySelector("#canvas");\n  var mapContainer = view.querySelector("#map");\n  var locationStatus = view.querySelector("#location-status");\n  var checkNotificationPermission = function checkNotificationPermission() {\n    var notificationInfo = view.querySelector(".notification-permission-info");\n    var enableNotificationsBtn = view.querySelector("#enable-notifications");\n    if (Notification.permission === "default") {\n      notificationInfo.style.display = "block";\n      enableNotificationsBtn.addEventListener("click", /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var granted, auth, token, _t;\n        return regenerator_default().wrap(function (_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 1;\n              return showNotificationPrompt();\n            case 1:\n              granted = _context.sent;\n              notificationInfo.style.display = granted ? "none" : "block";\n              if (!granted) {\n                _context.next = 3;\n                break;\n              }\n              auth = new AuthModel();\n              token = auth.getToken();\n              _context.next = 2;\n              return subscribeUser(token);\n            case 2:\n              showSuccess("Notifications enabled!");\n            case 3:\n              _context.next = 5;\n              break;\n            case 4:\n              _context.prev = 4;\n              _t = _context["catch"](0);\n              console.error("Error requesting notification permission:", _t);\n              showError("Failed to enable notifications");\n            case 5:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 4]]);\n      })));\n    } else {\n      notificationInfo.style.display = "none";\n    }\n  };\n  var initializeMap = function initializeMap() {\n    if (!map && mapContainer) {\n      map = L.map(mapContainer).setView([-6.2, 106.8], 13);\n      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {\n        attribution: "&copy; OpenStreetMap contributors"\n      }).addTo(map);\n      map.on("click", function (e) {\n        var _e$latlng = e.latlng,\n          lat = _e$latlng.lat,\n          lng = _e$latlng.lng;\n        updateLocation(lat, lng);\n        addMapMarker(lat, lng);\n        showSuccess("Location selected on map!");\n      });\n    }\n  };\n\n  // Add marker to map\n  var addMapMarker = function addMapMarker(lat, lng) {\n    if (mapMarker) {\n      map.removeLayer(mapMarker);\n    }\n    mapMarker = L.marker([lat, lng], {\n      draggable: true,\n      title: "Story Location"\n    }).addTo(map).bindPopup("Story location").openPopup();\n    mapMarker.on("dragend", function (e) {\n      var newPos = e.target.getLatLng();\n      updateLocation(newPos.lat, newPos.lng);\n    });\n  };\n\n  // Update location inputs and status\n  var updateLocation = function updateLocation(lat, lng) {\n    view.querySelector("#lat").value = lat;\n    view.querySelector("#lng").value = lng;\n    locationStatus.textContent = "Location set: ".concat(lat.toFixed(4), ", ").concat(lng.toFixed(4));\n    locationStatus.style.color = "#4CAF50";\n  };\n\n  // Message handlers\n  var showError = function showError(message) {\n    var errorElement = view.querySelector("#error-message");\n    errorElement.textContent = message;\n    errorElement.style.display = "block";\n    setTimeout(function () {\n      return errorElement.style.display = "none";\n    }, 5000);\n  };\n  var showSuccess = function showSuccess(message) {\n    var successElement = view.querySelector("#success-message");\n    successElement.textContent = message;\n    successElement.style.display = "block";\n    setTimeout(function () {\n      return successElement.style.display = "none";\n    }, 5000);\n  };\n\n  // Camera functions\n  var getCameraDevices = /*#__PURE__*/function () {\n    var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n      var devices, _t2;\n      return regenerator_default().wrap(function (_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 1;\n            return navigator.mediaDevices.enumerateDevices();\n          case 1:\n            devices = _context2.sent;\n            return _context2.abrupt("return", devices.filter(function (device) {\n              return device.kind === "videoinput";\n            }));\n          case 2:\n            _context2.prev = 2;\n            _t2 = _context2["catch"](0);\n            showError("Camera access error: ".concat(_t2.message));\n            return _context2.abrupt("return", []);\n          case 3:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2, null, [[0, 2]]);\n    }));\n    return function getCameraDevices() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var stopCamera = function stopCamera() {\n    stopCameraBtn.style.display = "none";\n    startCameraBtn.style.display = "inline-block";\n    if (stream) {\n      stream.getTracks().forEach(function (track) {\n        track.stop();\n        track.enabled = false;\n      });\n      stream = null;\n    }\n    cameraPreview.style.display = "none";\n    cameraPreview.srcObject = null;\n    captureBtn.style.display = "none";\n    cameraSelect.style.display = "none";\n  };\n  var _startCamera = /*#__PURE__*/function () {\n    var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n      var deviceId,\n        constraints,\n        _args3 = arguments,\n        _t3;\n      return regenerator_default().wrap(function (_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            deviceId = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : null;\n            if (isViewActive) {\n              _context3.next = 1;\n              break;\n            }\n            return _context3.abrupt("return");\n          case 1:\n            _context3.prev = 1;\n            stopCamera();\n            constraints = {\n              video: AddStoryView_objectSpread({\n                width: {\n                  ideal: 1280\n                },\n                height: {\n                  ideal: 720\n                }\n              }, deviceId && {\n                deviceId: {\n                  exact: deviceId\n                }\n              })\n            };\n            _context3.next = 2;\n            return navigator.mediaDevices.getUserMedia(constraints);\n          case 2:\n            stream = _context3.sent;\n            if (!(availableCameras.length === 0)) {\n              _context3.next = 4;\n              break;\n            }\n            _context3.next = 3;\n            return getCameraDevices();\n          case 3:\n            availableCameras = _context3.sent;\n            updateCameraSelect();\n          case 4:\n            cameraPreview.srcObject = stream;\n            cameraPreview.style.display = "block";\n            photoPreview.style.display = "none";\n            captureBtn.style.display = "inline-block";\n            stopCameraBtn.style.display = "inline-block";\n            startCameraBtn.style.display = "none";\n            retakeBtn.style.display = "none";\n            if (availableCameras.length > 1) {\n              cameraSelect.style.display = "inline-block";\n            }\n            _context3.next = 6;\n            break;\n          case 5:\n            _context3.prev = 5;\n            _t3 = _context3["catch"](1);\n            showError("Camera error: ".concat(_t3.message));\n            if (deviceId) {\n              _startCamera();\n            }\n          case 6:\n          case "end":\n            return _context3.stop();\n        }\n      }, _callee3, null, [[1, 5]]);\n    }));\n    return function startCamera() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var updateCameraSelect = function updateCameraSelect() {\n    cameraSelect.innerHTML = "";\n    availableCameras.forEach(function (camera) {\n      var option = document.createElement("option");\n      option.value = camera.deviceId;\n      option.text = camera.label || "Camera ".concat(cameraSelect.length + 1);\n      cameraSelect.appendChild(option);\n    });\n    cameraSelect.addEventListener("change", function () {\n      _startCamera(cameraSelect.value);\n    });\n  };\n  var capturePhoto = function capturePhoto() {\n    try {\n      var video = cameraPreview;\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      var ctx = canvas.getContext("2d");\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      photoPreview.src = canvas.toDataURL("image/jpeg");\n      photoPreview.style.display = "block";\n      cameraPreview.style.display = "none";\n      canvas.toBlob(function (blob) {\n        photoFile = new File([blob], "story-photo.jpg", {\n          type: "image/jpeg",\n          lastModified: Date.now()\n        });\n      }, "image/jpeg", 0.85);\n      captureBtn.style.display = "none";\n      stopCameraBtn.style.display = "none";\n      cameraSelect.style.display = "none";\n      retakeBtn.style.display = "inline-block";\n      stopCamera();\n    } catch (error) {\n      showError("Capture failed: ".concat(error.message));\n    }\n  };\n  var retakePhoto = function retakePhoto() {\n    photoPreview.style.display = "none";\n    photoPreview.src = "";\n    photoFile = null;\n    _startCamera(cameraSelect.value || null);\n  };\n\n  // Clean up when view is destroyed\n  var cleanup = function cleanup() {\n    isViewActive = false;\n    stopCamera();\n    if (map) {\n      map.remove();\n      map = null;\n      mapMarker = null;\n    }\n\n    // Remove all event listeners\n    var safeRemoveListener = function safeRemoveListener(element, event, handler) {\n      if (element && handler) {\n        element.removeEventListener(event, handler);\n      }\n    };\n    safeRemoveListener(startCameraBtn, "click", _startCamera);\n    safeRemoveListener(stopCameraBtn, "click", stopCamera);\n    safeRemoveListener(captureBtn, "click", capturePhoto);\n    safeRemoveListener(retakeBtn, "click", retakePhoto);\n    safeRemoveListener(cameraSelect, "change", _startCamera);\n  };\n\n  // Initialize map when view is created\n  setTimeout(initializeMap, 100);\n\n  // Bind event handlers\n  var bindAddStory = function bindAddStory(handler) {\n    var form = view.querySelector("#story-form");\n    var getLocationBtn = view.querySelector("#get-location");\n    var formSubmitHandler = /*#__PURE__*/function () {\n      var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(e) {\n        var description, data, _t4;\n        return regenerator_default().wrap(function (_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              e.preventDefault();\n              if (photoFile) {\n                _context4.next = 1;\n                break;\n              }\n              showError("Please take a photo first");\n              return _context4.abrupt("return");\n            case 1:\n              description = form.description.value.trim();\n              if (description) {\n                _context4.next = 2;\n                break;\n              }\n              showError("Please enter a description");\n              return _context4.abrupt("return");\n            case 2:\n              if (!(!form.lat.value || !form.lng.value)) {\n                _context4.next = 3;\n                break;\n              }\n              showError("Please select a location");\n              return _context4.abrupt("return");\n            case 3:\n              data = {\n                description: description,\n                photo: photoFile,\n                lat: parseFloat(form.lat.value),\n                lon: parseFloat(form.lng.value)\n              };\n              _context4.prev = 4;\n              _context4.next = 5;\n              return handler(data);\n            case 5:\n              _context4.next = 7;\n              break;\n            case 6:\n              _context4.prev = 6;\n              _t4 = _context4["catch"](4);\n              showError("Submission failed: ".concat(_t4.message));\n            case 7:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[4, 6]]);\n      }));\n      return function formSubmitHandler(_x) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    var getLocationHandler = function getLocationHandler() {\n      navigator.geolocation.getCurrentPosition(function (position) {\n        var lat = position.coords.latitude;\n        var lng = position.coords.longitude;\n        updateLocation(lat, lng);\n        addMapMarker(lat, lng);\n        if (map) {\n          map.setView([lat, lng], 15);\n        }\n        showSuccess("Current location obtained!");\n      }, function (error) {\n        showError("Location error: ".concat(error.message));\n      }, {\n        enableHighAccuracy: true,\n        timeout: 10000\n      });\n    };\n    startCameraBtn.addEventListener("click", _startCamera);\n    stopCameraBtn.addEventListener("click", stopCamera);\n    captureBtn.addEventListener("click", capturePhoto);\n    retakeBtn.addEventListener("click", retakePhoto);\n    getLocationBtn.addEventListener("click", getLocationHandler);\n    form.addEventListener("submit", formSubmitHandler);\n\n    // Add header navigation listener\n    window.addEventListener("header-navigation", stopCamera);\n  };\n  checkNotificationPermission();\n  return {\n    getView: function getView() {\n      return view;\n    },\n    bindAddStory: bindAddStory,\n    showError: showError,\n    showSuccess: showSuccess,\n    getMapContainer: function getMapContainer() {\n      return mapContainer;\n    },\n    cleanup: cleanup\n  };\n};\n;// ./src/utils/auth.js\nvar checkAuth = function checkAuth(authModel, router) {\n  if (!authModel.isAuthenticated()) {\n    router.navigateTo("/login");\n    return false;\n  }\n  return true;\n};\nvar checkGuest = function checkGuest(authModel, router) {\n  if (authModel.isAuthenticated()) {\n    router.navigateTo("/stories");\n    return false;\n  }\n  return true;\n};\n;// ./src/app.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ninitializeSkipToContent();\nvar authModel = new AuthModel();\nvar storyModel = new StoryModel(authModel);\nvar appRoot = document.getElementById("app");\nappRoot.appendChild(Header());\nvar deferredPrompt;\nwindow.addEventListener("beforeinstallprompt", function (e) {\n  e.preventDefault();\n  deferredPrompt = e;\n  var installBtn = document.getElementById("install-button");\n  if (installBtn) {\n    installBtn.style.display = "inline-block";\n    installBtn.addEventListener("click", /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n      var choice;\n      return regenerator_default().wrap(function (_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            installBtn.style.display = "none";\n            deferredPrompt.prompt();\n            _context.next = 1;\n            return deferredPrompt.userChoice;\n          case 1:\n            choice = _context.sent;\n            deferredPrompt = null;\n          case 2:\n          case "end":\n            return _context.stop();\n        }\n      }, _callee);\n    })));\n  }\n});\nvar _initMapWithRetry = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(handler, containerId, lat, lng, zoom) {\n    var attempts,\n      container,\n      _args2 = arguments,\n      _t;\n    return regenerator_default().wrap(function (_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          attempts = _args2.length > 5 && _args2[5] !== undefined ? _args2[5] : 0;\n          _context2.prev = 1;\n          container = document.getElementById(containerId);\n          if (!(!container && attempts < 3)) {\n            _context2.next = 3;\n            break;\n          }\n          _context2.next = 2;\n          return new Promise(function (resolve) {\n            return setTimeout(resolve, 100 * (attempts + 1));\n          });\n        case 2:\n          return _context2.abrupt("return", _initMapWithRetry(handler, containerId, lat, lng, zoom, attempts + 1));\n        case 3:\n          return _context2.abrupt("return", handler(containerId, lat, lng, zoom));\n        case 4:\n          _context2.prev = 4;\n          _t = _context2["catch"](1);\n          return _context2.abrupt("return", null);\n        case 5:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[1, 4]]);\n  }));\n  return function initMapWithRetry(_x, _x2, _x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nwindow.addEventListener("logout", function () {\n  authModel.logout();\n  updateAuthUI(false);\n  router.navigateTo("/login");\n});\nvar routes = [{\n  path: "/login",\n  view: function () {\n    var _view = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n      var view;\n      return regenerator_default().wrap(function (_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            if (checkGuest(authModel, router)) {\n              _context3.next = 1;\n              break;\n            }\n            return _context3.abrupt("return", ErrorView().getView());\n          case 1:\n            view = LoginView();\n            new AuthPresenter(authModel, {\n              bindLogin: view.bindLogin,\n              showError: view.showError\n            }, router);\n            return _context3.abrupt("return", view.getView());\n          case 2:\n          case "end":\n            return _context3.stop();\n        }\n      }, _callee3);\n    }));\n    function view() {\n      return _view.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: "/register",\n  view: function () {\n    var _view2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4() {\n      var view;\n      return regenerator_default().wrap(function (_context4) {\n        while (1) switch (_context4.prev = _context4.next) {\n          case 0:\n            if (checkGuest(authModel, router)) {\n              _context4.next = 1;\n              break;\n            }\n            return _context4.abrupt("return", ErrorView().getView());\n          case 1:\n            view = RegisterView();\n            new AuthPresenter(authModel, {\n              bindRegister: view.bindRegister,\n              showError: view.showError,\n              showSuccess: view.showSuccess\n            }, router);\n            return _context4.abrupt("return", view.getView());\n          case 2:\n          case "end":\n            return _context4.stop();\n        }\n      }, _callee4);\n    }));\n    function view() {\n      return _view2.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: "/",\n  view: function () {\n    var _view3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5() {\n      var view, presenter;\n      return regenerator_default().wrap(function (_context5) {\n        while (1) switch (_context5.prev = _context5.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context5.next = 1;\n              break;\n            }\n            return _context5.abrupt("return", ErrorView().getView());\n          case 1:\n            view = StoriesView();\n            presenter = new StoryPresenter(storyModel, {\n              bindLoadStories: view.bindLoadStories,\n              displayStories: view.displayStories,\n              showError: view.showError,\n              bindToggleBookmarkFilter: view.bindToggleBookmarkFilter,\n              bindBookmarkAction: view.bindBookmarkAction\n            }, router);\n            window.storyPresenter = presenter;\n            return _context5.abrupt("return", view.getView());\n          case 2:\n          case "end":\n            return _context5.stop();\n        }\n      }, _callee5);\n    }));\n    function view() {\n      return _view3.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: "/stories",\n  view: function () {\n    var _view4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6() {\n      var view, presenter;\n      return regenerator_default().wrap(function (_context6) {\n        while (1) switch (_context6.prev = _context6.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context6.next = 1;\n              break;\n            }\n            return _context6.abrupt("return", ErrorView().getView());\n          case 1:\n            view = StoriesView();\n            presenter = new StoryPresenter(storyModel, {\n              bindLoadStories: view.bindLoadStories,\n              displayStories: view.displayStories,\n              showError: view.showError,\n              bindToggleBookmarkFilter: view.bindToggleBookmarkFilter,\n              bindBookmarkAction: view.bindBookmarkAction\n            }, router);\n            window.storyPresenter = presenter;\n            return _context6.abrupt("return", view.getView());\n          case 2:\n          case "end":\n            return _context6.stop();\n        }\n      }, _callee6);\n    }));\n    function view() {\n      return _view4.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: "/stories/:id",\n  view: function () {\n    var _view5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(params) {\n      var view, id;\n      return regenerator_default().wrap(function (_context7) {\n        while (1) switch (_context7.prev = _context7.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context7.next = 1;\n              break;\n            }\n            return _context7.abrupt("return", ErrorView());\n          case 1:\n            view = DetailStoryView();\n            id = params.id;\n            new StoryPresenter(storyModel, {\n              bindLoadStoryDetail: function bindLoadStoryDetail(handler) {\n                var mapContainer = view.getView().querySelector("#story-map-container");\n                if (mapContainer) {\n                  mapContainer.innerHTML = \'<div id="story-map" class="detail-map"></div>\';\n                }\n                handler(id);\n              },\n              displayStoryDetail: function displayStoryDetail(story) {\n                view.displayStoryDetail(story);\n                if (story.lat && story.lon) {\n                  setTimeout(function () {\n                    var mapElement = view.getView().querySelector("#story-map");\n                    if (!mapElement || !mapElement._leaflet_id) {\n                      try {\n                        var map = L.map(mapElement).setView([story.lat, story.lon], 13);\n                        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {\n                          attribution: "&copy; OpenStreetMap contributors"\n                        }).addTo(map);\n                        L.marker([story.lat, story.lon]).addTo(map).bindPopup("<b>".concat(story.name, "</b><br>").concat(story.description.substring(0, 50), "...")).openPopup();\n                      } catch (error) {\n                        console.error("Map initialization error:", error);\n                      }\n                    }\n                  }, 50);\n                }\n              },\n              showError: view.showError\n            }, router);\n            return _context7.abrupt("return", view.getView());\n          case 2:\n          case "end":\n            return _context7.stop();\n        }\n      }, _callee7);\n    }));\n    function view(_x6) {\n      return _view5.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: "/add-story",\n  view: function () {\n    var _view6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee0() {\n      var view, domNode, mapPresenter;\n      return regenerator_default().wrap(function (_context0) {\n        while (1) switch (_context0.prev = _context0.next) {\n          case 0:\n            view = AddStoryView();\n            domNode = view.getView();\n            try {\n              mapPresenter = new MapPresenter({\n                bindInitMap: function () {\n                  var _bindInitMap = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(handler) {\n                    var result;\n                    return regenerator_default().wrap(function (_context8) {\n                      while (1) switch (_context8.prev = _context8.next) {\n                        case 0:\n                          _context8.next = 1;\n                          return _initMapWithRetry(handler, "map", -6.2088, 106.8456, 12);\n                        case 1:\n                          result = _context8.sent;\n                          if (result !== null && result !== void 0 && result.map) {\n                            result.map.on("click", function (e) {\n                              var _e$latlng = e.latlng,\n                                lat = _e$latlng.lat,\n                                lng = _e$latlng.lng;\n                              domNode.querySelector("#lat").value = lat;\n                              domNode.querySelector("#lng").value = lng;\n                              result.addMarker(lat, lng, "Story location");\n                            });\n                          }\n                          return _context8.abrupt("return", result === null || result === void 0 ? void 0 : result.map);\n                        case 2:\n                        case "end":\n                          return _context8.stop();\n                      }\n                    }, _callee8);\n                  }));\n                  function bindInitMap(_x7) {\n                    return _bindInitMap.apply(this, arguments);\n                  }\n                  return bindInitMap;\n                }(),\n                bindGetCurrentLocation: function bindGetCurrentLocation(handler) {\n                  var _domNode$querySelecto;\n                  (_domNode$querySelecto = domNode.querySelector("#get-location")) === null || _domNode$querySelecto === void 0 || _domNode$querySelecto.addEventListener("click", /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee9() {\n                    var _mapPresenter$map, location, _t2;\n                    return regenerator_default().wrap(function (_context9) {\n                      while (1) switch (_context9.prev = _context9.next) {\n                        case 0:\n                          _context9.prev = 0;\n                          _context9.next = 1;\n                          return handler();\n                        case 1:\n                          location = _context9.sent;\n                          domNode.querySelector("#lat").value = location.lat;\n                          domNode.querySelector("#lng").value = location.lng;\n                          mapPresenter.addMarker(location.lat, location.lng, "Current location");\n                          (_mapPresenter$map = mapPresenter.map) === null || _mapPresenter$map === void 0 || _mapPresenter$map.setView([location.lat, location.lng], 15);\n                          _context9.next = 3;\n                          break;\n                        case 2:\n                          _context9.prev = 2;\n                          _t2 = _context9["catch"](0);\n                          view.showError(_t2.message);\n                        case 3:\n                        case "end":\n                          return _context9.stop();\n                      }\n                    }, _callee9, null, [[0, 2]]);\n                  })));\n                }\n              });\n              new StoryPresenter(storyModel, {\n                bindAddStory: view.bindAddStory,\n                showError: view.showError,\n                showSuccess: view.showSuccess\n              }, router);\n            } catch (error) {\n              view.showError("Failed to initialize form");\n            }\n            return _context0.abrupt("return", domNode);\n          case 1:\n          case "end":\n            return _context0.stop();\n        }\n      }, _callee0);\n    }));\n    function view() {\n      return _view6.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: "/logout",\n  view: function () {\n    var _view7 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee1() {\n      return regenerator_default().wrap(function (_context1) {\n        while (1) switch (_context1.prev = _context1.next) {\n          case 0:\n            authModel.logout();\n            updateAuthUI(false);\n            router.navigateTo("/login");\n            return _context1.abrupt("return", {\n              getView: function getView() {\n                return document.createElement("div");\n              }\n            }.getView());\n          case 1:\n          case "end":\n            return _context1.stop();\n        }\n      }, _callee1);\n    }));\n    function view() {\n      return _view7.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: "*",\n  view: function view() {\n    return ErrorView().getView();\n  }\n}];\nvar router = new Router(routes);\nupdateAuthUI(authModel.isAuthenticated());\nif ("serviceWorker" in navigator) {\n  window.addEventListener("load", function () {\n    navigator.serviceWorker.register("/sw.js").then(/*#__PURE__*/function () {\n      var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee10(registration) {\n        var permission, _t3;\n        return regenerator_default().wrap(function (_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              if (!authModel.isAuthenticated()) {\n                _context10.next = 7;\n                break;\n              }\n              _context10.prev = 1;\n              if (!(Notification.permission === "granted")) {\n                _context10.next = 3;\n                break;\n              }\n              _context10.next = 2;\n              return subscribeUser(authModel.getToken());\n            case 2:\n              _context10.next = 5;\n              break;\n            case 3:\n              if (!(Notification.permission === "default")) {\n                _context10.next = 5;\n                break;\n              }\n              _context10.next = 4;\n              return requestNotificationPermission();\n            case 4:\n              permission = _context10.sent;\n              if (!permission) {\n                _context10.next = 5;\n                break;\n              }\n              _context10.next = 5;\n              return subscribeUser(authModel.getToken());\n            case 5:\n              _context10.next = 7;\n              break;\n            case 6:\n              _context10.prev = 6;\n              _t3 = _context10["catch"](1);\n              console.error("Push subscription failed:", _t3);\n            case 7:\n            case "end":\n              return _context10.stop();\n          }\n        }, _callee10, null, [[1, 6]]);\n      }));\n      return function (_x8) {\n        return _ref4.apply(this, arguments);\n      };\n    }())["catch"](function (error) {\n      console.error("Service worker registration failed:", error);\n    });\n  });\n  navigator.serviceWorker.addEventListener("message", function (event) {\n    var _event$data;\n    if (((_event$data = event.data) === null || _event$data === void 0 ? void 0 : _event$data.type) === "TRIGGER_SYNC") {\n      if (window.storyPresenter && typeof window.storyPresenter.handleOnline === "function") {\n        window.storyPresenter.handleOnline();\n      }\n    }\n  });\n}\nwindow.addEventListener("error", function (event) {\n  showNotification("An unexpected error occurred", {\n    type: "error"\n  });\n  console.error("Global error:", event.error);\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzQyNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7O0FBZ0JBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTs7Ozs7Ozs7Ozs7Ozs7OztBQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBOzs7OztBQ2RBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7O0FDUkE7QUFDQTtBQUNBO0FBRUE7QUFRQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7OztBQ2ZBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQXBFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQXVFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTs7Ozs7Ozs7Ozs7QUN2SEE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFOQTtBQUFBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFWQTtBQUFBO0FBQUE7QUFZQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQU5BO0FBQUE7QUFRQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQVZBO0FBQUE7QUFBQTs7Ozs7Ozs7O0FDZEE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUF0QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQXdCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFoQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFtQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDdEVBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFOQTtBQUFBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFWQTtBQUFBO0FBQUE7QUFZQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFOQTtBQUFBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFWQTtBQUFBO0FBQUE7QUFZQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBRkE7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFmQTtBQUFBO0FBQUE7QUFpQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFKQTtBQUFBO0FBTUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFSQTtBQUFBO0FBQUE7QUFVQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQU5BO0FBQUE7QUFRQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWxCQTtBQUFBO0FBQUE7QUFvQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFIQTtBQUFBO0FBS0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFmQTtBQUFBO0FBQUE7QUFpQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFQQTtBQUFBO0FBU0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFYQTtBQUFBO0FBQUE7QUFhQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFQQTtBQUFBO0FBU0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFYQTtBQUFBO0FBQUE7QUFhQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFQQTtBQUFBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFWQTtBQUFBO0FBQUE7QUFZQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBTEE7QUFBQTtBQU1BO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBUkE7QUFBQTtBQUFBO0FBVUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFKQTtBQUFBO0FBS0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFQQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQW5CQTtBQUFBO0FBQUE7QUFxQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFoQkE7QUFBQTtBQUFBO0FBbUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWpCQTtBQUFBO0FBQUE7QUFtQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFoQkE7QUFBQTtBQUFBO0FBa0JBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBMUJBO0FBQUE7QUFBQTtBQTBCQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBYkE7QUFBQTtBQUFBO0FBZUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBWEE7QUFBQTtBQUFBO0FBZUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUF6QkE7QUFBQTtBQUFBO0FBMkJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXpCQTtBQUFBO0FBQUE7QUEyQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXBCQTtBQUFBO0FBQUE7QUFzQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBUkE7QUFBQTtBQVVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUExQkE7QUFBQTtBQUFBO0FBNEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXJCQTtBQUFBO0FBQUE7QUF1QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWxCQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNuVEE7QUFPQTtBQWFBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBdkJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF5QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFsQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQW9CQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUZBO0FBQUE7QUFJQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFoQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWtDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFHQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBakNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFtQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUZBO0FBQUE7QUFBQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQVJBO0FBQUE7QUFVQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUF0REE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQXdEQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBckJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF1QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFoQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWtCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWZBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFpQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBTEE7QUFBQTtBQVFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBeEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUEwQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBaEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBb0JBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFIQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFGQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDOVRBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDQUE7QUFDQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBWkE7QUFBQTtBQUFBO0FBY0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUhBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBVEE7QUFBQTtBQVdBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQ0E7QUFBQTtBQUlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBM0NBO0FBQUE7QUFBQTtBQTZDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTtBQUhBO0FBQUE7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUF2QkE7QUFBQTtBQUFBO0FBeUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUlBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBekJBO0FBQUE7QUFBQTtBQTJCQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7QUMvSkE7QUFDQTtBQU1BO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7O0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUE1QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQThCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFkQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBZ0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBYkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN2RUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUZBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBOUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFnQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXBCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBc0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRkE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQW5CQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBcUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUF4QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQTBCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFHQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBMUJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUE0QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUdBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXJCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQXdCQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBekJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBMkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7Ozs7Ozs7O0FDM1BBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFUQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBV0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBdEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF3QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQVhBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBYUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTs7Ozs7Ozs7O0FDM0ZBO0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWRBO0FBQUE7QUFBQTtBQWdCQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBWUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7O0FDbEVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7OztBQzdEQTtBQUVBO0FBQUE7QUFDQTtBQUVBO0FBaUJBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7OztBQzFDQTtBQUVBO0FBQ0E7QUEwQkE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7OztBQ3pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUEwQkE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUE0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUMzTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUEyQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBbkRBO0FBQUE7QUFBQTtBQXFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNsUUE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUE4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7O0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBUkE7QUFBQTtBQUFBO0FBVUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBdENBO0FBQUE7QUFBQTtBQXdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQS9CQTtBQUFBO0FBQUE7QUFpQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQ2paQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBR0E7QUFHQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUdBO0FBQUE7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBUUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUF6QkE7QUFBQTtBQUFBO0FBMkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFUQTtBQUFBO0FBQUE7QUFBQTtBQVVBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBYkE7QUFBQTtBQUFBO0FBQUE7QUFjQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWpCQTtBQUFBO0FBQUE7QUFBQTtBQWtCQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWhCQTtBQUFBO0FBQUE7QUFBQTtBQWlCQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFHQTtBQUNBO0FBRUE7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBdkRBO0FBQUE7QUFBQTtBQUFBO0FBd0RBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQU5BO0FBT0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBakJBO0FBQUE7QUFBQTtBQUFBO0FBa0JBO0FBQUE7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBekRBO0FBQUE7QUFBQTtBQUFBO0FBMERBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBUEE7QUFBQTtBQUFBO0FBQUE7QUFRQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFJQTtBQUdBO0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFBQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL2NvbXBvbmVudHMvSGVhZGVyLmpzP2FkOGUiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3V0aWxzL3ZpZXctdHJhbnNpdGlvbi5qcz8yZDBmIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9jb21wb25lbnRzL0Zvb3Rlci5qcz8yNzBiIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy92aWV3cy9FcnJvclZpZXcuanM/NTk4MyIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvcm91dGVyLmpzPzQxY2IiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3NlcnZpY2VzL2F1dGhBcGkuanM/MDE5MiIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvbW9kZWxzL0F1dGhNb2RlbC5qcz83ODY3Iiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9kYXRhL2FwaS5qcz85MDlmIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9kYXRhL2RhdGFiYXNlLmpzPzM5MmYiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL21vZGVscy9TdG9yeU1vZGVsLmpzPzAzZDgiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3V0aWxzL2NvbmZpZy5qcz8wMWVhIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy91dGlscy9ub3RpZmljYXRpb24uanM/MjFhYyIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvcHJlc2VudGVycy9BdXRoUHJlc2VudGVyLmpzPzZjNzgiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ByZXNlbnRlcnMvU3RvcnlQcmVzZW50ZXIuanM/NDE4ZiIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvcHJlc2VudGVycy9NYXBQcmVzZW50ZXIuanM/MzM5OCIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdXRpbHMvU2tpcFRvQ29udGVudC5qcz85YTJjIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy92aWV3cy9CYXNlVmlldy5qcz83NGRmIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy92aWV3cy9hdXRoL0xvZ2luVmlldy5qcz8xZDU3Iiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy92aWV3cy9hdXRoL1JlZ2lzdGVyVmlldy5qcz84NjU4Iiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy92aWV3cy9zdG9yaWVzL1N0b3JpZXNWaWV3LmpzP2RiMGUiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ZpZXdzL3N0b3JpZXMvRGV0YWlsU3RvcnlWaWV3LmpzP2JiYTgiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ZpZXdzL3N0b3JpZXMvQWRkU3RvcnlWaWV3LmpzPzRlMGQiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3V0aWxzL2F1dGguanM/NWY4NyIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvYXBwLmpzPzExMTIiXSwic291cmNlc0NvbnRlbnQiOlsibGV0IGN1cnJlbnRBdXRoU3RhdGUgPSBmYWxzZTtcblxuZXhwb3J0IGNvbnN0IHVwZGF0ZUF1dGhVSSA9IChpc0xvZ2dlZEluKSA9PiB7XG4gIGN1cnJlbnRBdXRoU3RhdGUgPSBpc0xvZ2dlZEluO1xuICBjb25zdCBsb2dvdXRMaSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibG9nb3V0LWxpXCIpO1xuICBpZiAobG9nb3V0TGkpIHtcbiAgICBsb2dvdXRMaS5zdHlsZS5kaXNwbGF5ID0gaXNMb2dnZWRJbiA/IFwiYmxvY2tcIiA6IFwibm9uZVwiO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgSGVhZGVyID0gKCkgPT4ge1xuICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaGVhZGVyXCIpO1xuICBoZWFkZXIuaW5uZXJIVE1MID0gYFxuIDxuYXY+XG4gICAgICA8dWw+XG4gICAgICAgIDxsaT48YSBocmVmPVwiIy9zdG9yaWVzXCIgZGF0YS1uYXZpZ28+U3RvcmllczwvYT48L2xpPlxuICAgICAgICA8bGk+PGEgaHJlZj1cIiMvYWRkLXN0b3J5XCIgZGF0YS1uYXZpZ28+QWRkIFN0b3J5PC9hPjwvbGk+XG4gICAgICAgIDxsaSBpZD1cImluc3RhbGwtbGlcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+XG4gIDxhIGhyZWY9XCIjXCIgaWQ9XCJpbnN0YWxsLWJ1dHRvblwiIGNsYXNzPVwiYnRuXCIgZGF0YS1uYXZpZ28+SW5zdGFsbCBBcHA8L2E+XG48L2xpPlxuPGxpIGlkPVwibG9nb3V0LWxpXCIgc3R5bGU9XCJkaXNwbGF5OiAke2N1cnJlbnRBdXRoU3RhdGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIn1cIj5cbiAgPGEgaHJlZj1cIiNcIiBpZD1cImxvZ291dC1idXR0b25cIiBjbGFzcz1cImJ0blwiIGRhdGEtbmF2aWdvPkxvZ291dDwvYT5cbjwvbGk+XG5cbiAgICAgIDwvdWw+XG4gICAgPC9uYXY+XG4gIGA7XG5cbiAgLy8gTG9nb3V0IGhhbmRsZXJcbiAgaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoXCIjbG9nb3V0LWJ1dHRvblwiKT8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJsb2dvdXRcIikpO1xuICB9KTtcblxuICAvLyBOYXZpZ2F0aW9uIGhhbmRsZXJcbiAgY29uc3QgbmF2TGlua3MgPSBoZWFkZXIucXVlcnlTZWxlY3RvckFsbChcImFbZGF0YS1uYXZpZ29dXCIpO1xuICBuYXZMaW5rcy5mb3JFYWNoKChsaW5rKSA9PiB7XG4gICAgbGluay5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaGVhZGVyLW5hdmlnYXRpb25cIikpO1xuICAgIH0pO1xuICB9KTtcblxuICByZXR1cm4gaGVhZGVyO1xufTtcbiIsImV4cG9ydCBjb25zdCBzdGFydFZpZXdUcmFuc2l0aW9uID0gKGNhbGxiYWNrKSA9PiB7XG4gIGlmICghZG9jdW1lbnQuc3RhcnRWaWV3VHJhbnNpdGlvbikge1xuICAgIGNhbGxiYWNrKCk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgZG9jdW1lbnQuc3RhcnRWaWV3VHJhbnNpdGlvbigoKSA9PiB7XG4gICAgY2FsbGJhY2soKTtcbiAgfSk7XG59O1xuXG5kb2N1bWVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgndmlldy10cmFuc2l0aW9uLXN0YXJ0JykpO1xuXG4vLyBBcm91bmQgd2hlcmUgeW91ciB0cmFuc2l0aW9uIGNvbXBsZXRlc1xuZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3ZpZXctdHJhbnNpdGlvbi1lbmQnKSk7IiwiZXhwb3J0IGNvbnN0IEZvb3RlciA9ICgpID0+IHtcbiAgY29uc3QgZm9vdGVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImZvb3RlclwiKTtcblxuICBmb290ZXIuaW5uZXJIVE1MID0gYFxuICAgICAgPHA+JmNvcHk7ICR7bmV3IERhdGUoKS5nZXRGdWxsWWVhcigpfSBTdG9yeSBBcHAuIEFsbCByaWdodHMgcmVzZXJ2ZWQuPC9wPlxuICAgIGA7XG5cbiAgcmV0dXJuIGZvb3Rlcjtcbn07XG4iLCJleHBvcnQgY29uc3QgRXJyb3JWaWV3ID0gKCkgPT4ge1xuICBjb25zdCB2aWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbWFpbicpO1xuICB2aWV3LmlkID0gJ21haW4tY29udGVudCc7XG4gIFxuICB2aWV3LmlubmVySFRNTCA9IGBcbiAgICA8ZGl2IGNsYXNzPVwiZXJyb3ItbWVzc2FnZVwiPlxuICAgICAgPGgxPjQwNCBOb3QgRm91bmQ8L2gxPlxuICAgICAgPHA+VGhlIHBhZ2UgeW91J3JlIGxvb2tpbmcgZm9yIGRvZXNuJ3QgZXhpc3QuPC9wPlxuICAgICAgPGEgaHJlZj1cIiMvXCI+R28gdG8gSG9tZTwvYT5cbiAgICA8L2Rpdj5cbiAgYDtcbiAgXG4gIHJldHVybiB7XG4gICAgZ2V0VmlldzogKCkgPT4gdmlld1xuICB9O1xufTsiLCJpbXBvcnQgeyBzdGFydFZpZXdUcmFuc2l0aW9uIH0gZnJvbSBcIi4vdXRpbHMvdmlldy10cmFuc2l0aW9uLmpzXCI7XG5pbXBvcnQgeyBIZWFkZXIgfSBmcm9tIFwiLi9jb21wb25lbnRzL0hlYWRlci5qc1wiO1xuaW1wb3J0IHsgRm9vdGVyIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Gb290ZXIuanNcIjtcbmltcG9ydCB7IEVycm9yVmlldyB9IGZyb20gXCIuL3ZpZXdzL0Vycm9yVmlldy5qc1wiO1xuXG5leHBvcnQgY2xhc3MgUm91dGVyIHtcbiAgY29uc3RydWN0b3Iocm91dGVzKSB7XG4gICAgdGhpcy5yb3V0ZXMgPSByb3V0ZXM7XG4gICAgdGhpcy5yb290RWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXBwXCIpO1xuICAgIHRoaXMuY3VycmVudFByZXNlbnRlciA9IG51bGw7XG4gICAgdGhpcy5pbml0KCk7XG4gIH1cblxuICBpbml0KCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiaGFzaGNoYW5nZVwiLCAoKSA9PiB0aGlzLmhhbmRsZVJvdXRpbmcoKSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHRoaXMuaGFuZGxlUm91dGluZygpKTtcbiAgfVxuXG4gIGFzeW5jIGhhbmRsZVJvdXRpbmcoKSB7XG4gICAgY29uc3QgdXJsID0gd2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoMSkgfHwgXCIvXCI7XG4gICAgbGV0IHBhcmFtcyA9IHt9O1xuICAgIGNvbnN0IHJvdXRlID0gdGhpcy5maW5kTWF0Y2hpbmdSb3V0ZSh1cmwsIHBhcmFtcykgfHwgXG4gICAgICAgICAgICAgICAgIHRoaXMucm91dGVzLmZpbmQoKHIpID0+IHIucGF0aCA9PT0gXCIqXCIpO1xuXG4gICAgLy8gQ2xlYW4gdXAgcHJldmlvdXMgdmlld1xuICAgIGlmICh0aGlzLmN1cnJlbnRQcmVzZW50ZXI/LmNsZWFudXApIHtcbiAgICAgIHRoaXMuY3VycmVudFByZXNlbnRlci5jbGVhbnVwKCk7XG4gICAgfVxuXG4gICAgYXdhaXQgc3RhcnRWaWV3VHJhbnNpdGlvbihhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICB0aGlzLnJvb3RFbGVtLmlubmVySFRNTCA9IFwiXCI7XG5cbiAgICAgICAgLy8gQWRkIGhlYWRlciBpZiBhdXRoZW50aWNhdGVkXG4gICAgICAgIGlmICghW1wiL2xvZ2luXCIsIFwiL3JlZ2lzdGVyXCJdLmluY2x1ZGVzKHVybCkpIHtcbiAgICAgICAgICBjb25zdCBoZWFkZXIgPSBIZWFkZXIoKTtcbiAgICAgICAgICBjb25zdCBoZWFkZXJFbGVtZW50ID0gaGVhZGVyLmdldFZpZXc/LigpIHx8IGhlYWRlcjtcbiAgICAgICAgICBpZiAoaGVhZGVyRWxlbWVudCBpbnN0YW5jZW9mIE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMucm9vdEVsZW0uYXBwZW5kQ2hpbGQoaGVhZGVyRWxlbWVudCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gTG9hZCB2aWV3XG4gICAgICAgIGNvbnN0IHZpZXcgPSBhd2FpdCByb3V0ZS52aWV3KHBhcmFtcyk7XG4gICAgICAgIGNvbnN0IHZpZXdFbGVtZW50ID0gdmlldy5nZXRWaWV3Py4oKSB8fCB2aWV3O1xuXG4gICAgICAgIGlmICghKHZpZXdFbGVtZW50IGluc3RhbmNlb2YgTm9kZSkpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWaWV3IGlzIG5vdCBhIHZhbGlkIERPTSBub2RlXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRW5zdXJlIG1haW4gY29udGVudCBleGlzdHNcbiAgICAgICAgY29uc3QgbWFpbkNvbnRlbnQgPSB2aWV3RWxlbWVudC5xdWVyeVNlbGVjdG9yKCdtYWluJykgfHwgdmlld0VsZW1lbnQ7XG4gICAgICAgIGlmICghbWFpbkNvbnRlbnQuaWQpIHtcbiAgICAgICAgICBtYWluQ29udGVudC5pZCA9IFwibWFpbi1jb250ZW50XCI7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLnJvb3RFbGVtLmFwcGVuZENoaWxkKHZpZXdFbGVtZW50KTtcblxuICAgICAgICAvLyBBZGQgZm9vdGVyXG4gICAgICAgIGNvbnN0IGZvb3RlciA9IEZvb3RlcigpO1xuICAgICAgICBjb25zdCBmb290ZXJFbGVtZW50ID0gZm9vdGVyLmdldFZpZXc/LigpIHx8IGZvb3RlcjtcbiAgICAgICAgaWYgKGZvb3RlckVsZW1lbnQgaW5zdGFuY2VvZiBOb2RlKSB7XG4gICAgICAgICAgdGhpcy5yb290RWxlbS5hcHBlbmRDaGlsZChmb290ZXJFbGVtZW50KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNldCBmb2N1cyB0byBmaXJzdCBmb2N1c2FibGUgZWxlbWVudFxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICBjb25zdCBmaXJzdEZvY3VzYWJsZSA9IHRoaXMucm9vdEVsZW0ucXVlcnlTZWxlY3RvcihcbiAgICAgICAgICAgICdidXR0b24sIFtocmVmXSwgaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEsIFt0YWJpbmRleF06bm90KFt0YWJpbmRleD1cIi0xXCJdKSdcbiAgICAgICAgICApO1xuICAgICAgICAgIGZpcnN0Rm9jdXNhYmxlPy5mb2N1cygpO1xuICAgICAgICB9LCAxMDApO1xuXG4gICAgICAgIC8vIFN0b3JlIHByZXNlbnRlclxuICAgICAgICBpZiAocm91dGUucHJlc2VudGVyKSB7XG4gICAgICAgICAgdGhpcy5jdXJyZW50UHJlc2VudGVyID0gcm91dGUucHJlc2VudGVyO1xuICAgICAgICAgIHRoaXMuY3VycmVudFByZXNlbnRlci5hZnRlclJlbmRlcj8uKCk7XG4gICAgICAgIH1cblxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlJvdXRpbmcgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgY29uc3QgZXJyb3JWaWV3ID0gRXJyb3JWaWV3KCk7XG4gICAgICAgIHRoaXMucm9vdEVsZW0uaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgdGhpcy5yb290RWxlbS5hcHBlbmRDaGlsZChlcnJvclZpZXcuZ2V0VmlldygpKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZpbmRNYXRjaGluZ1JvdXRlKHVybCwgcGFyYW1zKSB7XG4gICAgcmV0dXJuIHRoaXMucm91dGVzLmZpbmQoKHJvdXRlKSA9PiB7XG4gICAgICBjb25zdCByb3V0ZVBhcnRzID0gcm91dGUucGF0aC5zcGxpdChcIi9cIik7XG4gICAgICBjb25zdCB1cmxQYXJ0cyA9IHVybC5zcGxpdChcIi9cIik7XG5cbiAgICAgIGlmIChyb3V0ZVBhcnRzLmxlbmd0aCAhPT0gdXJsUGFydHMubGVuZ3RoKSByZXR1cm4gZmFsc2U7XG5cbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm91dGVQYXJ0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCByb3V0ZVBhcnQgPSByb3V0ZVBhcnRzW2ldO1xuICAgICAgICBjb25zdCB1cmxQYXJ0ID0gdXJsUGFydHNbaV07XG5cbiAgICAgICAgaWYgKHJvdXRlUGFydC5zdGFydHNXaXRoKFwiOlwiKSkge1xuICAgICAgICAgIGNvbnN0IHBhcmFtTmFtZSA9IHJvdXRlUGFydC5zbGljZSgxKTtcbiAgICAgICAgICBwYXJhbXNbcGFyYW1OYW1lXSA9IHVybFBhcnQ7XG4gICAgICAgIH0gZWxzZSBpZiAocm91dGVQYXJ0ICE9PSB1cmxQYXJ0KSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuICB9XG5cbiAgbmF2aWdhdGVUbyhwYXRoKSB7XG4gICAgY29uc3QgY3VycmVudFBhdGggPSB3aW5kb3cubG9jYXRpb24uaGFzaC5zbGljZSgxKSB8fCBcIi9cIjtcblxuICAgIGlmIChjdXJyZW50UGF0aCA9PT0gXCIvYWRkLXN0b3J5XCIgJiYgdGhpcy5jdXJyZW50UHJlc2VudGVyKSB7XG4gICAgICB0aGlzLmN1cnJlbnRQcmVzZW50ZXIuY2xlYW51cCgpO1xuICAgIH1cblxuICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gcGF0aDtcbiAgfVxufSIsImNvbnN0IEFQSV9CQVNFX1VSTCA9ICdodHRwczovL3N0b3J5LWFwaS5kaWNvZGluZy5kZXYvdjEnO1xuXG5leHBvcnQgY29uc3QgbG9naW4gPSBhc3luYyAoZW1haWwsIHBhc3N3b3JkKSA9PiB7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9sb2dpbmAsIHtcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBoZWFkZXJzOiB7XG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlbWFpbCwgcGFzc3dvcmQgfSksXG4gIH0pO1xuICBcbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbn07XG5cbmV4cG9ydCBjb25zdCByZWdpc3RlciA9IGFzeW5jIChuYW1lLCBlbWFpbCwgcGFzc3dvcmQpID0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L3JlZ2lzdGVyYCwge1xuICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGVtYWlsLCBwYXNzd29yZCB9KSxcbiAgfSk7XG4gIFxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xufTsiLCJpbXBvcnQgeyBsb2dpbiwgcmVnaXN0ZXIgfSBmcm9tIFwiLi4vc2VydmljZXMvYXV0aEFwaVwiO1xuXG5leHBvcnQgY2xhc3MgQXV0aE1vZGVsIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy50b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidG9rZW5cIikgfHwgbnVsbDtcbiAgICB0aGlzLnVzZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidXNlclwiKSkgfHwgbnVsbDtcbiAgfVxuXG4gIGFzeW5jIGxvZ2luKGVtYWlsLCBwYXNzd29yZCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGxvZ2luKGVtYWlsLCBwYXNzd29yZCk7XG5cbiAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHtcbiAgICAgICAgdGhpcy50b2tlbiA9IHJlc3BvbnNlLmxvZ2luUmVzdWx0LnRva2VuO1xuICAgICAgICB0aGlzLnVzZXIgPSB7XG4gICAgICAgICAgdXNlcklkOiByZXNwb25zZS5sb2dpblJlc3VsdC51c2VySWQsXG4gICAgICAgICAgbmFtZTogcmVzcG9uc2UubG9naW5SZXN1bHQubmFtZSxcbiAgICAgICAgfTtcblxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRva2VuXCIsIHRoaXMudG9rZW4pO1xuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInVzZXJcIiwgSlNPTi5zdHJpbmdpZnkodGhpcy51c2VyKSk7XG5cbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdXNlcjogdGhpcy51c2VyIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiByZXNwb25zZS5tZXNzYWdlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMb2dpbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiTG9naW4gZmFpbGVkLiBQbGVhc2UgdHJ5IGFnYWluLlwiIH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgcmVnaXN0ZXIobmFtZSwgZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVnaXN0ZXIobmFtZSwgZW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiByZXNwb25zZS5tZXNzYWdlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJSZWdpc3RyYXRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBcIlJlZ2lzdHJhdGlvbiBmYWlsZWQuIFBsZWFzZSB0cnkgYWdhaW4uXCIsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGxvZ291dCgpIHtcbiAgICB0aGlzLnRva2VuID0gbnVsbDtcbiAgICB0aGlzLnVzZXIgPSBudWxsO1xuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwidG9rZW5cIik7XG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oXCJ1c2VyXCIpO1xuICB9XG5cbiAgaXNBdXRoZW50aWNhdGVkKCkge1xuICAgIHJldHVybiAhIXRoaXMudG9rZW47XG4gIH1cblxuICBnZXRVc2VyKCkge1xuICAgIHJldHVybiB0aGlzLnVzZXI7XG4gIH1cblxuICBnZXRUb2tlbigpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcIkF1dGhNb2RlbC5nZXRUb2tlbiBjYWxsZWRcIik7XG4gICAgLy8gY29uc29sZS5sb2coXCJBdXRoTW9kZWwgdHlwZTpcIiwgdHlwZW9mIEF1dGhNb2RlbCk7XG4gICAgLy8gY29uc29sZS5sb2coXCJBdXRoTW9kZWw6XCIsIEF1dGhNb2RlbCk7XG4gICAgcmV0dXJuIHRoaXMudG9rZW47XG4gIH1cbn1cbiIsImNvbnN0IEFQSV9CQVNFX1VSTCA9IFwiaHR0cHM6Ly9zdG9yeS1hcGkuZGljb2RpbmcuZGV2L3YxXCI7XG5cbmV4cG9ydCBjb25zdCByZWdpc3RlciA9IGFzeW5jIChuYW1lLCBlbWFpbCwgcGFzc3dvcmQpID0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L3JlZ2lzdGVyYCwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGVtYWlsLCBwYXNzd29yZCB9KSxcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbn07XG5cbmV4cG9ydCBjb25zdCBsb2dpbiA9IGFzeW5jIChlbWFpbCwgcGFzc3dvcmQpID0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L2xvZ2luYCwge1xuICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVtYWlsLCBwYXNzd29yZCB9KSxcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbn07XG5cbmV4cG9ydCBjb25zdCBnZXRBbGxTdG9yaWVzID0gYXN5bmMgKHRva2VuLCBwYWdlLCBzaXplLCB3aXRoTG9jYXRpb24pID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vc3Rvcmllcz9wYWdlPSR7cGFnZX0mc2l6ZT0ke3NpemV9JmxvY2F0aW9uPSR7d2l0aExvY2F0aW9uID8gMSA6IDB9YCwge1xuICAgICAgaGVhZGVyczogeyBBdXRob3JpemF0aW9uOiBgQmVhcmVyICR7dG9rZW59YCB9XG4gICAgfSk7XG4gICAgXG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICBjb25zb2xlLmxvZygnQVBJIFJlc3BvbnNlOicsIGRhdGEpOyAvLyBEZWJ1ZyBsb2dcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB0aHJvdyBuZXcgRXJyb3IoZGF0YS5tZXNzYWdlIHx8ICdGYWlsZWQgdG8gZmV0Y2gnKTtcbiAgICByZXR1cm4gZGF0YTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdBUEkgRXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0U3RvcnlEZXRhaWwgPSBhc3luYyAoaWQsIHRva2VuKSA9PiB7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9zdG9yaWVzLyR7aWR9YCwge1xuICAgIGhlYWRlcnM6IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxuICAgIH0sXG4gIH0pO1xuXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XG59O1xuXG5leHBvcnQgY29uc3QgYWRkU3RvcnkgPSBhc3luYyAoZGF0YSwgdG9rZW4pID0+IHtcbiAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgZm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XG4gIGZvcm1EYXRhLmFwcGVuZChcInBob3RvXCIsIGRhdGEucGhvdG8pO1xuICBpZiAoZGF0YS5sYXQgJiYgZGF0YS5sb24pIHtcbiAgICBmb3JtRGF0YS5hcHBlbmQoXCJsYXRcIiwgZGF0YS5sYXQpO1xuICAgIGZvcm1EYXRhLmFwcGVuZChcImxvblwiLCBkYXRhLmxvbik7XG4gIH1cblxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vc3Rvcmllc2AsIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxuICAgIH0sXG4gICAgYm9keTogZm9ybURhdGEsXG4gIH0pO1xuXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XG59O1xuXG5leHBvcnQgY29uc3QgYWRkU3RvcnlHdWVzdCA9IGFzeW5jIChkYXRhKSA9PiB7XG4gIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gIGZvcm1EYXRhLmFwcGVuZChcImRlc2NyaXB0aW9uXCIsIGRhdGEuZGVzY3JpcHRpb24pO1xuICBmb3JtRGF0YS5hcHBlbmQoXCJwaG90b1wiLCBkYXRhLnBob3RvKTtcbiAgaWYgKGRhdGEubGF0ICYmIGRhdGEubG9uKSB7XG4gICAgZm9ybURhdGEuYXBwZW5kKFwibGF0XCIsIGRhdGEubGF0KTtcbiAgICBmb3JtRGF0YS5hcHBlbmQoXCJsb25cIiwgZGF0YS5sb24pO1xuICB9XG5cbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L3N0b3JpZXMvZ3Vlc3RgLCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBib2R5OiBmb3JtRGF0YSxcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbn07XG5cbmV4cG9ydCBjb25zdCBzdWJzY3JpYmVUb05vdGlmaWNhdGlvbnMgPSBhc3luYyAoc3Vic2NyaXB0aW9uLCB0b2tlbikgPT4ge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vbm90aWZpY2F0aW9ucy9zdWJzY3JpYmVgLCB7XG4gICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICBoZWFkZXJzOiB7XG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxuICAgIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc3Vic2NyaXB0aW9uKSxcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbn07XG5cbmV4cG9ydCBjb25zdCB1bnN1YnNjcmliZUZyb21Ob3RpZmljYXRpb25zID0gYXN5bmMgKGVuZHBvaW50LCB0b2tlbikgPT4ge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vbm90aWZpY2F0aW9ucy9zdWJzY3JpYmVgLCB7XG4gICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGVuZHBvaW50IH0pLFxuICB9KTtcblxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xufTtcblxuZXhwb3J0IGNvbnN0IGJvb2ttYXJrU3RvcnkgPSBhc3luYyAoc3RvcnlJZCwgdG9rZW4pID0+IHtcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L2Jvb2ttYXJrc2AsIHtcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHN0b3J5SWQgfSksXG4gIH0pO1xuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xufTtcblxuZXhwb3J0IGNvbnN0IHVuYm9va21hcmtTdG9yeSA9IGFzeW5jIChzdG9yeUlkLCB0b2tlbikgPT4ge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vYm9va21hcmtzLyR7c3RvcnlJZH1gLCB7XG4gICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgIGhlYWRlcnM6IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxuICAgIH0sXG4gIH0pO1xuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xufTtcblxuZXhwb3J0IGNvbnN0IGdldEJvb2ttYXJrZWRTdG9yaWVzID0gYXN5bmMgKHRva2VuKSA9PiB7XG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9ib29rbWFya3NgLCB7XG4gICAgaGVhZGVyczoge1xuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAsXG4gICAgfSxcbiAgfSk7XG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XG59OyIsImV4cG9ydCBjb25zdCBpbml0REIgPSAoKSA9PiB7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4ZWREQi5vcGVuKFwiU3RvcnlBcHBEQlwiLCAyKTtcblxuICAgIHJlcXVlc3Qub25lcnJvciA9IChldmVudCkgPT4ge1xuICAgICAgY29uc29sZS5lcnJvcihcIkRhdGFiYXNlIGVycm9yOlwiLCBldmVudC50YXJnZXQuZXJyb3IpO1xuICAgICAgcmVqZWN0KFwiRGF0YWJhc2UgZXJyb3JcIik7XG4gICAgfTtcblxuICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gKGV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBkYiA9IGV2ZW50LnRhcmdldC5yZXN1bHQ7XG4gICAgICBjb25zdCBvbGRWZXJzaW9uID0gZXZlbnQub2xkVmVyc2lvbjtcbiAgICAgIGNvbnN0IG5ld1ZlcnNpb24gPSBldmVudC5uZXdWZXJzaW9uO1xuXG4gICAgICBjb25zb2xlLmxvZyhgVXBncmFkaW5nIERCIGZyb20gdiR7b2xkVmVyc2lvbn0gdG8gdiR7bmV3VmVyc2lvbn1gKTtcblxuXG4gICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoXCJzdG9yaWVzXCIpKSB7XG4gICAgICAgIGNvbnN0IHN0b3JpZXNTdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKFwic3Rvcmllc1wiLCB7IGtleVBhdGg6IFwiaWRcIiB9KTtcbiAgICAgICAgc3Rvcmllc1N0b3JlLmNyZWF0ZUluZGV4KFwiY3JlYXRlZEF0XCIsIFwiY3JlYXRlZEF0XCIsIHsgdW5pcXVlOiBmYWxzZSB9KTtcbiAgICAgIH1cblxuXG4gICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoXCJ1c2VyXCIpKSB7XG4gICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKFwidXNlclwiLCB7IGtleVBhdGg6IFwiaWRcIiB9KTtcbiAgICAgIH1cblxuXG4gICAgICBpZiAoIWRiLm9iamVjdFN0b3JlTmFtZXMuY29udGFpbnMoXCJib29rbWFya3NcIikpIHtcbiAgICAgICAgY29uc3QgYm9va21hcmtzU3RvcmUgPSBkYi5jcmVhdGVPYmplY3RTdG9yZShcImJvb2ttYXJrc1wiLCB7IGtleVBhdGg6IFwiaWRcIiB9KTtcbiAgICAgICAgYm9va21hcmtzU3RvcmUuY3JlYXRlSW5kZXgoXCJzdG9yeUlkXCIsIFwic3RvcnlJZFwiLCB7IHVuaXF1ZTogdHJ1ZSB9KTtcbiAgICAgICAgYm9va21hcmtzU3RvcmUuY3JlYXRlSW5kZXgoXCJjcmVhdGVkQXRcIiwgXCJjcmVhdGVkQXRcIiwgeyB1bmlxdWU6IGZhbHNlIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xuICAgICAgY29uc29sZS5sb2coXCJEYXRhYmFzZSBvcGVuZWQgc3VjY2Vzc2Z1bGx5XCIpO1xuICAgICAgcmVzb2x2ZShldmVudC50YXJnZXQucmVzdWx0KTtcbiAgICB9O1xuICB9KTtcbn07XG5cblxuZXhwb3J0IGNvbnN0IHNhdmVTdG9yaWVzID0gYXN5bmMgKHN0b3JpZXMpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBkYiA9IGF3YWl0IGluaXREQigpO1xuICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oXCJzdG9yaWVzXCIsIFwicmVhZHdyaXRlXCIpO1xuICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJzdG9yaWVzXCIpO1xuXG4gICAgc3Rvcmllcy5mb3JFYWNoKChzdG9yeSkgPT4ge1xuICAgICAgc3RvcmUucHV0KHN0b3J5KTtcbiAgICB9KTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdHJhbnNhY3Rpb24ub25jb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzYXZlIHN0b3JpZXM6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRTdG9yaWVzID0gYXN5bmMgKCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XG4gICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihcInN0b3JpZXNcIiwgXCJyZWFkb25seVwiKTtcbiAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwic3Rvcmllc1wiKTtcbiAgICBjb25zdCByZXF1ZXN0ID0gc3RvcmUuZ2V0QWxsKCk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4ge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0IHx8IFtdKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgc3RvcmllczpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBbXTtcbiAgfVxufTtcblxuXG5leHBvcnQgY29uc3Qgc2F2ZVVzZXJEYXRhID0gYXN5bmMgKHVzZXJEYXRhKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBpbml0REIoKTtcbiAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFwidXNlclwiLCBcInJlYWR3cml0ZVwiKTtcbiAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwidXNlclwiKTtcblxuICAgIHN0b3JlLnB1dCh7IGlkOiBcImN1cnJlbnRVc2VyXCIsIC4uLnVzZXJEYXRhIH0pO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gKCkgPT4ge1xuICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgdXNlciBkYXRhOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0VXNlckRhdGEgPSBhc3luYyAoKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBpbml0REIoKTtcbiAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFwidXNlclwiLCBcInJlYWRvbmx5XCIpO1xuICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJ1c2VyXCIpO1xuICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5nZXQoXCJjdXJyZW50VXNlclwiKTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQgfHwgbnVsbCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHVzZXIgZGF0YTpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG5sZXQgaXNXcml0aW5nID0gZmFsc2U7XG5cbmV4cG9ydCBjb25zdCBhZGRTdG9yeU9mZmxpbmUgPSBhc3luYyAoc3RvcnkpID0+IHtcbiAgaWYgKGlzV3JpdGluZykge1xuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICByZXR1cm4gYWRkU3RvcnlPZmZsaW5lKHN0b3J5KTsgXG4gIH1cblxuICBpc1dyaXRpbmcgPSB0cnVlO1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcInN0b3JpZXNcIiwgXCJyZWFkd3JpdGVcIik7XG4gICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInN0b3JpZXNcIik7XG4gICAgc3RvcmUucHV0KHN0b3J5KTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgdHgub25jb21wbGV0ZSA9ICgpID0+IHJlc29sdmUodHJ1ZSk7XG4gICAgICB0eC5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiVHJhbnNhY3Rpb24gZmFpbGVkOlwiLCB0eC5lcnJvcik7XG4gICAgICAgIHJlc29sdmUoZmFsc2UpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgc3Rvcnkgb2ZmbGluZTpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfSBmaW5hbGx5IHtcbiAgICBpc1dyaXRpbmcgPSBmYWxzZTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGRlbGV0ZVN0b3J5T2ZmbGluZSA9IGFzeW5jIChpZCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcInN0b3JpZXNcIiwgXCJyZWFkd3JpdGVcIik7XG4gICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInN0b3JpZXNcIik7XG4gICAgc3RvcmUuZGVsZXRlKGlkKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHR4Lm9uY29tcGxldGUgPSAoKSA9PiByZXNvbHZlKHRydWUpO1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZGVsZXRlIHN0b3J5OlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZ2V0T2ZmbGluZVN0b3JpZXMgPSBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XG4gIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oXCJzdG9yaWVzXCIsIFwicmVhZG9ubHlcIik7XG4gIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJzdG9yaWVzXCIpO1xuICBjb25zdCByZXF1ZXN0ID0gc3RvcmUuZ2V0QWxsKCk7XG4gIFxuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcbiAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQuZmlsdGVyKHN0b3J5ID0+IHN0b3J5LmlzT2ZmbGluZSkpO1xuICAgIH07XG4gIH0pO1xufTtcblxuXG5cbmV4cG9ydCBjb25zdCBhZGRCb29rbWFyayA9IGFzeW5jIChzdG9yeUlkKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBpbml0REIoKTtcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwiYm9va21hcmtzXCIsIFwicmVhZHdyaXRlXCIpO1xuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJib29rbWFya3NcIik7XG4gICAgXG4gICAgY29uc3QgYm9va21hcmsgPSB7XG4gICAgICBpZDogYGJvb2ttYXJrXyR7RGF0ZS5ub3coKX1gLFxuICAgICAgc3RvcnlJZCxcbiAgICAgIGNyZWF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgfTtcbiAgICBcbiAgICBzdG9yZS5wdXQoYm9va21hcmspO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICB0eC5vbmNvbXBsZXRlID0gKCkgPT4gcmVzb2x2ZSh0cnVlKTtcbiAgICAgIHR4Lm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJCb29rbWFyayB0cmFuc2FjdGlvbiBmYWlsZWQ6XCIsIHR4LmVycm9yKTtcbiAgICAgICAgcmVzb2x2ZShmYWxzZSk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gYWRkIGJvb2ttYXJrOlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgcmVtb3ZlQm9va21hcmsgPSBhc3luYyAoc3RvcnlJZCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcImJvb2ttYXJrc1wiLCBcInJlYWR3cml0ZVwiKTtcbiAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwiYm9va21hcmtzXCIpO1xuICAgIGNvbnN0IGluZGV4ID0gc3RvcmUuaW5kZXgoXCJzdG9yeUlkXCIpO1xuICAgIFxuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleC5nZXQoc3RvcnlJZCk7XG4gICAgXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcbiAgICAgICAgaWYgKHJlcXVlc3QucmVzdWx0KSB7XG4gICAgICAgICAgc3RvcmUuZGVsZXRlKHJlcXVlc3QucmVzdWx0LmlkKTtcbiAgICAgICAgfVxuICAgICAgICByZXNvbHZlKHRydWUpO1xuICAgICAgfTtcbiAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIGZpbmRpbmcgYm9va21hcms6XCIsIHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byByZW1vdmUgYm9va21hcms6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRCb29rbWFya3MgPSBhc3luYyAoKSA9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgZGIgPSBhd2FpdCBpbml0REIoKTtcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwiYm9va21hcmtzXCIsIFwicmVhZG9ubHlcIik7XG4gICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcImJvb2ttYXJrc1wiKTtcbiAgICBjb25zdCByZXF1ZXN0ID0gc3RvcmUuZ2V0QWxsKCk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gKCkgPT4ge1xuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0IHx8IFtdKTtcbiAgICAgIH07XG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBnZXR0aW5nIGJvb2ttYXJrczpcIiwgcmVxdWVzdC5lcnJvcik7XG4gICAgICAgIHJlc29sdmUoW10pO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBib29rbWFya3M6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBnZXRCb29rbWFya2VkU3RvcmllcyA9IGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBkYiA9IGF3YWl0IGluaXREQigpO1xuICAgIGNvbnN0IGJvb2ttYXJrcyA9IGF3YWl0IGdldEJvb2ttYXJrcygpO1xuICAgIGNvbnN0IHN0b3J5SWRzID0gYm9va21hcmtzLm1hcChiID0+IGIuc3RvcnlJZCk7XG5cbiAgICBpZiAoc3RvcnlJZHMubGVuZ3RoID09PSAwKSByZXR1cm4gW107XG5cbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwic3Rvcmllc1wiLCBcInJlYWRvbmx5XCIpO1xuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJzdG9yaWVzXCIpO1xuICAgIFxuICAgIGNvbnN0IHN0b3JpZXMgPSBhd2FpdCBQcm9taXNlLmFsbChcbiAgICAgIHN0b3J5SWRzLm1hcChpZCA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gc3RvcmUuZ2V0KGlkKTtcbiAgICAgICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHJlc29sdmUocmVxdWVzdC5yZXN1bHQpO1xuICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHJlc29sdmUobnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgcmV0dXJuIHN0b3JpZXMuZmlsdGVyKHN0b3J5ID0+IHN0b3J5ICE9PSBudWxsKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGdldCBib29rbWFya2VkIHN0b3JpZXM6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gW107XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBpc0Jvb2ttYXJrZWQgPSBhc3luYyAoc3RvcnlJZCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcImJvb2ttYXJrc1wiLCBcInJlYWRvbmx5XCIpO1xuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJib29rbWFya3NcIik7XG4gICAgY29uc3QgaW5kZXggPSBzdG9yZS5pbmRleChcInN0b3J5SWRcIik7XG4gICAgY29uc3QgcmVxdWVzdCA9IGluZGV4LmdldChzdG9yeUlkKTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgIHJlc29sdmUoISFyZXF1ZXN0LnJlc3VsdCk7XG4gICAgICB9O1xuICAgICAgcmVxdWVzdC5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgY2hlY2tpbmcgYm9va21hcms6XCIsIHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBjaGVjayBib29rbWFyazpcIiwgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufTtcblxuZXhwb3J0IGNvbnN0IGNsZWFyQWxsQm9va21hcmtzID0gYXN5bmMgKCkgPT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbihcImJvb2ttYXJrc1wiLCBcInJlYWR3cml0ZVwiKTtcbiAgICBjb25zdCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFwiYm9va21hcmtzXCIpO1xuICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5jbGVhcigpO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHJlc29sdmUodHJ1ZSk7XG4gICAgICByZXF1ZXN0Lm9uZXJyb3IgPSAoKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBjbGVhcmluZyBib29rbWFya3M6XCIsIHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICByZXNvbHZlKGZhbHNlKTtcbiAgICAgIH07XG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBjbGVhciBib29rbWFya3M6XCIsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn07IiwiaW1wb3J0IHtcbiAgZ2V0QWxsU3RvcmllcyxcbiAgZ2V0U3RvcnlEZXRhaWwsXG4gIGFkZFN0b3J5LFxuICBhZGRTdG9yeUd1ZXN0LFxufSBmcm9tIFwiLi4vZGF0YS9hcGkuanNcIjtcblxuaW1wb3J0IHtcbiAgc2F2ZVN0b3JpZXMsXG4gIGdldFN0b3JpZXMsXG4gIGFkZFN0b3J5T2ZmbGluZSxcbiAgZGVsZXRlU3RvcnlPZmZsaW5lLFxuICBnZXRPZmZsaW5lU3RvcmllcyxcblxuICBhZGRCb29rbWFyayxcbiAgcmVtb3ZlQm9va21hcmssXG4gIGdldEJvb2ttYXJrZWRTdG9yaWVzLFxuICBpc0Jvb2ttYXJrZWQsXG59IGZyb20gXCIuLi9kYXRhL2RhdGFiYXNlLmpzXCI7XG5cbmV4cG9ydCBjbGFzcyBTdG9yeU1vZGVsIHtcbiAgY29uc3RydWN0b3IoYXV0aE1vZGVsKSB7XG4gICAgdGhpcy5hdXRoTW9kZWwgPSBhdXRoTW9kZWw7XG4gIH1cblxuXG4gIGFzeW5jIGdldEFsbFN0b3JpZXMocGFnZSA9IDEsIHNpemUgPSAxMCwgd2l0aExvY2F0aW9uID0gZmFsc2UpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmF1dGhNb2RlbC5nZXRUb2tlbigpO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRBbGxTdG9yaWVzKHRva2VuLCBwYWdlLCBzaXplLCB3aXRoTG9jYXRpb24pO1xuXG4gICAgICBpZiAoIXJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN0b3JpZXM6IHJlc3BvbnNlLmxpc3RTdG9yeSB9O1xuICAgICAgfVxuXG4gICAgICBjb25zdCBvZmZsaW5lU3RvcmllcyA9IGF3YWl0IGdldFN0b3JpZXMoKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIHN0b3JpZXM6IG9mZmxpbmVTdG9yaWVzLFxuICAgICAgICBpc09mZmxpbmU6IHRydWUsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBvZmZsaW5lU3RvcmllcyA9IGF3YWl0IGdldFN0b3JpZXMoKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6ICEhb2ZmbGluZVN0b3JpZXMubGVuZ3RoLFxuICAgICAgICBzdG9yaWVzOiBvZmZsaW5lU3RvcmllcyB8fCBbXSxcbiAgICAgICAgaXNPZmZsaW5lOiB0cnVlLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBnZXRTdG9yeURldGFpbChpZCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aE1vZGVsLmdldFRva2VuKCk7XG4gICAgICBpZiAoIXRva2VuKSByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogXCJBdXRoZW50aWNhdGlvbiByZXF1aXJlZFwiIH07XG5cbiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0U3RvcnlEZXRhaWwoaWQsIHRva2VuKTtcbiAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN0b3J5OiByZXNwb25zZS5zdG9yeSB9O1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogcmVzcG9uc2UubWVzc2FnZSB8fCBcIkZhaWxlZCB0byBmZXRjaCBzdG9yeVwiLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJOZXR3b3JrIGVycm9yIHdoaWxlIGZldGNoaW5nIHN0b3J5XCIsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFkZFN0b3J5KGRhdGEpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmF1dGhNb2RlbC5nZXRUb2tlbigpO1xuICAgICAgaWYgKCFkYXRhPy5kZXNjcmlwdGlvbiB8fCAhZGF0YT8ucGhvdG8pIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiBcIkRlc2NyaXB0aW9uIGFuZCBwaG90byBhcmUgcmVxdWlyZWRcIixcbiAgICAgICAgfTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgcmVzcG9uc2UgPSB0b2tlblxuICAgICAgICA/IGF3YWl0IGFkZFN0b3J5KGRhdGEsIHRva2VuKVxuICAgICAgICA6IGF3YWl0IGFkZFN0b3J5R3Vlc3QoZGF0YSk7XG5cbiAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICAgIG1lc3NhZ2U6IFwiU3RvcnkgYWRkZWQgc3VjY2Vzc2Z1bGx5XCIsXG4gICAgICAgICAgZGF0YTogcmVzcG9uc2UsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiByZXNwb25zZS5tZXNzYWdlIHx8IFwiRmFpbGVkIHRvIGFkZCBzdG9yeVwiLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJOZXR3b3JrIGVycm9yIHdoaWxlIGFkZGluZyBzdG9yeVwiLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBhZGRTdG9yeU9mZmxpbmUoZGF0YSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzdG9yeUlkID0gYG9mZmxpbmVfJHtEYXRlLm5vdygpfV8ke01hdGguZmxvb3IoXG4gICAgICAgIE1hdGgucmFuZG9tKCkgKiAxMDAwXG4gICAgICApfWA7XG4gICAgICBsZXQgcGhvdG9VcmwgPSBcIlwiO1xuICAgICAgbGV0IHBob3RvQmFzZTY0ID0gXCJcIjtcblxuICAgICAgaWYgKGRhdGEucGhvdG8gaW5zdGFuY2VvZiBCbG9iIHx8IGRhdGEucGhvdG8gaW5zdGFuY2VvZiBGaWxlKSB7XG4gICAgICAgIHBob3RvQmFzZTY0ID0gYXdhaXQgdGhpcy5yZWFkRmlsZUFzQmFzZTY0KGRhdGEucGhvdG8pO1xuICAgICAgICBwaG90b1VybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoZGF0YS5waG90byk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN0b3J5ID0ge1xuICAgICAgICBpZDogc3RvcnlJZCxcbiAgICAgICAgbmFtZTogXCJZb3UgKE9mZmxpbmUpXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkYXRhLmRlc2NyaXB0aW9uLFxuICAgICAgICBwaG90b1VybDogcGhvdG9VcmwgfHwgXCIvYXNzZXRzL2ltYWdlcy9wbGFjZWhvbGRlci1vZmZsaW5lLmpwZ1wiLFxuICAgICAgICBwaG90b0Jhc2U2NCxcbiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBpc09mZmxpbmU6IHRydWUsXG4gICAgICAgIGxhdDogZGF0YS5sYXQsXG4gICAgICAgIGxvbjogZGF0YS5sb24sXG4gICAgICAgIG9yaWdpbmFsUGhvdG86IGRhdGEucGhvdG8sXG4gICAgICB9O1xuXG4gICAgICBhd2FpdCBhZGRTdG9yeU9mZmxpbmUoc3RvcnkpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc3RvcnkgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzYXZlIG9mZmxpbmUgc3Rvcnk6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvciB9O1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHN5bmNPZmZsaW5lU3RvcmllcyhzeW5jUXVldWUpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb2ZmbGluZVN0b3JpZXMgPSBhd2FpdCB0aGlzLmdldE9mZmxpbmVTdG9yaWVzKCk7XG4gICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aE1vZGVsLmdldFRva2VuKCk7XG5cbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJObyBhdXRoIHRva2VuIC0gc2tpcHBpbmcgc3luY1wiKTtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkF1dGhlbnRpY2F0aW9uIHJlcXVpcmVkXCIgfTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgdG9TeW5jID0gb2ZmbGluZVN0b3JpZXNcbiAgICAgICAgLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGEuY3JlYXRlZEF0KSAtIG5ldyBEYXRlKGIuY3JlYXRlZEF0KSlcbiAgICAgICAgLmZpbHRlcigoc3RvcnkpID0+IHN5bmNRdWV1ZS5oYXMoc3RvcnkuaWQpKTtcblxuICAgICAgaWYgKHRvU3luYy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJObyBzdG9yaWVzIHRvIHN5bmNcIik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN5bmNlZElkczogW10gfTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3luY2VkSWRzID0gW107XG5cbiAgICAgIGZvciAoY29uc3Qgc3Rvcnkgb2YgdG9TeW5jKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgcGhvdG9CbG9iID0gc3RvcnkucGhvdG9CYXNlNjRcbiAgICAgICAgICAgID8gYXdhaXQgdGhpcy5iYXNlNjRUb0Jsb2Ioc3RvcnkucGhvdG9CYXNlNjQpXG4gICAgICAgICAgICA6IHN0b3J5Lm9yaWdpbmFsUGhvdG87XG5cbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGFkZFN0b3J5KFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogc3RvcnkuZGVzY3JpcHRpb24sXG4gICAgICAgICAgICAgIHBob3RvOiBwaG90b0Jsb2IsXG4gICAgICAgICAgICAgIGxhdDogc3RvcnkubGF0LFxuICAgICAgICAgICAgICBsb246IHN0b3J5LmxvbixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b2tlblxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBpZiAoIXJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICBhd2FpdCBkZWxldGVTdG9yeU9mZmxpbmUoc3RvcnkuaWQpO1xuICAgICAgICAgICAgc3luY2VkSWRzLnB1c2goc3RvcnkuaWQpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gc3luYyAke3N0b3J5LmlkfTpgLCBlcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2Vzczogc3luY2VkSWRzLmxlbmd0aCA+IDAsXG4gICAgICAgIHN5bmNlZElkcyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJTeW5jIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3IgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBib29rbWFya1N0b3J5KHN0b3J5SWQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaXNBbHJlYWR5Qm9va21hcmtlZCA9IGF3YWl0IGlzQm9va21hcmtlZChzdG9yeUlkKTtcbiAgICAgIGlmIChpc0FscmVhZHlCb29rbWFya2VkKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIlN0b3J5IGFscmVhZHkgYm9va21hcmtlZFwiIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBhd2FpdCBhZGRCb29rbWFyayhzdG9yeUlkKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3MsXG4gICAgICAgIG1lc3NhZ2U6IHN1Y2Nlc3NcbiAgICAgICAgICA/IFwiU3RvcnkgYm9va21hcmtlZCBzdWNjZXNzZnVsbHlcIlxuICAgICAgICAgIDogXCJGYWlsZWQgdG8gYm9va21hcmsgc3RvcnlcIixcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJCb29rbWFyayBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gYm9va21hcmsgc3RvcnlcIixcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgdW5ib29rbWFya1N0b3J5KHN0b3J5SWQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3VjY2VzcyA9IGF3YWl0IHJlbW92ZUJvb2ttYXJrKHN0b3J5SWQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzcyxcbiAgICAgICAgbWVzc2FnZTogc3VjY2Vzc1xuICAgICAgICAgID8gXCJTdG9yeSByZW1vdmVkIGZyb20gYm9va21hcmtzXCJcbiAgICAgICAgICA6IFwiRmFpbGVkIHRvIHJlbW92ZSBib29rbWFya1wiLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIlVuYm9va21hcmsgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8IFwiRmFpbGVkIHRvIHJlbW92ZSBib29rbWFya1wiLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBhc3luYyB0b2dnbGVCb29rbWFyayhzdG9yeUlkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRseUJvb2ttYXJrZWQgPSBhd2FpdCBpc0Jvb2ttYXJrZWQoc3RvcnlJZCk7XG4gICAgICBpZiAoY3VycmVudGx5Qm9va21hcmtlZCkge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy51bmJvb2ttYXJrU3Rvcnkoc3RvcnlJZCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5ib29rbWFya1N0b3J5KHN0b3J5SWQpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiVG9nZ2xlIGJvb2ttYXJrIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSB8fCBcIkZhaWxlZCB0byB0b2dnbGUgYm9va21hcmtcIixcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0Qm9va21hcmtlZFN0b3JpZXMoKSB7XG4gICAgdHJ5IHtcblxuICAgICAgY29uc3QgeyBzdG9yaWVzIH0gPSBhd2FpdCB0aGlzLmdldEFsbFN0b3JpZXMoKTtcbiAgICAgIGNvbnN0IGJvb2ttYXJrZWRTdG9yaWVzID0gYXdhaXQgUHJvbWlzZS5hbGwoXG4gICAgICAgIHN0b3JpZXMubWFwKGFzeW5jIChzdG9yeSkgPT4gKHtcbiAgICAgICAgICAuLi5zdG9yeSxcbiAgICAgICAgICBpc0Jvb2ttYXJrZWQ6IGF3YWl0IGlzQm9va21hcmtlZChzdG9yeS5pZCksXG4gICAgICAgIH0pKVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgc3RvcmllczogYm9va21hcmtlZFN0b3JpZXMuZmlsdGVyKChzKSA9PiBzLmlzQm9va21hcmtlZCksXG4gICAgICAgIG1lc3NhZ2U6IFwiQm9va21hcmtlZCBzdG9yaWVzIGxvYWRlZFwiLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkdldCBib29rbWFya3MgZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBzdG9yaWVzOiBbXSxcbiAgICAgICAgbWVzc2FnZTogXCJGYWlsZWQgdG8gbG9hZCBib29rbWFya2VkIHN0b3JpZXNcIixcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY2hlY2tJZkJvb2ttYXJrZWQoc3RvcnlJZCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBib29rbWFya2VkID0gYXdhaXQgaXNCb29rbWFya2VkKHN0b3J5SWQpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgYm9va21hcmtlZCxcbiAgICAgICAgbWVzc2FnZTogYm9va21hcmtlZCA/IFwiU3RvcnkgaXMgYm9va21hcmtlZFwiIDogXCJTdG9yeSBpcyBub3QgYm9va21hcmtlZFwiLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkNoZWNrIGJvb2ttYXJrIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgYm9va21hcmtlZDogZmFsc2UsXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gY2hlY2sgYm9va21hcmsgc3RhdHVzXCIsXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG5cbiAgcmVhZEZpbGVBc0Jhc2U2NChmaWxlKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XG4gICAgICByZWFkZXIub25sb2FkID0gKCkgPT4gcmVzb2x2ZShyZWFkZXIucmVzdWx0KTtcbiAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0O1xuICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBiYXNlNjRUb0Jsb2IoYmFzZTY0KSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChiYXNlNjQpO1xuICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5ibG9iKCk7XG4gIH1cblxuICBhc3luYyBnZXRPZmZsaW5lU3RvcmllcygpIHtcbiAgICBjb25zdCBhbGxTdG9yaWVzID0gYXdhaXQgZ2V0U3RvcmllcygpO1xuICAgIHJldHVybiBhbGxTdG9yaWVzLmZpbHRlcigoc3RvcnkpID0+IHN0b3J5LmlzT2ZmbGluZSk7XG4gIH1cblxuICBhc3luYyBkZWxldGVTdG9yeU9mZmxpbmUoaWQpIHtcbiAgICByZXR1cm4gYXdhaXQgZGVsZXRlU3RvcnlPZmZsaW5lKGlkKTtcbiAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IFZBUElEX1BVQkxJQ19LRVkgPVxuICBcIkJDQ3MyZW9uTUktNkgyY3R2RmFXZy1VWWREdjM4N1Zub19ielV6QUxwQjQ0MnIybENuc0htdHJ4OGJpeVBpX0UtMWZTR0FCS19Rc19HbHZQb0pKcXhia1wiO1xuIiwiaW1wb3J0IHsgVkFQSURfUFVCTElDX0tFWSB9IGZyb20gXCIuL2NvbmZpZy5qc1wiO1xuaW1wb3J0IHtcbiAgc3Vic2NyaWJlVG9Ob3RpZmljYXRpb25zLFxuICB1bnN1YnNjcmliZUZyb21Ob3RpZmljYXRpb25zLFxufSBmcm9tIFwiLi4vZGF0YS9hcGkuanNcIjtcblxuZXhwb3J0IGNvbnN0IHJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uID0gYXN5bmMgKCkgPT4ge1xuICBpZiAoIShcIk5vdGlmaWNhdGlvblwiIGluIHdpbmRvdykpIHtcbiAgICBjb25zb2xlLmxvZyhcIlRoaXMgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0IG5vdGlmaWNhdGlvbnMuXCIpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJncmFudGVkXCIpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGNvbnN0IHBlcm1pc3Npb24gPSBhd2FpdCBOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24oKTtcbiAgcmV0dXJuIHBlcm1pc3Npb24gPT09IFwiZ3JhbnRlZFwiO1xufTtcblxuZXhwb3J0IGNvbnN0IHN1YnNjcmliZVVzZXIgPSBhc3luYyAodG9rZW4pID0+IHtcbiAgaWYgKCEoXCJzZXJ2aWNlV29ya2VyXCIgaW4gbmF2aWdhdG9yKSkge1xuICAgIGNvbnNvbGUubG9nKFwiU2VydmljZSBXb3JrZXIgbm90IHN1cHBvcnRlZFwiKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIGNvbnN0IHJlZ2lzdHJhdGlvbiA9IGF3YWl0IG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5O1xuICBsZXQgc3Vic2NyaXB0aW9uID0gYXdhaXQgcmVnaXN0cmF0aW9uLnB1c2hNYW5hZ2VyLmdldFN1YnNjcmlwdGlvbigpO1xuXG4gIGlmICghc3Vic2NyaXB0aW9uKSB7XG4gICAgdHJ5IHtcbiAgICAgIHN1YnNjcmlwdGlvbiA9IGF3YWl0IHJlZ2lzdHJhdGlvbi5wdXNoTWFuYWdlci5zdWJzY3JpYmUoe1xuICAgICAgICB1c2VyVmlzaWJsZU9ubHk6IHRydWUsXG4gICAgICAgIGFwcGxpY2F0aW9uU2VydmVyS2V5OiB1cmxCYXNlNjRUb1VpbnQ4QXJyYXkoVkFQSURfUFVCTElDX0tFWSksXG4gICAgICB9KTtcblxuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdWJzY3JpYmVUb05vdGlmaWNhdGlvbnMoXG4gICAgICAgIHtcbiAgICAgICAgICBlbmRwb2ludDogc3Vic2NyaXB0aW9uLmVuZHBvaW50LFxuICAgICAgICAgIGtleXM6IHtcbiAgICAgICAgICAgIHAyNTZkaDogYXJyYXlCdWZmZXJUb0Jhc2U2NChzdWJzY3JpcHRpb24uZ2V0S2V5KCdwMjU2ZGgnKSksXG4gICAgICAgICAgICBhdXRoOiBhcnJheUJ1ZmZlclRvQmFzZTY0KHN1YnNjcmlwdGlvbi5nZXRLZXkoJ2F1dGgnKSlcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB0b2tlblxuICAgICAgKTtcblxuICAgICAgaWYgKCFyZXN1bHQuZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJVc2VyIGlzIHN1YnNjcmliZWQuXCIpO1xuICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlN1YnNjcmlwdGlvbiBmYWlsZWQ6XCIsIHJlc3VsdC5tZXNzYWdlKTtcbiAgICAgICAgYXdhaXQgc3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc3Vic2NyaWJpbmcgdXNlcjpcIiwgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHN1YnNjcmlwdGlvbjtcbn07XG5cbmV4cG9ydCBjb25zdCB1bnN1YnNjcmliZVVzZXIgPSBhc3luYyAodG9rZW4pID0+IHtcbiAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7XG4gIGNvbnN0IHN1YnNjcmlwdGlvbiA9IGF3YWl0IHJlZ2lzdHJhdGlvbi5wdXNoTWFuYWdlci5nZXRTdWJzY3JpcHRpb24oKTtcblxuICBpZiAoc3Vic2NyaXB0aW9uKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHVuc3Vic2NyaWJlRnJvbU5vdGlmaWNhdGlvbnMoXG4gICAgICAgIHN1YnNjcmlwdGlvbi5lbmRwb2ludCxcbiAgICAgICAgdG9rZW5cbiAgICAgICk7XG5cbiAgICAgIGlmICghcmVzdWx0LmVycm9yKSB7XG4gICAgICAgIGF3YWl0IHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXIgaXMgdW5zdWJzY3JpYmVkLlwiKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciB1bnN1YnNjcmliaW5nIHVzZXI6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIGZhbHNlO1xufTtcblxuZXhwb3J0IGNvbnN0IHNob3dOb3RpZmljYXRpb25Qcm9tcHQgPSBhc3luYyAoY2FsbGJhY2spID0+IHtcbiAgaWYgKCEoXCJOb3RpZmljYXRpb25cIiBpbiB3aW5kb3cpKSB7XG4gICAgY29uc29sZS5sb2coXCJUaGlzIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBub3RpZmljYXRpb25zLlwiKTtcbiAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGZhbHNlKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09IFwiZ3JhbnRlZFwiKSB7XG4gICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayh0cnVlKTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJkZW5pZWRcIikge1xuICAgIGNvbnNvbGUubG9nKFwiTm90aWZpY2F0aW9uIHBlcm1pc3Npb24gaGFzIGJlZW4gZGVuaWVkLlwiKTtcbiAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGZhbHNlKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuXG4gIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJkZWZhdWx0XCIpIHtcblxuICAgIGNvbnN0IHBlcm1pc3Npb24gPSBhd2FpdCBOb3RpZmljYXRpb24ucmVxdWVzdFBlcm1pc3Npb24oKTtcbiAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHBlcm1pc3Npb24gPT09IFwiZ3JhbnRlZFwiKTtcbiAgICByZXR1cm4gcGVybWlzc2lvbiA9PT0gXCJncmFudGVkXCI7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCBzaG93Tm90aWZpY2F0aW9uID0gKG1lc3NhZ2UsIG9wdGlvbnMgPSB7fSkgPT4ge1xuICBjb25zdCB7IHR5cGUgPSAnaW5mbycsIGF1dG9DbG9zZSA9IDMwMDAgfSA9IG9wdGlvbnM7XG4gIFxuXG4gIGNvbnN0IG5vdGlmaWNhdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICBub3RpZmljYXRpb24uY2xhc3NOYW1lID0gYG5vdGlmaWNhdGlvbiBub3RpZmljYXRpb24tJHt0eXBlfWA7XG4gIG5vdGlmaWNhdGlvbi50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gIG5vdGlmaWNhdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnYWxlcnQnKTtcbiAgXG5cbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChub3RpZmljYXRpb24pO1xuICBcblxuICBpZiAoYXV0b0Nsb3NlKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBub3RpZmljYXRpb24uY2xhc3NMaXN0LmFkZCgnZmFkZS1vdXQnKTtcbiAgICAgIHNldFRpbWVvdXQoKCkgPT4gbm90aWZpY2F0aW9uLnJlbW92ZSgpLCAzMDApO1xuICAgIH0sIGF1dG9DbG9zZSk7XG4gIH1cbiAgXG4gIHJldHVybiBub3RpZmljYXRpb247XG59O1xuXG5mdW5jdGlvbiB1cmxCYXNlNjRUb1VpbnQ4QXJyYXkoYmFzZTY0U3RyaW5nKSB7XG4gIGNvbnN0IHBhZGRpbmcgPSAnPScucmVwZWF0KCg0IC0gKGJhc2U2NFN0cmluZy5sZW5ndGggJSA0KSkgJSA0KTtcbiAgY29uc3QgYmFzZTY0ID0gKGJhc2U2NFN0cmluZyArIHBhZGRpbmcpLnJlcGxhY2UoLy0vZywgJysnKS5yZXBsYWNlKC9fL2csICcvJyk7XG4gIGNvbnN0IHJhd0RhdGEgPSBhdG9iKGJhc2U2NCk7XG4gIGNvbnN0IG91dHB1dEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkocmF3RGF0YS5sZW5ndGgpO1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcmF3RGF0YS5sZW5ndGg7ICsraSkge1xuICAgIG91dHB1dEFycmF5W2ldID0gcmF3RGF0YS5jaGFyQ29kZUF0KGkpO1xuICB9XG4gIHJldHVybiBvdXRwdXRBcnJheTtcbn1cblxuZnVuY3Rpb24gYXJyYXlCdWZmZXJUb0Jhc2U2NChidWZmZXIpIHtcbiAgbGV0IGJpbmFyeSA9ICcnO1xuICBjb25zdCBieXRlcyA9IG5ldyBVaW50OEFycmF5KGJ1ZmZlcik7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYnl0ZXMuYnl0ZUxlbmd0aDsgaSsrKSB7XG4gICAgYmluYXJ5ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoYnl0ZXNbaV0pO1xuICB9XG4gIHJldHVybiBidG9hKGJpbmFyeSk7XG59IiwiaW1wb3J0IHsgdXBkYXRlQXV0aFVJIH0gZnJvbSBcIi4uL2NvbXBvbmVudHMvSGVhZGVyLmpzXCI7XG5pbXBvcnQgeyBcbiAgc3Vic2NyaWJlVXNlciwgXG4gIHVuc3Vic2NyaWJlVXNlcixcbiAgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb24gXG59IGZyb20gXCIuLi91dGlscy9ub3RpZmljYXRpb24uanNcIjtcblxuZXhwb3J0IGNsYXNzIEF1dGhQcmVzZW50ZXIge1xuICBjb25zdHJ1Y3RvcihhdXRoTW9kZWwsIGF1dGhWaWV3LCByb3V0ZXIpIHtcbiAgICB0aGlzLmF1dGhNb2RlbCA9IGF1dGhNb2RlbDtcbiAgICB0aGlzLmF1dGhWaWV3ID0gYXV0aFZpZXc7XG4gICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XG5cbiAgICAvLyBJbml0aWFsaXplIFVJIHN0YXRlXG4gICAgdXBkYXRlQXV0aFVJKHRoaXMuYXV0aE1vZGVsLmlzQXV0aGVudGljYXRlZCgpKTtcblxuICAgIGlmIChhdXRoVmlldy5iaW5kTG9naW4pIHtcbiAgICAgIGF1dGhWaWV3LmJpbmRMb2dpbih0aGlzLmhhbmRsZUxvZ2luLmJpbmQodGhpcykpO1xuICAgIH1cblxuICAgIGlmIChhdXRoVmlldy5iaW5kUmVnaXN0ZXIpIHtcbiAgICAgIGF1dGhWaWV3LmJpbmRSZWdpc3Rlcih0aGlzLmhhbmRsZVJlZ2lzdGVyLmJpbmQodGhpcykpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhbmRsZUxvZ2luKGVtYWlsLCBwYXNzd29yZCkge1xuICB0cnkge1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aE1vZGVsLmxvZ2luKGVtYWlsLCBwYXNzd29yZCk7XG5cbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgIHVwZGF0ZUF1dGhVSSh0cnVlKTsgLy8gVXBkYXRlIFVJIHN0YXRlIGltbWVkaWF0ZWx5XG4gICAgICBcbiAgICAgIC8vIFN0YXJ0IGJvdGggb3BlcmF0aW9ucyBidXQgZG9uJ3QgYXdhaXQgbm90aWZpY2F0aW9uIHNldHVwXG4gICAgICBjb25zdCBub3RpZmljYXRpb25Qcm9taXNlID0gKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBwZXJtaXNzaW9uR3JhbnRlZCA9IGF3YWl0IHJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uKCk7XG4gICAgICAgICAgaWYgKHBlcm1pc3Npb25HcmFudGVkKSBhd2FpdCBzdWJzY3JpYmVVc2VyKHJlc3VsdC50b2tlbik7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIk5vdGlmaWNhdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9KSgpO1xuXG4gICAgICAvLyBOYXZpZ2F0ZSBpbW1lZGlhdGVseSB3aXRob3V0IHdhaXRpbmcgZm9yIG5vdGlmaWNhdGlvbnNcbiAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlVG8oXCIvc3Rvcmllc1wiKTtcbiAgICAgIFxuICAgICAgLy8gTGV0IG5vdGlmaWNhdGlvbnMgY29tcGxldGUgaW4gYmFja2dyb3VuZFxuICAgICAgYXdhaXQgbm90aWZpY2F0aW9uUHJvbWlzZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5hdXRoVmlldy5zaG93RXJyb3I/LihyZXN1bHQubWVzc2FnZSk7XG4gICAgfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHRoaXMuYXV0aFZpZXcuc2hvd0Vycm9yPy4oZXJyb3IubWVzc2FnZSk7XG4gIH1cbn1cblxuICBhc3luYyBoYW5kbGVMb2dvdXQoKSB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVuc3Vic2NyaWJlIGZyb20gbm90aWZpY2F0aW9ucyBiZWZvcmUgbG9nb3V0XG4gICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aE1vZGVsLmdldFRva2VuKCk7XG4gICAgICBpZiAodG9rZW4pIHtcbiAgICAgICAgYXdhaXQgdW5zdWJzY3JpYmVVc2VyKHRva2VuKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHVuc3Vic2NyaWJpbmc6XCIsIGVycm9yKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5hdXRoTW9kZWwubG9nb3V0KCk7XG4gICAgICB1cGRhdGVBdXRoVUkoZmFsc2UpO1xuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUbyhcIi9sb2dpblwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBoYW5kbGVSZWdpc3RlcihuYW1lLCBlbWFpbCwgcGFzc3dvcmQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoTW9kZWwucmVnaXN0ZXIobmFtZSwgZW1haWwsIHBhc3N3b3JkKTtcblxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuYXV0aFZpZXcuc2hvd1N1Y2Nlc3M/LihcIlJlZ2lzdHJhdGlvbiBzdWNjZXNzZnVsLiBQbGVhc2UgbG9naW4uXCIpO1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvKFwiL2xvZ2luXCIpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hdXRoVmlldy5zaG93RXJyb3I/LihyZXN1bHQubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMuYXV0aFZpZXcuc2hvd0Vycm9yPy4oZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuICB9XG59IiwiaW1wb3J0IHsgc2hvd05vdGlmaWNhdGlvbiwgc2hvd05vdGlmaWNhdGlvblByb21wdCB9IGZyb20gXCIuLi91dGlscy9ub3RpZmljYXRpb24uanNcIjtcblxuZXhwb3J0IGNsYXNzIFN0b3J5UHJlc2VudGVyIHtcbiAgY29uc3RydWN0b3Ioc3RvcnlNb2RlbCwgc3RvcnlWaWV3LCByb3V0ZXIpIHtcbiAgICB0aGlzLnN0b3J5TW9kZWwgPSBzdG9yeU1vZGVsO1xuICAgIHRoaXMuc3RvcnlWaWV3ID0gc3RvcnlWaWV3O1xuICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xuICAgIHRoaXMuY3VycmVudFN0b3J5SWQgPSBudWxsO1xuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgdGhpcy5zaG93Qm9va21hcmtzT25seSA9IGZhbHNlO1xuXG5cbiAgICB0aGlzLmlzU3luY2luZyA9IGZhbHNlO1xuICAgIHRoaXMuc3luY1F1ZXVlID0gbmV3IFNldCgpO1xuXG5cblxuICAgIHRoaXMuaW5pdGlhbGl6ZUV2ZW50QmluZGluZ3MoKTtcbiAgICB0aGlzLmluaXRpYWxpemVTeW5jSGFuZGxlcnMoKTtcbiAgICB0aGlzLmxvYWRPZmZsaW5lU3Rvcmllc0ludG9RdWV1ZT8uKCk7XG4gIH1cblxuICBpbml0aWFsaXplRXZlbnRCaW5kaW5ncygpIHtcbiAgICBpZiAodGhpcy5zdG9yeVZpZXcuYmluZExvYWRTdG9yaWVzKSB7XG4gICAgICB0aGlzLnN0b3J5Vmlldy5iaW5kTG9hZFN0b3JpZXModGhpcy5oYW5kbGVMb2FkU3Rvcmllcy5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdG9yeVZpZXcuYmluZEFkZFN0b3J5KSB7XG4gICAgICB0aGlzLnN0b3J5Vmlldy5iaW5kQWRkU3RvcnkodGhpcy5oYW5kbGVBZGRTdG9yeS5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdG9yeVZpZXcuYmluZExvYWRTdG9yeURldGFpbCkge1xuICAgICAgdGhpcy5zdG9yeVZpZXcuYmluZExvYWRTdG9yeURldGFpbCh0aGlzLmhhbmRsZUxvYWRTdG9yeURldGFpbC5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdG9yeVZpZXcuYmluZFRvZ2dsZUJvb2ttYXJrRmlsdGVyKSB7XG4gICAgICB0aGlzLnN0b3J5Vmlldy5iaW5kVG9nZ2xlQm9va21hcmtGaWx0ZXIodGhpcy50b2dnbGVCb29rbWFya0ZpbHRlci5iaW5kKHRoaXMpKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5zdG9yeVZpZXcuYmluZEJvb2ttYXJrQWN0aW9uKSB7XG4gICAgICB0aGlzLnN0b3J5Vmlldy5iaW5kQm9va21hcmtBY3Rpb24odGhpcy5oYW5kbGVCb29rbWFya0FjdGlvbi5iaW5kKHRoaXMpKTtcbiAgICB9XG4gIH1cblxuICBpbml0aWFsaXplU3luY0hhbmRsZXJzKCkge1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwib25saW5lXCIsICgpID0+IHRoaXMuaGFuZGxlT25saW5lKCkpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNcIiwgKCkgPT4ge1xuICAgICAgaWYgKG5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICAgICAgdGhpcy5oYW5kbGVPbmxpbmUoKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGxvYWRPZmZsaW5lU3Rvcmllc0ludG9RdWV1ZSgpIHtcblxuICAgIGNvbnNvbGUubG9nKFwiT2ZmbGluZSBzeW5jIHF1ZXVlIGxvYWRlZCAoc3R1YilcIik7XG4gIH1cblxuICBhc3luYyB0b2dnbGVCb29rbWFya0ZpbHRlcigpIHtcbiAgICB0aGlzLnNob3dCb29rbWFya3NPbmx5ID0gIXRoaXMuc2hvd0Jvb2ttYXJrc09ubHk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5zaG93Qm9va21hcmtzT25seVxuICAgICAgICA/IGF3YWl0IHRoaXMuc3RvcnlNb2RlbC5nZXRCb29rbWFya2VkU3RvcmllcygpXG4gICAgICAgIDogYXdhaXQgdGhpcy5zdG9yeU1vZGVsLmdldEFsbFN0b3JpZXMoKTtcblxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LmRpc3BsYXlTdG9yaWVzKHJlc3VsdC5zdG9yaWVzKTtcblxuICAgICAgICBpZiAodHlwZW9mIHRoaXMuc3RvcnlWaWV3LnVwZGF0ZUJvb2ttYXJrRmlsdGVyU3RhdGUgPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICAgIHRoaXMuc3RvcnlWaWV3LnVwZGF0ZUJvb2ttYXJrRmlsdGVyU3RhdGUodGhpcy5zaG93Qm9va21hcmtzT25seSk7XG4gICAgICAgIH1cblxuICAgICAgICBzaG93Tm90aWZpY2F0aW9uKFxuICAgICAgICAgIHRoaXMuc2hvd0Jvb2ttYXJrc09ubHlcbiAgICAgICAgICAgID8gXCJTaG93aW5nIGJvb2ttYXJrZWQgc3Rvcmllc1wiXG4gICAgICAgICAgICA6IFwiU2hvd2luZyBhbGwgc3Rvcmllc1wiLFxuICAgICAgICAgIHsgdHlwZTogXCJpbmZvXCIsIGF1dG9DbG9zZTogMjAwMCB9XG4gICAgICAgICk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaG93Tm90aWZpY2F0aW9uKHJlc3VsdC5tZXNzYWdlIHx8IFwiRmFpbGVkIHRvIGxvYWQgc3Rvcmllc1wiLCB7XG4gICAgICAgICAgdHlwZTogXCJlcnJvclwiLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihcIkJvb2ttYXJrIGZpbHRlciBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgc2hvd05vdGlmaWNhdGlvbihcIkZhaWxlZCB0byB0b2dnbGUgYm9va21hcmsgZmlsdGVyXCIsIHsgdHlwZTogXCJlcnJvclwiIH0pO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhbmRsZUJvb2ttYXJrQWN0aW9uKHN0b3J5SWQpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBzdWNjZXNzLCBtZXNzYWdlIH0gPSBhd2FpdCB0aGlzLnN0b3J5TW9kZWwudG9nZ2xlQm9va21hcmsoc3RvcnlJZCk7XG5cbiAgICAgIGlmIChzdWNjZXNzKSB7XG4gICAgICAgIGlmICh0aGlzLnNob3dCb29rbWFya3NPbmx5KSB7XG4gICAgICAgICAgY29uc3QgeyBzdWNjZXNzLCBzdG9yaWVzIH0gPSBhd2FpdCB0aGlzLnN0b3J5TW9kZWwuZ2V0Qm9va21hcmtlZFN0b3JpZXMoKTtcbiAgICAgICAgICBpZiAoc3VjY2Vzcykge1xuICAgICAgICAgICAgdGhpcy5zdG9yeVZpZXcuZGlzcGxheVN0b3JpZXMoc3Rvcmllcyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgc2hvd05vdGlmaWNhdGlvbihtZXNzYWdlLCB7IHR5cGU6IFwic3VjY2Vzc1wiLCBhdXRvQ2xvc2U6IDIwMDAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzaG93Tm90aWZpY2F0aW9uKG1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gdXBkYXRlIGJvb2ttYXJrXCIsIHsgdHlwZTogXCJlcnJvclwiIH0pO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiQm9va21hcmsgYWN0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICBzaG93Tm90aWZpY2F0aW9uKFwiRmFpbGVkIHRvIHVwZGF0ZSBib29rbWFya1wiLCB7IHR5cGU6IFwiZXJyb3JcIiB9KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBoYW5kbGVMb2FkU3RvcmllcyhwYWdlID0gMSwgc2l6ZSA9IDEwKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuc2hvd0Jvb2ttYXJrc09ubHlcbiAgICAgICAgPyBhd2FpdCB0aGlzLnN0b3J5TW9kZWwuZ2V0Qm9va21hcmtlZFN0b3JpZXMoKVxuICAgICAgICA6IGF3YWl0IHRoaXMuc3RvcnlNb2RlbC5nZXRBbGxTdG9yaWVzKHBhZ2UsIHNpemUpO1xuXG4gICAgICBpZiAocmVzdWx0LmlzT2ZmbGluZSkge1xuICAgICAgICB0aGlzLnN0b3J5Vmlldy5zaG93T2ZmbGluZVdhcm5pbmc/LigpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuZGlzcGxheVN0b3JpZXMocmVzdWx0LnN0b3JpZXMgfHwgW10pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd0Vycm9yPy4ocmVzdWx0Lm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gbG9hZCBzdG9yaWVzXCIpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiTG9hZCBzdG9yaWVzIGVycm9yOlwiLCBlcnJvcik7XG4gICAgICB0aGlzLnN0b3J5Vmlldy5zaG93RXJyb3I/LihcIkZhaWxlZCB0byBsb2FkIHN0b3JpZXMuIFBsZWFzZSB0cnkgYWdhaW4uXCIpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhbmRsZUxvYWRTdG9yeURldGFpbChpZCkge1xuICAgIHRyeSB7XG4gICAgICBpZiAodGhpcy5pc0xvYWRpbmcgfHwgdGhpcy5jdXJyZW50U3RvcnlJZCA9PT0gaWQpIHJldHVybjtcblxuICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xuICAgICAgdGhpcy5jdXJyZW50U3RvcnlJZCA9IGlkO1xuXG4gICAgICB0aGlzLnN0b3J5Vmlldy5wcmVwYXJlTWFwQ29udGFpbmVyPy4oKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc3RvcnlNb2RlbC5nZXRTdG9yeURldGFpbChpZCk7XG5cbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlc29sdmUpKTtcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuZGlzcGxheVN0b3J5RGV0YWlsPy4ocmVzdWx0LnN0b3J5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKHJlc3VsdC5tZXNzYWdlIHx8IFwiU3Rvcnkgbm90IGZvdW5kXCIpO1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvKFwiL3N0b3JpZXNcIik7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJMb2FkIHN0b3J5IGRldGFpbCBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd0Vycm9yPy4oXCJGYWlsZWQgdG8gbG9hZCBzdG9yeSBkZXRhaWxzXCIpO1xuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUbyhcIi9zdG9yaWVzXCIpO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGhhbmRsZUFkZFN0b3J5KGRhdGEpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zdG9yeU1vZGVsLmFkZFN0b3J5KGRhdGEpO1xuXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd1N1Y2Nlc3M/LihcIlN0b3J5IGFkZGVkIHN1Y2Nlc3NmdWxseSFcIik7XG5cbiAgICAgICAgYXdhaXQgc2hvd05vdGlmaWNhdGlvblByb21wdCgoZ3JhbnRlZCkgPT4ge1xuICAgICAgICAgIGlmIChncmFudGVkKSB7XG5cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuY2xlYW51cCgpO1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICB0aGlzLmhhbmRsZUxvYWRTdG9yaWVzKCk7XG4gICAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUbyhcIi9zdG9yaWVzXCIpO1xuICAgICAgICB9LCAxNTAwKTtcbiAgICAgIH0gZWxzZSBpZiAoIXJlc3VsdC5zdWNjZXNzICYmICFuYXZpZ2F0b3Iub25MaW5lKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlT2ZmbGluZUFkZChkYXRhKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKHJlc3VsdC5tZXNzYWdlIHx8IFwiRmFpbGVkIHRvIGFkZCBzdG9yeVwiKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhpcy5oYW5kbGVBZGRFcnJvcihlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgaGFuZGxlT2ZmbGluZUFkZChkYXRhKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG9mZmxpbmVSZXN1bHQgPSBhd2FpdCB0aGlzLnN0b3J5TW9kZWwuYWRkU3RvcnlPZmZsaW5lKGRhdGEpO1xuICAgICAgdGhpcy5zeW5jUXVldWUuYWRkKG9mZmxpbmVSZXN1bHQuc3RvcnkuaWQpO1xuXG4gICAgICBhd2FpdCBzaG93Tm90aWZpY2F0aW9uUHJvbXB0KChncmFudGVkKSA9PiB7XG4gICAgICAgIGlmIChncmFudGVkKSB7XG5cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dTdWNjZXNzPy4oXCJTdG9yeSBzYXZlZCBvZmZsaW5lLiBXaWxsIHN5bmMgd2hlbiBvbmxpbmUhXCIpO1xuXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5oYW5kbGVMb2FkU3RvcmllcygpO1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvKFwiL3N0b3JpZXNcIik7XG4gICAgICB9LCAxNTAwKTtcbiAgICB9IGNhdGNoIChvZmZsaW5lRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJPZmZsaW5lIHNhdmUgZmFpbGVkOlwiLCBvZmZsaW5lRXJyb3IpO1xuICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd0Vycm9yPy4oXCJGYWlsZWQgdG8gc2F2ZSBzdG9yeSBvZmZsaW5lLlwiKTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVBZGRFcnJvcihlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJBZGQgc3RvcnkgZXJyb3I6XCIsIGVycm9yKTtcbiAgICBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiWW91J3JlIG9mZmxpbmUuIFBsZWFzZSBjb25uZWN0IHRvIHN1Ym1pdCBzdG9yaWVzLlwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd0Vycm9yPy4oXCJGYWlsZWQgdG8gYWRkIHN0b3J5LiBQbGVhc2UgdHJ5IGFnYWluLlwiKTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBoYW5kbGVPbmxpbmUoKSB7XG4gICAgaWYgKHRoaXMuaXNTeW5jaW5nIHx8IHRoaXMuc3luY1F1ZXVlLnNpemUgPT09IDApIHJldHVybjtcblxuICAgIHRoaXMuaXNTeW5jaW5nID0gdHJ1ZTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBzeW5jUmVzdWx0ID0gYXdhaXQgdGhpcy5zdG9yeU1vZGVsLnN5bmNPZmZsaW5lU3Rvcmllcyh0aGlzLnN5bmNRdWV1ZSk7XG5cbiAgICAgIGlmIChzeW5jUmVzdWx0LnN1Y2Nlc3MgJiYgc3luY1Jlc3VsdC5zeW5jZWRJZHMubGVuZ3RoID4gMCkge1xuICAgICAgICBzeW5jUmVzdWx0LnN5bmNlZElkcy5mb3JFYWNoKChpZCkgPT4ge1xuICAgICAgICAgIHRoaXMuc3luY1F1ZXVlLmRlbGV0ZShpZCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dTdWNjZXNzPy4oYFN5bmNlZCAke3N5bmNSZXN1bHQuc3luY2VkSWRzLmxlbmd0aH0gc3RvcmllcyFgKTtcbiAgICAgICAgdGhpcy5oYW5kbGVMb2FkU3RvcmllcygpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKFwiU3luYyBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgdGhpcy5pc1N5bmNpbmcgPSBmYWxzZTtcblxuICAgICAgaWYgKHRoaXMuc3luY1F1ZXVlLnNpemUgPiAwKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5oYW5kbGVPbmxpbmUoKSwgNTAwMCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgY2xlYW51cCgpIHtcbiAgICB0aGlzLnN0b3J5Vmlldy5jbGVhbnVwPy4oKTtcbiAgICB0aGlzLmN1cnJlbnRTdG9yeUlkID0gbnVsbDtcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgIHRoaXMuc2hvd0Jvb2ttYXJrc09ubHkgPSBmYWxzZTtcbiAgfVxufVxuIiwiZXhwb3J0IGNsYXNzIE1hcFByZXNlbnRlciB7XG4gIGNvbnN0cnVjdG9yKG1hcFZpZXcpIHtcbiAgICB0aGlzLnZpZXcgPSBtYXBWaWV3O1xuICAgIHRoaXMuY3VycmVudFBvc2l0aW9uID0gbnVsbDtcbiAgfVxuXG4gIGFzeW5jIGluaXRpYWxpemVNYXAoY29udGFpbmVySWQsIG9wdGlvbnMgPSB7fSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB7IGxhdCA9IDAsIGxuZyA9IDAsIHpvb20gPSAxMCB9ID0gb3B0aW9ucztcbiAgICAgIGF3YWl0IHRoaXMudmlldy5pbml0TWFwKGNvbnRhaW5lcklkLCBsYXQsIGxuZywgem9vbSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignTWFwIGluaXRpYWxpemF0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0Q3VycmVudExvY2F0aW9uKG9wdGlvbnMgPSB7fSkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBpZiAoIW5hdmlnYXRvci5nZW9sb2NhdGlvbikge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKFwiR2VvbG9jYXRpb24gaXMgbm90IHN1cHBvcnRlZCBieSB5b3VyIGJyb3dzZXJcIikpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oXG4gICAgICAgIChwb3NpdGlvbikgPT4ge1xuICAgICAgICAgIHRoaXMuY3VycmVudFBvc2l0aW9uID0ge1xuICAgICAgICAgICAgbGF0OiBwb3NpdGlvbi5jb29yZHMubGF0aXR1ZGUsXG4gICAgICAgICAgICBsbmc6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUsXG4gICAgICAgICAgICBhY2N1cmFjeTogcG9zaXRpb24uY29vcmRzLmFjY3VyYWN5XG4gICAgICAgICAgfTtcbiAgICAgICAgICByZXNvbHZlKHRoaXMuY3VycmVudFBvc2l0aW9uKTtcbiAgICAgICAgfSxcbiAgICAgICAgKGVycm9yKSA9PiB7XG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgfSxcbiAgICAgICAgb3B0aW9uc1xuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGNlbnRlclRvQ3VycmVudExvY2F0aW9uKHpvb20gPSAxNSkge1xuICAgIHRyeSB7XG4gICAgICBpZiAoIXRoaXMuY3VycmVudFBvc2l0aW9uKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuZ2V0Q3VycmVudExvY2F0aW9uKCk7XG4gICAgICB9XG4gICAgICB0aGlzLnZpZXcuc2V0Vmlldyh0aGlzLmN1cnJlbnRQb3NpdGlvbi5sYXQsIHRoaXMuY3VycmVudFBvc2l0aW9uLmxuZywgem9vbSk7XG4gICAgICByZXR1cm4gdGhpcy5jdXJyZW50UG9zaXRpb247XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjZW50ZXIgdG8gY3VycmVudCBsb2NhdGlvbjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICBhZGRNYXJrZXIobGF0LCBsbmcsIHBvcHVwQ29udGVudCA9IFwiXCIsIG9wdGlvbnMgPSB7fSkge1xuICAgIHJldHVybiB0aGlzLnZpZXcuYWRkTWFya2VyKGxhdCwgbG5nLCBwb3B1cENvbnRlbnQsIG9wdGlvbnMpO1xuICB9XG5cbiAgYWRkQ3VycmVudExvY2F0aW9uTWFya2VyKHBvcHVwQ29udGVudCA9IFwiXCIpIHtcbiAgICBpZiAoIXRoaXMuY3VycmVudFBvc2l0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0N1cnJlbnQgbG9jYXRpb24gbm90IGF2YWlsYWJsZScpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5hZGRNYXJrZXIoXG4gICAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbi5sYXQsXG4gICAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbi5sbmcsXG4gICAgICBwb3B1cENvbnRlbnQsXG4gICAgICB7IHRpdGxlOiAnWW91ciBMb2NhdGlvbicgfVxuICAgICk7XG4gIH1cblxuICBjbGVhck1hcmtlcnMoKSB7XG4gICAgdGhpcy52aWV3LmNsZWFyTWFya2VycygpO1xuICB9XG5cbiAgc2V0T25NYXBDbGlja0hhbmRsZXIoaGFuZGxlcikge1xuICAgIHRoaXMudmlldy5vbk1hcENsaWNrKChlKSA9PiB7XG4gICAgICBoYW5kbGVyKGUubGF0bG5nLmxhdCwgZS5sYXRsbmcubG5nKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsZWFudXAoKSB7XG4gICAgdGhpcy52aWV3LnJlbW92ZSgpO1xuICB9XG5cbiAgaGFuZGxlTG9jYXRpb25TZWxlY3Rpb24obGF0LCBsbmcpIHtcbiAgdGhpcy5jbGVhck1hcmtlcnMoKTsgLy8gQ2xlYXIgZXhpc3RpbmcgbWFya2Vyc1xuICB0aGlzLmFkZE1hcmtlcihsYXQsIGxuZywgXCJTZWxlY3RlZCBMb2NhdGlvblwiLCB7XG4gICAgZHJhZ2dhYmxlOiB0cnVlLFxuICAgIGNvbG9yOiAncmVkJ1xuICB9KTtcbiAgdGhpcy52aWV3LnNldFZpZXcobGF0LCBsbmcsIDE1KTtcbn1cbn0iLCJsZXQgY3VycmVudFNraXBUYXJnZXQgPSBudWxsO1xuXG5leHBvcnQgY29uc3QgcmVzZXRTa2lwVG9Db250ZW50ID0gKCkgPT4ge1xuICBpZiAoY3VycmVudFNraXBUYXJnZXQpIHtcbiAgICBjdXJyZW50U2tpcFRhcmdldC5jbGFzc0xpc3Q/LnJlbW92ZSgnZm9jdXMtdmlzaWJsZScpO1xuICAgIGN1cnJlbnRTa2lwVGFyZ2V0LnJlbW92ZUF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcbiAgICBjdXJyZW50U2tpcFRhcmdldCA9IG51bGw7XG4gIH1cbn07XG5cbmNvbnN0IGhhbmRsZVNraXBUb0NvbnRlbnQgPSBhc3luYyAoKSA9PiB7XG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlc29sdmUpKTtcbiAgXG4gIGNvbnN0IG1haW5Db250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21haW4tY29udGVudCcpO1xuICBpZiAoIW1haW5Db250ZW50KSByZXR1cm47XG5cbiAgcmVzZXRTa2lwVG9Db250ZW50KCk7XG4gIFxuICBtYWluQ29udGVudC5jbGFzc0xpc3QuYWRkKCdmb2N1cy12aXNpYmxlJyk7XG4gIG1haW5Db250ZW50LmZvY3VzKHsgcHJldmVudFNjcm9sbDogdHJ1ZSB9KTtcbiAgXG4gIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgIG1haW5Db250ZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2ZvY3VzLXZpc2libGUnKTtcbiAgfSwgMjAwMCk7XG59O1xuXG5leHBvcnQgY29uc3QgaW5pdGlhbGl6ZVNraXBUb0NvbnRlbnQgPSAoKSA9PiB7XG4gIGNvbnN0IGV4aXN0aW5nU2tpcExpbmsgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2tpcC1saW5rJyk7XG4gIGlmIChleGlzdGluZ1NraXBMaW5rKSBleGlzdGluZ1NraXBMaW5rLnJlbW92ZSgpO1xuXG4gIGNvbnN0IHNraXBMaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xuICBza2lwTGluay5ocmVmID0gJyNtYWluLWNvbnRlbnQnO1xuICBza2lwTGluay5jbGFzc05hbWUgPSAnc2tpcC1saW5rJztcbiAgc2tpcExpbmsudGV4dENvbnRlbnQgPSAnU2tpcCB0byBjb250ZW50JztcbiAgXG4gIHNraXBMaW5rLnN0eWxlLmNzc1RleHQgPSBgXG4gICAgcG9zaXRpb246IGZpeGVkO1xuICAgIHRvcDogLTQwcHg7XG4gICAgbGVmdDogMXJlbTtcbiAgICBiYWNrZ3JvdW5kOiAjMDAwO1xuICAgIGNvbG9yOiB3aGl0ZTtcbiAgICBwYWRkaW5nOiA4cHggMTJweDtcbiAgICBib3JkZXItcmFkaXVzOiAwIDAgNHB4IDRweDtcbiAgICB6LWluZGV4OiA5OTk5O1xuICAgIHRyYW5zaXRpb246IHRvcCAwLjNzIGVhc2U7XG4gIGA7XG5cbiAgc2tpcExpbmsuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PiB7XG4gICAgc2tpcExpbmsuc3R5bGUudG9wID0gJzAnO1xuICB9KTtcblxuICBza2lwTGluay5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgKCkgPT4ge1xuICAgIHNraXBMaW5rLnN0eWxlLnRvcCA9ICctNDBweCc7XG4gIH0pO1xuXG4gIHNraXBMaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKGUpID0+IHtcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgYXdhaXQgaGFuZGxlU2tpcFRvQ29udGVudCgpO1xuICB9KTtcblxuICBkb2N1bWVudC5ib2R5LnByZXBlbmQoc2tpcExpbmspO1xuXG4gIHJldHVybiAoKSA9PiB7XG4gICAgc2tpcExpbmsucmVtb3ZlKCk7XG4gICAgcmVzZXRTa2lwVG9Db250ZW50KCk7XG4gIH07XG59OyIsImltcG9ydCB7IHJlc2V0U2tpcFRvQ29udGVudCB9IGZyb20gJy4uL3V0aWxzL1NraXBUb0NvbnRlbnQnO1xuXG5leHBvcnQgY29uc3QgQmFzZVZpZXcgPSAoaHRtbENvbnRlbnQpID0+IHtcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICB2aWV3LmNsYXNzTmFtZSA9ICdhdXRoLWZvcm0nO1xuICB2aWV3LmlubmVySFRNTCA9IGh0bWxDb250ZW50O1xuXG4gIC8vIENyZWF0ZSBhIE11dGF0aW9uT2JzZXJ2ZXIgdG8gZGV0ZWN0IHdoZW4gdGhlIHZpZXcgaXMgcmVtb3ZlZFxuICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcbiAgICBtdXRhdGlvbnMuZm9yRWFjaCgobXV0YXRpb24pID0+IHtcbiAgICAgIGlmIChBcnJheS5mcm9tKG11dGF0aW9uLnJlbW92ZWROb2RlcykuaW5jbHVkZXModmlldykpIHtcbiAgICAgICAgY2xlYW51cCgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBjb25zdCBjbGVhbnVwID0gKCkgPT4ge1xuICAgIHJlc2V0U2tpcFRvQ29udGVudCgpO1xuICAgIG9ic2VydmVyLmRpc2Nvbm5lY3QoKTsgLy8gU3RvcCBvYnNlcnZpbmcgd2hlbiBjbGVhbmluZyB1cFxuICB9O1xuXG4gIC8vIFN0YXJ0IG9ic2VydmluZyB0aGUgdmlldydzIHBhcmVudCBmb3IgcmVtb3ZhbFxuICBpZiAodmlldy5wYXJlbnROb2RlKSB7XG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSh2aWV3LnBhcmVudE5vZGUsIHsgY2hpbGRMaXN0OiB0cnVlIH0pO1xuICB9XG5cbiAgY29uc3QgZ2V0VmlldyA9ICgpID0+IHtcbiAgICAvLyBXaGVuIHZpZXcgaXMgcmV0cmlldmVkLCBlbnN1cmUgd2Ugb2JzZXJ2ZSBpdHMgZXZlbnR1YWwgcGFyZW50XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBpZiAodmlldy5wYXJlbnROb2RlICYmICFvYnNlcnZlci5faXNPYnNlcnZpbmcpIHtcbiAgICAgICAgb2JzZXJ2ZXIub2JzZXJ2ZSh2aWV3LnBhcmVudE5vZGUsIHsgY2hpbGRMaXN0OiB0cnVlIH0pO1xuICAgICAgICBvYnNlcnZlci5faXNPYnNlcnZpbmcgPSB0cnVlO1xuICAgICAgfVxuICAgIH0sIDApO1xuICAgIHJldHVybiB2aWV3O1xuICB9O1xuXG4gIGNvbnN0IHNob3dFcnJvciA9IChtZXNzYWdlKSA9PiB7XG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdmlldy5xdWVyeVNlbGVjdG9yKCcjZXJyb3ItbWVzc2FnZScpIHx8IFxuICAgICAgICAgICAgICAgICAgICAgICAgdmlldy5xdWVyeVNlbGVjdG9yKCcuZXJyb3ItbWVzc2FnZScpO1xuICAgIGlmIChlcnJvckVsZW1lbnQpIHtcbiAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgICBlcnJvckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IG1lc3NhZ2UgPyAnYmxvY2snIDogJ25vbmUnO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBzaG93U3VjY2VzcyA9IChtZXNzYWdlKSA9PiB7XG4gICAgY29uc3Qgc3VjY2Vzc0VsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdWNjZXNzLW1lc3NhZ2UnKSB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdmlldy5xdWVyeVNlbGVjdG9yKCcuc3VjY2Vzcy1tZXNzYWdlJyk7XG4gICAgaWYgKHN1Y2Nlc3NFbGVtZW50KSB7XG4gICAgICBzdWNjZXNzRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgICBzdWNjZXNzRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gbWVzc2FnZSA/ICdibG9jaycgOiAnbm9uZSc7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0VmlldyxcbiAgICBzaG93RXJyb3IsXG4gICAgc2hvd1N1Y2Nlc3MsXG4gICAgY2xlYW51cFxuICB9O1xufTsiLCJpbXBvcnQgeyBCYXNlVmlldyB9IGZyb20gJy4uL0Jhc2VWaWV3LmpzJztcblxuZXhwb3J0IGNvbnN0IExvZ2luVmlldyA9ICgpID0+IHtcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaGVhZGVyJyk/LnJlbW92ZSgpO1xuXG4gIGNvbnN0IGJhc2UgPSBCYXNlVmlldyhgXG4gICAgPGgyPkxvZ2luPC9oMj5cbiAgICA8Zm9ybSBpZD1cImxvZ2luLWZvcm1cIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XG4gICAgICAgIDxsYWJlbCBmb3I9XCJlbWFpbFwiPkVtYWlsPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9XCJlbWFpbFwiIGlkPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiByZXF1aXJlZD5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgPGxhYmVsIGZvcj1cInBhc3N3b3JkXCI+UGFzc3dvcmQ8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT1cInBhc3N3b3JkXCIgaWQ9XCJwYXNzd29yZFwiIG5hbWU9XCJwYXNzd29yZFwiIHJlcXVpcmVkIG1pbmxlbmd0aD1cIjhcIj5cbiAgICAgIDwvZGl2PlxuICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCI+TG9naW48L2J1dHRvbj5cbiAgICA8L2Zvcm0+XG4gICAgPHA+RG9uJ3QgaGF2ZSBhbiBhY2NvdW50PyA8YSBocmVmPVwiIy9yZWdpc3RlclwiPlJlZ2lzdGVyIGhlcmU8L2E+PC9wPlxuICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjwvZGl2PlxuICBgKTtcblxuICBjb25zdCBiaW5kTG9naW4gPSAoaGFuZGxlcikgPT4ge1xuICAgIGNvbnN0IGZvcm0gPSBiYXNlLmdldFZpZXcoKS5xdWVyeVNlbGVjdG9yKCcjbG9naW4tZm9ybScpO1xuICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGJhc2UuZ2V0VmlldygpLnF1ZXJ5U2VsZWN0b3IoJyNlcnJvci1tZXNzYWdlJyk7XG4gICAgXG4gICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgY29uc3QgZW1haWwgPSBmb3JtLmVtYWlsLnZhbHVlO1xuICAgICAgY29uc3QgcGFzc3dvcmQgPSBmb3JtLnBhc3N3b3JkLnZhbHVlO1xuICAgICAgXG4gICAgICBlcnJvck1lc3NhZ2Uuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgIGF3YWl0IGhhbmRsZXIoZW1haWwsIHBhc3N3b3JkKTtcbiAgICB9KTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldFZpZXc6IGJhc2UuZ2V0VmlldywgIC8vIEV4cGxpY2l0bHkgZXhwb3NlIGdldFZpZXdcbiAgICBzaG93RXJyb3I6IGJhc2Uuc2hvd0Vycm9yLFxuICAgIHNob3dTdWNjZXNzOiBiYXNlLnNob3dTdWNjZXNzLFxuICAgIGJpbmRMb2dpblxuICB9O1xufTsiLCJpbXBvcnQgeyBCYXNlVmlldyB9IGZyb20gJy4uL0Jhc2VWaWV3LmpzJztcblxuZXhwb3J0IGNvbnN0IFJlZ2lzdGVyVmlldyA9ICgpID0+IHtcbiAgY29uc3QgYmFzZSA9IEJhc2VWaWV3KGBcbiAgICA8aDI+UmVnaXN0ZXI8L2gyPlxuICAgIDxmb3JtIGlkPVwicmVnaXN0ZXItZm9ybVwiPlxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgPGxhYmVsIGZvcj1cIm5hbWVcIj5OYW1lPC9sYWJlbD5cbiAgICAgICAgPGlucHV0IHR5cGU9XCJ0ZXh0XCIgaWQ9XCJuYW1lXCIgbmFtZT1cIm5hbWVcIiByZXF1aXJlZD5cbiAgICAgIDwvZGl2PlxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgPGxhYmVsIGZvcj1cImVtYWlsXCI+RW1haWw8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT1cImVtYWlsXCIgaWQ9XCJlbWFpbFwiIG5hbWU9XCJlbWFpbFwiIHJlcXVpcmVkPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgZm9yPVwicGFzc3dvcmRcIj5QYXNzd29yZDwvbGFiZWw+XG4gICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIiBpZD1cInBhc3N3b3JkXCIgbmFtZT1cInBhc3N3b3JkXCIgcmVxdWlyZWQgbWlubGVuZ3RoPVwiOFwiPlxuICAgICAgPC9kaXY+XG4gICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlybS1wYXNzd29yZFwiPkNvbmZpcm0gUGFzc3dvcmQ8L2xhYmVsPlxuICAgICAgICA8aW5wdXQgdHlwZT1cInBhc3N3b3JkXCIgaWQ9XCJjb25maXJtLXBhc3N3b3JkXCIgbmFtZT1cImNvbmZpcm0tcGFzc3dvcmRcIiByZXF1aXJlZCBtaW5sZW5ndGg9XCI4XCI+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiPlJlZ2lzdGVyPC9idXR0b24+XG4gICAgPC9mb3JtPlxuICAgIDxwPkFscmVhZHkgaGF2ZSBhbiBhY2NvdW50PyA8YSBocmVmPVwiIy9sb2dpblwiPkxvZ2luIGhlcmU8L2E+PC9wPlxuICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjwvZGl2PlxuICAgIDxkaXYgaWQ9XCJzdWNjZXNzLW1lc3NhZ2VcIiBjbGFzcz1cInN1Y2Nlc3MtbWVzc2FnZVwiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj48L2Rpdj5cbiAgYCk7XG5cbiAgY29uc3QgYmluZFJlZ2lzdGVyID0gKGhhbmRsZXIpID0+IHtcbiAgICBjb25zdCBmb3JtID0gYmFzZS5nZXRWaWV3KCkucXVlcnlTZWxlY3RvcignI3JlZ2lzdGVyLWZvcm0nKTtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBiYXNlLmdldFZpZXcoKS5xdWVyeVNlbGVjdG9yKCcjZXJyb3ItbWVzc2FnZScpO1xuICAgIFxuICAgIGZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYXN5bmMgKGUpID0+IHtcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgIGNvbnN0IG5hbWUgPSBmb3JtLm5hbWUudmFsdWU7XG4gICAgICBjb25zdCBlbWFpbCA9IGZvcm0uZW1haWwudmFsdWU7XG4gICAgICBjb25zdCBwYXNzd29yZCA9IGZvcm0ucGFzc3dvcmQudmFsdWU7XG4gICAgICBjb25zdCBjb25maXJtUGFzc3dvcmQgPSBmb3JtWydjb25maXJtLXBhc3N3b3JkJ10udmFsdWU7XG4gICAgICBcbiAgICAgIGVycm9yTWVzc2FnZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuXG4gICAgICBpZiAocGFzc3dvcmQgIT09IGNvbmZpcm1QYXNzd29yZCkge1xuICAgICAgICBiYXNlLnNob3dFcnJvcihcIlBhc3N3b3JkcyBkb24ndCBtYXRjaCFcIik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgYXdhaXQgaGFuZGxlcihuYW1lLCBlbWFpbCwgcGFzc3dvcmQpO1xuICAgIH0pO1xuICB9O1xuXG4gIHJldHVybiB7XG4gICAgZ2V0VmlldzogYmFzZS5nZXRWaWV3LFxuICAgIHNob3dFcnJvcjogYmFzZS5zaG93RXJyb3IsXG4gICAgc2hvd1N1Y2Nlc3M6IGJhc2Uuc2hvd1N1Y2Nlc3MsXG4gICAgYmluZFJlZ2lzdGVyXG4gIH07XG59OyIsImV4cG9ydCBjb25zdCBTdG9yaWVzVmlldyA9ICgpID0+IHtcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJtYWluXCIpO1xuICB2aWV3LmlkID0gXCJtYWluLWNvbnRlbnRcIjtcbiAgdmlldy5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwibWFpblwiKTtcbiAgdmlldy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiU3RvcmllcyBsaXN0XCIpO1xuXG5cbiAgdmlldy5pbm5lckhUTUwgPSBgXG4gICAgPGRpdiBjbGFzcz1cInN0b3JpZXMtaGVhZGVyXCI+XG4gICAgICA8aDEgaWQ9XCJzdG9yaWVzLWhlYWRpbmdcIj5TdG9yaWVzPC9oMT5cbiAgICAgIDxkaXYgY2xhc3M9XCJzdG9yaWVzLWNvbnRyb2xzXCI+XG4gICAgICAgIDxidXR0b24gY2xhc3M9XCJib29rbWFyay1maWx0ZXItYnRuXCIgYXJpYS1sYWJlbD1cIlNob3cgYm9va21hcmtlZCBzdG9yaWVzXCIgYXJpYS1wcmVzc2VkPVwiZmFsc2VcIj5cbiAgICAgICAgICA8c3ZnIHdpZHRoPVwiMjBcIiBoZWlnaHQ9XCIyMFwiIHZpZXdCb3g9XCIwIDAgMjQgMjRcIj5cbiAgICAgICAgICAgIDxwYXRoIGQ9XCJNMTcgM0g3Yy0xLjEgMC0yIC45LTIgMnYxNmw3LTMgNyAzVjVjMC0xLjEtLjktMi0yLTJ6XCIvPlxuICAgICAgICAgIDwvc3ZnPlxuICAgICAgICAgIDxzcGFuPkJvb2ttYXJrczwvc3Bhbj5cbiAgICAgICAgPC9idXR0b24+XG4gICAgICA8L2Rpdj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGNsYXNzPVwic3Rvcmllcy1ncmlkXCIgaWQ9XCJzdG9yaWVzLWNvbnRhaW5lclwiIHJvbGU9XCJsaXN0XCIgYXJpYS1sYWJlbGxlZGJ5PVwic3Rvcmllcy1oZWFkaW5nXCI+PC9kaXY+XG4gICAgPGRpdiBpZD1cImVycm9yLW1lc3NhZ2VcIiBjbGFzcz1cImVycm9yLW1lc3NhZ2VcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+PC9kaXY+XG4gICAgPGRpdiBpZD1cImxvYWRpbmctaW5kaWNhdG9yXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPlxuICAgICAgPGRpdiBjbGFzcz1cInNwaW5uZXJcIj48L2Rpdj5cbiAgICAgIDxzcGFuPkxvYWRpbmcgc3Rvcmllcy4uLjwvc3Bhbj5cbiAgICA8L2Rpdj5cbiAgICA8ZGl2IGlkPVwiZW1wdHktc3RhdGVcIiBjbGFzcz1cImVtcHR5LXN0YXRlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPlxuICAgICAgPHN2ZyBjbGFzcz1cImVtcHR5LWljb25cIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCI+XG4gICAgICAgIDxwYXRoIGQ9XCJNMTcgM0g3Yy0xLjEgMC0yIC45LTIgMnYxNmw3LTMgNyAzVjVjMC0xLjEtLjktMi0yLTJ6bTAgMTVsLTUtMi4xOEw3IDE4VjVoMTB2MTN6XCIvPlxuICAgICAgPC9zdmc+XG4gICAgICA8cCBjbGFzcz1cImVtcHR5LW1lc3NhZ2VcIj5ObyBzdG9yaWVzIGZvdW5kPC9wPlxuICAgIDwvZGl2PlxuICBgO1xuXG4gIGNvbnN0IGRpc3BsYXlTdG9yaWVzID0gKHN0b3JpZXMpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjc3Rvcmllcy1jb250YWluZXJcIik7XG4gICAgY29uc3QgbG9hZGluZyA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nLWluZGljYXRvclwiKTtcbiAgICBjb25zdCBlbXB0eVN0YXRlID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2VtcHR5LXN0YXRlXCIpO1xuXG4gICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XG5cbiAgICBpZiAoIXN0b3JpZXMgfHwgc3Rvcmllcy5sZW5ndGggPT09IDApIHtcbiAgICAgIGVtcHR5U3RhdGUuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgICAgY29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBlbXB0eVN0YXRlLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICBjb250YWluZXIuc3R5bGUuZGlzcGxheSA9IFwiZ3JpZFwiO1xuXG4gICAgc3Rvcmllcy5mb3JFYWNoKChzdG9yeSkgPT4ge1xuICAgICAgY29uc3Qgc2FmZVN0b3J5ID0ge1xuICAgICAgICBpZDogc3RvcnkuaWQgfHwgYG1pc3NpbmctaWQtJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YCxcbiAgICAgICAgbmFtZTogc3RvcnkubmFtZSB8fCBcIlVua25vd24gQXV0aG9yXCIsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBzdG9yeS5kZXNjcmlwdGlvbiB8fCBcIlwiLFxuICAgICAgICBwaG90b1VybDogc3RvcnkucGhvdG9VcmwgfHwgXCIvYXNzZXRzL2ltYWdlcy9wbGFjZWhvbGRlci1vZmZsaW5lLmpwZ1wiLFxuICAgICAgICBjcmVhdGVkQXQ6IHN0b3J5LmNyZWF0ZWRBdCB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGxhdDogc3RvcnkubGF0LFxuICAgICAgICBsb246IHN0b3J5LmxvblxuICAgICAgfTtcblxuICAgICAgY29uc3Qgc3RvcnlFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFydGljbGVcIik7XG4gICAgICBzdG9yeUVsZW1lbnQuY2xhc3NOYW1lID0gXCJzdG9yeS1jYXJkXCI7XG4gICAgICBzdG9yeUVsZW1lbnQuc2V0QXR0cmlidXRlKFwiZGF0YS1zdG9yeS1pZFwiLCBzYWZlU3RvcnkuaWQpO1xuICAgICAgc3RvcnlFbGVtZW50LnNldEF0dHJpYnV0ZShcInRhYmluZGV4XCIsIFwiMFwiKTtcblxuICAgICAgY29uc3QgZm9ybWF0dGVkRGF0ZSA9IG5ldyBEYXRlKHNhZmVTdG9yeS5jcmVhdGVkQXQpLnRvTG9jYWxlRGF0ZVN0cmluZyhcImlkLUlEXCIsIHtcbiAgICAgICAgeWVhcjogXCJudW1lcmljXCIsXG4gICAgICAgIG1vbnRoOiBcImxvbmdcIixcbiAgICAgICAgZGF5OiBcIm51bWVyaWNcIixcbiAgICAgICAgaG91cjogXCIyLWRpZ2l0XCIsXG4gICAgICAgIG1pbnV0ZTogXCIyLWRpZ2l0XCJcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBtYXhMZW5ndGggPSAxMDA7XG4gICAgICBsZXQgc2hvcnREZXNjcmlwdGlvbiA9IHNhZmVTdG9yeS5kZXNjcmlwdGlvbjtcbiAgICAgIGlmIChzaG9ydERlc2NyaXB0aW9uLmxlbmd0aCA+IG1heExlbmd0aCkge1xuICAgICAgICBzaG9ydERlc2NyaXB0aW9uID0gc2hvcnREZXNjcmlwdGlvbi5zdWJzdHJpbmcoMCwgbWF4TGVuZ3RoKS5yZXBsYWNlKC9cXHMrXFxTKiQvLCAnJykgKyAnLi4uJztcbiAgICAgIH1cblxuICAgICAgc3RvcnlFbGVtZW50LmlubmVySFRNTCA9IGBcbiAgICAgICAgPGRpdiBjbGFzcz1cInN0b3J5LWltYWdlLWNvbnRhaW5lclwiPlxuICAgICAgICAgIDxpbWcgc3JjPVwiJHtzYWZlU3RvcnkucGhvdG9Vcmx9XCIgXG4gICAgICAgICAgICAgICBhbHQ9XCJTdG9yeSBpbWFnZSBieSAke3NhZmVTdG9yeS5uYW1lfVwiIFxuICAgICAgICAgICAgICAgY2xhc3M9XCJzdG9yeS1pbWFnZVwiXG4gICAgICAgICAgICAgICBsb2FkaW5nPVwibGF6eVwiPlxuICAgICAgICAgIDxidXR0b24gY2xhc3M9XCJib29rbWFyay1idXR0b25cIiBhcmlhLWxhYmVsPVwiQm9va21hcmsgdGhpcyBzdG9yeVwiPlxuICAgICAgICAgICAgPHN2ZyBjbGFzcz1cImJvb2ttYXJrLWljb25cIiB2aWV3Qm94PVwiMCAwIDI0IDI0XCIgd2lkdGg9XCIyNFwiIGhlaWdodD1cIjI0XCI+XG4gICAgICAgICAgICAgIDxwYXRoIGQ9XCJNMTcgM0g3Yy0xLjEgMC0yIC45LTIgMnYxNmw3LTMgNyAzVjVjMC0xLjEtLjktMi0yLTJ6XCIvPlxuICAgICAgICAgICAgPC9zdmc+XG4gICAgICAgICAgPC9idXR0b24+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RvcnktY29udGVudFwiPlxuICAgICAgICAgIDxoMyBjbGFzcz1cInN0b3J5LXRpdGxlXCI+JHtzYWZlU3RvcnkubmFtZX08L2gzPlxuICAgICAgICAgIDxwIGNsYXNzPVwic3RvcnktZGVzY3JpcHRpb25cIj4ke3Nob3J0RGVzY3JpcHRpb259PC9wPlxuICAgICAgICAgIDx0aW1lIGRhdGV0aW1lPVwiJHtuZXcgRGF0ZShzYWZlU3RvcnkuY3JlYXRlZEF0KS50b0lTT1N0cmluZygpfVwiIFxuICAgICAgICAgICAgICAgIGNsYXNzPVwic3RvcnktZGF0ZVwiPlxuICAgICAgICAgICAgJHtmb3JtYXR0ZWREYXRlfVxuICAgICAgICAgIDwvdGltZT5cbiAgICAgICAgICA8YSBocmVmPVwiIy9zdG9yaWVzLyR7c2FmZVN0b3J5LmlkfVwiIFxuICAgICAgICAgICAgIGNsYXNzPVwicmVhZC1tb3JlXCIgXG4gICAgICAgICAgICAgYXJpYS1sYWJlbD1cIlJlYWQgbW9yZSBhYm91dCAke3NhZmVTdG9yeS5uYW1lfVwiXG4gICAgICAgICAgICAgdGFiaW5kZXg9XCIwXCI+XG4gICAgICAgICAgICBSZWFkIG1vcmVcbiAgICAgICAgICA8L2E+XG4gICAgICAgIDwvZGl2PlxuICAgICAgYDtcblxuICAgICAgc3RvcnlFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xuICAgICAgICBpZiAoIWUudGFyZ2V0LmNsb3Nlc3QoXCIuYm9va21hcmstYnV0dG9uXCIpKSB7XG4gICAgICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBgIy9zdG9yaWVzLyR7c2FmZVN0b3J5LmlkfWA7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBzdG9yeUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgKGUpID0+IHtcbiAgICAgICAgaWYgKGUua2V5ID09PSBcIkVudGVyXCIgJiYgZS50YXJnZXQgPT09IHN0b3J5RWxlbWVudCkge1xuICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gYCMvc3Rvcmllcy8ke3NhZmVTdG9yeS5pZH1gO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHN0b3J5RWxlbWVudCk7XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3Qgc2hvd0Vycm9yID0gKG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBlcnJvckVsID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2Vycm9yLW1lc3NhZ2VcIik7XG4gICAgZXJyb3JFbC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgZXJyb3JFbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgIHZpZXcucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nLWluZGljYXRvclwiKS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgdmlldy5xdWVyeVNlbGVjdG9yKFwiI2VtcHR5LXN0YXRlXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgfTtcblxuICBjb25zdCBzaG93TG9hZGluZyA9ICgpID0+IHtcbiAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjbG9hZGluZy1pbmRpY2F0b3JcIikuc3R5bGUuZGlzcGxheSA9IFwiZmxleFwiO1xuICAgIHZpZXcucXVlcnlTZWxlY3RvcihcIiNlcnJvci1tZXNzYWdlXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjZW1wdHktc3RhdGVcIikuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICB9O1xuXG4gIGNvbnN0IHNob3dPZmZsaW5lV2FybmluZyA9ICgpID0+IHtcbiAgICBjb25zdCBjb250YWluZXIgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjc3Rvcmllcy1jb250YWluZXJcIik7XG4gICAgY29uc3QgZXhpc3RpbmdXYXJuaW5nID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiLm9mZmxpbmUtd2FybmluZ1wiKTtcblxuICAgIGlmICghZXhpc3RpbmdXYXJuaW5nKSB7XG4gICAgICBjb25zdCB3YXJuaW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgIHdhcm5pbmcuY2xhc3NOYW1lID0gXCJvZmZsaW5lLXdhcm5pbmdcIjtcbiAgICAgIHdhcm5pbmcuaW5uZXJIVE1MID0gYFxuICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS13aWZpLXNsYXNoXCI+PC9pPlxuICAgICAgICA8c3Bhbj5TaG93aW5nIG9mZmxpbmUgZGF0YS4gU29tZSBzdG9yaWVzIG1heSBub3QgYmUgdXAtdG8tZGF0ZS48L3NwYW4+XG4gICAgICBgO1xuICAgICAgY29udGFpbmVyLnByZXBlbmQod2FybmluZyk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHVwZGF0ZUJvb2ttYXJrRmlsdGVyU3RhdGUgPSAoaXNBY3RpdmUpID0+IHtcbiAgICBjb25zdCBmaWx0ZXJCdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIuYm9va21hcmstZmlsdGVyLWJ0blwiKTtcbiAgICBpZiAoZmlsdGVyQnRuKSB7XG4gICAgICBmaWx0ZXJCdG4uY2xhc3NMaXN0LnRvZ2dsZShcImFjdGl2ZVwiLCBpc0FjdGl2ZSk7XG4gICAgICBmaWx0ZXJCdG4uc2V0QXR0cmlidXRlKFwiYXJpYS1wcmVzc2VkXCIsIGlzQWN0aXZlKTtcbiAgICAgIGNvbnN0IHRleHRTcGFuID0gZmlsdGVyQnRuLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuXCIpO1xuICAgICAgaWYgKHRleHRTcGFuKSB7XG4gICAgICAgIHRleHRTcGFuLnRleHRDb250ZW50ID0gaXNBY3RpdmUgPyBcIkFsbCBTdG9yaWVzXCIgOiBcIkJvb2ttYXJrc1wiO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICBjb25zdCBiaW5kVG9nZ2xlQm9va21hcmtGaWx0ZXIgPSAoaGFuZGxlcikgPT4ge1xuICAgIGNvbnN0IGJ0biA9IHZpZXcucXVlcnlTZWxlY3RvcihcIi5ib29rbWFyay1maWx0ZXItYnRuXCIpO1xuICAgIGJ0bj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGhhbmRsZXIpO1xuICB9O1xuXG4gIGNvbnN0IGJpbmRCb29rbWFya0FjdGlvbiA9IChoYW5kbGVyKSA9PiB7XG4gICAgdmlldy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgIGNvbnN0IGJvb2ttYXJrQnRuID0gZS50YXJnZXQuY2xvc2VzdChcIi5ib29rbWFyay1idXR0b25cIik7XG4gICAgICBpZiAoYm9va21hcmtCdG4pIHtcbiAgICAgICAgY29uc3Qgc3RvcnlDYXJkID0gYm9va21hcmtCdG4uY2xvc2VzdChcIi5zdG9yeS1jYXJkXCIpO1xuICAgICAgICBjb25zdCBzdG9yeUlkID0gc3RvcnlDYXJkPy5kYXRhc2V0LnN0b3J5SWQ7XG4gICAgICAgIGlmIChzdG9yeUlkKSB7XG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICAgaGFuZGxlcihzdG9yeUlkKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGJpbmRMb2FkU3RvcmllcyA9IChoYW5kbGVyKSA9PiB7XG4gICAgc2hvd0xvYWRpbmcoKTtcbiAgICBoYW5kbGVyKCkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICBzaG93RXJyb3IoZXJyb3IubWVzc2FnZSB8fCBcIkZhaWxlZCB0byBsb2FkIHN0b3JpZXNcIik7XG4gICAgfSk7XG4gIH07XG5cbiAgcmV0dXJuIHtcbiAgICBnZXRWaWV3OiAoKSA9PiB2aWV3LFxuICAgIGRpc3BsYXlTdG9yaWVzLFxuICAgIHNob3dFcnJvcixcbiAgICBzaG93TG9hZGluZyxcbiAgICBzaG93T2ZmbGluZVdhcm5pbmcsXG4gICAgYmluZExvYWRTdG9yaWVzLFxuICAgIHVwZGF0ZUJvb2ttYXJrRmlsdGVyU3RhdGUsXG4gICAgYmluZFRvZ2dsZUJvb2ttYXJrRmlsdGVyLFxuICAgIGJpbmRCb29rbWFya0FjdGlvblxuICB9O1xufTtcbiIsImltcG9ydCB7IHN0YXJ0Vmlld1RyYW5zaXRpb24gfSBmcm9tICcuLi8uLi91dGlscy92aWV3LXRyYW5zaXRpb24uanMnO1xuaW1wb3J0ICdsZWFmbGV0L2Rpc3QvbGVhZmxldC5jc3MnO1xuaW1wb3J0IEwgZnJvbSAnbGVhZmxldCc7XG5pbXBvcnQgJ2xlYWZsZXQubWFya2VyY2x1c3Rlci9kaXN0L2xlYWZsZXQubWFya2VyY2x1c3Rlcic7XG5pbXBvcnQgJ2xlYWZsZXQubWFya2VyY2x1c3Rlci9kaXN0L01hcmtlckNsdXN0ZXIuY3NzJztcbmltcG9ydCAnbGVhZmxldC5tYXJrZXJjbHVzdGVyL2Rpc3QvTWFya2VyQ2x1c3Rlci5EZWZhdWx0LmNzcyc7XG5cbi8vIEZpeCBmb3IgZGVmYXVsdCBtYXJrZXIgaWNvbnMgaW4gTGVhZmxldFxuZGVsZXRlIEwuSWNvbi5EZWZhdWx0LnByb3RvdHlwZS5fZ2V0SWNvblVybDtcbkwuSWNvbi5EZWZhdWx0Lm1lcmdlT3B0aW9ucyh7XG4gIGljb25SZXRpbmFVcmw6ICdodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9sZWFmbGV0LzEuNy4xL2ltYWdlcy9tYXJrZXItaWNvbi0yeC5wbmcnLFxuICBpY29uVXJsOiAnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvbGVhZmxldC8xLjcuMS9pbWFnZXMvbWFya2VyLWljb24ucG5nJyxcbiAgc2hhZG93VXJsOiAnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvbGVhZmxldC8xLjcuMS9pbWFnZXMvbWFya2VyLXNoYWRvdy5wbmcnXG59KTtcblxuZXhwb3J0IGNvbnN0IERldGFpbFN0b3J5VmlldyA9ICgpID0+IHtcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ21haW4nKTtcbiAgdmlldy5pZCA9ICdtYWluLWNvbnRlbnQnO1xuICBcbiAgdmlldy5pbm5lckhUTUwgPSBgXG4gICAgPGRpdiBjbGFzcz1cImRldGFpbC1zdG9yeVwiPlxuICAgICAgPGRpdiBjbGFzcz1cInN0b3J5LWltYWdlLWNvbnRhaW5lclwiPlxuICAgICAgICA8aW1nIGlkPVwic3RvcnktaW1hZ2VcIiBjbGFzcz1cImRldGFpbC1zdG9yeS1pbWFnZVwiIGFsdD1cIlN0b3J5IGltYWdlXCI+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJzdG9yeS1tZXRhXCI+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cImF1dGhvci1pbmZvXCI+XG4gICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS11c2VyLWNpcmNsZVwiPjwvaT5cbiAgICAgICAgICAgIDxzcGFuIGlkPVwic3RvcnktYXV0aG9yXCI+PC9zcGFuPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJkYXRlLWluZm9cIj5cbiAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFyIGZhLWNhbGVuZGFyLWFsdFwiPjwvaT5cbiAgICAgICAgICAgIDxzcGFuIGlkPVwic3RvcnktZGF0ZVwiPjwvc3Bhbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L2Rpdj5cbiAgICAgIFxuICAgICAgPGRpdiBjbGFzcz1cInN0b3J5LWNvbnRlbnRcIj5cbiAgICAgICAgPGgxIGlkPVwic3RvcnktdGl0bGVcIiBjbGFzcz1cInN0b3J5LXRpdGxlXCI+PC9oMT5cbiAgICAgICAgPHAgaWQ9XCJzdG9yeS1kZXNjcmlwdGlvblwiIGNsYXNzPVwic3RvcnktZGVzY3JpcHRpb25cIj48L3A+XG4gICAgICAgIFxuICAgICAgICA8ZGl2IGNsYXNzPVwibG9jYXRpb24tc2VjdGlvblwiPlxuICAgICAgICAgIDxoMz48aSBjbGFzcz1cImZhcyBmYS1tYXAtbWFya2VyLWFsdFwiPjwvaT4gTG9rYXNpPC9oMz5cbiAgICAgICAgICA8ZGl2IGlkPVwic3RvcnktbWFwLWNvbnRhaW5lclwiIGNsYXNzPVwiZGV0YWlsLW1hcC1jb250YWluZXJcIj5cbiAgICAgICAgICAgIDxkaXYgaWQ9XCJzdG9yeS1tYXBcIiBjbGFzcz1cImRldGFpbC1tYXBcIj48L2Rpdj5cbiAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtYXAtY29udHJvbHNcIj5cbiAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cInNhdGVsbGl0ZS12aWV3XCIgY2xhc3M9XCJtYXAtY29udHJvbC1idG5cIj5cbiAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1zYXRlbGxpdGVcIj48L2k+XG4gICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgICA8YnV0dG9uIGlkPVwic3RyZWV0LXZpZXdcIiBjbGFzcz1cIm1hcC1jb250cm9sLWJ0blwiPlxuICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXJvYWRcIj48L2k+XG4gICAgICAgICAgICAgIDwvYnV0dG9uPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgPC9kaXY+XG4gICAgXG4gICAgPGRpdiBpZD1cImVycm9yLW1lc3NhZ2VcIiBjbGFzcz1cImVycm9yLW1lc3NhZ2VcIj5cbiAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZVwiPjwvaT5cbiAgICAgIDxzcGFuIGNsYXNzPVwiZXJyb3ItdGV4dFwiPjwvc3Bhbj5cbiAgICA8L2Rpdj5cbiAgYDtcblxuICBsZXQgbWFwSW5zdGFuY2UgPSBudWxsO1xuICBsZXQgbWFya2VyQ2x1c3RlciA9IG51bGw7XG4gIGxldCBiYXNlTGF5ZXJzID0ge307XG4gIGxldCBjdXJyZW50TGF5ZXIgPSBudWxsO1xuXG4gIGNvbnN0IHByZXBhcmVNYXBDb250YWluZXIgPSAoKSA9PiB7XG4gICAgY29uc3QgY29udGFpbmVyID0gdmlldy5xdWVyeVNlbGVjdG9yKCcjc3RvcnktbWFwLWNvbnRhaW5lcicpO1xuICAgIGNvbnN0IG1hcERpdiA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcCcpO1xuICAgIFxuICAgIC8vIENvbXBsZXRlbHkgcmVjcmVhdGUgdGhlIG1hcCBjb250YWluZXJcbiAgICBpZiAobWFwRGl2KSB7XG4gICAgICBjb25zdCBuZXdNYXBEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIG5ld01hcERpdi5pZCA9ICdzdG9yeS1tYXAnO1xuICAgICAgbmV3TWFwRGl2LmNsYXNzTmFtZSA9ICdkZXRhaWwtbWFwJztcbiAgICAgIGNvbnRhaW5lci5yZXBsYWNlQ2hpbGQobmV3TWFwRGl2LCBtYXBEaXYpO1xuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhbiB1cCBleGlzdGluZyBtYXAgaW5zdGFuY2VzXG4gICAgaWYgKG1hcEluc3RhbmNlKSB7XG4gICAgICBtYXBJbnN0YW5jZS5yZW1vdmUoKTtcbiAgICAgIG1hcEluc3RhbmNlID0gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgaWYgKG1hcmtlckNsdXN0ZXIpIHtcbiAgICAgIG1hcmtlckNsdXN0ZXIuY2xlYXJMYXllcnMoKTtcbiAgICAgIG1hcmtlckNsdXN0ZXIgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBpbml0TWFwID0gKGxhdCwgbG5nKSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGlmIG1hcCBjb250YWluZXIgZXhpc3RzIGFuZCBpc24ndCBhbHJlYWR5IGluaXRpYWxpemVkXG4gICAgICBjb25zdCBtYXBFbGVtZW50ID0gdmlldy5xdWVyeVNlbGVjdG9yKCcjc3RvcnktbWFwJyk7XG4gICAgICBpZiAoIW1hcEVsZW1lbnQgfHwgbWFwRWxlbWVudC5fbGVhZmxldF9pZCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgIH1cblxuICAgICAgLy8gQ3JlYXRlIG5ldyBtYXAgaW5zdGFuY2VcbiAgICAgIG1hcEluc3RhbmNlID0gTC5tYXAobWFwRWxlbWVudCwge1xuICAgICAgICB6b29tQ29udHJvbDogZmFsc2UsXG4gICAgICAgIHByZWZlckNhbnZhczogdHJ1ZVxuICAgICAgfSkuc2V0VmlldyhbbGF0LCBsbmddLCAxMyk7XG5cbiAgICAgIC8vIEFkZCB6b29tIGNvbnRyb2xcbiAgICAgIEwuY29udHJvbC56b29tKHtcbiAgICAgICAgcG9zaXRpb246ICdib3R0b21yaWdodCdcbiAgICAgIH0pLmFkZFRvKG1hcEluc3RhbmNlKTtcblxuICAgICAgLy8gRGVmaW5lIGJhc2UgbGF5ZXJzXG4gICAgICBiYXNlTGF5ZXJzID0ge1xuICAgICAgICBcIlN0cmVldCBWaWV3XCI6IEwudGlsZUxheWVyKCdodHRwczovL3tzfS50aWxlLm9wZW5zdHJlZXRtYXAub3JnL3t6fS97eH0ve3l9LnBuZycsIHtcbiAgICAgICAgICBhdHRyaWJ1dGlvbjogJyZjb3B5OyA8YSBocmVmPVwiaHR0cHM6Ly93d3cub3BlbnN0cmVldG1hcC5vcmcvY29weXJpZ2h0XCI+T3BlblN0cmVldE1hcDwvYT4gY29udHJpYnV0b3JzJyxcbiAgICAgICAgICBtYXhab29tOiAxOVxuICAgICAgICB9KSxcbiAgICAgICAgXCJTYXRlbGxpdGUgVmlld1wiOiBMLnRpbGVMYXllcignaHR0cHM6Ly9zZXJ2ZXIuYXJjZ2lzb25saW5lLmNvbS9BcmNHSVMvcmVzdC9zZXJ2aWNlcy9Xb3JsZF9JbWFnZXJ5L01hcFNlcnZlci90aWxlL3t6fS97eX0ve3h9Jywge1xuICAgICAgICAgIGF0dHJpYnV0aW9uOiAnVGlsZXMgJmNvcHk7IEVzcmkgJm1kYXNoOyBTb3VyY2U6IEVzcmksIGktY3ViZWQsIFVTREEsIFVTR1MsIEFFWCwgR2VvRXllLCBHZXRtYXBwaW5nLCBBZXJvZ3JpZCwgSUdOLCBJR1AsIFVQUi1FR1AsIGFuZCB0aGUgR0lTIFVzZXIgQ29tbXVuaXR5JyxcbiAgICAgICAgICBtYXhab29tOiAxOVxuICAgICAgICB9KVxuICAgICAgfTtcblxuICAgICAgLy8gQWRkIGRlZmF1bHQgbGF5ZXJcbiAgICAgIGJhc2VMYXllcnNbXCJTdHJlZXQgVmlld1wiXS5hZGRUbyhtYXBJbnN0YW5jZSk7XG4gICAgICBjdXJyZW50TGF5ZXIgPSBcIlN0cmVldCBWaWV3XCI7XG5cbiAgICAgIC8vIEFkZCBsYXllciBjb250cm9sXG4gICAgICBMLmNvbnRyb2wubGF5ZXJzKGJhc2VMYXllcnMsIG51bGwsIHtcbiAgICAgICAgcG9zaXRpb246ICd0b3ByaWdodCcsXG4gICAgICAgIGNvbGxhcHNlZDogZmFsc2VcbiAgICAgIH0pLmFkZFRvKG1hcEluc3RhbmNlKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBtYXJrZXIgY2x1c3RlclxuICAgICAgbWFya2VyQ2x1c3RlciA9IEwubWFya2VyQ2x1c3Rlckdyb3VwKHtcbiAgICAgICAgc3BpZGVyZnlPbk1heFpvb206IHRydWUsXG4gICAgICAgIHNob3dDb3ZlcmFnZU9uSG92ZXI6IGZhbHNlLFxuICAgICAgICB6b29tVG9Cb3VuZHNPbkNsaWNrOiB0cnVlLFxuICAgICAgICBtYXhDbHVzdGVyUmFkaXVzOiA0MFxuICAgICAgfSk7XG5cbiAgICAgIC8vIEFkZCBjdXN0b20gY29udHJvbCBidXR0b24gZXZlbnRzXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F0ZWxsaXRlLXZpZXcnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG4gICAgICAgIHN3aXRjaExheWVyKFwiU2F0ZWxsaXRlIFZpZXdcIik7XG4gICAgICB9KTtcblxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0cmVldC12aWV3Jyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgICBzd2l0Y2hMYXllcihcIlN0cmVldCBWaWV3XCIpO1xuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiBtYXBJbnN0YW5jZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignTWFwIGluaXRpYWxpemF0aW9uIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBzd2l0Y2hMYXllciA9IChsYXllck5hbWUpID0+IHtcbiAgICBpZiAobWFwSW5zdGFuY2UgJiYgY3VycmVudExheWVyICE9PSBsYXllck5hbWUpIHtcbiAgICAgIG1hcEluc3RhbmNlLnJlbW92ZUxheWVyKGJhc2VMYXllcnNbY3VycmVudExheWVyXSk7XG4gICAgICBiYXNlTGF5ZXJzW2xheWVyTmFtZV0uYWRkVG8obWFwSW5zdGFuY2UpO1xuICAgICAgY3VycmVudExheWVyID0gbGF5ZXJOYW1lO1xuICAgICAgXG4gICAgICAvLyBVcGRhdGUgYWN0aXZlIGJ1dHRvbiBzdGF0ZVxuICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLm1hcC1jb250cm9sLWJ0bicpLmZvckVhY2goYnRuID0+IHtcbiAgICAgICAgYnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xuICAgICAgfSk7XG4gICAgICBjb25zdCBhY3RpdmVCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgJHtsYXllck5hbWUudG9Mb3dlckNhc2UoKS5yZXBsYWNlKCcgJywgJy0nKX0tdmlld2ApO1xuICAgICAgaWYgKGFjdGl2ZUJ0bikgYWN0aXZlQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBkaXNwbGF5U3RvcnlEZXRhaWwgPSBhc3luYyAoc3RvcnkpID0+IHtcbiAgICBhd2FpdCBzdGFydFZpZXdUcmFuc2l0aW9uKGFzeW5jICgpID0+IHtcbiAgICAgIC8vIFByZXBhcmUgdGhlIHZpZXcgZmlyc3RcbiAgICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LWltYWdlJyk7XG4gICAgICBpbWFnZUVsZW1lbnQuc3JjID0gc3RvcnkucGhvdG9Vcmw7XG4gICAgICBpbWFnZUVsZW1lbnQuYWx0ID0gYFN0b3J5IGJ5ICR7c3RvcnkubmFtZX1gO1xuICAgICAgdmlldy5xdWVyeVNlbGVjdG9yKCcjc3RvcnktdGl0bGUnKS50ZXh0Q29udGVudCA9IHN0b3J5Lm5hbWU7XG4gICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1hdXRob3InKS50ZXh0Q29udGVudCA9IHN0b3J5Lm5hbWU7XG4gICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1kZXNjcmlwdGlvbicpLnRleHRDb250ZW50ID0gc3RvcnkuZGVzY3JpcHRpb247XG4gICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1kYXRlJykudGV4dENvbnRlbnQgPSBuZXcgRGF0ZShzdG9yeS5jcmVhdGVkQXQpLnRvTG9jYWxlU3RyaW5nKCdpZC1JRCcsIHtcbiAgICAgICAgd2Vla2RheTogJ2xvbmcnLFxuICAgICAgICB5ZWFyOiAnbnVtZXJpYycsXG4gICAgICAgIG1vbnRoOiAnbG9uZycsXG4gICAgICAgIGRheTogJ251bWVyaWMnLFxuICAgICAgICBob3VyOiAnMi1kaWdpdCcsXG4gICAgICAgIG1pbnV0ZTogJzItZGlnaXQnXG4gICAgICB9KTtcblxuICAgICAgLy8gSGFuZGxlIG1hcCBkaXNwbGF5XG4gICAgICBjb25zdCBtYXBDb250YWluZXIgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1tYXAtY29udGFpbmVyJyk7XG4gICAgICBpZiAoc3RvcnkubGF0ICYmIHN0b3J5Lmxvbikge1xuICAgICAgICBtYXBDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XG4gICAgICAgIFxuICAgICAgICAvLyBQcmVwYXJlIHRoZSBtYXAgY29udGFpbmVyXG4gICAgICAgIHByZXBhcmVNYXBDb250YWluZXIoKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFdhaXQgZm9yIERPTSB0byBiZSByZWFkeVxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZShyZXNvbHZlKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBJbml0aWFsaXplIG1hcFxuICAgICAgICBjb25zdCBtYXAgPSBpbml0TWFwKHN0b3J5LmxhdCwgc3RvcnkubG9uKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChtYXApIHtcbiAgICAgICAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBjbHVzdGVyXG4gICAgICAgICAgY29uc3QgbWFya2VyID0gTC5tYXJrZXIoW3N0b3J5LmxhdCwgc3RvcnkubG9uXSlcbiAgICAgICAgICAgIC5iaW5kUG9wdXAoYFxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWFwLXBvcHVwXCI+XG4gICAgICAgICAgICAgICAgPGg0PiR7c3RvcnkubmFtZX08L2g0PlxuICAgICAgICAgICAgICAgIDxwPiR7c3RvcnkuZGVzY3JpcHRpb24uc3Vic3RyaW5nKDAsIDEwMCl9Li4uPC9wPlxuICAgICAgICAgICAgICAgIDxzbWFsbD4ke25ldyBEYXRlKHN0b3J5LmNyZWF0ZWRBdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9PC9zbWFsbD5cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICBgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBtYXJrZXJDbHVzdGVyLmFkZExheWVyKG1hcmtlcik7XG4gICAgICAgICAgbWFwLmFkZExheWVyKG1hcmtlckNsdXN0ZXIpO1xuICAgICAgICAgIG1hcmtlci5vcGVuUG9wdXAoKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbWFwQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG4gICAgICB9XG4gICAgfSk7XG4gIH07XG5cbiAgY29uc3Qgc2hvd0Vycm9yID0gKG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNlcnJvci1tZXNzYWdlJyk7XG4gICAgY29uc3QgZXJyb3JUZXh0ID0gZXJyb3JFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5lcnJvci10ZXh0Jyk7XG4gICAgZXJyb3JUZXh0LnRleHRDb250ZW50ID0gbWVzc2FnZTtcbiAgICBlcnJvckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcbiAgICBcbiAgICAvLyBBbmltYXRpb24gZm9yIGVycm9yIG1lc3NhZ2VcbiAgICBlcnJvckVsZW1lbnQuYW5pbWF0ZShbXG4gICAgICB7IG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoLTEwcHgpJyB9LFxuICAgICAgeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDApJyB9XG4gICAgXSwge1xuICAgICAgZHVyYXRpb246IDMwMCxcbiAgICAgIGVhc2luZzogJ2Vhc2Utb3V0J1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7XG4gICAgaWYgKG1hcEluc3RhbmNlKSB7XG4gICAgICBtYXBJbnN0YW5jZS5yZW1vdmUoKTtcbiAgICAgIG1hcEluc3RhbmNlID0gbnVsbDtcbiAgICB9XG4gICAgaWYgKG1hcmtlckNsdXN0ZXIpIHtcbiAgICAgIG1hcmtlckNsdXN0ZXIuY2xlYXJMYXllcnMoKTtcbiAgICAgIG1hcmtlckNsdXN0ZXIgPSBudWxsO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4ge1xuICAgIGdldFZpZXc6ICgpID0+IHZpZXcsXG4gICAgZGlzcGxheVN0b3J5RGV0YWlsLFxuICAgIHNob3dFcnJvcixcbiAgICBjbGVhbnVwLFxuICAgIHByZXBhcmVNYXBDb250YWluZXJcbiAgfTtcbn07IiwiaW1wb3J0IHtcbiAgc2hvd05vdGlmaWNhdGlvblByb21wdCxcbiAgc3Vic2NyaWJlVXNlcixcbn0gZnJvbSBcIi4uLy4uL3V0aWxzL25vdGlmaWNhdGlvbi5qc1wiO1xuaW1wb3J0IHsgQXV0aE1vZGVsIH0gZnJvbSBcIi4uLy4uL21vZGVscy9BdXRoTW9kZWwuanNcIjtcblxuZXhwb3J0IGNvbnN0IEFkZFN0b3J5VmlldyA9ICgpID0+IHtcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJtYWluXCIpO1xuICB2aWV3LmlkID0gXCJtYWluLWNvbnRlbnRcIjtcbiAgdmlldy5zZXRBdHRyaWJ1dGUoXCJyb2xlXCIsIFwibWFpblwiKTtcbiAgdmlldy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiQWRkIG5ldyBzdG9yeSBmb3JtXCIpO1xuXG4gIHZpZXcuaW5uZXJIVE1MID0gYFxuXG4gICAgPGRpdiBjbGFzcz1cImFkZC1zdG9yeS1mb3JtXCI+XG4gICAgPGgyPkFkZCBOZXcgU3Rvcnk8L2gyPiBcbiAgICA8ZGl2IGNsYXNzPVwibm90aWZpY2F0aW9uLXBlcm1pc3Npb24taW5mb1wiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj5cbiAgICAgIDxwPldlJ2QgbGlrZSB0byBzaG93IG5vdGlmaWNhdGlvbnMgd2hlbiB5b3UgYWRkIHN0b3JpZXMuIFRoaXMgaGVscHMgeW91IGtlZXAgdHJhY2sgb2YgeW91ciBjb250cmlidXRpb25zLjwvcD5cbiAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGlkPVwiZW5hYmxlLW5vdGlmaWNhdGlvbnNcIiBjbGFzcz1cImJ0blwiPkVuYWJsZSBOb3RpZmljYXRpb25zPC9idXR0b24+XG4gICAgPC9kaXY+XG4gICAgICA8Zm9ybSBpZD1cInN0b3J5LWZvcm1cIj5cbiAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cbiAgICAgICAgICA8bGFiZWwgZm9yPVwiZGVzY3JpcHRpb25cIj5EZXNjcmlwdGlvbjwvbGFiZWw+XG4gICAgICAgICAgPHRleHRhcmVhIGlkPVwiZGVzY3JpcHRpb25cIiBuYW1lPVwiZGVzY3JpcHRpb25cIiByb3dzPVwiNFwiIHJlcXVpcmVkPjwvdGV4dGFyZWE+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICBcbiAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXAgY2FtZXJhLWNvbnRhaW5lclwiPlxuICAgICAgICAgIDxsYWJlbD5QaG90bzwvbGFiZWw+XG4gICAgICAgICAgPGRpdiBjbGFzcz1cInByZXZpZXctY29udGFpbmVyXCI+XG4gICAgICAgICAgICA8dmlkZW8gaWQ9XCJjYW1lcmEtcHJldmlld1wiIGNsYXNzPVwibWVkaWEtcHJldmlld1wiIGF1dG9wbGF5IHBsYXlzaW5saW5lPjwvdmlkZW8+XG4gICAgICAgICAgICA8aW1nIGlkPVwicGhvdG8tcHJldmlld1wiIGNsYXNzPVwibWVkaWEtcHJldmlld1wiIHN0eWxlPVwiZGlzcGxheTpub25lOyBvYmplY3QtZml0OmNvbnRhaW47XCIgYWx0PVwiQ2FwdHVyZWQgcGhvdG9cIj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICA8ZGl2IGNsYXNzPVwiY2FtZXJhLWNvbnRyb2xzXCI+XG4gICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cInN0YXJ0LWNhbWVyYVwiIGNsYXNzPVwiYnRuIGNhbWVyYS1idG5cIj5TdGFydCBDYW1lcmE8L2J1dHRvbj5cbiAgICAgICAgICAgIDxzZWxlY3QgaWQ9XCJjYW1lcmEtc2VsZWN0XCIgY2xhc3M9XCJjYW1lcmEtc2VsZWN0XCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+PC9zZWxlY3Q+XG4gICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cImNhcHR1cmUtYnRuXCIgY2xhc3M9XCJidG4gY2FwdHVyZS1idG5cIiBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIj5DYXB0dXJlIFBob3RvPC9idXR0b24+XG4gICAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cInN0b3AtY2FtZXJhXCIgY2xhc3M9XCJidG4gc3RvcC1idG5cIiBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIj5TdG9wIENhbWVyYTwvYnV0dG9uPlxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaWQ9XCJyZXRha2UtYnRuXCIgY2xhc3M9XCJidG4gcmV0YWtlLWJ0blwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPlJldGFrZSBQaG90bzwvYnV0dG9uPlxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgIDxjYW52YXMgaWQ9XCJjYW52YXNcIiBzdHlsZT1cImRpc3BsYXk6bm9uZTtcIj48L2NhbnZhcz5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIFxuICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cFwiPlxuICAgICAgICAgIDxsYWJlbD5Mb2NhdGlvbjwvbGFiZWw+XG4gICAgICAgICAgPGRpdiBpZD1cIm1hcFwiIGNsYXNzPVwibWFwLWNvbnRhaW5lclwiPjwvZGl2PlxuICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGlkPVwiZ2V0LWxvY2F0aW9uXCIgY2xhc3M9XCJidG4gbG9jYXRpb24tYnRuXCI+VXNlIEN1cnJlbnQgTG9jYXRpb248L2J1dHRvbj5cbiAgICAgICAgICA8aW5wdXQgdHlwZT1cImhpZGRlblwiIGlkPVwibGF0XCIgbmFtZT1cImxhdFwiPlxuICAgICAgICAgIDxpbnB1dCB0eXBlPVwiaGlkZGVuXCIgaWQ9XCJsbmdcIiBuYW1lPVwibG5nXCI+XG4gICAgICAgICAgPHAgaWQ9XCJsb2NhdGlvbi1zdGF0dXNcIiBjbGFzcz1cImxvY2F0aW9uLXN0YXR1c1wiPk5vIGxvY2F0aW9uIHNlbGVjdGVkPC9wPlxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgXG4gICAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiIGNsYXNzPVwiYnRuIHN1Ym1pdC1idG5cIj5TdWJtaXQgU3Rvcnk8L2J1dHRvbj5cbiAgICAgIDwvZm9ybT5cbiAgICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCI+PC9kaXY+XG4gICAgICA8ZGl2IGlkPVwic3VjY2Vzcy1tZXNzYWdlXCIgY2xhc3M9XCJzdWNjZXNzLW1lc3NhZ2VcIj48L2Rpdj5cbiAgICA8L2Rpdj5cbiAgYDtcblxuICAvLyBTdGF0ZVxuICBsZXQgc3RyZWFtID0gbnVsbDtcbiAgbGV0IHBob3RvRmlsZSA9IG51bGw7XG4gIGxldCBtYXAgPSBudWxsO1xuICBsZXQgYXZhaWxhYmxlQ2FtZXJhcyA9IFtdO1xuICBsZXQgbWFwTWFya2VyID0gbnVsbDtcbiAgbGV0IGlzVmlld0FjdGl2ZSA9IHRydWU7XG5cbiAgLy8gRE9NIEVsZW1lbnRzXG4gIGNvbnN0IGNhbWVyYVByZXZpZXcgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjY2FtZXJhLXByZXZpZXdcIik7XG4gIGNvbnN0IHBob3RvUHJldmlldyA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNwaG90by1wcmV2aWV3XCIpO1xuICBjb25zdCBzdGFydENhbWVyYUJ0biA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNzdGFydC1jYW1lcmFcIik7XG4gIGNvbnN0IGNhbWVyYVNlbGVjdCA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNjYW1lcmEtc2VsZWN0XCIpO1xuICBjb25zdCBjYXB0dXJlQnRuID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2NhcHR1cmUtYnRuXCIpO1xuICBjb25zdCBzdG9wQ2FtZXJhQnRuID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI3N0b3AtY2FtZXJhXCIpO1xuICBjb25zdCByZXRha2VCdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjcmV0YWtlLWJ0blwiKTtcbiAgY29uc3QgY2FudmFzID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2NhbnZhc1wiKTtcbiAgY29uc3QgbWFwQ29udGFpbmVyID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI21hcFwiKTtcbiAgY29uc3QgbG9jYXRpb25TdGF0dXMgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjbG9jYXRpb24tc3RhdHVzXCIpO1xuXG4gIGNvbnN0IGNoZWNrTm90aWZpY2F0aW9uUGVybWlzc2lvbiA9ICgpID0+IHtcbiAgICBjb25zdCBub3RpZmljYXRpb25JbmZvID0gdmlldy5xdWVyeVNlbGVjdG9yKFxuICAgICAgXCIubm90aWZpY2F0aW9uLXBlcm1pc3Npb24taW5mb1wiXG4gICAgKTtcbiAgICBjb25zdCBlbmFibGVOb3RpZmljYXRpb25zQnRuID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2VuYWJsZS1ub3RpZmljYXRpb25zXCIpO1xuXG4gICAgaWYgKE5vdGlmaWNhdGlvbi5wZXJtaXNzaW9uID09PSBcImRlZmF1bHRcIikge1xuICAgICAgbm90aWZpY2F0aW9uSW5mby5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuXG4gICAgICBlbmFibGVOb3RpZmljYXRpb25zQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgZ3JhbnRlZCA9IGF3YWl0IHNob3dOb3RpZmljYXRpb25Qcm9tcHQoKTtcbiAgICAgICAgICBub3RpZmljYXRpb25JbmZvLnN0eWxlLmRpc3BsYXkgPSBncmFudGVkID8gXCJub25lXCIgOiBcImJsb2NrXCI7XG5cbiAgICAgICAgICBpZiAoZ3JhbnRlZCkge1xuICAgICAgICAgICAgY29uc3QgYXV0aCA9IG5ldyBBdXRoTW9kZWwoKTsgXG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IGF1dGguZ2V0VG9rZW4oKTsgXG4gICAgICAgICAgICBhd2FpdCBzdWJzY3JpYmVVc2VyKHRva2VuKTsgXG4gICAgICAgICAgICBzaG93U3VjY2VzcyhcIk5vdGlmaWNhdGlvbnMgZW5hYmxlZCFcIik7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciByZXF1ZXN0aW5nIG5vdGlmaWNhdGlvbiBwZXJtaXNzaW9uOlwiLCBlcnJvcik7XG4gICAgICAgICAgc2hvd0Vycm9yKFwiRmFpbGVkIHRvIGVuYWJsZSBub3RpZmljYXRpb25zXCIpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgbm90aWZpY2F0aW9uSW5mby5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGluaXRpYWxpemVNYXAgPSAoKSA9PiB7XG4gICAgaWYgKCFtYXAgJiYgbWFwQ29udGFpbmVyKSB7XG4gICAgICBtYXAgPSBMLm1hcChtYXBDb250YWluZXIpLnNldFZpZXcoWy02LjIsIDEwNi44XSwgMTMpO1xuICAgICAgTC50aWxlTGF5ZXIoXCJodHRwczovL3tzfS50aWxlLm9wZW5zdHJlZXRtYXAub3JnL3t6fS97eH0ve3l9LnBuZ1wiLCB7XG4gICAgICAgIGF0dHJpYnV0aW9uOiBcIiZjb3B5OyBPcGVuU3RyZWV0TWFwIGNvbnRyaWJ1dG9yc1wiLFxuICAgICAgfSkuYWRkVG8obWFwKTtcblxuICAgICAgbWFwLm9uKFwiY2xpY2tcIiwgKGUpID0+IHtcbiAgICAgICAgY29uc3QgeyBsYXQsIGxuZyB9ID0gZS5sYXRsbmc7XG4gICAgICAgIHVwZGF0ZUxvY2F0aW9uKGxhdCwgbG5nKTtcbiAgICAgICAgYWRkTWFwTWFya2VyKGxhdCwgbG5nKTtcbiAgICAgICAgc2hvd1N1Y2Nlc3MoXCJMb2NhdGlvbiBzZWxlY3RlZCBvbiBtYXAhXCIpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIC8vIEFkZCBtYXJrZXIgdG8gbWFwXG4gIGNvbnN0IGFkZE1hcE1hcmtlciA9IChsYXQsIGxuZykgPT4ge1xuICAgIGlmIChtYXBNYXJrZXIpIHtcbiAgICAgIG1hcC5yZW1vdmVMYXllcihtYXBNYXJrZXIpO1xuICAgIH1cblxuICAgIG1hcE1hcmtlciA9IEwubWFya2VyKFtsYXQsIGxuZ10sIHtcbiAgICAgIGRyYWdnYWJsZTogdHJ1ZSxcbiAgICAgIHRpdGxlOiBcIlN0b3J5IExvY2F0aW9uXCIsXG4gICAgfSlcbiAgICAgIC5hZGRUbyhtYXApXG4gICAgICAuYmluZFBvcHVwKFwiU3RvcnkgbG9jYXRpb25cIilcbiAgICAgIC5vcGVuUG9wdXAoKTtcblxuICAgIG1hcE1hcmtlci5vbihcImRyYWdlbmRcIiwgKGUpID0+IHtcbiAgICAgIGNvbnN0IG5ld1BvcyA9IGUudGFyZ2V0LmdldExhdExuZygpO1xuICAgICAgdXBkYXRlTG9jYXRpb24obmV3UG9zLmxhdCwgbmV3UG9zLmxuZyk7XG4gICAgfSk7XG4gIH07XG5cbiAgLy8gVXBkYXRlIGxvY2F0aW9uIGlucHV0cyBhbmQgc3RhdHVzXG4gIGNvbnN0IHVwZGF0ZUxvY2F0aW9uID0gKGxhdCwgbG5nKSA9PiB7XG4gICAgdmlldy5xdWVyeVNlbGVjdG9yKFwiI2xhdFwiKS52YWx1ZSA9IGxhdDtcbiAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjbG5nXCIpLnZhbHVlID0gbG5nO1xuICAgIGxvY2F0aW9uU3RhdHVzLnRleHRDb250ZW50ID0gYExvY2F0aW9uIHNldDogJHtsYXQudG9GaXhlZChcbiAgICAgIDRcbiAgICApfSwgJHtsbmcudG9GaXhlZCg0KX1gO1xuICAgIGxvY2F0aW9uU3RhdHVzLnN0eWxlLmNvbG9yID0gXCIjNENBRjUwXCI7XG4gIH07XG5cbiAgLy8gTWVzc2FnZSBoYW5kbGVyc1xuICBjb25zdCBzaG93RXJyb3IgPSAobWVzc2FnZSkgPT4ge1xuICAgIGNvbnN0IGVycm9yRWxlbWVudCA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNlcnJvci1tZXNzYWdlXCIpO1xuICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgZXJyb3JFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgc2V0VGltZW91dCgoKSA9PiAoZXJyb3JFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIiksIDUwMDApO1xuICB9O1xuXG4gIGNvbnN0IHNob3dTdWNjZXNzID0gKG1lc3NhZ2UpID0+IHtcbiAgICBjb25zdCBzdWNjZXNzRWxlbWVudCA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNzdWNjZXNzLW1lc3NhZ2VcIik7XG4gICAgc3VjY2Vzc0VsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuICAgIHN1Y2Nlc3NFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XG4gICAgc2V0VGltZW91dCgoKSA9PiAoc3VjY2Vzc0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiKSwgNTAwMCk7XG4gIH07XG5cbiAgLy8gQ2FtZXJhIGZ1bmN0aW9uc1xuICBjb25zdCBnZXRDYW1lcmFEZXZpY2VzID0gYXN5bmMgKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBkZXZpY2VzID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5lbnVtZXJhdGVEZXZpY2VzKCk7XG4gICAgICByZXR1cm4gZGV2aWNlcy5maWx0ZXIoKGRldmljZSkgPT4gZGV2aWNlLmtpbmQgPT09IFwidmlkZW9pbnB1dFwiKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgc2hvd0Vycm9yKGBDYW1lcmEgYWNjZXNzIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHN0b3BDYW1lcmEgPSAoKSA9PiB7XG4gICAgc3RvcENhbWVyYUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgc3RhcnRDYW1lcmFCdG4uc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG5cbiAgICBpZiAoc3RyZWFtKSB7XG4gICAgICBzdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaCgodHJhY2spID0+IHtcbiAgICAgICAgdHJhY2suc3RvcCgpO1xuICAgICAgICB0cmFjay5lbmFibGVkID0gZmFsc2U7XG4gICAgICB9KTtcbiAgICAgIHN0cmVhbSA9IG51bGw7XG4gICAgfVxuXG4gICAgY2FtZXJhUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgY2FtZXJhUHJldmlldy5zcmNPYmplY3QgPSBudWxsO1xuICAgIGNhcHR1cmVCdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIGNhbWVyYVNlbGVjdC5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gIH07XG5cbiAgY29uc3Qgc3RhcnRDYW1lcmEgPSBhc3luYyAoZGV2aWNlSWQgPSBudWxsKSA9PiB7XG4gICAgaWYgKCFpc1ZpZXdBY3RpdmUpIHJldHVybjtcblxuICAgIHRyeSB7XG4gICAgICBzdG9wQ2FtZXJhKCk7XG5cbiAgICAgIGNvbnN0IGNvbnN0cmFpbnRzID0ge1xuICAgICAgICB2aWRlbzoge1xuICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiAxMjgwIH0sXG4gICAgICAgICAgaGVpZ2h0OiB7IGlkZWFsOiA3MjAgfSxcbiAgICAgICAgICAuLi4oZGV2aWNlSWQgJiYgeyBkZXZpY2VJZDogeyBleGFjdDogZGV2aWNlSWQgfSB9KSxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIHN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzKTtcblxuICAgICAgaWYgKGF2YWlsYWJsZUNhbWVyYXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGF2YWlsYWJsZUNhbWVyYXMgPSBhd2FpdCBnZXRDYW1lcmFEZXZpY2VzKCk7XG4gICAgICAgIHVwZGF0ZUNhbWVyYVNlbGVjdCgpO1xuICAgICAgfVxuXG4gICAgICBjYW1lcmFQcmV2aWV3LnNyY09iamVjdCA9IHN0cmVhbTtcbiAgICAgIGNhbWVyYVByZXZpZXcuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcbiAgICAgIHBob3RvUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICBjYXB0dXJlQnRuLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgICAgc3RvcENhbWVyYUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJpbmxpbmUtYmxvY2tcIjtcbiAgICAgIHN0YXJ0Q2FtZXJhQnRuLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgIHJldGFrZUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAgIGlmIChhdmFpbGFibGVDYW1lcmFzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgY2FtZXJhU2VsZWN0LnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBzaG93RXJyb3IoYENhbWVyYSBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgaWYgKGRldmljZUlkKSB7XG4gICAgICAgIHN0YXJ0Q2FtZXJhKCk7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHVwZGF0ZUNhbWVyYVNlbGVjdCA9ICgpID0+IHtcbiAgICBjYW1lcmFTZWxlY3QuaW5uZXJIVE1MID0gXCJcIjtcbiAgICBhdmFpbGFibGVDYW1lcmFzLmZvckVhY2goKGNhbWVyYSkgPT4ge1xuICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcIm9wdGlvblwiKTtcbiAgICAgIG9wdGlvbi52YWx1ZSA9IGNhbWVyYS5kZXZpY2VJZDtcbiAgICAgIG9wdGlvbi50ZXh0ID0gY2FtZXJhLmxhYmVsIHx8IGBDYW1lcmEgJHtjYW1lcmFTZWxlY3QubGVuZ3RoICsgMX1gO1xuICAgICAgY2FtZXJhU2VsZWN0LmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgfSk7XG5cbiAgICBjYW1lcmFTZWxlY3QuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCAoKSA9PiB7XG4gICAgICBzdGFydENhbWVyYShjYW1lcmFTZWxlY3QudmFsdWUpO1xuICAgIH0pO1xuICB9O1xuXG4gIGNvbnN0IGNhcHR1cmVQaG90byA9ICgpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgdmlkZW8gPSBjYW1lcmFQcmV2aWV3O1xuICAgICAgY2FudmFzLndpZHRoID0gdmlkZW8udmlkZW9XaWR0aDtcbiAgICAgIGNhbnZhcy5oZWlnaHQgPSB2aWRlby52aWRlb0hlaWdodDtcblxuICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcbiAgICAgIGN0eC5kcmF3SW1hZ2UodmlkZW8sIDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XG5cbiAgICAgIHBob3RvUHJldmlldy5zcmMgPSBjYW52YXMudG9EYXRhVVJMKFwiaW1hZ2UvanBlZ1wiKTtcbiAgICAgIHBob3RvUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xuICAgICAgY2FtZXJhUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cbiAgICAgIGNhbnZhcy50b0Jsb2IoXG4gICAgICAgIChibG9iKSA9PiB7XG4gICAgICAgICAgcGhvdG9GaWxlID0gbmV3IEZpbGUoW2Jsb2JdLCBcInN0b3J5LXBob3RvLmpwZ1wiLCB7XG4gICAgICAgICAgICB0eXBlOiBcImltYWdlL2pwZWdcIixcbiAgICAgICAgICAgIGxhc3RNb2RpZmllZDogRGF0ZS5ub3coKSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgXCJpbWFnZS9qcGVnXCIsXG4gICAgICAgIDAuODVcbiAgICAgICk7XG5cbiAgICAgIGNhcHR1cmVCdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgc3RvcENhbWVyYUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICBjYW1lcmFTZWxlY3Quc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgICAgcmV0YWtlQnRuLnN0eWxlLmRpc3BsYXkgPSBcImlubGluZS1ibG9ja1wiO1xuICAgICAgc3RvcENhbWVyYSgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBzaG93RXJyb3IoYENhcHR1cmUgZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHJldGFrZVBob3RvID0gKCkgPT4ge1xuICAgIHBob3RvUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgcGhvdG9QcmV2aWV3LnNyYyA9IFwiXCI7XG4gICAgcGhvdG9GaWxlID0gbnVsbDtcbiAgICBzdGFydENhbWVyYShjYW1lcmFTZWxlY3QudmFsdWUgfHwgbnVsbCk7XG4gIH07XG5cbiAgLy8gQ2xlYW4gdXAgd2hlbiB2aWV3IGlzIGRlc3Ryb3llZFxuICBjb25zdCBjbGVhbnVwID0gKCkgPT4ge1xuICAgIGlzVmlld0FjdGl2ZSA9IGZhbHNlO1xuICAgIHN0b3BDYW1lcmEoKTtcblxuICAgIGlmIChtYXApIHtcbiAgICAgIG1hcC5yZW1vdmUoKTtcbiAgICAgIG1hcCA9IG51bGw7XG4gICAgICBtYXBNYXJrZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIFJlbW92ZSBhbGwgZXZlbnQgbGlzdGVuZXJzXG4gICAgY29uc3Qgc2FmZVJlbW92ZUxpc3RlbmVyID0gKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyKSA9PiB7XG4gICAgICBpZiAoZWxlbWVudCAmJiBoYW5kbGVyKSB7XG4gICAgICAgIGVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudCwgaGFuZGxlcik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHNhZmVSZW1vdmVMaXN0ZW5lcihzdGFydENhbWVyYUJ0biwgXCJjbGlja1wiLCBzdGFydENhbWVyYSk7XG4gICAgc2FmZVJlbW92ZUxpc3RlbmVyKHN0b3BDYW1lcmFCdG4sIFwiY2xpY2tcIiwgc3RvcENhbWVyYSk7XG4gICAgc2FmZVJlbW92ZUxpc3RlbmVyKGNhcHR1cmVCdG4sIFwiY2xpY2tcIiwgY2FwdHVyZVBob3RvKTtcbiAgICBzYWZlUmVtb3ZlTGlzdGVuZXIocmV0YWtlQnRuLCBcImNsaWNrXCIsIHJldGFrZVBob3RvKTtcbiAgICBzYWZlUmVtb3ZlTGlzdGVuZXIoY2FtZXJhU2VsZWN0LCBcImNoYW5nZVwiLCBzdGFydENhbWVyYSk7XG4gIH07XG5cbiAgLy8gSW5pdGlhbGl6ZSBtYXAgd2hlbiB2aWV3IGlzIGNyZWF0ZWRcbiAgc2V0VGltZW91dChpbml0aWFsaXplTWFwLCAxMDApO1xuXG4gIC8vIEJpbmQgZXZlbnQgaGFuZGxlcnNcbiAgY29uc3QgYmluZEFkZFN0b3J5ID0gKGhhbmRsZXIpID0+IHtcbiAgICBjb25zdCBmb3JtID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI3N0b3J5LWZvcm1cIik7XG4gICAgY29uc3QgZ2V0TG9jYXRpb25CdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjZ2V0LWxvY2F0aW9uXCIpO1xuXG4gICAgY29uc3QgZm9ybVN1Ym1pdEhhbmRsZXIgPSBhc3luYyAoZSkgPT4ge1xuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICBpZiAoIXBob3RvRmlsZSkge1xuICAgICAgICBzaG93RXJyb3IoXCJQbGVhc2UgdGFrZSBhIHBob3RvIGZpcnN0XCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGRlc2NyaXB0aW9uID0gZm9ybS5kZXNjcmlwdGlvbi52YWx1ZS50cmltKCk7XG4gICAgICBpZiAoIWRlc2NyaXB0aW9uKSB7XG4gICAgICAgIHNob3dFcnJvcihcIlBsZWFzZSBlbnRlciBhIGRlc2NyaXB0aW9uXCIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmICghZm9ybS5sYXQudmFsdWUgfHwgIWZvcm0ubG5nLnZhbHVlKSB7XG4gICAgICAgIHNob3dFcnJvcihcIlBsZWFzZSBzZWxlY3QgYSBsb2NhdGlvblwiKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBkYXRhID0ge1xuICAgICAgICBkZXNjcmlwdGlvbixcbiAgICAgICAgcGhvdG86IHBob3RvRmlsZSxcbiAgICAgICAgbGF0OiBwYXJzZUZsb2F0KGZvcm0ubGF0LnZhbHVlKSxcbiAgICAgICAgbG9uOiBwYXJzZUZsb2F0KGZvcm0ubG5nLnZhbHVlKSxcbiAgICAgIH07XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGhhbmRsZXIoZGF0YSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBzaG93RXJyb3IoYFN1Ym1pc3Npb24gZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IGdldExvY2F0aW9uSGFuZGxlciA9ICgpID0+IHtcbiAgICAgIG5hdmlnYXRvci5nZW9sb2NhdGlvbi5nZXRDdXJyZW50UG9zaXRpb24oXG4gICAgICAgIChwb3NpdGlvbikgPT4ge1xuICAgICAgICAgIGNvbnN0IGxhdCA9IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZTtcbiAgICAgICAgICBjb25zdCBsbmcgPSBwb3NpdGlvbi5jb29yZHMubG9uZ2l0dWRlO1xuXG4gICAgICAgICAgdXBkYXRlTG9jYXRpb24obGF0LCBsbmcpO1xuICAgICAgICAgIGFkZE1hcE1hcmtlcihsYXQsIGxuZyk7XG5cbiAgICAgICAgICBpZiAobWFwKSB7XG4gICAgICAgICAgICBtYXAuc2V0VmlldyhbbGF0LCBsbmddLCAxNSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHNob3dTdWNjZXNzKFwiQ3VycmVudCBsb2NhdGlvbiBvYnRhaW5lZCFcIik7XG4gICAgICAgIH0sXG4gICAgICAgIChlcnJvcikgPT4ge1xuICAgICAgICAgIHNob3dFcnJvcihgTG9jYXRpb24gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgfSxcbiAgICAgICAgeyBlbmFibGVIaWdoQWNjdXJhY3k6IHRydWUsIHRpbWVvdXQ6IDEwMDAwIH1cbiAgICAgICk7XG4gICAgfTtcblxuICAgIHN0YXJ0Q2FtZXJhQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzdGFydENhbWVyYSk7XG4gICAgc3RvcENhbWVyYUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgc3RvcENhbWVyYSk7XG4gICAgY2FwdHVyZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2FwdHVyZVBob3RvKTtcbiAgICByZXRha2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHJldGFrZVBob3RvKTtcbiAgICBnZXRMb2NhdGlvbkJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZ2V0TG9jYXRpb25IYW5kbGVyKTtcbiAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgZm9ybVN1Ym1pdEhhbmRsZXIpO1xuXG4gICAgLy8gQWRkIGhlYWRlciBuYXZpZ2F0aW9uIGxpc3RlbmVyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJoZWFkZXItbmF2aWdhdGlvblwiLCBzdG9wQ2FtZXJhKTtcbiAgfTtcblxuICBjaGVja05vdGlmaWNhdGlvblBlcm1pc3Npb24oKTtcblxuICByZXR1cm4ge1xuICAgIGdldFZpZXc6ICgpID0+IHZpZXcsXG4gICAgYmluZEFkZFN0b3J5LFxuICAgIHNob3dFcnJvcixcbiAgICBzaG93U3VjY2VzcyxcbiAgICBnZXRNYXBDb250YWluZXI6ICgpID0+IG1hcENvbnRhaW5lcixcbiAgICBjbGVhbnVwLFxuICB9O1xufTtcbiIsImV4cG9ydCBjb25zdCBjaGVja0F1dGggPSAoYXV0aE1vZGVsLCByb3V0ZXIpID0+IHtcbiAgaWYgKCFhdXRoTW9kZWwuaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICByb3V0ZXIubmF2aWdhdGVUbyhcIi9sb2dpblwiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5leHBvcnQgY29uc3QgY2hlY2tHdWVzdCA9IChhdXRoTW9kZWwsIHJvdXRlcikgPT4ge1xuICBpZiAoYXV0aE1vZGVsLmlzQXV0aGVudGljYXRlZCgpKSB7XG4gICAgcm91dGVyLm5hdmlnYXRlVG8oXCIvc3Rvcmllc1wiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgcmV0dXJuIHRydWU7XG59O1xuXG5cbiIsImltcG9ydCB7IEhlYWRlciwgdXBkYXRlQXV0aFVJIH0gZnJvbSBcIi4vY29tcG9uZW50cy9IZWFkZXIuanNcIjtcbmltcG9ydCBcIi4uL3B1YmxpYy9hc3NldHMvc3R5bGVzL21haW4uY3NzXCI7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tIFwiLi9yb3V0ZXIuanNcIjtcbmltcG9ydCB7IEF1dGhNb2RlbCB9IGZyb20gXCIuL21vZGVscy9BdXRoTW9kZWwuanNcIjtcbmltcG9ydCB7IFN0b3J5TW9kZWwgfSBmcm9tIFwiLi9tb2RlbHMvU3RvcnlNb2RlbC5qc1wiO1xuaW1wb3J0IHsgQXV0aFByZXNlbnRlciB9IGZyb20gXCIuL3ByZXNlbnRlcnMvQXV0aFByZXNlbnRlci5qc1wiO1xuaW1wb3J0IHsgU3RvcnlQcmVzZW50ZXIgfSBmcm9tIFwiLi9wcmVzZW50ZXJzL1N0b3J5UHJlc2VudGVyLmpzXCI7XG5pbXBvcnQgeyBNYXBQcmVzZW50ZXIgfSBmcm9tIFwiLi9wcmVzZW50ZXJzL01hcFByZXNlbnRlci5qc1wiO1xuaW1wb3J0IHsgTG9naW5WaWV3IH0gZnJvbSBcIi4vdmlld3MvYXV0aC9Mb2dpblZpZXcuanNcIjtcbmltcG9ydCB7IFJlZ2lzdGVyVmlldyB9IGZyb20gXCIuL3ZpZXdzL2F1dGgvUmVnaXN0ZXJWaWV3LmpzXCI7XG5pbXBvcnQgeyBTdG9yaWVzVmlldyB9IGZyb20gXCIuL3ZpZXdzL3N0b3JpZXMvU3Rvcmllc1ZpZXcuanNcIjtcbmltcG9ydCB7IERldGFpbFN0b3J5VmlldyB9IGZyb20gXCIuL3ZpZXdzL3N0b3JpZXMvRGV0YWlsU3RvcnlWaWV3LmpzXCI7XG5pbXBvcnQgeyBBZGRTdG9yeVZpZXcgfSBmcm9tIFwiLi92aWV3cy9zdG9yaWVzL0FkZFN0b3J5Vmlldy5qc1wiO1xuaW1wb3J0IHsgRXJyb3JWaWV3IH0gZnJvbSBcIi4vdmlld3MvRXJyb3JWaWV3LmpzXCI7XG5pbXBvcnQgeyBjaGVja0F1dGgsIGNoZWNrR3Vlc3QgfSBmcm9tIFwiLi91dGlscy9hdXRoLmpzXCI7XG5pbXBvcnQge1xuICByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbixcbiAgc3Vic2NyaWJlVXNlcixcbiAgc2hvd05vdGlmaWNhdGlvblxufSBmcm9tIFwiLi91dGlscy9ub3RpZmljYXRpb24uanNcIjtcbmltcG9ydCB7IGluaXRpYWxpemVTa2lwVG9Db250ZW50IH0gZnJvbSBcIi4vdXRpbHMvU2tpcFRvQ29udGVudC5qc1wiO1xuXG5cbmluaXRpYWxpemVTa2lwVG9Db250ZW50KCk7XG5cblxuY29uc3QgYXV0aE1vZGVsID0gbmV3IEF1dGhNb2RlbCgpO1xuY29uc3Qgc3RvcnlNb2RlbCA9IG5ldyBTdG9yeU1vZGVsKGF1dGhNb2RlbCk7XG5cblxuY29uc3QgYXBwUm9vdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXBwXCIpO1xuYXBwUm9vdC5hcHBlbmRDaGlsZChIZWFkZXIoKSk7XG5cblxubGV0IGRlZmVycmVkUHJvbXB0O1xud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJiZWZvcmVpbnN0YWxscHJvbXB0XCIsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgZGVmZXJyZWRQcm9tcHQgPSBlO1xuXG4gIGNvbnN0IGluc3RhbGxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImluc3RhbGwtYnV0dG9uXCIpO1xuICBpZiAoaW5zdGFsbEJ0bikge1xuICAgIGluc3RhbGxCdG4uc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XG4gICAgaW5zdGFsbEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgaW5zdGFsbEJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG4gICAgICBkZWZlcnJlZFByb21wdC5wcm9tcHQoKTtcbiAgICAgIGNvbnN0IGNob2ljZSA9IGF3YWl0IGRlZmVycmVkUHJvbXB0LnVzZXJDaG9pY2U7XG4gICAgICBkZWZlcnJlZFByb21wdCA9IG51bGw7XG4gICAgfSk7XG4gIH1cbn0pO1xuXG5cbmNvbnN0IGluaXRNYXBXaXRoUmV0cnkgPSBhc3luYyAoXG4gIGhhbmRsZXIsXG4gIGNvbnRhaW5lcklkLFxuICBsYXQsXG4gIGxuZyxcbiAgem9vbSxcbiAgYXR0ZW1wdHMgPSAwXG4pID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXJJZCk7XG4gICAgaWYgKCFjb250YWluZXIgJiYgYXR0ZW1wdHMgPCAzKSB7XG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAgKiAoYXR0ZW1wdHMgKyAxKSkpO1xuICAgICAgcmV0dXJuIGluaXRNYXBXaXRoUmV0cnkoXG4gICAgICAgIGhhbmRsZXIsXG4gICAgICAgIGNvbnRhaW5lcklkLFxuICAgICAgICBsYXQsXG4gICAgICAgIGxuZyxcbiAgICAgICAgem9vbSxcbiAgICAgICAgYXR0ZW1wdHMgKyAxXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gaGFuZGxlcihjb250YWluZXJJZCwgbGF0LCBsbmcsIHpvb20pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiBudWxsO1xuICB9XG59O1xuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvZ291dFwiLCAoKSA9PiB7XG4gIGF1dGhNb2RlbC5sb2dvdXQoKTtcbiAgdXBkYXRlQXV0aFVJKGZhbHNlKTtcbiAgcm91dGVyLm5hdmlnYXRlVG8oXCIvbG9naW5cIik7XG59KTtcblxuXG5jb25zdCByb3V0ZXMgPSBbXG4gIHtcbiAgICBwYXRoOiBcIi9sb2dpblwiLFxuICAgIHZpZXc6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghY2hlY2tHdWVzdChhdXRoTW9kZWwsIHJvdXRlcikpIHJldHVybiBFcnJvclZpZXcoKS5nZXRWaWV3KCk7XG4gICAgICBjb25zdCB2aWV3ID0gTG9naW5WaWV3KCk7XG4gICAgICBuZXcgQXV0aFByZXNlbnRlcihcbiAgICAgICAgYXV0aE1vZGVsLFxuICAgICAgICB7IGJpbmRMb2dpbjogdmlldy5iaW5kTG9naW4sIHNob3dFcnJvcjogdmlldy5zaG93RXJyb3IgfSxcbiAgICAgICAgcm91dGVyXG4gICAgICApO1xuICAgICAgcmV0dXJuIHZpZXcuZ2V0VmlldygpO1xuICAgIH0sXG4gIH0sXG4gIHtcbiAgICBwYXRoOiBcIi9yZWdpc3RlclwiLFxuICAgIHZpZXc6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghY2hlY2tHdWVzdChhdXRoTW9kZWwsIHJvdXRlcikpIHJldHVybiBFcnJvclZpZXcoKS5nZXRWaWV3KCk7XG4gICAgICBjb25zdCB2aWV3ID0gUmVnaXN0ZXJWaWV3KCk7XG4gICAgICBuZXcgQXV0aFByZXNlbnRlcihcbiAgICAgICAgYXV0aE1vZGVsLFxuICAgICAgICB7XG4gICAgICAgICAgYmluZFJlZ2lzdGVyOiB2aWV3LmJpbmRSZWdpc3RlcixcbiAgICAgICAgICBzaG93RXJyb3I6IHZpZXcuc2hvd0Vycm9yLFxuICAgICAgICAgIHNob3dTdWNjZXNzOiB2aWV3LnNob3dTdWNjZXNzLFxuICAgICAgICB9LFxuICAgICAgICByb3V0ZXJcbiAgICAgICk7XG4gICAgICByZXR1cm4gdmlldy5nZXRWaWV3KCk7XG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHBhdGg6IFwiL1wiLFxuICAgIHZpZXc6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghY2hlY2tBdXRoKGF1dGhNb2RlbCwgcm91dGVyKSkgcmV0dXJuIEVycm9yVmlldygpLmdldFZpZXcoKTtcbiAgICAgIGNvbnN0IHZpZXcgPSBTdG9yaWVzVmlldygpO1xuICAgICAgY29uc3QgcHJlc2VudGVyID0gbmV3IFN0b3J5UHJlc2VudGVyKFxuICAgICAgICBzdG9yeU1vZGVsLFxuICAgICAgICB7XG4gICAgICAgICAgYmluZExvYWRTdG9yaWVzOiB2aWV3LmJpbmRMb2FkU3RvcmllcyxcbiAgICAgICAgICBkaXNwbGF5U3Rvcmllczogdmlldy5kaXNwbGF5U3RvcmllcyxcbiAgICAgICAgICBzaG93RXJyb3I6IHZpZXcuc2hvd0Vycm9yLFxuICAgICAgICAgIGJpbmRUb2dnbGVCb29rbWFya0ZpbHRlcjogdmlldy5iaW5kVG9nZ2xlQm9va21hcmtGaWx0ZXIsXG4gICAgICAgICAgYmluZEJvb2ttYXJrQWN0aW9uOiB2aWV3LmJpbmRCb29rbWFya0FjdGlvblxuICAgICAgICB9LFxuICAgICAgICByb3V0ZXJcbiAgICAgICk7XG5cbiAgICAgIHdpbmRvdy5zdG9yeVByZXNlbnRlciA9IHByZXNlbnRlcjtcbiAgICAgIHJldHVybiB2aWV3LmdldFZpZXcoKTtcbiAgICB9LFxuICB9LFxuICB7XG4gICAgcGF0aDogXCIvc3Rvcmllc1wiLFxuICAgIHZpZXc6IGFzeW5jICgpID0+IHtcbiAgICAgIGlmICghY2hlY2tBdXRoKGF1dGhNb2RlbCwgcm91dGVyKSkgcmV0dXJuIEVycm9yVmlldygpLmdldFZpZXcoKTtcbiAgICAgIGNvbnN0IHZpZXcgPSBTdG9yaWVzVmlldygpO1xuICAgICAgY29uc3QgcHJlc2VudGVyID0gbmV3IFN0b3J5UHJlc2VudGVyKFxuICAgICAgICBzdG9yeU1vZGVsLFxuICAgICAgICB7XG4gICAgICAgICAgYmluZExvYWRTdG9yaWVzOiB2aWV3LmJpbmRMb2FkU3RvcmllcyxcbiAgICAgICAgICBkaXNwbGF5U3Rvcmllczogdmlldy5kaXNwbGF5U3RvcmllcyxcbiAgICAgICAgICBzaG93RXJyb3I6IHZpZXcuc2hvd0Vycm9yLFxuICAgICAgICAgIGJpbmRUb2dnbGVCb29rbWFya0ZpbHRlcjogdmlldy5iaW5kVG9nZ2xlQm9va21hcmtGaWx0ZXIsXG4gICAgICAgICAgYmluZEJvb2ttYXJrQWN0aW9uOiB2aWV3LmJpbmRCb29rbWFya0FjdGlvblxuICAgICAgICB9LFxuICAgICAgICByb3V0ZXJcbiAgICAgICk7XG4gICAgICB3aW5kb3cuc3RvcnlQcmVzZW50ZXIgPSBwcmVzZW50ZXI7XG4gICAgICByZXR1cm4gdmlldy5nZXRWaWV3KCk7XG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHBhdGg6IFwiL3N0b3JpZXMvOmlkXCIsXG4gICAgdmlldzogYXN5bmMgKHBhcmFtcykgPT4ge1xuICAgICAgaWYgKCFjaGVja0F1dGgoYXV0aE1vZGVsLCByb3V0ZXIpKSByZXR1cm4gRXJyb3JWaWV3KCk7XG4gICAgICBjb25zdCB2aWV3ID0gRGV0YWlsU3RvcnlWaWV3KCk7XG4gICAgICBjb25zdCB7IGlkIH0gPSBwYXJhbXM7XG4gICAgICBuZXcgU3RvcnlQcmVzZW50ZXIoXG4gICAgICAgIHN0b3J5TW9kZWwsXG4gICAgICAgIHtcbiAgICAgICAgICBiaW5kTG9hZFN0b3J5RGV0YWlsOiAoaGFuZGxlcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgbWFwQ29udGFpbmVyID0gdmlld1xuICAgICAgICAgICAgICAuZ2V0VmlldygpXG4gICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yKFwiI3N0b3J5LW1hcC1jb250YWluZXJcIik7XG4gICAgICAgICAgICBpZiAobWFwQ29udGFpbmVyKSB7XG4gICAgICAgICAgICAgIG1hcENvbnRhaW5lci5pbm5lckhUTUwgPVxuICAgICAgICAgICAgICAgICc8ZGl2IGlkPVwic3RvcnktbWFwXCIgY2xhc3M9XCJkZXRhaWwtbWFwXCI+PC9kaXY+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGhhbmRsZXIoaWQpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZGlzcGxheVN0b3J5RGV0YWlsOiAoc3RvcnkpID0+IHtcbiAgICAgICAgICAgIHZpZXcuZGlzcGxheVN0b3J5RGV0YWlsKHN0b3J5KTtcbiAgICAgICAgICAgIGlmIChzdG9yeS5sYXQgJiYgc3RvcnkubG9uKSB7XG4gICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG1hcEVsZW1lbnQgPSB2aWV3LmdldFZpZXcoKS5xdWVyeVNlbGVjdG9yKFwiI3N0b3J5LW1hcFwiKTtcbiAgICAgICAgICAgICAgICBpZiAoIW1hcEVsZW1lbnQgfHwgIW1hcEVsZW1lbnQuX2xlYWZsZXRfaWQpIHtcbiAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG1hcCA9IEwubWFwKG1hcEVsZW1lbnQpLnNldFZpZXcoXG4gICAgICAgICAgICAgICAgICAgICAgW3N0b3J5LmxhdCwgc3RvcnkubG9uXSxcbiAgICAgICAgICAgICAgICAgICAgICAxM1xuICAgICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgICBMLnRpbGVMYXllcihcbiAgICAgICAgICAgICAgICAgICAgICBcImh0dHBzOi8ve3N9LnRpbGUub3BlbnN0cmVldG1hcC5vcmcve3p9L3t4fS97eX0ucG5nXCIsXG4gICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRpb246IFwiJmNvcHk7IE9wZW5TdHJlZXRNYXAgY29udHJpYnV0b3JzXCIsXG4gICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICApLmFkZFRvKG1hcCk7XG4gICAgICAgICAgICAgICAgICAgIEwubWFya2VyKFtzdG9yeS5sYXQsIHN0b3J5Lmxvbl0pXG4gICAgICAgICAgICAgICAgICAgICAgLmFkZFRvKG1hcClcbiAgICAgICAgICAgICAgICAgICAgICAuYmluZFBvcHVwKFxuICAgICAgICAgICAgICAgICAgICAgICAgYDxiPiR7c3RvcnkubmFtZX08L2I+PGJyPiR7c3RvcnkuZGVzY3JpcHRpb24uc3Vic3RyaW5nKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgICA1MFxuICAgICAgICAgICAgICAgICAgICAgICAgKX0uLi5gXG4gICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgIC5vcGVuUG9wdXAoKTtcbiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJNYXAgaW5pdGlhbGl6YXRpb24gZXJyb3I6XCIsIGVycm9yKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sIDUwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIHNob3dFcnJvcjogdmlldy5zaG93RXJyb3IsXG4gICAgICAgIH0sXG4gICAgICAgIHJvdXRlclxuICAgICAgKTtcbiAgICAgIHJldHVybiB2aWV3LmdldFZpZXcoKTtcbiAgICB9LFxuICB9LFxuICB7XG4gICAgcGF0aDogXCIvYWRkLXN0b3J5XCIsXG4gICAgdmlldzogYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdmlldyA9IEFkZFN0b3J5VmlldygpO1xuICAgICAgY29uc3QgZG9tTm9kZSA9IHZpZXcuZ2V0VmlldygpO1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbWFwUHJlc2VudGVyID0gbmV3IE1hcFByZXNlbnRlcih7XG4gICAgICAgICAgYmluZEluaXRNYXA6IGFzeW5jIChoYW5kbGVyKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbml0TWFwV2l0aFJldHJ5KFxuICAgICAgICAgICAgICBoYW5kbGVyLFxuICAgICAgICAgICAgICBcIm1hcFwiLFxuICAgICAgICAgICAgICAtNi4yMDg4LFxuICAgICAgICAgICAgICAxMDYuODQ1NixcbiAgICAgICAgICAgICAgMTJcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBpZiAocmVzdWx0Py5tYXApIHtcbiAgICAgICAgICAgICAgcmVzdWx0Lm1hcC5vbihcImNsaWNrXCIsIChlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgeyBsYXQsIGxuZyB9ID0gZS5sYXRsbmc7XG4gICAgICAgICAgICAgICAgZG9tTm9kZS5xdWVyeVNlbGVjdG9yKFwiI2xhdFwiKS52YWx1ZSA9IGxhdDtcbiAgICAgICAgICAgICAgICBkb21Ob2RlLnF1ZXJ5U2VsZWN0b3IoXCIjbG5nXCIpLnZhbHVlID0gbG5nO1xuICAgICAgICAgICAgICAgIHJlc3VsdC5hZGRNYXJrZXIobGF0LCBsbmcsIFwiU3RvcnkgbG9jYXRpb25cIik7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdD8ubWFwO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgYmluZEdldEN1cnJlbnRMb2NhdGlvbjogKGhhbmRsZXIpID0+IHtcbiAgICAgICAgICAgIGRvbU5vZGVcbiAgICAgICAgICAgICAgLnF1ZXJ5U2VsZWN0b3IoXCIjZ2V0LWxvY2F0aW9uXCIpXG4gICAgICAgICAgICAgID8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgY29uc3QgbG9jYXRpb24gPSBhd2FpdCBoYW5kbGVyKCk7XG4gICAgICAgICAgICAgICAgICBkb21Ob2RlLnF1ZXJ5U2VsZWN0b3IoXCIjbGF0XCIpLnZhbHVlID0gbG9jYXRpb24ubGF0O1xuICAgICAgICAgICAgICAgICAgZG9tTm9kZS5xdWVyeVNlbGVjdG9yKFwiI2xuZ1wiKS52YWx1ZSA9IGxvY2F0aW9uLmxuZztcbiAgICAgICAgICAgICAgICAgIG1hcFByZXNlbnRlci5hZGRNYXJrZXIoXG4gICAgICAgICAgICAgICAgICAgIGxvY2F0aW9uLmxhdCxcbiAgICAgICAgICAgICAgICAgICAgbG9jYXRpb24ubG5nLFxuICAgICAgICAgICAgICAgICAgICBcIkN1cnJlbnQgbG9jYXRpb25cIlxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIG1hcFByZXNlbnRlci5tYXA/LnNldFZpZXcoW2xvY2F0aW9uLmxhdCwgbG9jYXRpb24ubG5nXSwgMTUpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICB2aWV3LnNob3dFcnJvcihlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIG5ldyBTdG9yeVByZXNlbnRlcihcbiAgICAgICAgICBzdG9yeU1vZGVsLFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGJpbmRBZGRTdG9yeTogdmlldy5iaW5kQWRkU3RvcnksXG4gICAgICAgICAgICBzaG93RXJyb3I6IHZpZXcuc2hvd0Vycm9yLFxuICAgICAgICAgICAgc2hvd1N1Y2Nlc3M6IHZpZXcuc2hvd1N1Y2Nlc3MsXG4gICAgICAgICAgfSxcbiAgICAgICAgICByb3V0ZXJcbiAgICAgICAgKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHZpZXcuc2hvd0Vycm9yKFwiRmFpbGVkIHRvIGluaXRpYWxpemUgZm9ybVwiKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBkb21Ob2RlO1xuICAgIH0sXG4gIH0sXG4gIHtcbiAgICBwYXRoOiBcIi9sb2dvdXRcIixcbiAgICB2aWV3OiBhc3luYyAoKSA9PiB7XG4gICAgICBhdXRoTW9kZWwubG9nb3V0KCk7XG4gICAgICB1cGRhdGVBdXRoVUkoZmFsc2UpO1xuICAgICAgcm91dGVyLm5hdmlnYXRlVG8oXCIvbG9naW5cIik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBnZXRWaWV3OiAoKSA9PiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLFxuICAgICAgfS5nZXRWaWV3KCk7XG4gICAgfSxcbiAgfSxcbiAge1xuICAgIHBhdGg6IFwiKlwiLFxuICAgIHZpZXc6ICgpID0+IEVycm9yVmlldygpLmdldFZpZXcoKSxcbiAgfSxcbl07XG5cblxuY29uc3Qgcm91dGVyID0gbmV3IFJvdXRlcihyb3V0ZXMpO1xuXG5cbnVwZGF0ZUF1dGhVSShhdXRoTW9kZWwuaXNBdXRoZW50aWNhdGVkKCkpO1xuXG5cbmlmIChcInNlcnZpY2VXb3JrZXJcIiBpbiBuYXZpZ2F0b3IpIHtcbiAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkXCIsICgpID0+IHtcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlclxuICAgICAgLnJlZ2lzdGVyKFwiL3N3LmpzXCIpXG4gICAgICAudGhlbihhc3luYyAocmVnaXN0cmF0aW9uKSA9PiB7XG4gICAgICAgIGlmIChhdXRoTW9kZWwuaXNBdXRoZW50aWNhdGVkKCkpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKE5vdGlmaWNhdGlvbi5wZXJtaXNzaW9uID09PSBcImdyYW50ZWRcIikge1xuICAgICAgICAgICAgICBhd2FpdCBzdWJzY3JpYmVVc2VyKGF1dGhNb2RlbC5nZXRUb2tlbigpKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoTm90aWZpY2F0aW9uLnBlcm1pc3Npb24gPT09IFwiZGVmYXVsdFwiKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHBlcm1pc3Npb24gPSBhd2FpdCByZXF1ZXN0Tm90aWZpY2F0aW9uUGVybWlzc2lvbigpO1xuICAgICAgICAgICAgICBpZiAocGVybWlzc2lvbikgYXdhaXQgc3Vic2NyaWJlVXNlcihhdXRoTW9kZWwuZ2V0VG9rZW4oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJQdXNoIHN1YnNjcmlwdGlvbiBmYWlsZWQ6XCIsIGVycm9yKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJTZXJ2aWNlIHdvcmtlciByZWdpc3RyYXRpb24gZmFpbGVkOlwiLCBlcnJvcik7XG4gICAgICB9KTtcbiAgfSk7XG5cblxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQuZGF0YT8udHlwZSA9PT0gXCJUUklHR0VSX1NZTkNcIikge1xuICAgICAgaWYgKFxuICAgICAgICB3aW5kb3cuc3RvcnlQcmVzZW50ZXIgJiZcbiAgICAgICAgdHlwZW9mIHdpbmRvdy5zdG9yeVByZXNlbnRlci5oYW5kbGVPbmxpbmUgPT09IFwiZnVuY3Rpb25cIlxuICAgICAgKSB7XG4gICAgICAgIHdpbmRvdy5zdG9yeVByZXNlbnRlci5oYW5kbGVPbmxpbmUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG5cbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiZXJyb3JcIiwgKGV2ZW50KSA9PiB7XG4gIHNob3dOb3RpZmljYXRpb24oXCJBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkXCIsIHsgdHlwZTogXCJlcnJvclwiIH0pO1xuICBjb25zb2xlLmVycm9yKFwiR2xvYmFsIGVycm9yOlwiLCBldmVudC5lcnJvcik7XG59KTsiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///7427\n')}},n=>{n.O(0,[96,869],()=>n(n.s=7427)),n.O()}]);