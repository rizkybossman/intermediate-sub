"use strict";(self.webpackChunkstory_app=self.webpackChunkstory_app||[]).push([[792],{7427:(__unused_webpack_module,__unused_webpack___webpack_exports__,__webpack_require__)=>{eval('\n// NAMESPACE OBJECT: ./src/models/AuthModel.js\nvar AuthModel_namespaceObject = {};\n__webpack_require__.r(AuthModel_namespaceObject);\n__webpack_require__.d(AuthModel_namespaceObject, {\n  W: () => (AuthModel)\n});\n\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\nvar asyncToGenerator = __webpack_require__(467);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.js\nvar es_symbol = __webpack_require__(2675);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.description.js\nvar es_symbol_description = __webpack_require__(9463);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.concat.js\nvar es_array_concat = __webpack_require__(8706);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.map.js\nvar es_array_map = __webpack_require__(2062);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.function.name.js\nvar es_function_name = __webpack_require__(2010);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.to-string.js\nvar es_object_to_string = __webpack_require__(6099);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.promise.js\nvar es_promise = __webpack_require__(3362);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.timers.js\nvar web_timers = __webpack_require__(6031);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/regenerator/index.js\nvar regenerator = __webpack_require__(4756);\nvar regenerator_default = /*#__PURE__*/__webpack_require__.n(regenerator);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.for-each.js\nvar es_array_for_each = __webpack_require__(1629);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.for-each.js\nvar web_dom_collections_for_each = __webpack_require__(3500);\n;// ./src/components/Header.js\n\n\n\nvar currentAuthState = false;\nvar updateAuthUI = function updateAuthUI(isLoggedIn) {\n  currentAuthState = isLoggedIn;\n  var logoutLi = document.getElementById("logout-li");\n  if (logoutLi) {\n    logoutLi.style.display = isLoggedIn ? "block" : "none";\n  }\n};\nvar Header = function Header() {\n  var _header$querySelector;\n  var header = document.createElement("header");\n  header.innerHTML = "\\n <nav>\\n      <ul>\\n        <li><a href=\\"#/stories\\" data-navigo>Stories</a></li>\\n        <li><a href=\\"#/add-story\\" data-navigo>Add Story</a></li>\\n        <li id=\\"install-li\\" style=\\"display: none;\\">\\n  <a href=\\"#\\" id=\\"install-button\\" class=\\"btn\\" data-navigo>Install App</a>\\n</li>\\n<li id=\\"logout-li\\" style=\\"display: ".concat(currentAuthState ? "block" : "none", "\\">\\n  <a href=\\"#\\" id=\\"logout-button\\" class=\\"btn\\" data-navigo>Logout</a>\\n</li>\\n\\n      </ul>\\n    </nav>\\n  ");\n\n  // Logout handler\n  (_header$querySelector = header.querySelector("#logout-button")) === null || _header$querySelector === void 0 || _header$querySelector.addEventListener("click", function () {\n    window.dispatchEvent(new CustomEvent("logout"));\n  });\n\n  // Navigation handler\n  var navLinks = header.querySelectorAll("a[data-navigo]");\n  navLinks.forEach(function (link) {\n    link.addEventListener("click", function () {\n      window.dispatchEvent(new CustomEvent("header-navigation"));\n    });\n  });\n  return header;\n};\n// EXTERNAL MODULE: ./public/assets/styles/main.css\nvar main = __webpack_require__(7478);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/classCallCheck.js\nvar classCallCheck = __webpack_require__(3029);\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/createClass.js\nvar createClass = __webpack_require__(2901);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.find.js\nvar es_array_find = __webpack_require__(113);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.includes.js\nvar es_array_includes = __webpack_require__(4423);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.slice.js\nvar es_array_slice = __webpack_require__(4782);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.starts-with.js\nvar es_string_starts_with = __webpack_require__(1392);\n;// ./src/utils/view-transition.js\nvar startViewTransition = function startViewTransition(callback) {\n  if (!document.startViewTransition) {\n    callback();\n    return;\n  }\n  document.startViewTransition(function () {\n    callback();\n  });\n};\ndocument.dispatchEvent(new CustomEvent(\'view-transition-start\'));\n\n// Around where your transition completes\ndocument.dispatchEvent(new CustomEvent(\'view-transition-end\'));\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-string.js\nvar es_date_to_string = __webpack_require__(3288);\n;// ./src/components/Footer.js\n\nvar Footer = function Footer() {\n  var footer = document.createElement("footer");\n  footer.innerHTML = "\\n      <p>&copy; ".concat(new Date().getFullYear(), " Story App. All rights reserved.</p>\\n    ");\n  return footer;\n};\n;// ./src/views/ErrorView.js\nvar ErrorView = function ErrorView() {\n  var view = document.createElement(\'main\');\n  view.id = \'main-content\';\n  view.innerHTML = "\\n    <div class=\\"error-message\\">\\n      <h1>404 Not Found</h1>\\n      <p>The page you\'re looking for doesn\'t exist.</p>\\n      <a href=\\"#/\\">Go to Home</a>\\n    </div>\\n  ";\n  return {\n    getView: function getView() {\n      return view;\n    }\n  };\n};\n;// ./src/router.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar Router = /*#__PURE__*/function () {\n  function Router(routes) {\n    (0,classCallCheck/* default */.A)(this, Router);\n    this.routes = routes;\n    this.rootElem = document.getElementById("app");\n    this.currentPresenter = null;\n    this.init();\n  }\n  return (0,createClass/* default */.A)(Router, [{\n    key: "init",\n    value: function init() {\n      var _this = this;\n      window.addEventListener("hashchange", function () {\n        return _this.handleRouting();\n      });\n      window.addEventListener("load", function () {\n        return _this.handleRouting();\n      });\n    }\n  }, {\n    key: "handleRouting",\n    value: function () {\n      var _handleRouting = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n        var _this$currentPresente,\n          _this2 = this;\n        var url, params, route;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              url = window.location.hash.slice(1) || "/";\n              params = {};\n              route = this.findMatchingRoute(url, params) || this.routes.find(function (r) {\n                return r.path === "*";\n              }); // Clean up previous view\n              if ((_this$currentPresente = this.currentPresenter) !== null && _this$currentPresente !== void 0 && _this$currentPresente.cleanup) {\n                this.currentPresenter.cleanup();\n              }\n              _context2.next = 6;\n              return startViewTransition(/*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n                var _view$getView, _footer$getView, _header$getView, header, headerElement, view, viewElement, mainContent, footer, footerElement, _this2$currentPresent, _this2$currentPresent2, errorView;\n                return regenerator_default().wrap(function _callee$(_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.prev = 0;\n                      _this2.rootElem.innerHTML = "";\n\n                      // Add header if authenticated\n                      if (!["/login", "/register"].includes(url)) {\n                        header = Header();\n                        headerElement = ((_header$getView = header.getView) === null || _header$getView === void 0 ? void 0 : _header$getView.call(header)) || header;\n                        if (headerElement instanceof Node) {\n                          _this2.rootElem.appendChild(headerElement);\n                        }\n                      }\n\n                      // Load view\n                      _context.next = 5;\n                      return route.view(params);\n                    case 5:\n                      view = _context.sent;\n                      viewElement = ((_view$getView = view.getView) === null || _view$getView === void 0 ? void 0 : _view$getView.call(view)) || view;\n                      if (viewElement instanceof Node) {\n                        _context.next = 9;\n                        break;\n                      }\n                      throw new Error("View is not a valid DOM node");\n                    case 9:\n                      // Ensure main content exists\n                      mainContent = viewElement.querySelector(\'main\') || viewElement;\n                      if (!mainContent.id) {\n                        mainContent.id = "main-content";\n                      }\n                      _this2.rootElem.appendChild(viewElement);\n\n                      // Add footer\n                      footer = Footer();\n                      footerElement = ((_footer$getView = footer.getView) === null || _footer$getView === void 0 ? void 0 : _footer$getView.call(footer)) || footer;\n                      if (footerElement instanceof Node) {\n                        _this2.rootElem.appendChild(footerElement);\n                      }\n\n                      // Set focus to first focusable element\n                      setTimeout(function () {\n                        var firstFocusable = _this2.rootElem.querySelector(\'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])\');\n                        firstFocusable === null || firstFocusable === void 0 || firstFocusable.focus();\n                      }, 100);\n\n                      // Store presenter\n                      if (route.presenter) {\n                        _this2.currentPresenter = route.presenter;\n                        (_this2$currentPresent = (_this2$currentPresent2 = _this2.currentPresenter).afterRender) === null || _this2$currentPresent === void 0 || _this2$currentPresent.call(_this2$currentPresent2);\n                      }\n                      _context.next = 25;\n                      break;\n                    case 19:\n                      _context.prev = 19;\n                      _context.t0 = _context["catch"](0);\n                      console.error("Routing error:", _context.t0);\n                      errorView = ErrorView();\n                      _this2.rootElem.innerHTML = "";\n                      _this2.rootElem.appendChild(errorView.getView());\n                    case 25:\n                    case "end":\n                      return _context.stop();\n                  }\n                }, _callee, null, [[0, 19]]);\n              })));\n            case 6:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this);\n      }));\n      function handleRouting() {\n        return _handleRouting.apply(this, arguments);\n      }\n      return handleRouting;\n    }()\n  }, {\n    key: "findMatchingRoute",\n    value: function findMatchingRoute(url, params) {\n      return this.routes.find(function (route) {\n        var routeParts = route.path.split("/");\n        var urlParts = url.split("/");\n        if (routeParts.length !== urlParts.length) return false;\n        for (var i = 0; i < routeParts.length; i++) {\n          var routePart = routeParts[i];\n          var urlPart = urlParts[i];\n          if (routePart.startsWith(":")) {\n            var paramName = routePart.slice(1);\n            params[paramName] = urlPart;\n          } else if (routePart !== urlPart) {\n            return false;\n          }\n        }\n        return true;\n      });\n    }\n  }, {\n    key: "navigateTo",\n    value: function navigateTo(path) {\n      var currentPath = window.location.hash.slice(1) || "/";\n      if (currentPath === "/add-story" && this.currentPresenter) {\n        this.currentPresenter.cleanup();\n      }\n      window.location.hash = path;\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-json.js\nvar es_date_to_json = __webpack_require__(739);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.keys.js\nvar es_object_keys = __webpack_require__(9432);\n;// ./src/services/authApi.js\n\n\n\n\n\nvar API_BASE_URL = \'https://story-api.dicoding.dev/v1\';\nvar authApi_login = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(email, password) {\n    var response;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return fetch("".concat(API_BASE_URL, "/login"), {\n            method: \'POST\',\n            headers: {\n              \'Content-Type\': \'application/json\'\n            },\n            body: JSON.stringify({\n              email: email,\n              password: password\n            })\n          });\n        case 2:\n          response = _context.sent;\n          return _context.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function login(_x, _x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar authApi_register = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(name, email, password) {\n    var response;\n    return regenerator_default().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return fetch("".concat(API_BASE_URL, "/register"), {\n            method: \'POST\',\n            headers: {\n              \'Content-Type\': \'application/json\'\n            },\n            body: JSON.stringify({\n              name: name,\n              email: email,\n              password: password\n            })\n          });\n        case 2:\n          response = _context2.sent;\n          return _context2.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function register(_x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n;// ./src/models/AuthModel.js\n\n\n\n\n\n\n\n\nvar AuthModel = /*#__PURE__*/function () {\n  function AuthModel() {\n    (0,classCallCheck/* default */.A)(this, AuthModel);\n    this.token = localStorage.getItem("token") || null;\n    this.user = JSON.parse(localStorage.getItem("user")) || null;\n  }\n  return (0,createClass/* default */.A)(AuthModel, [{\n    key: "login",\n    value: function () {\n      var _login2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(email, password) {\n        var response;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return authApi_login(email, password);\n            case 3:\n              response = _context.sent;\n              if (response.error) {\n                _context.next = 10;\n                break;\n              }\n              this.token = response.loginResult.token;\n              this.user = {\n                userId: response.loginResult.userId,\n                name: response.loginResult.name\n              };\n              localStorage.setItem("token", this.token);\n              localStorage.setItem("user", JSON.stringify(this.user));\n              return _context.abrupt("return", {\n                success: true,\n                user: this.user\n              });\n            case 10:\n              return _context.abrupt("return", {\n                success: false,\n                message: response.message\n              });\n            case 13:\n              _context.prev = 13;\n              _context.t0 = _context["catch"](0);\n              console.error("Login error:", _context.t0);\n              return _context.abrupt("return", {\n                success: false,\n                message: "Login failed. Please try again."\n              });\n            case 17:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[0, 13]]);\n      }));\n      function login(_x, _x2) {\n        return _login2.apply(this, arguments);\n      }\n      return login;\n    }()\n  }, {\n    key: "register",\n    value: function () {\n      var _register2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(name, email, password) {\n        var response;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return authApi_register(name, email, password);\n            case 3:\n              response = _context2.sent;\n              if (response.error) {\n                _context2.next = 6;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: true\n              });\n            case 6:\n              return _context2.abrupt("return", {\n                success: false,\n                message: response.message\n              });\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2["catch"](0);\n              console.error("Registration error:", _context2.t0);\n              return _context2.abrupt("return", {\n                success: false,\n                message: "Registration failed. Please try again."\n              });\n            case 13:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[0, 9]]);\n      }));\n      function register(_x3, _x4, _x5) {\n        return _register2.apply(this, arguments);\n      }\n      return register;\n    }()\n  }, {\n    key: "logout",\n    value: function logout() {\n      this.token = null;\n      this.user = null;\n      localStorage.removeItem("token");\n      localStorage.removeItem("user");\n    }\n  }, {\n    key: "isAuthenticated",\n    value: function isAuthenticated() {\n      return !!this.token;\n    }\n  }, {\n    key: "getUser",\n    value: function getUser() {\n      return this.user;\n    }\n  }, {\n    key: "getToken",\n    value: function getToken() {\n      return this.token;\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.symbol.iterator.js\nvar es_symbol_iterator = __webpack_require__(2259);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.filter.js\nvar es_array_filter = __webpack_require__(2008);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.from.js\nvar es_array_from = __webpack_require__(3418);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.is-array.js\nvar es_array_is_array = __webpack_require__(4346);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.iterator.js\nvar es_array_iterator = __webpack_require__(3792);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array.sort.js\nvar es_array_sort = __webpack_require__(6910);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.now.js\nvar es_date_now = __webpack_require__(9089);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.date.to-iso-string.js\nvar es_date_to_iso_string = __webpack_require__(1688);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.regexp.exec.js\nvar es_regexp_exec = __webpack_require__(7495);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.regexp.to-string.js\nvar es_regexp_to_string = __webpack_require__(8781);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.iterator.js\nvar es_string_iterator = __webpack_require__(7764);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.dom-collections.iterator.js\nvar web_dom_collections_iterator = __webpack_require__(2953);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url.js\nvar web_url = __webpack_require__(3296);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url.to-json.js\nvar web_url_to_json = __webpack_require__(7208);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/web.url-search-params.js\nvar web_url_search_params = __webpack_require__(8408);\n;// ./src/data/api.js\n\n\n\n\n\n\n\n\nvar api_API_BASE_URL = "https://story-api.dicoding.dev/v1";\nvar register = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(name, email, password) {\n    var response;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/register"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json"\n            },\n            body: JSON.stringify({\n              name: name,\n              email: email,\n              password: password\n            })\n          });\n        case 2:\n          response = _context.sent;\n          return _context.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function register(_x, _x2, _x3) {\n    return _ref.apply(this, arguments);\n  };\n}()));\nvar login = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref2 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(email, password) {\n    var response;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/login"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json"\n            },\n            body: JSON.stringify({\n              email: email,\n              password: password\n            })\n          });\n        case 2:\n          response = _context2.sent;\n          return _context2.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n  return function login(_x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}()));\nvar api_getAllStories = /*#__PURE__*/function () {\n  var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(token, page, size, withLocation) {\n    var response, data;\n    return regenerator_default().wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return fetch("".concat(api_API_BASE_URL, "/stories?page=").concat(page, "&size=").concat(size, "&location=").concat(withLocation ? 1 : 0), {\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            }\n          });\n        case 3:\n          response = _context3.sent;\n          _context3.next = 6;\n          return response.json();\n        case 6:\n          data = _context3.sent;\n          console.log(\'API Response:\', data); // Debug log\n          if (response.ok) {\n            _context3.next = 10;\n            break;\n          }\n          throw new Error(data.message || \'Failed to fetch\');\n        case 10:\n          return _context3.abrupt("return", data);\n        case 13:\n          _context3.prev = 13;\n          _context3.t0 = _context3["catch"](0);\n          console.error(\'API Error:\', _context3.t0);\n          throw _context3.t0;\n        case 17:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[0, 13]]);\n  }));\n  return function getAllStories(_x6, _x7, _x8, _x9) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nvar api_getStoryDetail = /*#__PURE__*/function () {\n  var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(id, token) {\n    var response;\n    return regenerator_default().wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/stories/").concat(id), {\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            }\n          });\n        case 2:\n          response = _context4.sent;\n          return _context4.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return function getStoryDetail(_x0, _x1) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nvar api_addStory = /*#__PURE__*/function () {\n  var _ref5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(data, token) {\n    var formData, response;\n    return regenerator_default().wrap(function _callee5$(_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          formData = new FormData();\n          formData.append("description", data.description);\n          formData.append("photo", data.photo);\n          if (data.lat && data.lon) {\n            formData.append("lat", data.lat);\n            formData.append("lon", data.lon);\n          }\n          _context5.next = 6;\n          return fetch("".concat(api_API_BASE_URL, "/stories"), {\n            method: "POST",\n            headers: {\n              Authorization: "Bearer ".concat(token)\n            },\n            body: formData\n          });\n        case 6:\n          response = _context5.sent;\n          return _context5.abrupt("return", response.json());\n        case 8:\n        case "end":\n          return _context5.stop();\n      }\n    }, _callee5);\n  }));\n  return function addStory(_x10, _x11) {\n    return _ref5.apply(this, arguments);\n  };\n}();\nvar addStoryGuest = /*#__PURE__*/function () {\n  var _ref6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(data) {\n    var formData, response;\n    return regenerator_default().wrap(function _callee6$(_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          formData = new FormData();\n          formData.append("description", data.description);\n          formData.append("photo", data.photo);\n          if (data.lat && data.lon) {\n            formData.append("lat", data.lat);\n            formData.append("lon", data.lon);\n          }\n          _context6.next = 6;\n          return fetch("".concat(api_API_BASE_URL, "/stories/guest"), {\n            method: "POST",\n            body: formData\n          });\n        case 6:\n          response = _context6.sent;\n          return _context6.abrupt("return", response.json());\n        case 8:\n        case "end":\n          return _context6.stop();\n      }\n    }, _callee6);\n  }));\n  return function addStoryGuest(_x12) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nvar subscribeToNotifications = /*#__PURE__*/function () {\n  var _ref7 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(subscription, token) {\n    var response;\n    return regenerator_default().wrap(function _callee7$(_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/notifications/subscribe"), {\n            method: "POST",\n            headers: {\n              "Content-Type": "application/json",\n              Authorization: "Bearer ".concat(token)\n            },\n            body: JSON.stringify(subscription)\n          });\n        case 2:\n          response = _context7.sent;\n          return _context7.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return function subscribeToNotifications(_x13, _x14) {\n    return _ref7.apply(this, arguments);\n  };\n}();\nvar unsubscribeFromNotifications = /*#__PURE__*/function () {\n  var _ref8 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(endpoint, token) {\n    var response;\n    return regenerator_default().wrap(function _callee8$(_context8) {\n      while (1) switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.next = 2;\n          return fetch("".concat(api_API_BASE_URL, "/notifications/subscribe"), {\n            method: "DELETE",\n            headers: {\n              "Content-Type": "application/json",\n              Authorization: "Bearer ".concat(token)\n            },\n            body: JSON.stringify({\n              endpoint: endpoint\n            })\n          });\n        case 2:\n          response = _context8.sent;\n          return _context8.abrupt("return", response.json());\n        case 4:\n        case "end":\n          return _context8.stop();\n      }\n    }, _callee8);\n  }));\n  return function unsubscribeFromNotifications(_x15, _x16) {\n    return _ref8.apply(this, arguments);\n  };\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.define-properties.js\nvar es_object_define_properties = __webpack_require__(7945);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.define-property.js\nvar es_object_define_property = __webpack_require__(4185);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\nvar es_object_get_own_property_descriptor = __webpack_require__(3851);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.object.get-own-property-descriptors.js\nvar es_object_get_own_property_descriptors = __webpack_require__(1278);\n;// ./src/data/database.js\n\n\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar initDB = function initDB() {\n  return new Promise(function (resolve, reject) {\n    var request = indexedDB.open("StoryAppDB", 1);\n    request.onerror = function (event) {\n      console.error("Database error:", event.target.error);\n      reject("Database error");\n    };\n    request.onupgradeneeded = function (event) {\n      var db = event.target.result;\n\n      // Create object store for stories\n      if (!db.objectStoreNames.contains("stories")) {\n        var storiesStore = db.createObjectStore("stories", {\n          keyPath: "id"\n        });\n        storiesStore.createIndex("createdAt", "createdAt", {\n          unique: false\n        });\n      }\n\n      // Create object store for user data\n      if (!db.objectStoreNames.contains("user")) {\n        db.createObjectStore("user", {\n          keyPath: "id"\n        });\n      }\n    };\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n  });\n};\nvar saveStories = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(stories) {\n    var db, transaction, store;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return initDB();\n        case 3:\n          db = _context.sent;\n          transaction = db.transaction("stories", "readwrite");\n          store = transaction.objectStore("stories");\n          stories.forEach(function (story) {\n            store.put(story);\n          });\n          return _context.abrupt("return", new Promise(function (resolve) {\n            transaction.oncomplete = function () {\n              resolve(true);\n            };\n          }));\n        case 10:\n          _context.prev = 10;\n          _context.t0 = _context["catch"](0);\n          console.error("Failed to save stories:", _context.t0);\n          return _context.abrupt("return", false);\n        case 14:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee, null, [[0, 10]]);\n  }));\n  return function saveStories(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar getStories = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n    var db, transaction, store, request;\n    return regenerator_default().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n          _context2.next = 3;\n          return initDB();\n        case 3:\n          db = _context2.sent;\n          transaction = db.transaction("stories", "readonly");\n          store = transaction.objectStore("stories");\n          request = store.getAll();\n          return _context2.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result || []);\n            };\n          }));\n        case 10:\n          _context2.prev = 10;\n          _context2.t0 = _context2["catch"](0);\n          console.error("Failed to get stories:", _context2.t0);\n          return _context2.abrupt("return", []);\n        case 14:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[0, 10]]);\n  }));\n  return function getStories() {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar saveUserData = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref3 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(userData) {\n    var db, transaction, store;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n          _context3.next = 3;\n          return initDB();\n        case 3:\n          db = _context3.sent;\n          transaction = db.transaction("user", "readwrite");\n          store = transaction.objectStore("user");\n          store.put(_objectSpread({\n            id: "currentUser"\n          }, userData));\n          return _context3.abrupt("return", new Promise(function (resolve) {\n            transaction.oncomplete = function () {\n              resolve(true);\n            };\n          }));\n        case 10:\n          _context3.prev = 10;\n          _context3.t0 = _context3["catch"](0);\n          console.error("Failed to save user data:", _context3.t0);\n          return _context3.abrupt("return", false);\n        case 14:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[0, 10]]);\n  }));\n  return function saveUserData(_x2) {\n    return _ref3.apply(this, arguments);\n  };\n}()));\nvar getUserData = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref4 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n    var db, transaction, store, request;\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.prev = 0;\n          _context4.next = 3;\n          return initDB();\n        case 3:\n          db = _context4.sent;\n          transaction = db.transaction("user", "readonly");\n          store = transaction.objectStore("user");\n          request = store.get("currentUser");\n          return _context4.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result || null);\n            };\n          }));\n        case 10:\n          _context4.prev = 10;\n          _context4.t0 = _context4["catch"](0);\n          console.error("Failed to get user data:", _context4.t0);\n          return _context4.abrupt("return", null);\n        case 14:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4, null, [[0, 10]]);\n  }));\n  return function getUserData() {\n    return _ref4.apply(this, arguments);\n  };\n}()));\nvar isWriting = false;\nvar _addStoryOffline = /*#__PURE__*/function () {\n  var _ref5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(story) {\n    var db, tx, store;\n    return regenerator_default().wrap(function _callee5$(_context5) {\n      while (1) switch (_context5.prev = _context5.next) {\n        case 0:\n          if (!isWriting) {\n            _context5.next = 4;\n            break;\n          }\n          _context5.next = 3;\n          return new Promise(function (resolve) {\n            return setTimeout(resolve, 100);\n          });\n        case 3:\n          return _context5.abrupt("return", _addStoryOffline(story));\n        case 4:\n          isWriting = true;\n          _context5.prev = 5;\n          _context5.next = 8;\n          return initDB();\n        case 8:\n          db = _context5.sent;\n          tx = db.transaction("stories", "readwrite");\n          store = tx.objectStore("stories");\n          store.put(story);\n          return _context5.abrupt("return", new Promise(function (resolve) {\n            tx.oncomplete = function () {\n              return resolve(true);\n            };\n            tx.onerror = function () {\n              console.error("Transaction failed:", tx.error);\n              resolve(false);\n            };\n          }));\n        case 15:\n          _context5.prev = 15;\n          _context5.t0 = _context5["catch"](5);\n          console.error("Failed to save story offline:", _context5.t0);\n          return _context5.abrupt("return", false);\n        case 19:\n          _context5.prev = 19;\n          isWriting = false;\n          return _context5.finish(19);\n        case 22:\n        case "end":\n          return _context5.stop();\n      }\n    }, _callee5, null, [[5, 15, 19, 22]]);\n  }));\n  return function addStoryOffline(_x3) {\n    return _ref5.apply(this, arguments);\n  };\n}();\n\nvar database_deleteStoryOffline = /*#__PURE__*/function () {\n  var _ref6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(id) {\n    var db, tx, store;\n    return regenerator_default().wrap(function _callee6$(_context6) {\n      while (1) switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.prev = 0;\n          _context6.next = 3;\n          return initDB();\n        case 3:\n          db = _context6.sent;\n          tx = db.transaction("stories", "readwrite");\n          store = tx.objectStore("stories");\n          store["delete"](id);\n          return _context6.abrupt("return", new Promise(function (resolve) {\n            tx.oncomplete = function () {\n              return resolve(true);\n            };\n          }));\n        case 10:\n          _context6.prev = 10;\n          _context6.t0 = _context6["catch"](0);\n          console.error("Failed to delete story:", _context6.t0);\n          return _context6.abrupt("return", false);\n        case 14:\n        case "end":\n          return _context6.stop();\n      }\n    }, _callee6, null, [[0, 10]]);\n  }));\n  return function deleteStoryOffline(_x4) {\n    return _ref6.apply(this, arguments);\n  };\n}();\nvar getOfflineStories = /*#__PURE__*/(/* unused pure expression or super */ null && (function () {\n  var _ref7 = _asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7() {\n    var db, tx, store, request;\n    return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n      while (1) switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.next = 2;\n          return initDB();\n        case 2:\n          db = _context7.sent;\n          tx = db.transaction("stories", "readonly");\n          store = tx.objectStore("stories");\n          request = store.getAll();\n          return _context7.abrupt("return", new Promise(function (resolve) {\n            request.onsuccess = function () {\n              resolve(request.result.filter(function (story) {\n                return story.isOffline;\n              }));\n            };\n          }));\n        case 7:\n        case "end":\n          return _context7.stop();\n      }\n    }, _callee7);\n  }));\n  return function getOfflineStories() {\n    return _ref7.apply(this, arguments);\n  };\n}()));\n;// ./src/models/StoryModel.js\n\n\n\nfunction _createForOfIteratorHelper(r, e) { var t = "undefined" != typeof Symbol && r[Symbol.iterator] || r["@@iterator"]; if (!t) { if (Array.isArray(r) || (t = _unsupportedIterableToArray(r)) || e && r && "number" == typeof r.length) { t && (r = t); var _n = 0, F = function F() {}; return { s: F, n: function n() { return _n >= r.length ? { done: !0 } : { done: !1, value: r[_n++] }; }, e: function e(r) { throw r; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var o, a = !0, u = !1; return { s: function s() { t = t.call(r); }, n: function n() { var r = t.next(); return a = r.done, r; }, e: function e(r) { u = !0, o = r; }, f: function f() { try { a || null == t["return"] || t["return"](); } finally { if (u) throw o; } } }; }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if ("string" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return "Object" === t && r.constructor && (t = r.constructor.name), "Map" === t || "Set" === t ? Array.from(r) : "Arguments" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar StoryModel = /*#__PURE__*/function () {\n  function StoryModel(authModel) {\n    (0,classCallCheck/* default */.A)(this, StoryModel);\n    this.authModel = authModel;\n  }\n  return (0,createClass/* default */.A)(StoryModel, [{\n    key: "getAllStories",\n    value: function () {\n      var _getAllStories2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var page,\n          size,\n          withLocation,\n          token,\n          response,\n          offlineStories,\n          _offlineStories,\n          _args = arguments;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              page = _args.length > 0 && _args[0] !== undefined ? _args[0] : 1;\n              size = _args.length > 1 && _args[1] !== undefined ? _args[1] : 10;\n              withLocation = _args.length > 2 && _args[2] !== undefined ? _args[2] : false;\n              _context.prev = 3;\n              token = this.authModel.getToken();\n              _context.next = 7;\n              return api_getAllStories(token, page, size, withLocation);\n            case 7:\n              response = _context.sent;\n              if (response.error) {\n                _context.next = 12;\n                break;\n              }\n              _context.next = 11;\n              return saveStories(response.listStory);\n            case 11:\n              return _context.abrupt("return", {\n                success: true,\n                stories: response.listStory\n              });\n            case 12:\n              _context.next = 14;\n              return getStories();\n            case 14:\n              offlineStories = _context.sent;\n              return _context.abrupt("return", {\n                success: true,\n                stories: offlineStories,\n                isOffline: true\n              });\n            case 18:\n              _context.prev = 18;\n              _context.t0 = _context["catch"](3);\n              _context.next = 22;\n              return getStories();\n            case 22:\n              _offlineStories = _context.sent;\n              return _context.abrupt("return", {\n                success: !!_offlineStories.length,\n                stories: _offlineStories || [],\n                isOffline: true\n              });\n            case 24:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[3, 18]]);\n      }));\n      function getAllStories() {\n        return _getAllStories2.apply(this, arguments);\n      }\n      return getAllStories;\n    }()\n  }, {\n    key: "getStoryDetail",\n    value: function () {\n      var _getStoryDetail2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(id) {\n        var token, response;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              token = this.authModel.getToken();\n              if (token) {\n                _context2.next = 4;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: false,\n                message: "Authentication required"\n              });\n            case 4:\n              _context2.next = 6;\n              return api_getStoryDetail(id, token);\n            case 6:\n              response = _context2.sent;\n              if (response.error) {\n                _context2.next = 9;\n                break;\n              }\n              return _context2.abrupt("return", {\n                success: true,\n                story: response.story\n              });\n            case 9:\n              return _context2.abrupt("return", {\n                success: false,\n                message: response.message || "Failed to fetch story"\n              });\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2["catch"](0);\n              return _context2.abrupt("return", {\n                success: false,\n                message: _context2.t0.message || "Network error while fetching story"\n              });\n            case 15:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 12]]);\n      }));\n      function getStoryDetail(_x) {\n        return _getStoryDetail2.apply(this, arguments);\n      }\n      return getStoryDetail;\n    }()\n  }, {\n    key: "addStory",\n    value: function () {\n      var _addStory2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(data) {\n        var token, response;\n        return regenerator_default().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              token = this.authModel.getToken();\n              if (!(!(data !== null && data !== void 0 && data.description) || !(data !== null && data !== void 0 && data.photo))) {\n                _context3.next = 4;\n                break;\n              }\n              return _context3.abrupt("return", {\n                success: false,\n                message: "Description and photo are required"\n              });\n            case 4:\n              if (!token) {\n                _context3.next = 10;\n                break;\n              }\n              _context3.next = 7;\n              return api_addStory(data, token);\n            case 7:\n              _context3.t0 = _context3.sent;\n              _context3.next = 13;\n              break;\n            case 10:\n              _context3.next = 12;\n              return addStoryGuest(data);\n            case 12:\n              _context3.t0 = _context3.sent;\n            case 13:\n              response = _context3.t0;\n              if (response.error) {\n                _context3.next = 16;\n                break;\n              }\n              return _context3.abrupt("return", {\n                success: true,\n                message: "Story added successfully",\n                data: response\n              });\n            case 16:\n              return _context3.abrupt("return", {\n                success: false,\n                message: response.message || "Failed to add story"\n              });\n            case 19:\n              _context3.prev = 19;\n              _context3.t1 = _context3["catch"](0);\n              return _context3.abrupt("return", {\n                success: false,\n                message: _context3.t1.message || "Network error while adding story"\n              });\n            case 22:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[0, 19]]);\n      }));\n      function addStory(_x2) {\n        return _addStory2.apply(this, arguments);\n      }\n      return addStory;\n    }()\n  }, {\n    key: "addStoryOffline",\n    value: function () {\n      var _addStoryOffline2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(data) {\n        var storyId, photoUrl, photoBase64, story;\n        return regenerator_default().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              storyId = "offline_".concat(Date.now(), "_").concat(Math.floor(Math.random() * 1000));\n              photoUrl = \'\';\n              photoBase64 = \'\';\n              if (!(data.photo instanceof Blob || data.photo instanceof File)) {\n                _context4.next = 9;\n                break;\n              }\n              _context4.next = 7;\n              return this.readFileAsBase64(data.photo);\n            case 7:\n              photoBase64 = _context4.sent;\n              photoUrl = URL.createObjectURL(data.photo);\n            case 9:\n              story = {\n                id: storyId,\n                name: "You (Offline)",\n                description: data.description,\n                photoUrl: photoUrl || \'/assets/images/placeholder-offline.jpg\',\n                photoBase64: photoBase64,\n                createdAt: new Date().toISOString(),\n                updatedAt: new Date().toISOString(),\n                isOffline: true,\n                lat: data.lat,\n                lon: data.lon,\n                originalPhoto: data.photo\n              };\n              _context4.next = 12;\n              return _addStoryOffline(story);\n            case 12:\n              return _context4.abrupt("return", {\n                success: true,\n                story: story\n              });\n            case 15:\n              _context4.prev = 15;\n              _context4.t0 = _context4["catch"](0);\n              console.error("Failed to save offline story:", _context4.t0);\n              return _context4.abrupt("return", {\n                success: false,\n                error: _context4.t0\n              });\n            case 19:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 15]]);\n      }));\n      function addStoryOffline(_x3) {\n        return _addStoryOffline2.apply(this, arguments);\n      }\n      return addStoryOffline;\n    }()\n  }, {\n    key: "readFileAsBase64",\n    value: function readFileAsBase64(file) {\n      return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function () {\n          return resolve(reader.result);\n        };\n        reader.onerror = reject;\n        reader.readAsDataURL(file);\n      });\n    }\n  }, {\n    key: "syncOfflineStories",\n    value: function () {\n      var _syncOfflineStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(syncQueue) {\n        var offlineStories, token, toSync, syncedIds, _iterator, _step, story, photoBlob, response;\n        return regenerator_default().wrap(function _callee5$(_context5) {\n          while (1) switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.prev = 0;\n              _context5.next = 3;\n              return this.getOfflineStories();\n            case 3:\n              offlineStories = _context5.sent;\n              token = this.authModel.getToken();\n              if (token) {\n                _context5.next = 8;\n                break;\n              }\n              console.log(\'No auth token - skipping sync\');\n              return _context5.abrupt("return", {\n                success: false,\n                error: \'Authentication required\'\n              });\n            case 8:\n              // Filter stories that are both offline and in the sync queue\n              toSync = offlineStories.sort(function (a, b) {\n                return new Date(a.createdAt) - new Date(b.createdAt);\n              }).filter(function (story) {\n                return syncQueue.has(story.id);\n              });\n              if (!(toSync.length === 0)) {\n                _context5.next = 12;\n                break;\n              }\n              console.log(\'No stories to sync\');\n              return _context5.abrupt("return", {\n                success: true,\n                syncedIds: []\n              });\n            case 12:\n              syncedIds = [];\n              _iterator = _createForOfIteratorHelper(toSync);\n              _context5.prev = 14;\n              _iterator.s();\n            case 16:\n              if ((_step = _iterator.n()).done) {\n                _context5.next = 42;\n                break;\n              }\n              story = _step.value;\n              _context5.prev = 18;\n              console.log(\'Syncing story:\', story.id);\n              if (!story.photoBase64) {\n                _context5.next = 26;\n                break;\n              }\n              _context5.next = 23;\n              return this.base64ToBlob(story.photoBase64);\n            case 23:\n              _context5.t0 = _context5.sent;\n              _context5.next = 27;\n              break;\n            case 26:\n              _context5.t0 = story.originalPhoto;\n            case 27:\n              photoBlob = _context5.t0;\n              _context5.next = 30;\n              return api_addStory({\n                description: story.description,\n                photo: photoBlob,\n                lat: story.lat,\n                lon: story.lon\n              }, token);\n            case 30:\n              response = _context5.sent;\n              if (response.error) {\n                _context5.next = 35;\n                break;\n              }\n              _context5.next = 34;\n              return database_deleteStoryOffline(story.id);\n            case 34:\n              syncedIds.push(story.id);\n            case 35:\n              _context5.next = 40;\n              break;\n            case 37:\n              _context5.prev = 37;\n              _context5.t1 = _context5["catch"](18);\n              console.error("Failed to sync ".concat(story.id, ":"), _context5.t1);\n            case 40:\n              _context5.next = 16;\n              break;\n            case 42:\n              _context5.next = 47;\n              break;\n            case 44:\n              _context5.prev = 44;\n              _context5.t2 = _context5["catch"](14);\n              _iterator.e(_context5.t2);\n            case 47:\n              _context5.prev = 47;\n              _iterator.f();\n              return _context5.finish(47);\n            case 50:\n              return _context5.abrupt("return", {\n                success: syncedIds.length > 0,\n                syncedIds: syncedIds\n              });\n            case 53:\n              _context5.prev = 53;\n              _context5.t3 = _context5["catch"](0);\n              console.error(\'Sync error:\', _context5.t3);\n              return _context5.abrupt("return", {\n                success: false,\n                error: _context5.t3\n              });\n            case 57:\n            case "end":\n              return _context5.stop();\n          }\n        }, _callee5, this, [[0, 53], [14, 44, 47, 50], [18, 37]]);\n      }));\n      function syncOfflineStories(_x4) {\n        return _syncOfflineStories.apply(this, arguments);\n      }\n      return syncOfflineStories;\n    }()\n  }, {\n    key: "base64ToBlob",\n    value: function () {\n      var _base64ToBlob = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(base64) {\n        var response;\n        return regenerator_default().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              _context6.next = 2;\n              return fetch(base64);\n            case 2:\n              response = _context6.sent;\n              _context6.next = 5;\n              return response.blob();\n            case 5:\n              return _context6.abrupt("return", _context6.sent);\n            case 6:\n            case "end":\n              return _context6.stop();\n          }\n        }, _callee6);\n      }));\n      function base64ToBlob(_x5) {\n        return _base64ToBlob.apply(this, arguments);\n      }\n      return base64ToBlob;\n    }()\n  }, {\n    key: "getOfflineStories",\n    value: function () {\n      var _getOfflineStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7() {\n        var allStories;\n        return regenerator_default().wrap(function _callee7$(_context7) {\n          while (1) switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return getStories();\n            case 2:\n              allStories = _context7.sent;\n              return _context7.abrupt("return", allStories.filter(function (story) {\n                return story.isOffline;\n              }));\n            case 4:\n            case "end":\n              return _context7.stop();\n          }\n        }, _callee7);\n      }));\n      function getOfflineStories() {\n        return _getOfflineStories.apply(this, arguments);\n      }\n      return getOfflineStories;\n    }()\n  }, {\n    key: "deleteStoryOffline",\n    value: function () {\n      var _deleteStoryOffline2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(id) {\n        return regenerator_default().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.next = 2;\n              return database_deleteStoryOffline(id);\n            case 2:\n              return _context8.abrupt("return", _context8.sent);\n            case 3:\n            case "end":\n              return _context8.stop();\n          }\n        }, _callee8);\n      }));\n      function deleteStoryOffline(_x6) {\n        return _deleteStoryOffline2.apply(this, arguments);\n      }\n      return deleteStoryOffline;\n    }()\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.function.bind.js\nvar es_function_bind = __webpack_require__(4170);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array-buffer.constructor.js\nvar es_array_buffer_constructor = __webpack_require__(4743);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.array-buffer.slice.js\nvar es_array_buffer_slice = __webpack_require__(1745);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.data-view.js\nvar es_data_view = __webpack_require__(8309);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.repeat.js\nvar es_string_repeat = __webpack_require__(2781);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.replace.js\nvar es_string_replace = __webpack_require__(5440);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.uint8-array.js\nvar es_typed_array_uint8_array = __webpack_require__(1489);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.copy-within.js\nvar es_typed_array_copy_within = __webpack_require__(1630);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.every.js\nvar es_typed_array_every = __webpack_require__(2170);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.fill.js\nvar es_typed_array_fill = __webpack_require__(5044);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.filter.js\nvar es_typed_array_filter = __webpack_require__(1920);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.find.js\nvar es_typed_array_find = __webpack_require__(1694);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.find-index.js\nvar es_typed_array_find_index = __webpack_require__(9955);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.for-each.js\nvar es_typed_array_for_each = __webpack_require__(3206);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.includes.js\nvar es_typed_array_includes = __webpack_require__(4496);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.index-of.js\nvar es_typed_array_index_of = __webpack_require__(6651);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.iterator.js\nvar es_typed_array_iterator = __webpack_require__(2887);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.join.js\nvar es_typed_array_join = __webpack_require__(9369);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.last-index-of.js\nvar es_typed_array_last_index_of = __webpack_require__(6812);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.map.js\nvar es_typed_array_map = __webpack_require__(8995);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reduce.js\nvar es_typed_array_reduce = __webpack_require__(1575);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reduce-right.js\nvar es_typed_array_reduce_right = __webpack_require__(6072);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.reverse.js\nvar es_typed_array_reverse = __webpack_require__(8747);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.set.js\nvar es_typed_array_set = __webpack_require__(8845);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.slice.js\nvar es_typed_array_slice = __webpack_require__(9423);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.some.js\nvar es_typed_array_some = __webpack_require__(7301);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.sort.js\nvar es_typed_array_sort = __webpack_require__(373);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.subarray.js\nvar es_typed_array_subarray = __webpack_require__(6614);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.to-locale-string.js\nvar es_typed_array_to_locale_string = __webpack_require__(1405);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.typed-array.to-string.js\nvar es_typed_array_to_string = __webpack_require__(3684);\n;// ./src/utils/config.js\nvar VAPID_PUBLIC_KEY = "BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk";\n;// ./src/utils/notification.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar requestNotificationPermission = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n    var permission;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          if ("Notification" in window) {\n            _context.next = 3;\n            break;\n          }\n          console.log("This browser does not support notifications.");\n          return _context.abrupt("return", false);\n        case 3:\n          if (!(Notification.permission === "granted")) {\n            _context.next = 5;\n            break;\n          }\n          return _context.abrupt("return", true);\n        case 5:\n          _context.next = 7;\n          return Notification.requestPermission();\n        case 7:\n          permission = _context.sent;\n          return _context.abrupt("return", permission === "granted");\n        case 9:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function requestNotificationPermission() {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar subscribeUser = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(token) {\n    var registration, subscription, result;\n    return regenerator_default().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          if ("serviceWorker" in navigator) {\n            _context2.next = 3;\n            break;\n          }\n          console.log("Service Worker not supported");\n          return _context2.abrupt("return", null);\n        case 3:\n          _context2.next = 5;\n          return navigator.serviceWorker.ready;\n        case 5:\n          registration = _context2.sent;\n          _context2.next = 8;\n          return registration.pushManager.getSubscription();\n        case 8:\n          subscription = _context2.sent;\n          if (subscription) {\n            _context2.next = 32;\n            break;\n          }\n          _context2.prev = 10;\n          _context2.next = 13;\n          return registration.pushManager.subscribe({\n            userVisibleOnly: true,\n            applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)\n          });\n        case 13:\n          subscription = _context2.sent;\n          _context2.next = 16;\n          return subscribeToNotifications({\n            endpoint: subscription.endpoint,\n            keys: {\n              p256dh: arrayBufferToBase64(subscription.getKey(\'p256dh\')),\n              auth: arrayBufferToBase64(subscription.getKey(\'auth\'))\n            }\n          }, token);\n        case 16:\n          result = _context2.sent;\n          if (result.error) {\n            _context2.next = 22;\n            break;\n          }\n          console.log("User is subscribed.");\n          return _context2.abrupt("return", subscription);\n        case 22:\n          console.error("Subscription failed:", result.message);\n          _context2.next = 25;\n          return subscription.unsubscribe();\n        case 25:\n          return _context2.abrupt("return", null);\n        case 26:\n          _context2.next = 32;\n          break;\n        case 28:\n          _context2.prev = 28;\n          _context2.t0 = _context2["catch"](10);\n          console.error("Error subscribing user:", _context2.t0);\n          return _context2.abrupt("return", null);\n        case 32:\n          return _context2.abrupt("return", subscription);\n        case 33:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[10, 28]]);\n  }));\n  return function subscribeUser(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar unsubscribeUser = /*#__PURE__*/function () {\n  var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(token) {\n    var registration, subscription, result;\n    return regenerator_default().wrap(function _callee3$(_context3) {\n      while (1) switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.next = 2;\n          return navigator.serviceWorker.ready;\n        case 2:\n          registration = _context3.sent;\n          _context3.next = 5;\n          return registration.pushManager.getSubscription();\n        case 5:\n          subscription = _context3.sent;\n          if (!subscription) {\n            _context3.next = 23;\n            break;\n          }\n          _context3.prev = 7;\n          _context3.next = 10;\n          return unsubscribeFromNotifications(subscription.endpoint, token);\n        case 10:\n          result = _context3.sent;\n          if (result.error) {\n            _context3.next = 16;\n            break;\n          }\n          _context3.next = 14;\n          return subscription.unsubscribe();\n        case 14:\n          console.log("User is unsubscribed.");\n          return _context3.abrupt("return", true);\n        case 16:\n          return _context3.abrupt("return", false);\n        case 19:\n          _context3.prev = 19;\n          _context3.t0 = _context3["catch"](7);\n          console.error("Error unsubscribing user:", _context3.t0);\n          return _context3.abrupt("return", false);\n        case 23:\n          return _context3.abrupt("return", false);\n        case 24:\n        case "end":\n          return _context3.stop();\n      }\n    }, _callee3, null, [[7, 19]]);\n  }));\n  return function unsubscribeUser(_x2) {\n    return _ref3.apply(this, arguments);\n  };\n}();\nvar showNotificationPrompt = /*#__PURE__*/function () {\n  var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(callback) {\n    var permission;\n    return regenerator_default().wrap(function _callee4$(_context4) {\n      while (1) switch (_context4.prev = _context4.next) {\n        case 0:\n          if ("Notification" in window) {\n            _context4.next = 4;\n            break;\n          }\n          console.log("This browser does not support notifications.");\n          if (callback) callback(false);\n          return _context4.abrupt("return", false);\n        case 4:\n          if (!(Notification.permission === "granted")) {\n            _context4.next = 7;\n            break;\n          }\n          if (callback) callback(true);\n          return _context4.abrupt("return", true);\n        case 7:\n          if (!(Notification.permission === "denied")) {\n            _context4.next = 11;\n            break;\n          }\n          console.log("Notification permission has been denied.");\n          if (callback) callback(false);\n          return _context4.abrupt("return", false);\n        case 11:\n          if (!(Notification.permission === "default")) {\n            _context4.next = 17;\n            break;\n          }\n          _context4.next = 14;\n          return Notification.requestPermission();\n        case 14:\n          permission = _context4.sent;\n          if (callback) callback(permission === "granted");\n          return _context4.abrupt("return", permission === "granted");\n        case 17:\n        case "end":\n          return _context4.stop();\n      }\n    }, _callee4);\n  }));\n  return function showNotificationPrompt(_x3) {\n    return _ref4.apply(this, arguments);\n  };\n}();\nfunction urlBase64ToUint8Array(base64String) {\n  var padding = \'=\'.repeat((4 - base64String.length % 4) % 4);\n  var base64 = (base64String + padding).replace(/-/g, \'+\').replace(/_/g, \'/\');\n  var rawData = atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n  return outputArray;\n}\nfunction arrayBufferToBase64(buffer) {\n  var binary = \'\';\n  var bytes = new Uint8Array(buffer);\n  for (var i = 0; i < bytes.byteLength; i++) {\n    binary += String.fromCharCode(bytes[i]);\n  }\n  return btoa(binary);\n}\n;// ./src/presenters/AuthPresenter.js\n\n\n\n\n\n\n\nvar AuthPresenter = /*#__PURE__*/function () {\n  function AuthPresenter(authModel, authView, router) {\n    (0,classCallCheck/* default */.A)(this, AuthPresenter);\n    this.authModel = authModel;\n    this.authView = authView;\n    this.router = router;\n\n    // Initialize UI state\n    updateAuthUI(this.authModel.isAuthenticated());\n    if (authView.bindLogin) {\n      authView.bindLogin(this.handleLogin.bind(this));\n    }\n    if (authView.bindRegister) {\n      authView.bindRegister(this.handleRegister.bind(this));\n    }\n  }\n  return (0,createClass/* default */.A)(AuthPresenter, [{\n    key: "handleLogin",\n    value: function () {\n      var _handleLogin = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(email, password) {\n        var result, notificationPromise, _this$authView$showEr, _this$authView, _this$authView$showEr2, _this$authView2;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              _context2.next = 3;\n              return this.authModel.login(email, password);\n            case 3:\n              result = _context2.sent;\n              if (!result.success) {\n                _context2.next = 12;\n                break;\n              }\n              updateAuthUI(true); // Update UI state immediately\n\n              // Start both operations but don\'t await notification setup\n              notificationPromise = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n                var permissionGranted;\n                return regenerator_default().wrap(function _callee$(_context) {\n                  while (1) switch (_context.prev = _context.next) {\n                    case 0:\n                      _context.prev = 0;\n                      _context.next = 3;\n                      return requestNotificationPermission();\n                    case 3:\n                      permissionGranted = _context.sent;\n                      if (!permissionGranted) {\n                        _context.next = 7;\n                        break;\n                      }\n                      _context.next = 7;\n                      return subscribeUser(result.token);\n                    case 7:\n                      _context.next = 12;\n                      break;\n                    case 9:\n                      _context.prev = 9;\n                      _context.t0 = _context["catch"](0);\n                      console.error("Notification error:", _context.t0);\n                    case 12:\n                    case "end":\n                      return _context.stop();\n                  }\n                }, _callee, null, [[0, 9]]);\n              }))(); // Navigate immediately without waiting for notifications\n              this.router.navigateTo("/stories");\n\n              // Let notifications complete in background\n              _context2.next = 10;\n              return notificationPromise;\n            case 10:\n              _context2.next = 13;\n              break;\n            case 12:\n              (_this$authView$showEr = (_this$authView = this.authView).showError) === null || _this$authView$showEr === void 0 || _this$authView$showEr.call(_this$authView, result.message);\n            case 13:\n              _context2.next = 18;\n              break;\n            case 15:\n              _context2.prev = 15;\n              _context2.t0 = _context2["catch"](0);\n              (_this$authView$showEr2 = (_this$authView2 = this.authView).showError) === null || _this$authView$showEr2 === void 0 || _this$authView$showEr2.call(_this$authView2, _context2.t0.message);\n            case 18:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[0, 15]]);\n      }));\n      function handleLogin(_x, _x2) {\n        return _handleLogin.apply(this, arguments);\n      }\n      return handleLogin;\n    }()\n  }, {\n    key: "handleLogout",\n    value: function () {\n      var _handleLogout = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n        var token;\n        return regenerator_default().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              // Unsubscribe from notifications before logout\n              token = this.authModel.getToken();\n              if (!token) {\n                _context3.next = 5;\n                break;\n              }\n              _context3.next = 5;\n              return unsubscribeUser(token);\n            case 5:\n              _context3.next = 10;\n              break;\n            case 7:\n              _context3.prev = 7;\n              _context3.t0 = _context3["catch"](0);\n              console.error("Error unsubscribing:", _context3.t0);\n            case 10:\n              _context3.prev = 10;\n              this.authModel.logout();\n              updateAuthUI(false);\n              this.router.navigateTo("/login");\n              return _context3.finish(10);\n            case 15:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[0, 7, 10, 15]]);\n      }));\n      function handleLogout() {\n        return _handleLogout.apply(this, arguments);\n      }\n      return handleLogout;\n    }()\n  }, {\n    key: "handleRegister",\n    value: function () {\n      var _handleRegister = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(name, email, password) {\n        var result, _this$authView$showSu, _this$authView3, _this$authView$showEr3, _this$authView4, _this$authView$showEr4, _this$authView5;\n        return regenerator_default().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return this.authModel.register(name, email, password);\n            case 3:\n              result = _context4.sent;\n              if (result.success) {\n                (_this$authView$showSu = (_this$authView3 = this.authView).showSuccess) === null || _this$authView$showSu === void 0 || _this$authView$showSu.call(_this$authView3, "Registration successful. Please login.");\n                this.router.navigateTo("/login");\n              } else {\n                (_this$authView$showEr3 = (_this$authView4 = this.authView).showError) === null || _this$authView$showEr3 === void 0 || _this$authView$showEr3.call(_this$authView4, result.message);\n              }\n              _context4.next = 10;\n              break;\n            case 7:\n              _context4.prev = 7;\n              _context4.t0 = _context4["catch"](0);\n              (_this$authView$showEr4 = (_this$authView5 = this.authView).showError) === null || _this$authView$showEr4 === void 0 || _this$authView$showEr4.call(_this$authView5, _context4.t0.message);\n            case 10:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 7]]);\n      }));\n      function handleRegister(_x3, _x4, _x5) {\n        return _handleRegister.apply(this, arguments);\n      }\n      return handleRegister;\n    }()\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.set.js\nvar es_set = __webpack_require__(1415);\n;// ./src/presenters/StoryPresenter.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nvar StoryPresenter = /*#__PURE__*/function () {\n  function StoryPresenter(storyModel, storyView, router) {\n    (0,classCallCheck/* default */.A)(this, StoryPresenter);\n    this.storyModel = storyModel;\n    this.storyView = storyView;\n    this.router = router;\n    this.currentStoryId = null;\n    this.isLoading = false;\n    this.mapInitialized = false;\n\n    // Sync management\n    this.isSyncing = false;\n    this.pendingSyncIds = new Set();\n    this.syncQueue = new Set();\n    this.initializeEventBindings();\n    this.initializeSyncHandlers();\n    this.startSyncMonitor();\n  }\n  return (0,createClass/* default */.A)(StoryPresenter, [{\n    key: "initializeEventBindings",\n    value: function initializeEventBindings() {\n      if (this.storyView.bindLoadStories) {\n        this.storyView.bindLoadStories(this.handleLoadStories.bind(this));\n      }\n      if (this.storyView.bindAddStory) {\n        this.storyView.bindAddStory(this.handleAddStory.bind(this));\n      }\n      if (this.storyView.bindLoadStoryDetail) {\n        this.storyView.bindLoadStoryDetail(this.handleLoadStoryDetail.bind(this));\n      }\n    }\n  }, {\n    key: "initializeSyncHandlers",\n    value: function initializeSyncHandlers() {\n      // Load existing offline stories into queue\n      this.loadOfflineStoriesIntoQueue();\n\n      // Set up event listeners\n      window.addEventListener(\'online\', this.handleConnectionChange.bind(this));\n      window.addEventListener(\'focus\', this.handleFocus.bind(this));\n    }\n  }, {\n    key: "loadOfflineStoriesIntoQueue",\n    value: function () {\n      var _loadOfflineStoriesIntoQueue = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var _this = this;\n        var offlineStories;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return this.storyModel.getOfflineStories();\n            case 3:\n              offlineStories = _context.sent;\n              offlineStories.forEach(function (story) {\n                return _this.syncQueue.add(story.id);\n              });\n              console.log(\'Initial sync queue:\', Array.from(this.syncQueue));\n\n              // Trigger sync if we\'re already online\n              if (navigator.onLine) {\n                this.handleOnline();\n              }\n              _context.next = 12;\n              break;\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context["catch"](0);\n              console.error(\'Failed to load offline stories:\', _context.t0);\n            case 12:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[0, 9]]);\n      }));\n      function loadOfflineStoriesIntoQueue() {\n        return _loadOfflineStoriesIntoQueue.apply(this, arguments);\n      }\n      return loadOfflineStoriesIntoQueue;\n    }()\n  }, {\n    key: "handleConnectionChange",\n    value: function handleConnectionChange() {\n      var _this2 = this;\n      if (navigator.onLine) {\n        console.log(\'Connection restored - triggering sync\');\n        setTimeout(function () {\n          return _this2.handleOnline();\n        }, 1000);\n      }\n    }\n  }, {\n    key: "handleFocus",\n    value: function handleFocus() {\n      if (navigator.onLine && this.syncQueue.size > 0) {\n        console.log(\'Window focused - checking sync\');\n        this.handleOnline();\n      }\n    }\n  }, {\n    key: "startSyncMonitor",\n    value: function startSyncMonitor() {\n      var _this3 = this;\n      setInterval(function () {\n        console.log(\'Sync Monitor:\', {\n          isSyncing: _this3.isSyncing,\n          queueSize: _this3.syncQueue.size,\n          queueContents: Array.from(_this3.syncQueue),\n          pendingSyncs: Array.from(_this3.pendingSyncIds)\n        });\n      }, 10000);\n    }\n  }, {\n    key: "handleLoadStories",\n    value: function () {\n      var _handleLoadStories = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n        var page,\n          size,\n          result,\n          _this$storyView$showO,\n          _this$storyView,\n          _this$storyView$displ,\n          _this$storyView2,\n          _this$storyView$showE,\n          _this$storyView3,\n          _this$storyView$showE2,\n          _this$storyView4,\n          _args2 = arguments;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              page = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : 1;\n              size = _args2.length > 1 && _args2[1] !== undefined ? _args2[1] : 10;\n              _context2.prev = 2;\n              _context2.next = 5;\n              return this.storyModel.getAllStories(page, size);\n            case 5:\n              result = _context2.sent;\n              if (result.isOffline) {\n                (_this$storyView$showO = (_this$storyView = this.storyView).showOfflineWarning) === null || _this$storyView$showO === void 0 || _this$storyView$showO.call(_this$storyView);\n              }\n              if (result.success) {\n                (_this$storyView$displ = (_this$storyView2 = this.storyView).displayStories) === null || _this$storyView$displ === void 0 || _this$storyView$displ.call(_this$storyView2, result.stories || []);\n              } else {\n                (_this$storyView$showE = (_this$storyView3 = this.storyView).showError) === null || _this$storyView$showE === void 0 || _this$storyView$showE.call(_this$storyView3, result.message || "Failed to load stories");\n              }\n              _context2.next = 14;\n              break;\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2["catch"](2);\n              console.error("Load stories error:", _context2.t0);\n              (_this$storyView$showE2 = (_this$storyView4 = this.storyView).showError) === null || _this$storyView$showE2 === void 0 || _this$storyView$showE2.call(_this$storyView4, "Failed to load stories. Please try again.");\n            case 14:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2, this, [[2, 10]]);\n      }));\n      function handleLoadStories() {\n        return _handleLoadStories.apply(this, arguments);\n      }\n      return handleLoadStories;\n    }()\n  }, {\n    key: "handleLoadStoryDetail",\n    value: function () {\n      var _handleLoadStoryDetail = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3(id) {\n        var _this$storyView$prepa, _this$storyView5, result, _this$storyView$displ2, _this$storyView6, _this$storyView$showE3, _this$storyView7, _this$storyView$showE4, _this$storyView8;\n        return regenerator_default().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              if (!(this.isLoading || this.currentStoryId === id)) {\n                _context3.next = 3;\n                break;\n              }\n              return _context3.abrupt("return");\n            case 3:\n              this.isLoading = true;\n              this.currentStoryId = id;\n              (_this$storyView$prepa = (_this$storyView5 = this.storyView).prepareMapContainer) === null || _this$storyView$prepa === void 0 || _this$storyView$prepa.call(_this$storyView5);\n              _context3.next = 8;\n              return this.storyModel.getStoryDetail(id);\n            case 8:\n              result = _context3.sent;\n              if (!result.success) {\n                _context3.next = 15;\n                break;\n              }\n              _context3.next = 12;\n              return new Promise(function (resolve) {\n                return requestAnimationFrame(resolve);\n              });\n            case 12:\n              (_this$storyView$displ2 = (_this$storyView6 = this.storyView).displayStoryDetail) === null || _this$storyView$displ2 === void 0 || _this$storyView$displ2.call(_this$storyView6, result.story);\n              _context3.next = 17;\n              break;\n            case 15:\n              (_this$storyView$showE3 = (_this$storyView7 = this.storyView).showError) === null || _this$storyView$showE3 === void 0 || _this$storyView$showE3.call(_this$storyView7, result.message || "Story not found");\n              this.router.navigateTo("/stories");\n            case 17:\n              _context3.next = 24;\n              break;\n            case 19:\n              _context3.prev = 19;\n              _context3.t0 = _context3["catch"](0);\n              console.error("Load story detail error:", _context3.t0);\n              (_this$storyView$showE4 = (_this$storyView8 = this.storyView).showError) === null || _this$storyView$showE4 === void 0 || _this$storyView$showE4.call(_this$storyView8, "Failed to load story details");\n              this.router.navigateTo("/stories");\n            case 24:\n              _context3.prev = 24;\n              this.isLoading = false;\n              return _context3.finish(24);\n            case 27:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[0, 19, 24, 27]]);\n      }));\n      function handleLoadStoryDetail(_x) {\n        return _handleLoadStoryDetail.apply(this, arguments);\n      }\n      return handleLoadStoryDetail;\n    }()\n  }, {\n    key: "handleAddStory",\n    value: function () {\n      var _handleAddStory = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(data) {\n        var result, _this$storyView$showE5, _this$storyView9;\n        return regenerator_default().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return this.storyModel.addStory(data);\n            case 3:\n              result = _context4.sent;\n              if (!result.success) {\n                _context4.next = 8;\n                break;\n              }\n              this.handleAddSuccess(data);\n              _context4.next = 14;\n              break;\n            case 8:\n              if (!(!result.success && !navigator.onLine)) {\n                _context4.next = 13;\n                break;\n              }\n              _context4.next = 11;\n              return this.handleOfflineAdd(data);\n            case 11:\n              _context4.next = 14;\n              break;\n            case 13:\n              (_this$storyView$showE5 = (_this$storyView9 = this.storyView).showError) === null || _this$storyView$showE5 === void 0 || _this$storyView$showE5.call(_this$storyView9, result.message || "Failed to add story");\n            case 14:\n              _context4.next = 19;\n              break;\n            case 16:\n              _context4.prev = 16;\n              _context4.t0 = _context4["catch"](0);\n              this.handleAddError(_context4.t0);\n            case 19:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, this, [[0, 16]]);\n      }));\n      function handleAddStory(_x2) {\n        return _handleAddStory.apply(this, arguments);\n      }\n      return handleAddStory;\n    }()\n  }, {\n    key: "handleAddSuccess",\n    value: function () {\n      var _handleAddSuccess = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6(data) {\n        var _this$storyView$showS,\n          _this$storyView0,\n          _this4 = this;\n        return regenerator_default().wrap(function _callee6$(_context6) {\n          while (1) switch (_context6.prev = _context6.next) {\n            case 0:\n              (_this$storyView$showS = (_this$storyView0 = this.storyView).showSuccess) === null || _this$storyView$showS === void 0 || _this$storyView$showS.call(_this$storyView0, "Story added successfully!");\n              _context6.next = 3;\n              return showNotificationPrompt(/*#__PURE__*/function () {\n                var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5(granted) {\n                  return regenerator_default().wrap(function _callee5$(_context5) {\n                    while (1) switch (_context5.prev = _context5.next) {\n                      case 0:\n                        if (granted) {\n                          // new Notification("Story created (Local)", {\n                          //   body: `New story: ${data.description.substring(0, 50)}...`,\n                          //   icon: "/assets/images/icon-192x192.png",\n                          // });\n                        }\n                      case 1:\n                      case "end":\n                        return _context5.stop();\n                    }\n                  }, _callee5);\n                }));\n                return function (_x4) {\n                  return _ref.apply(this, arguments);\n                };\n              }());\n            case 3:\n              this.cleanup();\n              setTimeout(function () {\n                _this4.handleLoadStories();\n                _this4.router.navigateTo("/stories");\n              }, 1500);\n            case 5:\n            case "end":\n              return _context6.stop();\n          }\n        }, _callee6, this);\n      }));\n      function handleAddSuccess(_x3) {\n        return _handleAddSuccess.apply(this, arguments);\n      }\n      return handleAddSuccess;\n    }()\n  }, {\n    key: "handleOfflineAdd",\n    value: function () {\n      var _handleOfflineAdd = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(data) {\n        var _this5 = this;\n        var _this$storyView$showS2, _this$storyView1, offlineResult, _this$storyView$showE6, _this$storyView10;\n        return regenerator_default().wrap(function _callee8$(_context8) {\n          while (1) switch (_context8.prev = _context8.next) {\n            case 0:\n              _context8.prev = 0;\n              _context8.next = 3;\n              return this.storyModel.addStoryOffline(data);\n            case 3:\n              offlineResult = _context8.sent;\n              this.syncQueue.add(offlineResult.story.id);\n              _context8.next = 7;\n              return showNotificationPrompt(/*#__PURE__*/function () {\n                var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(granted) {\n                  return regenerator_default().wrap(function _callee7$(_context7) {\n                    while (1) switch (_context7.prev = _context7.next) {\n                      case 0:\n                        if (granted) {\n                          // new Notification("Story Saved Offline (Local)", {\n                          //   body: "Will upload when you\'re back online",\n                          //   icon: "/assets/images/icon-192x192.png"\n                          // });\n                        }\n                      case 1:\n                      case "end":\n                        return _context7.stop();\n                    }\n                  }, _callee7);\n                }));\n                return function (_x6) {\n                  return _ref2.apply(this, arguments);\n                };\n              }());\n            case 7:\n              (_this$storyView$showS2 = (_this$storyView1 = this.storyView).showSuccess) === null || _this$storyView$showS2 === void 0 || _this$storyView$showS2.call(_this$storyView1, "Story saved offline. Will sync when online!");\n              setTimeout(function () {\n                _this5.handleLoadStories();\n                _this5.router.navigateTo("/stories");\n              }, 1500);\n              _context8.next = 15;\n              break;\n            case 11:\n              _context8.prev = 11;\n              _context8.t0 = _context8["catch"](0);\n              console.error("Offline save failed:", _context8.t0);\n              (_this$storyView$showE6 = (_this$storyView10 = this.storyView).showError) === null || _this$storyView$showE6 === void 0 || _this$storyView$showE6.call(_this$storyView10, "Failed to save story offline.");\n            case 15:\n            case "end":\n              return _context8.stop();\n          }\n        }, _callee8, this, [[0, 11]]);\n      }));\n      function handleOfflineAdd(_x5) {\n        return _handleOfflineAdd.apply(this, arguments);\n      }\n      return handleOfflineAdd;\n    }()\n  }, {\n    key: "handleAddError",\n    value: function handleAddError(error) {\n      console.error("Add story error:", error);\n      if (!navigator.onLine) {\n        var _this$storyView$showE7, _this$storyView11;\n        (_this$storyView$showE7 = (_this$storyView11 = this.storyView).showError) === null || _this$storyView$showE7 === void 0 || _this$storyView$showE7.call(_this$storyView11, "You\'re offline. Please connect to submit stories.");\n      } else {\n        var _this$storyView$showE8, _this$storyView12;\n        (_this$storyView$showE8 = (_this$storyView12 = this.storyView).showError) === null || _this$storyView$showE8 === void 0 || _this$storyView$showE8.call(_this$storyView12, "Failed to add story. Please try again.");\n      }\n    }\n  }, {\n    key: "handleOnline",\n    value: function () {\n      var _handleOnline = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee9() {\n        var _this6 = this;\n        var syncResult, _this$storyView$showS3, _this$storyView13;\n        return regenerator_default().wrap(function _callee9$(_context9) {\n          while (1) switch (_context9.prev = _context9.next) {\n            case 0:\n              if (!(this.isSyncing || this.syncQueue.size === 0)) {\n                _context9.next = 2;\n                break;\n              }\n              return _context9.abrupt("return");\n            case 2:\n              console.log(\'Starting sync with queue:\', Array.from(this.syncQueue));\n              this.isSyncing = true;\n              _context9.prev = 4;\n              _context9.next = 7;\n              return this.storyModel.syncOfflineStories(this.syncQueue);\n            case 7:\n              syncResult = _context9.sent;\n              console.log(\'Sync completed:\', syncResult);\n              if (syncResult.success && syncResult.syncedIds.length > 0) {\n                syncResult.syncedIds.forEach(function (id) {\n                  _this6.syncQueue["delete"](id);\n                  _this6.pendingSyncIds["delete"](id);\n                });\n                (_this$storyView$showS3 = (_this$storyView13 = this.storyView).showSuccess) === null || _this$storyView$showS3 === void 0 || _this$storyView$showS3.call(_this$storyView13, "Synced ".concat(syncResult.syncedIds.length, " stories!"));\n                this.handleLoadStories();\n              }\n              _context9.next = 15;\n              break;\n            case 12:\n              _context9.prev = 12;\n              _context9.t0 = _context9["catch"](4);\n              console.error(\'Sync failed:\', _context9.t0);\n            case 15:\n              _context9.prev = 15;\n              this.isSyncing = false;\n\n              // Retry if there are remaining stories\n              if (this.syncQueue.size > 0) {\n                setTimeout(function () {\n                  return _this6.handleOnline();\n                }, 5000);\n              }\n              return _context9.finish(15);\n            case 19:\n            case "end":\n              return _context9.stop();\n          }\n        }, _callee9, this, [[4, 12, 15, 19]]);\n      }));\n      function handleOnline() {\n        return _handleOnline.apply(this, arguments);\n      }\n      return handleOnline;\n    }()\n  }, {\n    key: "cleanup",\n    value: function cleanup() {\n      if (typeof this.storyView.cleanup === "function") {\n        this.storyView.cleanup();\n      }\n      this.currentStoryId = null;\n      this.isLoading = false;\n    }\n  }]);\n}();\n;// ./src/presenters/MapPresenter.js\n\n\n\n\n\n\nvar MapPresenter = /*#__PURE__*/function () {\n  function MapPresenter(mapView) {\n    (0,classCallCheck/* default */.A)(this, MapPresenter);\n    this.view = mapView;\n    this.currentPosition = null;\n  }\n  return (0,createClass/* default */.A)(MapPresenter, [{\n    key: "initializeMap",\n    value: function () {\n      var _initializeMap = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(containerId) {\n        var options,\n          _options$lat,\n          lat,\n          _options$lng,\n          lng,\n          _options$zoom,\n          zoom,\n          _args = arguments;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              options = _args.length > 1 && _args[1] !== undefined ? _args[1] : {};\n              _context.prev = 1;\n              _options$lat = options.lat, lat = _options$lat === void 0 ? 0 : _options$lat, _options$lng = options.lng, lng = _options$lng === void 0 ? 0 : _options$lng, _options$zoom = options.zoom, zoom = _options$zoom === void 0 ? 10 : _options$zoom;\n              _context.next = 5;\n              return this.view.initMap(containerId, lat, lng, zoom);\n            case 5:\n              return _context.abrupt("return", true);\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context["catch"](1);\n              console.error(\'Map initialization failed:\', _context.t0);\n              return _context.abrupt("return", false);\n            case 12:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, this, [[1, 8]]);\n      }));\n      function initializeMap(_x) {\n        return _initializeMap.apply(this, arguments);\n      }\n      return initializeMap;\n    }()\n  }, {\n    key: "getCurrentLocation",\n    value: function () {\n      var _getCurrentLocation = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n        var _this = this;\n        var options,\n          _args2 = arguments;\n        return regenerator_default().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              options = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : {};\n              return _context2.abrupt("return", new Promise(function (resolve, reject) {\n                if (!navigator.geolocation) {\n                  reject(new Error("Geolocation is not supported by your browser"));\n                  return;\n                }\n                navigator.geolocation.getCurrentPosition(function (position) {\n                  _this.currentPosition = {\n                    lat: position.coords.latitude,\n                    lng: position.coords.longitude,\n                    accuracy: position.coords.accuracy\n                  };\n                  resolve(_this.currentPosition);\n                }, function (error) {\n                  reject(error);\n                }, options);\n              }));\n            case 2:\n            case "end":\n              return _context2.stop();\n          }\n        }, _callee2);\n      }));\n      function getCurrentLocation() {\n        return _getCurrentLocation.apply(this, arguments);\n      }\n      return getCurrentLocation;\n    }()\n  }, {\n    key: "centerToCurrentLocation",\n    value: function () {\n      var _centerToCurrentLocation = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n        var zoom,\n          _args3 = arguments;\n        return regenerator_default().wrap(function _callee3$(_context3) {\n          while (1) switch (_context3.prev = _context3.next) {\n            case 0:\n              zoom = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : 15;\n              _context3.prev = 1;\n              if (this.currentPosition) {\n                _context3.next = 5;\n                break;\n              }\n              _context3.next = 5;\n              return this.getCurrentLocation();\n            case 5:\n              this.view.setView(this.currentPosition.lat, this.currentPosition.lng, zoom);\n              return _context3.abrupt("return", this.currentPosition);\n            case 9:\n              _context3.prev = 9;\n              _context3.t0 = _context3["catch"](1);\n              console.error(\'Failed to center to current location:\', _context3.t0);\n              throw _context3.t0;\n            case 13:\n            case "end":\n              return _context3.stop();\n          }\n        }, _callee3, this, [[1, 9]]);\n      }));\n      function centerToCurrentLocation() {\n        return _centerToCurrentLocation.apply(this, arguments);\n      }\n      return centerToCurrentLocation;\n    }()\n  }, {\n    key: "addMarker",\n    value: function addMarker(lat, lng) {\n      var popupContent = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : "";\n      var options = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : {};\n      return this.view.addMarker(lat, lng, popupContent, options);\n    }\n  }, {\n    key: "addCurrentLocationMarker",\n    value: function addCurrentLocationMarker() {\n      var popupContent = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "";\n      if (!this.currentPosition) {\n        throw new Error(\'Current location not available\');\n      }\n      return this.addMarker(this.currentPosition.lat, this.currentPosition.lng, popupContent, {\n        title: \'Your Location\'\n      });\n    }\n  }, {\n    key: "clearMarkers",\n    value: function clearMarkers() {\n      this.view.clearMarkers();\n    }\n  }, {\n    key: "setOnMapClickHandler",\n    value: function setOnMapClickHandler(handler) {\n      this.view.onMapClick(function (e) {\n        handler(e.latlng.lat, e.latlng.lng);\n      });\n    }\n  }, {\n    key: "cleanup",\n    value: function cleanup() {\n      this.view.remove();\n    }\n  }, {\n    key: "handleLocationSelection",\n    value: function handleLocationSelection(lat, lng) {\n      this.clearMarkers(); // Clear existing markers\n      this.addMarker(lat, lng, "Selected Location", {\n        draggable: true,\n        color: \'red\'\n      });\n      this.view.setView(lat, lng, 15);\n    }\n  }]);\n}();\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.includes.js\nvar es_string_includes = __webpack_require__(1699);\n;// ./src/utils/SkipToContent.js\n\n\n\n\n\nvar currentSkipTarget = null;\nvar resetSkipToContent = function resetSkipToContent() {\n  if (currentSkipTarget) {\n    var _currentSkipTarget$cl;\n    (_currentSkipTarget$cl = currentSkipTarget.classList) === null || _currentSkipTarget$cl === void 0 || _currentSkipTarget$cl.remove(\'focus-visible\');\n    currentSkipTarget.removeAttribute(\'tabindex\');\n    currentSkipTarget = null;\n  }\n};\nvar handleSkipToContent = /*#__PURE__*/function () {\n  var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n    var mainContent;\n    return regenerator_default().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return new Promise(function (resolve) {\n            return requestAnimationFrame(resolve);\n          });\n        case 2:\n          mainContent = document.getElementById(\'main-content\');\n          if (mainContent) {\n            _context.next = 5;\n            break;\n          }\n          return _context.abrupt("return");\n        case 5:\n          resetSkipToContent();\n          mainContent.classList.add(\'focus-visible\');\n          mainContent.focus({\n            preventScroll: true\n          });\n          setTimeout(function () {\n            mainContent.classList.remove(\'focus-visible\');\n          }, 2000);\n        case 9:\n        case "end":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n  return function handleSkipToContent() {\n    return _ref.apply(this, arguments);\n  };\n}();\nvar initializeSkipToContent = function initializeSkipToContent() {\n  var existingSkipLink = document.querySelector(\'.skip-link\');\n  if (existingSkipLink) existingSkipLink.remove();\n  var skipLink = document.createElement(\'a\');\n  skipLink.href = \'#main-content\';\n  skipLink.className = \'skip-link\';\n  skipLink.textContent = \'Skip to content\';\n  skipLink.style.cssText = "\\n    position: fixed;\\n    top: -40px;\\n    left: 1rem;\\n    background: #000;\\n    color: white;\\n    padding: 8px 12px;\\n    border-radius: 0 0 4px 4px;\\n    z-index: 9999;\\n    transition: top 0.3s ease;\\n  ";\n  skipLink.addEventListener(\'focus\', function () {\n    skipLink.style.top = \'0\';\n  });\n  skipLink.addEventListener(\'blur\', function () {\n    skipLink.style.top = \'-40px\';\n  });\n  skipLink.addEventListener(\'click\', /*#__PURE__*/function () {\n    var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(e) {\n      return regenerator_default().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            e.preventDefault();\n            _context2.next = 3;\n            return handleSkipToContent();\n          case 3:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }());\n  document.body.prepend(skipLink);\n  return function () {\n    skipLink.remove();\n    resetSkipToContent();\n  };\n};\n;// ./src/views/BaseView.js\n\n\n\n\n\n\n\n\n\nvar BaseView = function BaseView(htmlContent) {\n  var view = document.createElement(\'div\');\n  view.className = \'auth-form\';\n  view.innerHTML = htmlContent;\n\n  // Create a MutationObserver to detect when the view is removed\n  var observer = new MutationObserver(function (mutations) {\n    mutations.forEach(function (mutation) {\n      if (Array.from(mutation.removedNodes).includes(view)) {\n        cleanup();\n      }\n    });\n  });\n  var cleanup = function cleanup() {\n    resetSkipToContent();\n    observer.disconnect(); // Stop observing when cleaning up\n  };\n\n  // Start observing the view\'s parent for removal\n  if (view.parentNode) {\n    observer.observe(view.parentNode, {\n      childList: true\n    });\n  }\n  var getView = function getView() {\n    // When view is retrieved, ensure we observe its eventual parent\n    setTimeout(function () {\n      if (view.parentNode && !observer._isObserving) {\n        observer.observe(view.parentNode, {\n          childList: true\n        });\n        observer._isObserving = true;\n      }\n    }, 0);\n    return view;\n  };\n  var showError = function showError(message) {\n    var errorElement = view.querySelector(\'#error-message\') || view.querySelector(\'.error-message\');\n    if (errorElement) {\n      errorElement.textContent = message;\n      errorElement.style.display = message ? \'block\' : \'none\';\n    }\n  };\n  var showSuccess = function showSuccess(message) {\n    var successElement = view.querySelector(\'#success-message\') || view.querySelector(\'.success-message\');\n    if (successElement) {\n      successElement.textContent = message;\n      successElement.style.display = message ? \'block\' : \'none\';\n    }\n  };\n  return {\n    getView: getView,\n    showError: showError,\n    showSuccess: showSuccess,\n    cleanup: cleanup\n  };\n};\n;// ./src/views/auth/LoginView.js\n\n\n\nvar LoginView = function LoginView() {\n  var _document$querySelect;\n  (_document$querySelect = document.querySelector(\'header\')) === null || _document$querySelect === void 0 || _document$querySelect.remove();\n  var base = BaseView("\\n    <h2>Login</h2>\\n    <form id=\\"login-form\\">\\n      <div class=\\"form-group\\">\\n        <label for=\\"email\\">Email</label>\\n        <input type=\\"email\\" id=\\"email\\" name=\\"email\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"password\\">Password</label>\\n        <input type=\\"password\\" id=\\"password\\" name=\\"password\\" required minlength=\\"8\\">\\n      </div>\\n      <button type=\\"submit\\">Login</button>\\n    </form>\\n    <p>Don\'t have an account? <a href=\\"#/register\\">Register here</a></p>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n  ");\n  var bindLogin = function bindLogin(handler) {\n    var form = base.getView().querySelector(\'#login-form\');\n    var errorMessage = base.getView().querySelector(\'#error-message\');\n    form.addEventListener(\'submit\', /*#__PURE__*/function () {\n      var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(e) {\n        var email, password;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              email = form.email.value;\n              password = form.password.value;\n              errorMessage.style.display = \'none\';\n              _context.next = 6;\n              return handler(email, password);\n            case 6:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n  return {\n    getView: base.getView,\n    // Explicitly expose getView\n    showError: base.showError,\n    showSuccess: base.showSuccess,\n    bindLogin: bindLogin\n  };\n};\n;// ./src/views/auth/RegisterView.js\n\n\n\n\nvar RegisterView = function RegisterView() {\n  var base = BaseView("\\n    <h2>Register</h2>\\n    <form id=\\"register-form\\">\\n      <div class=\\"form-group\\">\\n        <label for=\\"name\\">Name</label>\\n        <input type=\\"text\\" id=\\"name\\" name=\\"name\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"email\\">Email</label>\\n        <input type=\\"email\\" id=\\"email\\" name=\\"email\\" required>\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"password\\">Password</label>\\n        <input type=\\"password\\" id=\\"password\\" name=\\"password\\" required minlength=\\"8\\">\\n      </div>\\n      <div class=\\"form-group\\">\\n        <label for=\\"confirm-password\\">Confirm Password</label>\\n        <input type=\\"password\\" id=\\"confirm-password\\" name=\\"confirm-password\\" required minlength=\\"8\\">\\n      </div>\\n      <button type=\\"submit\\">Register</button>\\n    </form>\\n    <p>Already have an account? <a href=\\"#/login\\">Login here</a></p>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n    <div id=\\"success-message\\" class=\\"success-message\\" style=\\"display: none;\\"></div>\\n  ");\n  var bindRegister = function bindRegister(handler) {\n    var form = base.getView().querySelector(\'#register-form\');\n    var errorMessage = base.getView().querySelector(\'#error-message\');\n    form.addEventListener(\'submit\', /*#__PURE__*/function () {\n      var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee(e) {\n        var name, email, password, confirmPassword;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              name = form.name.value;\n              email = form.email.value;\n              password = form.password.value;\n              confirmPassword = form[\'confirm-password\'].value;\n              errorMessage.style.display = \'none\';\n              if (!(password !== confirmPassword)) {\n                _context.next = 9;\n                break;\n              }\n              base.showError("Passwords don\'t match!");\n              return _context.abrupt("return");\n            case 9:\n              _context.next = 11;\n              return handler(name, email, password);\n            case 11:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee);\n      }));\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  };\n  return {\n    getView: base.getView,\n    showError: base.showError,\n    showSuccess: base.showSuccess,\n    bindRegister: bindRegister\n  };\n};\n;// ./src/views/stories/StoriesView.js\n\n\n\n\n\n\n\n\nvar StoriesView = function StoriesView() {\n  var view = document.createElement("main");\n  view.id = "main-content";\n  view.setAttribute("role", "main");\n  view.setAttribute("aria-label", "Stories list");\n  view.innerHTML = "\\n    <h1 id=\\"stories-heading\\">Stories</h1>\\n    <div class=\\"stories-grid\\" id=\\"stories-container\\" role=\\"list\\" aria-labelledby=\\"stories-heading\\"></div>\\n    <div id=\\"error-message\\" class=\\"error-message\\" style=\\"display: none;\\"></div>\\n    <div id=\\"loading-indicator\\" style=\\"display: none;\\">Loading stories...</div>\\n  ";\n  var displayStories = function displayStories(stories) {\n    var container = view.querySelector("#stories-container");\n    var loading = view.querySelector("#loading-indicator");\n    loading.style.display = "none";\n    container.innerHTML = "";\n    if (!stories || stories.length === 0) {\n      container.innerHTML = \'<p class="no-stories">No stories found</p>\';\n      return;\n    }\n\n    // Tambahkan fallback photoUrl jika kosong\n    stories.forEach(function (story) {\n      story.photoUrl = story.photoUrl || \'/assets/images/placeholder-offline.jpg\';\n      var storyElement = document.createElement("article");\n      storyElement.className = "story-card";\n      storyElement.innerHTML = "\\n      <img src=\\"".concat(story.photoUrl, "\\" alt=\\"").concat(story.name, "\'s story\\" class=\\"story-image\\">\\n      <div class=\\"story-content\\">\\n        <h3>").concat(story.name, "</h3>\\n        <p>").concat(story.description.substring(0, 100)).concat(story.description.length > 100 ? "..." : "", "</p>\\n        <p class=\\"story-date\\">").concat(new Date(story.createdAt).toLocaleDateString(), "</p>\\n        <a href=\\"#/stories/").concat(story.id, "\\" class=\\"read-more\\">Read more</a>\\n      </div>\\n    ");\n\n      // Make entire card clickable\n      storyElement.addEventListener("click", function () {\n        window.location.hash = "#/stories/".concat(story.id);\n      });\n\n      // Keyboard navigation\n      storyElement.addEventListener("keydown", function (e) {\n        if (e.key === "Enter") {\n          window.location.hash = "#/stories/".concat(story.id);\n        }\n      });\n      container.appendChild(storyElement);\n    });\n\n    // Focus management for the entire container\n    container.addEventListener("focusout", function (e) {\n      if (!e.relatedTarget || !container.contains(e.relatedTarget)) {\n        document.querySelectorAll(".story-card").forEach(function (card) {\n          card.classList.remove("card-focused");\n          card.querySelector(".read-more").tabIndex = -1;\n        });\n      }\n    });\n  };\n  var showError = function showError(message) {\n    var errorEl = view.querySelector("#error-message");\n    errorEl.textContent = message;\n    errorEl.style.display = "block";\n    view.querySelector("#loading-indicator").style.display = "none";\n  };\n  var showLoading = function showLoading() {\n    view.querySelector("#loading-indicator").style.display = "block";\n    view.querySelector("#error-message").style.display = "none";\n  };\n  var showOfflineWarning = function showOfflineWarning() {\n    var container = view.querySelector(\'#stories-container\');\n    var warning = document.createElement(\'div\');\n    warning.className = \'offline-warning\';\n    warning.innerHTML = "\\n    <i class=\\"fas fa-wifi-slash\\"></i>\\n    <span>Showing offline data. Some stories may not be up-to-date.</span>\\n  ";\n    container.prepend(warning);\n  };\n  var bindLoadStories = function bindLoadStories(handler) {\n    showLoading();\n    handler()["catch"](function (error) {\n      showError(error.message || "Failed to load stories");\n    });\n  };\n  return {\n    getView: function getView() {\n      return view;\n    },\n    displayStories: displayStories,\n    showError: showError,\n    bindLoadStories: bindLoadStories,\n    showLoading: showLoading,\n    showOfflineWarning: showOfflineWarning\n  };\n};\n// EXTERNAL MODULE: ./node_modules/leaflet/dist/leaflet.css\nvar leaflet = __webpack_require__(3093);\n// EXTERNAL MODULE: ./node_modules/leaflet/dist/leaflet-src.js\nvar leaflet_src = __webpack_require__(3481);\nvar leaflet_src_default = /*#__PURE__*/__webpack_require__.n(leaflet_src);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/leaflet.markercluster.js\nvar leaflet_markercluster = __webpack_require__(3866);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/MarkerCluster.css\nvar MarkerCluster = __webpack_require__(9500);\n// EXTERNAL MODULE: ./node_modules/leaflet.markercluster/dist/MarkerCluster.Default.css\nvar MarkerCluster_Default = __webpack_require__(1081);\n;// ./src/views/stories/DetailStoryView.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// Fix for default marker icons in Leaflet\ndelete (leaflet_src_default()).Icon.Default.prototype._getIconUrl;\nleaflet_src_default().Icon.Default.mergeOptions({\n  iconRetinaUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\',\n  iconUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\',\n  shadowUrl: \'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\'\n});\nvar DetailStoryView = function DetailStoryView() {\n  var view = document.createElement(\'main\');\n  view.id = \'main-content\';\n  view.innerHTML = "\\n    <div class=\\"detail-story\\">\\n      <div class=\\"story-image-container\\">\\n        <img id=\\"story-image\\" class=\\"detail-story-image\\" alt=\\"Story image\\">\\n        <div class=\\"story-meta\\">\\n          <div class=\\"author-info\\">\\n            <i class=\\"fas fa-user-circle\\"></i>\\n            <span id=\\"story-author\\"></span>\\n          </div>\\n          <div class=\\"date-info\\">\\n            <i class=\\"far fa-calendar-alt\\"></i>\\n            <span id=\\"story-date\\"></span>\\n          </div>\\n        </div>\\n      </div>\\n      \\n      <div class=\\"story-content\\">\\n        <h1 id=\\"story-title\\" class=\\"story-title\\"></h1>\\n        <p id=\\"story-description\\" class=\\"story-description\\"></p>\\n        \\n        <div class=\\"location-section\\">\\n          <h3><i class=\\"fas fa-map-marker-alt\\"></i> Lokasi</h3>\\n          <div id=\\"story-map-container\\" class=\\"detail-map-container\\">\\n            <div id=\\"story-map\\" class=\\"detail-map\\"></div>\\n            <div class=\\"map-controls\\">\\n              <button id=\\"satellite-view\\" class=\\"map-control-btn\\">\\n                <i class=\\"fas fa-satellite\\"></i>\\n              </button>\\n              <button id=\\"street-view\\" class=\\"map-control-btn\\">\\n                <i class=\\"fas fa-road\\"></i>\\n              </button>\\n            </div>\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n    \\n    <div id=\\"error-message\\" class=\\"error-message\\">\\n      <i class=\\"fas fa-exclamation-circle\\"></i>\\n      <span class=\\"error-text\\"></span>\\n    </div>\\n  ";\n  var mapInstance = null;\n  var markerCluster = null;\n  var baseLayers = {};\n  var currentLayer = null;\n  var prepareMapContainer = function prepareMapContainer() {\n    var container = view.querySelector(\'#story-map-container\');\n    var mapDiv = view.querySelector(\'#story-map\');\n\n    // Completely recreate the map container\n    if (mapDiv) {\n      var newMapDiv = document.createElement(\'div\');\n      newMapDiv.id = \'story-map\';\n      newMapDiv.className = \'detail-map\';\n      container.replaceChild(newMapDiv, mapDiv);\n    }\n\n    // Clean up existing map instances\n    if (mapInstance) {\n      mapInstance.remove();\n      mapInstance = null;\n    }\n    if (markerCluster) {\n      markerCluster.clearLayers();\n      markerCluster = null;\n    }\n  };\n  var initMap = function initMap(lat, lng) {\n    try {\n      var _document$getElementB, _document$getElementB2;\n      // Check if map container exists and isn\'t already initialized\n      var mapElement = view.querySelector(\'#story-map\');\n      if (!mapElement || mapElement._leaflet_id) {\n        return null;\n      }\n\n      // Create new map instance\n      mapInstance = leaflet_src_default().map(mapElement, {\n        zoomControl: false,\n        preferCanvas: true\n      }).setView([lat, lng], 13);\n\n      // Add zoom control\n      leaflet_src_default().control.zoom({\n        position: \'bottomright\'\n      }).addTo(mapInstance);\n\n      // Define base layers\n      baseLayers = {\n        "Street View": leaflet_src_default().tileLayer(\'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\', {\n          attribution: \'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors\',\n          maxZoom: 19\n        }),\n        "Satellite View": leaflet_src_default().tileLayer(\'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}\', {\n          attribution: \'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community\',\n          maxZoom: 19\n        })\n      };\n\n      // Add default layer\n      baseLayers["Street View"].addTo(mapInstance);\n      currentLayer = "Street View";\n\n      // Add layer control\n      leaflet_src_default().control.layers(baseLayers, null, {\n        position: \'topright\',\n        collapsed: false\n      }).addTo(mapInstance);\n\n      // Initialize marker cluster\n      markerCluster = leaflet_src_default().markerClusterGroup({\n        spiderfyOnMaxZoom: true,\n        showCoverageOnHover: false,\n        zoomToBoundsOnClick: true,\n        maxClusterRadius: 40\n      });\n\n      // Add custom control button events\n      (_document$getElementB = document.getElementById(\'satellite-view\')) === null || _document$getElementB === void 0 || _document$getElementB.addEventListener(\'click\', function () {\n        switchLayer("Satellite View");\n      });\n      (_document$getElementB2 = document.getElementById(\'street-view\')) === null || _document$getElementB2 === void 0 || _document$getElementB2.addEventListener(\'click\', function () {\n        switchLayer("Street View");\n      });\n      return mapInstance;\n    } catch (error) {\n      console.error(\'Map initialization error:\', error);\n      return null;\n    }\n  };\n  var switchLayer = function switchLayer(layerName) {\n    if (mapInstance && currentLayer !== layerName) {\n      mapInstance.removeLayer(baseLayers[currentLayer]);\n      baseLayers[layerName].addTo(mapInstance);\n      currentLayer = layerName;\n\n      // Update active button state\n      document.querySelectorAll(\'.map-control-btn\').forEach(function (btn) {\n        btn.classList.remove(\'active\');\n      });\n      var activeBtn = document.getElementById("".concat(layerName.toLowerCase().replace(\' \', \'-\'), "-view"));\n      if (activeBtn) activeBtn.classList.add(\'active\');\n    }\n  };\n  var displayStoryDetail = /*#__PURE__*/function () {\n    var _ref = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(story) {\n      return regenerator_default().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return startViewTransition(/*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n              var imageElement, mapContainer, map, marker;\n              return regenerator_default().wrap(function _callee$(_context) {\n                while (1) switch (_context.prev = _context.next) {\n                  case 0:\n                    // Prepare the view first\n                    imageElement = view.querySelector(\'#story-image\');\n                    imageElement.src = story.photoUrl;\n                    imageElement.alt = "Story by ".concat(story.name);\n                    view.querySelector(\'#story-title\').textContent = story.name;\n                    view.querySelector(\'#story-author\').textContent = story.name;\n                    view.querySelector(\'#story-description\').textContent = story.description;\n                    view.querySelector(\'#story-date\').textContent = new Date(story.createdAt).toLocaleString(\'id-ID\', {\n                      weekday: \'long\',\n                      year: \'numeric\',\n                      month: \'long\',\n                      day: \'numeric\',\n                      hour: \'2-digit\',\n                      minute: \'2-digit\'\n                    });\n\n                    // Handle map display\n                    mapContainer = view.querySelector(\'#story-map-container\');\n                    if (!(story.lat && story.lon)) {\n                      _context.next = 17;\n                      break;\n                    }\n                    mapContainer.style.display = \'block\';\n\n                    // Prepare the map container\n                    prepareMapContainer();\n\n                    // Wait for DOM to be ready\n                    _context.next = 13;\n                    return new Promise(function (resolve) {\n                      return requestAnimationFrame(resolve);\n                    });\n                  case 13:\n                    // Initialize map\n                    map = initMap(story.lat, story.lon);\n                    if (map) {\n                      // Add marker to the cluster\n                      marker = leaflet_src_default().marker([story.lat, story.lon]).bindPopup("\\n              <div class=\\"map-popup\\">\\n                <h4>".concat(story.name, "</h4>\\n                <p>").concat(story.description.substring(0, 100), "...</p>\\n                <small>").concat(new Date(story.createdAt).toLocaleDateString(), "</small>\\n              </div>\\n            "));\n                      markerCluster.addLayer(marker);\n                      map.addLayer(markerCluster);\n                      marker.openPopup();\n                    }\n                    _context.next = 18;\n                    break;\n                  case 17:\n                    mapContainer.style.display = \'none\';\n                  case 18:\n                  case "end":\n                    return _context.stop();\n                }\n              }, _callee);\n            })));\n          case 2:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2);\n    }));\n    return function displayStoryDetail(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n  var showError = function showError(message) {\n    var errorElement = view.querySelector(\'#error-message\');\n    var errorText = errorElement.querySelector(\'.error-text\');\n    errorText.textContent = message;\n    errorElement.style.display = \'flex\';\n\n    // Animation for error message\n    errorElement.animate([{\n      opacity: 0,\n      transform: \'translateY(-10px)\'\n    }, {\n      opacity: 1,\n      transform: \'translateY(0)\'\n    }], {\n      duration: 300,\n      easing: \'ease-out\'\n    });\n  };\n  var cleanup = function cleanup() {\n    if (mapInstance) {\n      mapInstance.remove();\n      mapInstance = null;\n    }\n    if (markerCluster) {\n      markerCluster.clearLayers();\n      markerCluster = null;\n    }\n  };\n  return {\n    getView: function getView() {\n      return view;\n    },\n    displayStoryDetail: displayStoryDetail,\n    showError: showError,\n    cleanup: cleanup,\n    prepareMapContainer: prepareMapContainer\n  };\n};\n// EXTERNAL MODULE: ./node_modules/@babel/runtime/helpers/esm/defineProperty.js\nvar defineProperty = __webpack_require__(4467);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.number.to-fixed.js\nvar es_number_to_fixed = __webpack_require__(9868);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.parse-float.js\nvar es_parse_float = __webpack_require__(8459);\n// EXTERNAL MODULE: ./node_modules/core-js/modules/es.string.trim.js\nvar es_string_trim = __webpack_require__(2762);\n;// ./src/views/stories/AddStoryView.js\n\n\nfunction AddStoryView_ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction AddStoryView_objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? AddStoryView_ownKeys(Object(t), !0).forEach(function (r) { (0,defineProperty/* default */.A)(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : AddStoryView_ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n // adjust the path if needed\n\nvar AddStoryView = function AddStoryView() {\n  var view = document.createElement("main");\n  view.id = "main-content";\n  view.setAttribute("role", "main");\n  view.setAttribute("aria-label", "Add new story form");\n  view.innerHTML = "\\n\\n    <div class=\\"add-story-form\\">\\n    <h2>Add New Story</h2> \\n    <div class=\\"notification-permission-info\\" style=\\"display: none;\\">\\n      <p>We\'d like to show notifications when you add stories. This helps you keep track of your contributions.</p>\\n      <button type=\\"button\\" id=\\"enable-notifications\\" class=\\"btn\\">Enable Notifications</button>\\n    </div>\\n      <form id=\\"story-form\\">\\n        <div class=\\"form-group\\">\\n          <label for=\\"description\\">Description</label>\\n          <textarea id=\\"description\\" name=\\"description\\" rows=\\"4\\" required></textarea>\\n        </div>\\n        \\n        <div class=\\"form-group camera-container\\">\\n          <label>Photo</label>\\n          <div class=\\"preview-container\\">\\n            <video id=\\"camera-preview\\" class=\\"media-preview\\" autoplay playsinline></video>\\n            <img id=\\"photo-preview\\" class=\\"media-preview\\" style=\\"display:none; object-fit:contain;\\" alt=\\"Captured photo\\">\\n          </div>\\n          <div class=\\"camera-controls\\">\\n            <button type=\\"button\\" id=\\"start-camera\\" class=\\"btn camera-btn\\">Start Camera</button>\\n            <select id=\\"camera-select\\" class=\\"camera-select\\" style=\\"display:none;\\"></select>\\n            <button type=\\"button\\" id=\\"capture-btn\\" class=\\"btn capture-btn\\" style=\\"display:none;\\">Capture Photo</button>\\n            <button type=\\"button\\" id=\\"stop-camera\\" class=\\"btn stop-btn\\" style=\\"display:none;\\">Stop Camera</button>\\n            <button type=\\"button\\" id=\\"retake-btn\\" class=\\"btn retake-btn\\" style=\\"display:none;\\">Retake Photo</button>\\n          </div>\\n          <canvas id=\\"canvas\\" style=\\"display:none;\\"></canvas>\\n        </div>\\n        \\n        <div class=\\"form-group\\">\\n          <label>Location</label>\\n          <div id=\\"map\\" class=\\"map-container\\"></div>\\n          <button type=\\"button\\" id=\\"get-location\\" class=\\"btn location-btn\\">Use Current Location</button>\\n          <input type=\\"hidden\\" id=\\"lat\\" name=\\"lat\\">\\n          <input type=\\"hidden\\" id=\\"lng\\" name=\\"lng\\">\\n          <p id=\\"location-status\\" class=\\"location-status\\">No location selected</p>\\n        </div>\\n        \\n        <button type=\\"submit\\" class=\\"btn submit-btn\\">Submit Story</button>\\n      </form>\\n      <div id=\\"error-message\\" class=\\"error-message\\"></div>\\n      <div id=\\"success-message\\" class=\\"success-message\\"></div>\\n    </div>\\n  ";\n\n  // State\n  var stream = null;\n  var photoFile = null;\n  var map = null;\n  var availableCameras = [];\n  var mapMarker = null;\n  var isViewActive = true;\n\n  // DOM Elements\n  var cameraPreview = view.querySelector("#camera-preview");\n  var photoPreview = view.querySelector("#photo-preview");\n  var startCameraBtn = view.querySelector("#start-camera");\n  var cameraSelect = view.querySelector("#camera-select");\n  var captureBtn = view.querySelector("#capture-btn");\n  var stopCameraBtn = view.querySelector("#stop-camera");\n  var retakeBtn = view.querySelector("#retake-btn");\n  var canvas = view.querySelector("#canvas");\n  var mapContainer = view.querySelector("#map");\n  var locationStatus = view.querySelector("#location-status");\n  var checkNotificationPermission = function checkNotificationPermission() {\n    var notificationInfo = view.querySelector(".notification-permission-info");\n    var enableNotificationsBtn = view.querySelector("#enable-notifications");\n    if (Notification.permission === "default") {\n      notificationInfo.style.display = "block";\n      enableNotificationsBtn.addEventListener("click", /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n        var granted, token;\n        return regenerator_default().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return showNotificationPrompt();\n            case 3:\n              granted = _context.sent;\n              notificationInfo.style.display = granted ? "none" : "block";\n              if (!granted) {\n                _context.next = 10;\n                break;\n              }\n              token = AuthModel_namespaceObject["default"].getToken(); // Implement this in AuthModel.js if missing\n              _context.next = 9;\n              return subscribeUser(token);\n            case 9:\n              // this sends the push subscription to the API\n              showSuccess("Notifications enabled!");\n            case 10:\n              _context.next = 16;\n              break;\n            case 12:\n              _context.prev = 12;\n              _context.t0 = _context["catch"](0);\n              console.error("Error requesting notification permission:", _context.t0);\n              showError("Failed to enable notifications");\n            case 16:\n            case "end":\n              return _context.stop();\n          }\n        }, _callee, null, [[0, 12]]);\n      })));\n    } else {\n      notificationInfo.style.display = "none";\n    }\n  };\n  var initializeMap = function initializeMap() {\n    if (!map && mapContainer) {\n      map = L.map(mapContainer).setView([-6.2, 106.8], 13);\n      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {\n        attribution: "&copy; OpenStreetMap contributors"\n      }).addTo(map);\n      map.on("click", function (e) {\n        var _e$latlng = e.latlng,\n          lat = _e$latlng.lat,\n          lng = _e$latlng.lng;\n        updateLocation(lat, lng);\n        addMapMarker(lat, lng);\n        showSuccess("Location selected on map!");\n      });\n    }\n  };\n\n  // Add marker to map\n  var addMapMarker = function addMapMarker(lat, lng) {\n    if (mapMarker) {\n      map.removeLayer(mapMarker);\n    }\n    mapMarker = L.marker([lat, lng], {\n      draggable: true,\n      title: "Story Location"\n    }).addTo(map).bindPopup("Story location").openPopup();\n    mapMarker.on("dragend", function (e) {\n      var newPos = e.target.getLatLng();\n      updateLocation(newPos.lat, newPos.lng);\n    });\n  };\n\n  // Update location inputs and status\n  var updateLocation = function updateLocation(lat, lng) {\n    view.querySelector("#lat").value = lat;\n    view.querySelector("#lng").value = lng;\n    locationStatus.textContent = "Location set: ".concat(lat.toFixed(4), ", ").concat(lng.toFixed(4));\n    locationStatus.style.color = "#4CAF50";\n  };\n\n  // Message handlers\n  var showError = function showError(message) {\n    var errorElement = view.querySelector("#error-message");\n    errorElement.textContent = message;\n    errorElement.style.display = "block";\n    setTimeout(function () {\n      return errorElement.style.display = "none";\n    }, 5000);\n  };\n  var showSuccess = function showSuccess(message) {\n    var successElement = view.querySelector("#success-message");\n    successElement.textContent = message;\n    successElement.style.display = "block";\n    setTimeout(function () {\n      return successElement.style.display = "none";\n    }, 5000);\n  };\n\n  // Camera functions\n  var getCameraDevices = /*#__PURE__*/function () {\n    var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2() {\n      var devices;\n      return regenerator_default().wrap(function _callee2$(_context2) {\n        while (1) switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.prev = 0;\n            _context2.next = 3;\n            return navigator.mediaDevices.enumerateDevices();\n          case 3:\n            devices = _context2.sent;\n            return _context2.abrupt("return", devices.filter(function (device) {\n              return device.kind === "videoinput";\n            }));\n          case 7:\n            _context2.prev = 7;\n            _context2.t0 = _context2["catch"](0);\n            showError("Camera access error: ".concat(_context2.t0.message));\n            return _context2.abrupt("return", []);\n          case 11:\n          case "end":\n            return _context2.stop();\n        }\n      }, _callee2, null, [[0, 7]]);\n    }));\n    return function getCameraDevices() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n  var stopCamera = function stopCamera() {\n    stopCameraBtn.style.display = "none";\n    startCameraBtn.style.display = "inline-block";\n    if (stream) {\n      stream.getTracks().forEach(function (track) {\n        track.stop();\n        track.enabled = false;\n      });\n      stream = null;\n    }\n    cameraPreview.style.display = "none";\n    cameraPreview.srcObject = null;\n    captureBtn.style.display = "none";\n    cameraSelect.style.display = "none";\n  };\n  var _startCamera = /*#__PURE__*/function () {\n    var _ref3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n      var deviceId,\n        constraints,\n        _args3 = arguments;\n      return regenerator_default().wrap(function _callee3$(_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            deviceId = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : null;\n            if (isViewActive) {\n              _context3.next = 3;\n              break;\n            }\n            return _context3.abrupt("return");\n          case 3:\n            _context3.prev = 3;\n            stopCamera();\n            constraints = {\n              video: AddStoryView_objectSpread({\n                width: {\n                  ideal: 1280\n                },\n                height: {\n                  ideal: 720\n                }\n              }, deviceId && {\n                deviceId: {\n                  exact: deviceId\n                }\n              })\n            };\n            _context3.next = 8;\n            return navigator.mediaDevices.getUserMedia(constraints);\n          case 8:\n            stream = _context3.sent;\n            if (!(availableCameras.length === 0)) {\n              _context3.next = 14;\n              break;\n            }\n            _context3.next = 12;\n            return getCameraDevices();\n          case 12:\n            availableCameras = _context3.sent;\n            updateCameraSelect();\n          case 14:\n            cameraPreview.srcObject = stream;\n            cameraPreview.style.display = "block";\n            photoPreview.style.display = "none";\n            captureBtn.style.display = "inline-block";\n            stopCameraBtn.style.display = "inline-block";\n            startCameraBtn.style.display = "none";\n            retakeBtn.style.display = "none";\n            if (availableCameras.length > 1) {\n              cameraSelect.style.display = "inline-block";\n            }\n            _context3.next = 28;\n            break;\n          case 24:\n            _context3.prev = 24;\n            _context3.t0 = _context3["catch"](3);\n            showError("Camera error: ".concat(_context3.t0.message));\n            if (deviceId) {\n              _startCamera();\n            }\n          case 28:\n          case "end":\n            return _context3.stop();\n        }\n      }, _callee3, null, [[3, 24]]);\n    }));\n    return function startCamera() {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n  var updateCameraSelect = function updateCameraSelect() {\n    cameraSelect.innerHTML = "";\n    availableCameras.forEach(function (camera) {\n      var option = document.createElement("option");\n      option.value = camera.deviceId;\n      option.text = camera.label || "Camera ".concat(cameraSelect.length + 1);\n      cameraSelect.appendChild(option);\n    });\n    cameraSelect.addEventListener("change", function () {\n      _startCamera(cameraSelect.value);\n    });\n  };\n  var capturePhoto = function capturePhoto() {\n    try {\n      var video = cameraPreview;\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      var ctx = canvas.getContext("2d");\n      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\n      photoPreview.src = canvas.toDataURL("image/jpeg");\n      photoPreview.style.display = "block";\n      cameraPreview.style.display = "none";\n      canvas.toBlob(function (blob) {\n        photoFile = new File([blob], "story-photo.jpg", {\n          type: "image/jpeg",\n          lastModified: Date.now()\n        });\n      }, "image/jpeg", 0.85);\n      captureBtn.style.display = "none";\n      stopCameraBtn.style.display = "none";\n      cameraSelect.style.display = "none";\n      retakeBtn.style.display = "inline-block";\n      stopCamera();\n    } catch (error) {\n      showError("Capture failed: ".concat(error.message));\n    }\n  };\n  var retakePhoto = function retakePhoto() {\n    photoPreview.style.display = "none";\n    photoPreview.src = "";\n    photoFile = null;\n    _startCamera(cameraSelect.value || null);\n  };\n\n  // Clean up when view is destroyed\n  var cleanup = function cleanup() {\n    isViewActive = false;\n    stopCamera();\n    if (map) {\n      map.remove();\n      map = null;\n      mapMarker = null;\n    }\n\n    // Remove all event listeners\n    var safeRemoveListener = function safeRemoveListener(element, event, handler) {\n      if (element && handler) {\n        element.removeEventListener(event, handler);\n      }\n    };\n    safeRemoveListener(startCameraBtn, "click", _startCamera);\n    safeRemoveListener(stopCameraBtn, "click", stopCamera);\n    safeRemoveListener(captureBtn, "click", capturePhoto);\n    safeRemoveListener(retakeBtn, "click", retakePhoto);\n    safeRemoveListener(cameraSelect, "change", _startCamera);\n  };\n\n  // Initialize map when view is created\n  setTimeout(initializeMap, 100);\n\n  // Bind event handlers\n  var bindAddStory = function bindAddStory(handler) {\n    var form = view.querySelector("#story-form");\n    var getLocationBtn = view.querySelector("#get-location");\n    var formSubmitHandler = /*#__PURE__*/function () {\n      var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4(e) {\n        var description, data;\n        return regenerator_default().wrap(function _callee4$(_context4) {\n          while (1) switch (_context4.prev = _context4.next) {\n            case 0:\n              e.preventDefault();\n              if (photoFile) {\n                _context4.next = 4;\n                break;\n              }\n              showError("Please take a photo first");\n              return _context4.abrupt("return");\n            case 4:\n              description = form.description.value.trim();\n              if (description) {\n                _context4.next = 8;\n                break;\n              }\n              showError("Please enter a description");\n              return _context4.abrupt("return");\n            case 8:\n              if (!(!form.lat.value || !form.lng.value)) {\n                _context4.next = 11;\n                break;\n              }\n              showError("Please select a location");\n              return _context4.abrupt("return");\n            case 11:\n              data = {\n                description: description,\n                photo: photoFile,\n                lat: parseFloat(form.lat.value),\n                lon: parseFloat(form.lng.value)\n              };\n              _context4.prev = 12;\n              _context4.next = 15;\n              return handler(data);\n            case 15:\n              _context4.next = 20;\n              break;\n            case 17:\n              _context4.prev = 17;\n              _context4.t0 = _context4["catch"](12);\n              showError("Submission failed: ".concat(_context4.t0.message));\n            case 20:\n            case "end":\n              return _context4.stop();\n          }\n        }, _callee4, null, [[12, 17]]);\n      }));\n      return function formSubmitHandler(_x) {\n        return _ref4.apply(this, arguments);\n      };\n    }();\n    var getLocationHandler = function getLocationHandler() {\n      navigator.geolocation.getCurrentPosition(function (position) {\n        var lat = position.coords.latitude;\n        var lng = position.coords.longitude;\n        updateLocation(lat, lng);\n        addMapMarker(lat, lng);\n        if (map) {\n          map.setView([lat, lng], 15);\n        }\n        showSuccess("Current location obtained!");\n      }, function (error) {\n        showError("Location error: ".concat(error.message));\n      }, {\n        enableHighAccuracy: true,\n        timeout: 10000\n      });\n    };\n    startCameraBtn.addEventListener("click", _startCamera);\n    stopCameraBtn.addEventListener("click", stopCamera);\n    captureBtn.addEventListener("click", capturePhoto);\n    retakeBtn.addEventListener("click", retakePhoto);\n    getLocationBtn.addEventListener("click", getLocationHandler);\n    form.addEventListener("submit", formSubmitHandler);\n\n    // Add header navigation listener\n    window.addEventListener("header-navigation", stopCamera);\n  };\n  checkNotificationPermission();\n  return {\n    getView: function getView() {\n      return view;\n    },\n    bindAddStory: bindAddStory,\n    showError: showError,\n    showSuccess: showSuccess,\n    getMapContainer: function getMapContainer() {\n      return mapContainer;\n    },\n    cleanup: cleanup\n  };\n};\n;// ./src/utils/auth.js\nvar checkAuth = function checkAuth(authModel, router) {\n  if (!authModel.isAuthenticated()) {\n    router.navigateTo("/login");\n    return false;\n  }\n  return true;\n};\nvar checkGuest = function checkGuest(authModel, router) {\n  if (authModel.isAuthenticated()) {\n    router.navigateTo("/stories");\n    return false;\n  }\n  return true;\n};\n;// ./src/app.js\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\ninitializeSkipToContent();\nvar authModel = new AuthModel();\nvar storyModel = new StoryModel(authModel);\ninitializeSkipToContent();\nvar appRoot = document.getElementById("app");\nappRoot.appendChild(Header());\nvar deferredPrompt;\nwindow.addEventListener(\'beforeinstallprompt\', function (e) {\n  e.preventDefault();\n  deferredPrompt = e;\n  var installBtn = document.getElementById(\'install-button\');\n  if (installBtn) {\n    installBtn.style.display = \'inline-block\';\n    installBtn.addEventListener(\'click\', /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee() {\n      var choice;\n      return regenerator_default().wrap(function _callee$(_context) {\n        while (1) switch (_context.prev = _context.next) {\n          case 0:\n            installBtn.style.display = \'none\';\n            deferredPrompt.prompt();\n            _context.next = 4;\n            return deferredPrompt.userChoice;\n          case 4:\n            choice = _context.sent;\n            deferredPrompt = null;\n          case 6:\n          case "end":\n            return _context.stop();\n        }\n      }, _callee);\n    })));\n  }\n});\nvar _initMapWithRetry = /*#__PURE__*/function () {\n  var _ref2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee2(handler, containerId, lat, lng, zoom) {\n    var attempts,\n      container,\n      _args2 = arguments;\n    return regenerator_default().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          attempts = _args2.length > 5 && _args2[5] !== undefined ? _args2[5] : 0;\n          _context2.prev = 1;\n          container = document.getElementById(containerId);\n          if (!(!container && attempts < 3)) {\n            _context2.next = 7;\n            break;\n          }\n          _context2.next = 6;\n          return new Promise(function (resolve) {\n            return setTimeout(resolve, 100 * (attempts + 1));\n          });\n        case 6:\n          return _context2.abrupt("return", _initMapWithRetry(handler, containerId, lat, lng, zoom, attempts + 1));\n        case 7:\n          return _context2.abrupt("return", handler(containerId, lat, lng, zoom));\n        case 10:\n          _context2.prev = 10;\n          _context2.t0 = _context2["catch"](1);\n          return _context2.abrupt("return", null);\n        case 13:\n        case "end":\n          return _context2.stop();\n      }\n    }, _callee2, null, [[1, 10]]);\n  }));\n  return function initMapWithRetry(_x, _x2, _x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nwindow.addEventListener(\'logout\', function () {\n  authModel.logout();\n  updateAuthUI(false);\n  router.navigateTo(\'/login\');\n});\nvar routes = [{\n  path: \'/login\',\n  view: function () {\n    var _view = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee3() {\n      var view;\n      return regenerator_default().wrap(function _callee3$(_context3) {\n        while (1) switch (_context3.prev = _context3.next) {\n          case 0:\n            if (checkGuest(authModel, router)) {\n              _context3.next = 2;\n              break;\n            }\n            return _context3.abrupt("return", ErrorView().getView());\n          case 2:\n            view = LoginView();\n            new AuthPresenter(authModel, {\n              bindLogin: view.bindLogin,\n              showError: view.showError\n            }, router);\n            return _context3.abrupt("return", view.getView());\n          case 5:\n          case "end":\n            return _context3.stop();\n        }\n      }, _callee3);\n    }));\n    function view() {\n      return _view.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/register\',\n  view: function () {\n    var _view2 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee4() {\n      var view;\n      return regenerator_default().wrap(function _callee4$(_context4) {\n        while (1) switch (_context4.prev = _context4.next) {\n          case 0:\n            if (checkGuest(authModel, router)) {\n              _context4.next = 2;\n              break;\n            }\n            return _context4.abrupt("return", ErrorView().getView());\n          case 2:\n            view = RegisterView();\n            new AuthPresenter(authModel, {\n              bindRegister: view.bindRegister,\n              showError: view.showError,\n              showSuccess: view.showSuccess\n            }, router);\n            return _context4.abrupt("return", view.getView());\n          case 5:\n          case "end":\n            return _context4.stop();\n        }\n      }, _callee4);\n    }));\n    function view() {\n      return _view2.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/\',\n  view: function () {\n    var _view3 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee5() {\n      var view;\n      return regenerator_default().wrap(function _callee5$(_context5) {\n        while (1) switch (_context5.prev = _context5.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context5.next = 2;\n              break;\n            }\n            return _context5.abrupt("return", ErrorView().getView());\n          case 2:\n            view = StoriesView();\n            new StoryPresenter(storyModel, {\n              bindLoadStories: view.bindLoadStories,\n              displayStories: view.displayStories,\n              showError: view.showError\n            }, router);\n            return _context5.abrupt("return", view.getView());\n          case 5:\n          case "end":\n            return _context5.stop();\n        }\n      }, _callee5);\n    }));\n    function view() {\n      return _view3.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/stories\',\n  view: function () {\n    var _view4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee6() {\n      var view;\n      return regenerator_default().wrap(function _callee6$(_context6) {\n        while (1) switch (_context6.prev = _context6.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context6.next = 2;\n              break;\n            }\n            return _context6.abrupt("return", ErrorView().getView());\n          case 2:\n            view = StoriesView();\n            new StoryPresenter(storyModel, {\n              bindLoadStories: view.bindLoadStories,\n              displayStories: view.displayStories,\n              showError: view.showError\n            }, router);\n            return _context6.abrupt("return", view.getView());\n          case 5:\n          case "end":\n            return _context6.stop();\n        }\n      }, _callee6);\n    }));\n    function view() {\n      return _view4.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/stories/:id\',\n  view: function () {\n    var _view5 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee7(params) {\n      var view, id;\n      return regenerator_default().wrap(function _callee7$(_context7) {\n        while (1) switch (_context7.prev = _context7.next) {\n          case 0:\n            if (checkAuth(authModel, router)) {\n              _context7.next = 2;\n              break;\n            }\n            return _context7.abrupt("return", ErrorView());\n          case 2:\n            view = DetailStoryView();\n            id = params.id;\n            new StoryPresenter(storyModel, {\n              bindLoadStoryDetail: function bindLoadStoryDetail(handler) {\n                var mapContainer = view.getView().querySelector(\'#story-map-container\');\n                if (mapContainer) {\n                  mapContainer.innerHTML = \'<div id="story-map" class="detail-map"></div>\';\n                }\n                handler(id);\n              },\n              displayStoryDetail: function displayStoryDetail(story) {\n                view.displayStoryDetail(story);\n                if (story.lat && story.lon) {\n                  setTimeout(function () {\n                    var mapElement = view.getView().querySelector(\'#story-map\');\n                    if (!mapElement || !mapElement._leaflet_id) {\n                      try {\n                        var map = L.map(mapElement).setView([story.lat, story.lon], 13);\n                        L.tileLayer(\'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\', {\n                          attribution: \'&copy; OpenStreetMap contributors\'\n                        }).addTo(map);\n                        L.marker([story.lat, story.lon]).addTo(map).bindPopup("<b>".concat(story.name, "</b><br>").concat(story.description.substring(0, 50), "...")).openPopup();\n                      } catch (error) {}\n                    }\n                  }, 50);\n                }\n              },\n              showError: view.showError\n            }, router);\n            return _context7.abrupt("return", view.getView());\n          case 6:\n          case "end":\n            return _context7.stop();\n        }\n      }, _callee7);\n    }));\n    function view(_x6) {\n      return _view5.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/add-story\',\n  view: function () {\n    var _view6 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee0() {\n      var view, domNode, mapPresenter;\n      return regenerator_default().wrap(function _callee0$(_context0) {\n        while (1) switch (_context0.prev = _context0.next) {\n          case 0:\n            view = AddStoryView();\n            domNode = view.getView();\n            try {\n              mapPresenter = new MapPresenter({\n                bindInitMap: function () {\n                  var _bindInitMap = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee8(handler) {\n                    var result;\n                    return regenerator_default().wrap(function _callee8$(_context8) {\n                      while (1) switch (_context8.prev = _context8.next) {\n                        case 0:\n                          _context8.next = 2;\n                          return _initMapWithRetry(handler, \'map\', -6.2088, 106.8456, 12);\n                        case 2:\n                          result = _context8.sent;\n                          if (result !== null && result !== void 0 && result.map) {\n                            result.map.on(\'click\', function (e) {\n                              var _e$latlng = e.latlng,\n                                lat = _e$latlng.lat,\n                                lng = _e$latlng.lng;\n                              domNode.querySelector(\'#lat\').value = lat;\n                              domNode.querySelector(\'#lng\').value = lng;\n                              result.addMarker(lat, lng, \'Story location\');\n                            });\n                          }\n                          return _context8.abrupt("return", result === null || result === void 0 ? void 0 : result.map);\n                        case 5:\n                        case "end":\n                          return _context8.stop();\n                      }\n                    }, _callee8);\n                  }));\n                  function bindInitMap(_x7) {\n                    return _bindInitMap.apply(this, arguments);\n                  }\n                  return bindInitMap;\n                }(),\n                bindGetCurrentLocation: function bindGetCurrentLocation(handler) {\n                  var _domNode$querySelecto;\n                  (_domNode$querySelecto = domNode.querySelector(\'#get-location\')) === null || _domNode$querySelecto === void 0 || _domNode$querySelecto.addEventListener(\'click\', /*#__PURE__*/(0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee9() {\n                    var _mapPresenter$map, location;\n                    return regenerator_default().wrap(function _callee9$(_context9) {\n                      while (1) switch (_context9.prev = _context9.next) {\n                        case 0:\n                          _context9.prev = 0;\n                          _context9.next = 3;\n                          return handler();\n                        case 3:\n                          location = _context9.sent;\n                          domNode.querySelector(\'#lat\').value = location.lat;\n                          domNode.querySelector(\'#lng\').value = location.lng;\n                          mapPresenter.addMarker(location.lat, location.lng, \'Current location\');\n                          (_mapPresenter$map = mapPresenter.map) === null || _mapPresenter$map === void 0 || _mapPresenter$map.setView([location.lat, location.lng], 15);\n                          _context9.next = 13;\n                          break;\n                        case 10:\n                          _context9.prev = 10;\n                          _context9.t0 = _context9["catch"](0);\n                          view.showError(_context9.t0.message);\n                        case 13:\n                        case "end":\n                          return _context9.stop();\n                      }\n                    }, _callee9, null, [[0, 10]]);\n                  })));\n                }\n              });\n              new StoryPresenter(storyModel, {\n                bindAddStory: view.bindAddStory,\n                showError: view.showError,\n                showSuccess: view.showSuccess\n              }, router);\n            } catch (error) {\n              view.showError(\'Failed to initialize form\');\n            }\n            return _context0.abrupt("return", domNode);\n          case 4:\n          case "end":\n            return _context0.stop();\n        }\n      }, _callee0);\n    }));\n    function view() {\n      return _view6.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'/logout\',\n  view: function () {\n    var _view7 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee1() {\n      return regenerator_default().wrap(function _callee1$(_context1) {\n        while (1) switch (_context1.prev = _context1.next) {\n          case 0:\n            authModel.logout();\n            updateAuthUI(false);\n            router.navigateTo(\'/login\');\n            return _context1.abrupt("return", {\n              getView: function getView() {\n                return document.createElement(\'div\');\n              }\n            }.getView());\n          case 4:\n          case "end":\n            return _context1.stop();\n        }\n      }, _callee1);\n    }));\n    function view() {\n      return _view7.apply(this, arguments);\n    }\n    return view;\n  }()\n}, {\n  path: \'*\',\n  view: function view() {\n    return ErrorView().getView();\n  }\n}];\nvar router = new Router(routes);\nupdateAuthUI(authModel.isAuthenticated());\nif (\'serviceWorker\' in navigator) {\n  window.addEventListener(\'load\', function () {\n    navigator.serviceWorker.register(\'/sw.js\').then(/*#__PURE__*/function () {\n      var _ref4 = (0,asyncToGenerator/* default */.A)(/*#__PURE__*/regenerator_default().mark(function _callee10(registration) {\n        var permission;\n        return regenerator_default().wrap(function _callee10$(_context10) {\n          while (1) switch (_context10.prev = _context10.next) {\n            case 0:\n              if (!authModel.isAuthenticated()) {\n                _context10.next = 12;\n                break;\n              }\n              _context10.prev = 1;\n              _context10.next = 4;\n              return requestNotificationPermission();\n            case 4:\n              permission = _context10.sent;\n              if (!permission) {\n                _context10.next = 8;\n                break;\n              }\n              _context10.next = 8;\n              return subscribeUser(authModel.getToken());\n            case 8:\n              _context10.next = 12;\n              break;\n            case 10:\n              _context10.prev = 10;\n              _context10.t0 = _context10["catch"](1);\n            case 12:\n            case "end":\n              return _context10.stop();\n          }\n        }, _callee10, null, [[1, 10]]);\n      }));\n      return function (_x8) {\n        return _ref4.apply(this, arguments);\n      };\n    }())["catch"](function (error) {});\n  });\n  navigator.serviceWorker.addEventListener(\'message\', function (event) {\n    var _event$data;\n    if (((_event$data = event.data) === null || _event$data === void 0 ? void 0 : _event$data.type) === \'TRIGGER_SYNC\') {\n      if (window.storyPresenter && typeof window.storyPresenter.handleOnline === \'function\') {\n        window.storyPresenter.handleOnline();\n      }\n    }\n  });\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiNzQyNy5qcyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUNBOztBQWdCQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7QUMxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7O0FBRUE7QUFDQTs7Ozs7QUNkQTtBQUNBO0FBRUE7QUFJQTtBQUNBOztBQ1JBO0FBQ0E7QUFDQTtBQUVBO0FBUUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUNmQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFwRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF1RUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7O0FDdkhBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBTkE7QUFBQTtBQVFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBVkE7QUFBQTtBQUFBO0FBWUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFOQTtBQUFBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFWQTtBQUFBO0FBQUE7Ozs7Ozs7OztBQ2RBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBdEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF3QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBaEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBbUJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbEVBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFOQTtBQUFBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFWQTtBQUFBO0FBQUE7QUFZQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFOQTtBQUFBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFWQTtBQUFBO0FBQUE7QUFZQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBRkE7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFmQTtBQUFBO0FBQUE7QUFpQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFKQTtBQUFBO0FBTUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFSQTtBQUFBO0FBQUE7QUFVQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQU5BO0FBQUE7QUFRQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQWxCQTtBQUFBO0FBQUE7QUFvQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFIQTtBQUFBO0FBS0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFmQTtBQUFBO0FBQUE7QUFpQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFQQTtBQUFBO0FBU0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFYQTtBQUFBO0FBQUE7QUFhQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFQQTtBQUFBO0FBU0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFYQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3ZHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQW5CQTtBQUFBO0FBQUE7QUFxQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFoQkE7QUFBQTtBQUFBO0FBa0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWpCQTtBQUFBO0FBQUE7QUFtQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFoQkE7QUFBQTtBQUFBO0FBa0JBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBMUJBO0FBQUE7QUFBQTtBQTBCQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBYkE7QUFBQTtBQUFBO0FBZUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBWEE7QUFBQTtBQUFBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQ3hKQTtBQU9BO0FBT0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBeEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUEwQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFsQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQW9CQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUZBO0FBQUE7QUFJQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUE3QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQStCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBL0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBa0NBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFGQTtBQUFBO0FBQUE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFMQTtBQUFBO0FBT0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBdERBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUF3REE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFIQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFGQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDNU1BOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUNBQTtBQUNBO0FBS0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFaQTtBQUFBO0FBQUE7QUFjQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUFBO0FBSEE7QUFBQTtBQUFBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFUQTtBQUFBO0FBV0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFDQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUEzQ0E7QUFBQTtBQUFBO0FBNkNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBSEE7QUFBQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQXZCQTtBQUFBO0FBQUE7QUF5QkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUExQkE7QUFBQTtBQUFBO0FBNEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztBQ3pJQTtBQUNBO0FBTUE7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFLQTs7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQTVCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBOEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWRBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFnQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFiQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUN2RUE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBYkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFlQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBakJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFtQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXhCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBMEJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQWRBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFnQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBakJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFtQkE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQXhCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQTJCQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBN0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBZ0NBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7Ozs7Ozs7O0FDN09BO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBVEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQVdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQXRCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBd0JBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBWEE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFhQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBOzs7Ozs7Ozs7QUMzRkE7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBZEE7QUFBQTtBQUFBO0FBZ0JBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFZQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUNsRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O0FDN0RBO0FBRUE7QUFBQTtBQUNBO0FBRUE7QUFpQkE7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7O0FDMUNBO0FBRUE7QUFDQTtBQTBCQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7QUN6REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBT0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTs7QUFVQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQzNHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQTJDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFuREE7QUFBQTtBQUFBO0FBcURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FDbFFBO0FBSUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBOztBQThDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTs7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFSQTtBQUFBO0FBQUE7QUFVQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBdENBO0FBQUE7QUFBQTtBQXdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQS9CQTtBQUFBO0FBQUE7QUFpQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBOztBQ2haQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFYQTtBQUFBO0FBQUE7QUFhQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBTEE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUxBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFMQTtBQUFBO0FBQUE7QUFBQTtBQU1BO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBTEE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFuQ0E7QUFBQTtBQUFBO0FBQUE7QUFvQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFYQTtBQUFBO0FBQUE7QUFBQTtBQVlBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBN0NBO0FBQUE7QUFBQTtBQUFBO0FBOENBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBUEE7QUFBQTtBQUFBO0FBQUE7QUFRQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFHQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFFQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvY29tcG9uZW50cy9IZWFkZXIuanM/YWQ4ZSIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdXRpbHMvdmlldy10cmFuc2l0aW9uLmpzPzJkMGYiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL2NvbXBvbmVudHMvRm9vdGVyLmpzPzI3MGIiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ZpZXdzL0Vycm9yVmlldy5qcz81OTgzIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9yb3V0ZXIuanM/NDFjYiIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvc2VydmljZXMvYXV0aEFwaS5qcz8wMTkyIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9tb2RlbHMvQXV0aE1vZGVsLmpzPzc4NjciLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL2RhdGEvYXBpLmpzPzkwOWYiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL2RhdGEvZGF0YWJhc2UuanM/MzkyZiIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvbW9kZWxzL1N0b3J5TW9kZWwuanM/MDNkOCIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdXRpbHMvY29uZmlnLmpzPzAxZWEiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3V0aWxzL25vdGlmaWNhdGlvbi5qcz8yMWFjIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9wcmVzZW50ZXJzL0F1dGhQcmVzZW50ZXIuanM/NmM3OCIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvcHJlc2VudGVycy9TdG9yeVByZXNlbnRlci5qcz80MThmIiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9wcmVzZW50ZXJzL01hcFByZXNlbnRlci5qcz8zMzk4Iiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy91dGlscy9Ta2lwVG9Db250ZW50LmpzPzlhMmMiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ZpZXdzL0Jhc2VWaWV3LmpzPzc0ZGYiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ZpZXdzL2F1dGgvTG9naW5WaWV3LmpzPzFkNTciLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ZpZXdzL2F1dGgvUmVnaXN0ZXJWaWV3LmpzPzg2NTgiLCJ3ZWJwYWNrOi8vc3RvcnktYXBwLy4vc3JjL3ZpZXdzL3N0b3JpZXMvU3Rvcmllc1ZpZXcuanM/ZGIwZSIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdmlld3Mvc3Rvcmllcy9EZXRhaWxTdG9yeVZpZXcuanM/YmJhOCIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdmlld3Mvc3Rvcmllcy9BZGRTdG9yeVZpZXcuanM/NGUwZCIsIndlYnBhY2s6Ly9zdG9yeS1hcHAvLi9zcmMvdXRpbHMvYXV0aC5qcz81Zjg3Iiwid2VicGFjazovL3N0b3J5LWFwcC8uL3NyYy9hcHAuanM/MTExMiJdLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgY3VycmVudEF1dGhTdGF0ZSA9IGZhbHNlO1xyXG5cclxuZXhwb3J0IGNvbnN0IHVwZGF0ZUF1dGhVSSA9IChpc0xvZ2dlZEluKSA9PiB7XHJcbiAgY3VycmVudEF1dGhTdGF0ZSA9IGlzTG9nZ2VkSW47XHJcbiAgY29uc3QgbG9nb3V0TGkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImxvZ291dC1saVwiKTtcclxuICBpZiAobG9nb3V0TGkpIHtcclxuICAgIGxvZ291dExpLnN0eWxlLmRpc3BsYXkgPSBpc0xvZ2dlZEluID8gXCJibG9ja1wiIDogXCJub25lXCI7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IEhlYWRlciA9ICgpID0+IHtcclxuICBjb25zdCBoZWFkZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaGVhZGVyXCIpO1xyXG4gIGhlYWRlci5pbm5lckhUTUwgPSBgXHJcbiA8bmF2PlxyXG4gICAgICA8dWw+XHJcbiAgICAgICAgPGxpPjxhIGhyZWY9XCIjL3N0b3JpZXNcIiBkYXRhLW5hdmlnbz5TdG9yaWVzPC9hPjwvbGk+XHJcbiAgICAgICAgPGxpPjxhIGhyZWY9XCIjL2FkZC1zdG9yeVwiIGRhdGEtbmF2aWdvPkFkZCBTdG9yeTwvYT48L2xpPlxyXG4gICAgICAgIDxsaSBpZD1cImluc3RhbGwtbGlcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+XHJcbiAgPGEgaHJlZj1cIiNcIiBpZD1cImluc3RhbGwtYnV0dG9uXCIgY2xhc3M9XCJidG5cIiBkYXRhLW5hdmlnbz5JbnN0YWxsIEFwcDwvYT5cclxuPC9saT5cclxuPGxpIGlkPVwibG9nb3V0LWxpXCIgc3R5bGU9XCJkaXNwbGF5OiAke2N1cnJlbnRBdXRoU3RhdGUgPyBcImJsb2NrXCIgOiBcIm5vbmVcIn1cIj5cclxuICA8YSBocmVmPVwiI1wiIGlkPVwibG9nb3V0LWJ1dHRvblwiIGNsYXNzPVwiYnRuXCIgZGF0YS1uYXZpZ28+TG9nb3V0PC9hPlxyXG48L2xpPlxyXG5cclxuICAgICAgPC91bD5cclxuICAgIDwvbmF2PlxyXG4gIGA7XHJcblxyXG4gIC8vIExvZ291dCBoYW5kbGVyXHJcbiAgaGVhZGVyLnF1ZXJ5U2VsZWN0b3IoXCIjbG9nb3V0LWJ1dHRvblwiKT8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImxvZ291dFwiKSk7XHJcbiAgfSk7XHJcblxyXG4gIC8vIE5hdmlnYXRpb24gaGFuZGxlclxyXG4gIGNvbnN0IG5hdkxpbmtzID0gaGVhZGVyLnF1ZXJ5U2VsZWN0b3JBbGwoXCJhW2RhdGEtbmF2aWdvXVwiKTtcclxuICBuYXZMaW5rcy5mb3JFYWNoKChsaW5rKSA9PiB7XHJcbiAgICBsaW5rLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XHJcbiAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudChcImhlYWRlci1uYXZpZ2F0aW9uXCIpKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gaGVhZGVyO1xyXG59O1xyXG4iLCJleHBvcnQgY29uc3Qgc3RhcnRWaWV3VHJhbnNpdGlvbiA9IChjYWxsYmFjaykgPT4ge1xyXG4gIGlmICghZG9jdW1lbnQuc3RhcnRWaWV3VHJhbnNpdGlvbikge1xyXG4gICAgY2FsbGJhY2soKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcblxyXG4gIGRvY3VtZW50LnN0YXJ0Vmlld1RyYW5zaXRpb24oKCkgPT4ge1xyXG4gICAgY2FsbGJhY2soKTtcclxuICB9KTtcclxufTtcclxuXHJcbmRvY3VtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCd2aWV3LXRyYW5zaXRpb24tc3RhcnQnKSk7XHJcblxyXG4vLyBBcm91bmQgd2hlcmUgeW91ciB0cmFuc2l0aW9uIGNvbXBsZXRlc1xyXG5kb2N1bWVudC5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgndmlldy10cmFuc2l0aW9uLWVuZCcpKTsiLCJleHBvcnQgY29uc3QgRm9vdGVyID0gKCkgPT4ge1xyXG4gIGNvbnN0IGZvb3RlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJmb290ZXJcIik7XHJcblxyXG4gIGZvb3Rlci5pbm5lckhUTUwgPSBgXHJcbiAgICAgIDxwPiZjb3B5OyAke25ldyBEYXRlKCkuZ2V0RnVsbFllYXIoKX0gU3RvcnkgQXBwLiBBbGwgcmlnaHRzIHJlc2VydmVkLjwvcD5cclxuICAgIGA7XHJcblxyXG4gIHJldHVybiBmb290ZXI7XHJcbn07XHJcbiIsImV4cG9ydCBjb25zdCBFcnJvclZpZXcgPSAoKSA9PiB7XHJcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ21haW4nKTtcclxuICB2aWV3LmlkID0gJ21haW4tY29udGVudCc7XHJcbiAgXHJcbiAgdmlldy5pbm5lckhUTUwgPSBgXHJcbiAgICA8ZGl2IGNsYXNzPVwiZXJyb3ItbWVzc2FnZVwiPlxyXG4gICAgICA8aDE+NDA0IE5vdCBGb3VuZDwvaDE+XHJcbiAgICAgIDxwPlRoZSBwYWdlIHlvdSdyZSBsb29raW5nIGZvciBkb2Vzbid0IGV4aXN0LjwvcD5cclxuICAgICAgPGEgaHJlZj1cIiMvXCI+R28gdG8gSG9tZTwvYT5cclxuICAgIDwvZGl2PlxyXG4gIGA7XHJcbiAgXHJcbiAgcmV0dXJuIHtcclxuICAgIGdldFZpZXc6ICgpID0+IHZpZXdcclxuICB9O1xyXG59OyIsImltcG9ydCB7IHN0YXJ0Vmlld1RyYW5zaXRpb24gfSBmcm9tIFwiLi91dGlscy92aWV3LXRyYW5zaXRpb24uanNcIjtcclxuaW1wb3J0IHsgSGVhZGVyIH0gZnJvbSBcIi4vY29tcG9uZW50cy9IZWFkZXIuanNcIjtcclxuaW1wb3J0IHsgRm9vdGVyIH0gZnJvbSBcIi4vY29tcG9uZW50cy9Gb290ZXIuanNcIjtcclxuaW1wb3J0IHsgRXJyb3JWaWV3IH0gZnJvbSBcIi4vdmlld3MvRXJyb3JWaWV3LmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUm91dGVyIHtcclxuICBjb25zdHJ1Y3Rvcihyb3V0ZXMpIHtcclxuICAgIHRoaXMucm91dGVzID0gcm91dGVzO1xyXG4gICAgdGhpcy5yb290RWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXBwXCIpO1xyXG4gICAgdGhpcy5jdXJyZW50UHJlc2VudGVyID0gbnVsbDtcclxuICAgIHRoaXMuaW5pdCgpO1xyXG4gIH1cclxuXHJcbiAgaW5pdCgpIHtcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiaGFzaGNoYW5nZVwiLCAoKSA9PiB0aGlzLmhhbmRsZVJvdXRpbmcoKSk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgKCkgPT4gdGhpcy5oYW5kbGVSb3V0aW5nKCkpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlUm91dGluZygpIHtcclxuICAgIGNvbnN0IHVybCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoLnNsaWNlKDEpIHx8IFwiL1wiO1xyXG4gICAgbGV0IHBhcmFtcyA9IHt9O1xyXG4gICAgY29uc3Qgcm91dGUgPSB0aGlzLmZpbmRNYXRjaGluZ1JvdXRlKHVybCwgcGFyYW1zKSB8fCBcclxuICAgICAgICAgICAgICAgICB0aGlzLnJvdXRlcy5maW5kKChyKSA9PiByLnBhdGggPT09IFwiKlwiKTtcclxuXHJcbiAgICAvLyBDbGVhbiB1cCBwcmV2aW91cyB2aWV3XHJcbiAgICBpZiAodGhpcy5jdXJyZW50UHJlc2VudGVyPy5jbGVhbnVwKSB7XHJcbiAgICAgIHRoaXMuY3VycmVudFByZXNlbnRlci5jbGVhbnVwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgYXdhaXQgc3RhcnRWaWV3VHJhbnNpdGlvbihhc3luYyAoKSA9PiB7XHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgdGhpcy5yb290RWxlbS5pbm5lckhUTUwgPSBcIlwiO1xyXG5cclxuICAgICAgICAvLyBBZGQgaGVhZGVyIGlmIGF1dGhlbnRpY2F0ZWRcclxuICAgICAgICBpZiAoIVtcIi9sb2dpblwiLCBcIi9yZWdpc3RlclwiXS5pbmNsdWRlcyh1cmwpKSB7XHJcbiAgICAgICAgICBjb25zdCBoZWFkZXIgPSBIZWFkZXIoKTtcclxuICAgICAgICAgIGNvbnN0IGhlYWRlckVsZW1lbnQgPSBoZWFkZXIuZ2V0Vmlldz8uKCkgfHwgaGVhZGVyO1xyXG4gICAgICAgICAgaWYgKGhlYWRlckVsZW1lbnQgaW5zdGFuY2VvZiBOb2RlKSB7XHJcbiAgICAgICAgICAgIHRoaXMucm9vdEVsZW0uYXBwZW5kQ2hpbGQoaGVhZGVyRWxlbWVudCk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBMb2FkIHZpZXdcclxuICAgICAgICBjb25zdCB2aWV3ID0gYXdhaXQgcm91dGUudmlldyhwYXJhbXMpO1xyXG4gICAgICAgIGNvbnN0IHZpZXdFbGVtZW50ID0gdmlldy5nZXRWaWV3Py4oKSB8fCB2aWV3O1xyXG5cclxuICAgICAgICBpZiAoISh2aWV3RWxlbWVudCBpbnN0YW5jZW9mIE5vZGUpKSB7XHJcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJWaWV3IGlzIG5vdCBhIHZhbGlkIERPTSBub2RlXCIpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gRW5zdXJlIG1haW4gY29udGVudCBleGlzdHNcclxuICAgICAgICBjb25zdCBtYWluQ29udGVudCA9IHZpZXdFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJ21haW4nKSB8fCB2aWV3RWxlbWVudDtcclxuICAgICAgICBpZiAoIW1haW5Db250ZW50LmlkKSB7XHJcbiAgICAgICAgICBtYWluQ29udGVudC5pZCA9IFwibWFpbi1jb250ZW50XCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLnJvb3RFbGVtLmFwcGVuZENoaWxkKHZpZXdFbGVtZW50KTtcclxuXHJcbiAgICAgICAgLy8gQWRkIGZvb3RlclxyXG4gICAgICAgIGNvbnN0IGZvb3RlciA9IEZvb3RlcigpO1xyXG4gICAgICAgIGNvbnN0IGZvb3RlckVsZW1lbnQgPSBmb290ZXIuZ2V0Vmlldz8uKCkgfHwgZm9vdGVyO1xyXG4gICAgICAgIGlmIChmb290ZXJFbGVtZW50IGluc3RhbmNlb2YgTm9kZSkge1xyXG4gICAgICAgICAgdGhpcy5yb290RWxlbS5hcHBlbmRDaGlsZChmb290ZXJFbGVtZW50KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFNldCBmb2N1cyB0byBmaXJzdCBmb2N1c2FibGUgZWxlbWVudFxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgY29uc3QgZmlyc3RGb2N1c2FibGUgPSB0aGlzLnJvb3RFbGVtLnF1ZXJ5U2VsZWN0b3IoXHJcbiAgICAgICAgICAgICdidXR0b24sIFtocmVmXSwgaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWEsIFt0YWJpbmRleF06bm90KFt0YWJpbmRleD1cIi0xXCJdKSdcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICBmaXJzdEZvY3VzYWJsZT8uZm9jdXMoKTtcclxuICAgICAgICB9LCAxMDApO1xyXG5cclxuICAgICAgICAvLyBTdG9yZSBwcmVzZW50ZXJcclxuICAgICAgICBpZiAocm91dGUucHJlc2VudGVyKSB7XHJcbiAgICAgICAgICB0aGlzLmN1cnJlbnRQcmVzZW50ZXIgPSByb3V0ZS5wcmVzZW50ZXI7XHJcbiAgICAgICAgICB0aGlzLmN1cnJlbnRQcmVzZW50ZXIuYWZ0ZXJSZW5kZXI/LigpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlJvdXRpbmcgZXJyb3I6XCIsIGVycm9yKTtcclxuICAgICAgICBjb25zdCBlcnJvclZpZXcgPSBFcnJvclZpZXcoKTtcclxuICAgICAgICB0aGlzLnJvb3RFbGVtLmlubmVySFRNTCA9IFwiXCI7XHJcbiAgICAgICAgdGhpcy5yb290RWxlbS5hcHBlbmRDaGlsZChlcnJvclZpZXcuZ2V0VmlldygpKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmaW5kTWF0Y2hpbmdSb3V0ZSh1cmwsIHBhcmFtcykge1xyXG4gICAgcmV0dXJuIHRoaXMucm91dGVzLmZpbmQoKHJvdXRlKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJvdXRlUGFydHMgPSByb3V0ZS5wYXRoLnNwbGl0KFwiL1wiKTtcclxuICAgICAgY29uc3QgdXJsUGFydHMgPSB1cmwuc3BsaXQoXCIvXCIpO1xyXG5cclxuICAgICAgaWYgKHJvdXRlUGFydHMubGVuZ3RoICE9PSB1cmxQYXJ0cy5sZW5ndGgpIHJldHVybiBmYWxzZTtcclxuXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcm91dGVQYXJ0cy5sZW5ndGg7IGkrKykge1xyXG4gICAgICAgIGNvbnN0IHJvdXRlUGFydCA9IHJvdXRlUGFydHNbaV07XHJcbiAgICAgICAgY29uc3QgdXJsUGFydCA9IHVybFBhcnRzW2ldO1xyXG5cclxuICAgICAgICBpZiAocm91dGVQYXJ0LnN0YXJ0c1dpdGgoXCI6XCIpKSB7XHJcbiAgICAgICAgICBjb25zdCBwYXJhbU5hbWUgPSByb3V0ZVBhcnQuc2xpY2UoMSk7XHJcbiAgICAgICAgICBwYXJhbXNbcGFyYW1OYW1lXSA9IHVybFBhcnQ7XHJcbiAgICAgICAgfSBlbHNlIGlmIChyb3V0ZVBhcnQgIT09IHVybFBhcnQpIHtcclxuICAgICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBuYXZpZ2F0ZVRvKHBhdGgpIHtcclxuICAgIGNvbnN0IGN1cnJlbnRQYXRoID0gd2luZG93LmxvY2F0aW9uLmhhc2guc2xpY2UoMSkgfHwgXCIvXCI7XHJcblxyXG4gICAgaWYgKGN1cnJlbnRQYXRoID09PSBcIi9hZGQtc3RvcnlcIiAmJiB0aGlzLmN1cnJlbnRQcmVzZW50ZXIpIHtcclxuICAgICAgdGhpcy5jdXJyZW50UHJlc2VudGVyLmNsZWFudXAoKTtcclxuICAgIH1cclxuXHJcbiAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9IHBhdGg7XHJcbiAgfVxyXG59IiwiY29uc3QgQVBJX0JBU0VfVVJMID0gJ2h0dHBzOi8vc3RvcnktYXBpLmRpY29kaW5nLmRldi92MSc7XHJcblxyXG5leHBvcnQgY29uc3QgbG9naW4gPSBhc3luYyAoZW1haWwsIHBhc3N3b3JkKSA9PiB7XHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L2xvZ2luYCwge1xyXG4gICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXHJcbiAgICB9LFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlbWFpbCwgcGFzc3dvcmQgfSksXHJcbiAgfSk7XHJcbiAgXHJcbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCByZWdpc3RlciA9IGFzeW5jIChuYW1lLCBlbWFpbCwgcGFzc3dvcmQpID0+IHtcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vcmVnaXN0ZXJgLCB7XHJcbiAgICBtZXRob2Q6ICdQT1NUJyxcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcclxuICAgIH0sXHJcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IG5hbWUsIGVtYWlsLCBwYXNzd29yZCB9KSxcclxuICB9KTtcclxuICBcclxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG59OyIsImltcG9ydCB7IGxvZ2luLCByZWdpc3RlciB9IGZyb20gJy4uL3NlcnZpY2VzL2F1dGhBcGknO1xyXG5leHBvcnQgY2xhc3MgQXV0aE1vZGVsIHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIHRoaXMudG9rZW4gPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInRva2VuXCIpIHx8IG51bGw7XHJcbiAgICB0aGlzLnVzZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwidXNlclwiKSkgfHwgbnVsbDtcclxuICB9XHJcblxyXG4gIGFzeW5jIGxvZ2luKGVtYWlsLCBwYXNzd29yZCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBsb2dpbihlbWFpbCwgcGFzc3dvcmQpO1xyXG5cclxuICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgIHRoaXMudG9rZW4gPSByZXNwb25zZS5sb2dpblJlc3VsdC50b2tlbjtcclxuICAgICAgICB0aGlzLnVzZXIgPSB7XHJcbiAgICAgICAgICB1c2VySWQ6IHJlc3BvbnNlLmxvZ2luUmVzdWx0LnVzZXJJZCxcclxuICAgICAgICAgIG5hbWU6IHJlc3BvbnNlLmxvZ2luUmVzdWx0Lm5hbWUsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ0b2tlblwiLCB0aGlzLnRva2VuKTtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInVzZXJcIiwgSlNPTi5zdHJpbmdpZnkodGhpcy51c2VyKSk7XHJcblxyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHVzZXI6IHRoaXMudXNlciB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogcmVzcG9uc2UubWVzc2FnZSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIkxvZ2luIGVycm9yOlwiLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkxvZ2luIGZhaWxlZC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIiB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgcmVnaXN0ZXIobmFtZSwgZW1haWwsIHBhc3N3b3JkKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHJlZ2lzdGVyKG5hbWUsIGVtYWlsLCBwYXNzd29yZCk7XHJcblxyXG4gICAgICBpZiAoIXJlc3BvbnNlLmVycm9yKSB7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgbWVzc2FnZTogcmVzcG9uc2UubWVzc2FnZSB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIlJlZ2lzdHJhdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiUmVnaXN0cmF0aW9uIGZhaWxlZC4gUGxlYXNlIHRyeSBhZ2Fpbi5cIixcclxuICAgICAgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGxvZ291dCgpIHtcclxuICAgIHRoaXMudG9rZW4gPSBudWxsO1xyXG4gICAgdGhpcy51c2VyID0gbnVsbDtcclxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKFwidG9rZW5cIik7XHJcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShcInVzZXJcIik7XHJcbiAgfVxyXG5cclxuICBpc0F1dGhlbnRpY2F0ZWQoKSB7XHJcbiAgICByZXR1cm4gISF0aGlzLnRva2VuO1xyXG4gIH1cclxuXHJcbiAgZ2V0VXNlcigpIHtcclxuICAgIHJldHVybiB0aGlzLnVzZXI7XHJcbiAgfVxyXG5cclxuICBnZXRUb2tlbigpIHtcclxuICAgIHJldHVybiB0aGlzLnRva2VuO1xyXG4gIH1cclxufVxyXG4iLCJjb25zdCBBUElfQkFTRV9VUkwgPSBcImh0dHBzOi8vc3RvcnktYXBpLmRpY29kaW5nLmRldi92MVwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IHJlZ2lzdGVyID0gYXN5bmMgKG5hbWUsIGVtYWlsLCBwYXNzd29yZCkgPT4ge1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9yZWdpc3RlcmAsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgZW1haWwsIHBhc3N3b3JkIH0pLFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGxvZ2luID0gYXN5bmMgKGVtYWlsLCBwYXNzd29yZCkgPT4ge1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9sb2dpbmAsIHtcclxuICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgZW1haWwsIHBhc3N3b3JkIH0pLFxyXG4gIH0pO1xyXG5cclxuICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldEFsbFN0b3JpZXMgPSBhc3luYyAodG9rZW4sIHBhZ2UsIHNpemUsIHdpdGhMb2NhdGlvbikgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vc3Rvcmllcz9wYWdlPSR7cGFnZX0mc2l6ZT0ke3NpemV9JmxvY2F0aW9uPSR7d2l0aExvY2F0aW9uID8gMSA6IDB9YCwge1xyXG4gICAgICBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpO1xyXG4gICAgY29uc29sZS5sb2coJ0FQSSBSZXNwb25zZTonLCBkYXRhKTsgLy8gRGVidWcgbG9nXHJcbiAgICBcclxuICAgIGlmICghcmVzcG9uc2Uub2spIHRocm93IG5ldyBFcnJvcihkYXRhLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBmZXRjaCcpO1xyXG4gICAgcmV0dXJuIGRhdGE7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0FQSSBFcnJvcjonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0U3RvcnlEZXRhaWwgPSBhc3luYyAoaWQsIHRva2VuKSA9PiB7XHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L3N0b3JpZXMvJHtpZH1gLCB7XHJcbiAgICBoZWFkZXJzOiB7XHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxyXG4gICAgfSxcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBhZGRTdG9yeSA9IGFzeW5jIChkYXRhLCB0b2tlbikgPT4ge1xyXG4gIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgZm9ybURhdGEuYXBwZW5kKFwiZGVzY3JpcHRpb25cIiwgZGF0YS5kZXNjcmlwdGlvbik7XHJcbiAgZm9ybURhdGEuYXBwZW5kKFwicGhvdG9cIiwgZGF0YS5waG90byk7XHJcbiAgaWYgKGRhdGEubGF0ICYmIGRhdGEubG9uKSB7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoXCJsYXRcIiwgZGF0YS5sYXQpO1xyXG4gICAgZm9ybURhdGEuYXBwZW5kKFwibG9uXCIsIGRhdGEubG9uKTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9zdG9yaWVzYCwge1xyXG4gICAgbWV0aG9kOiBcIlBPU1RcIixcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAsXHJcbiAgICB9LFxyXG4gICAgYm9keTogZm9ybURhdGEsXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgYWRkU3RvcnlHdWVzdCA9IGFzeW5jIChkYXRhKSA9PiB7XHJcbiAgY29uc3QgZm9ybURhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICBmb3JtRGF0YS5hcHBlbmQoXCJkZXNjcmlwdGlvblwiLCBkYXRhLmRlc2NyaXB0aW9uKTtcclxuICBmb3JtRGF0YS5hcHBlbmQoXCJwaG90b1wiLCBkYXRhLnBob3RvKTtcclxuICBpZiAoZGF0YS5sYXQgJiYgZGF0YS5sb24pIHtcclxuICAgIGZvcm1EYXRhLmFwcGVuZChcImxhdFwiLCBkYXRhLmxhdCk7XHJcbiAgICBmb3JtRGF0YS5hcHBlbmQoXCJsb25cIiwgZGF0YS5sb24pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHtBUElfQkFTRV9VUkx9L3N0b3JpZXMvZ3Vlc3RgLCB7XHJcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgYm9keTogZm9ybURhdGEsXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3Qgc3Vic2NyaWJlVG9Ob3RpZmljYXRpb25zID0gYXN5bmMgKHN1YnNjcmlwdGlvbiwgdG9rZW4pID0+IHtcclxuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGAke0FQSV9CQVNFX1VSTH0vbm90aWZpY2F0aW9ucy9zdWJzY3JpYmVgLCB7XHJcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgaGVhZGVyczoge1xyXG4gICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcclxuICAgICAgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke3Rva2VufWAsXHJcbiAgICB9LFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoc3Vic2NyaXB0aW9uKSxcclxuICB9KTtcclxuXHJcbiAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCB1bnN1YnNjcmliZUZyb21Ob3RpZmljYXRpb25zID0gYXN5bmMgKGVuZHBvaW50LCB0b2tlbikgPT4ge1xyXG4gIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goYCR7QVBJX0JBU0VfVVJMfS9ub3RpZmljYXRpb25zL3N1YnNjcmliZWAsIHtcclxuICAgIG1ldGhvZDogXCJERUxFVEVcIixcclxuICAgIGhlYWRlcnM6IHtcclxuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXHJcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbn1gLFxyXG4gICAgfSxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgZW5kcG9pbnQgfSksXHJcbiAgfSk7XHJcblxyXG4gIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbn07XHJcbiIsImV4cG9ydCBjb25zdCBpbml0REIgPSAoKSA9PiB7XHJcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihcIlN0b3J5QXBwREJcIiwgMSk7XHJcblxyXG4gICAgcmVxdWVzdC5vbmVycm9yID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJEYXRhYmFzZSBlcnJvcjpcIiwgZXZlbnQudGFyZ2V0LmVycm9yKTtcclxuICAgICAgcmVqZWN0KFwiRGF0YWJhc2UgZXJyb3JcIik7XHJcbiAgICB9O1xyXG5cclxuICAgIHJlcXVlc3Qub251cGdyYWRlbmVlZGVkID0gKGV2ZW50KSA9PiB7XHJcbiAgICAgIGNvbnN0IGRiID0gZXZlbnQudGFyZ2V0LnJlc3VsdDtcclxuXHJcbiAgICAgIC8vIENyZWF0ZSBvYmplY3Qgc3RvcmUgZm9yIHN0b3JpZXNcclxuICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKFwic3Rvcmllc1wiKSkge1xyXG4gICAgICAgIGNvbnN0IHN0b3JpZXNTdG9yZSA9IGRiLmNyZWF0ZU9iamVjdFN0b3JlKFwic3Rvcmllc1wiLCB7IGtleVBhdGg6IFwiaWRcIiB9KTtcclxuICAgICAgICBzdG9yaWVzU3RvcmUuY3JlYXRlSW5kZXgoXCJjcmVhdGVkQXRcIiwgXCJjcmVhdGVkQXRcIiwgeyB1bmlxdWU6IGZhbHNlIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBDcmVhdGUgb2JqZWN0IHN0b3JlIGZvciB1c2VyIGRhdGFcclxuICAgICAgaWYgKCFkYi5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKFwidXNlclwiKSkge1xyXG4gICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKFwidXNlclwiLCB7IGtleVBhdGg6IFwiaWRcIiB9KTtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9IChldmVudCkgPT4ge1xyXG4gICAgICByZXNvbHZlKGV2ZW50LnRhcmdldC5yZXN1bHQpO1xyXG4gICAgfTtcclxuICB9KTtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBzYXZlU3RvcmllcyA9IGFzeW5jIChzdG9yaWVzKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XHJcbiAgICBjb25zdCB0cmFuc2FjdGlvbiA9IGRiLnRyYW5zYWN0aW9uKFwic3Rvcmllc1wiLCBcInJlYWR3cml0ZVwiKTtcclxuICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJzdG9yaWVzXCIpO1xyXG5cclxuICAgIHN0b3JpZXMuZm9yRWFjaCgoc3RvcnkpID0+IHtcclxuICAgICAgc3RvcmUucHV0KHN0b3J5KTtcclxuICAgIH0pO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICB0cmFuc2FjdGlvbi5vbmNvbXBsZXRlID0gKCkgPT4ge1xyXG4gICAgICAgIHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBzYXZlIHN0b3JpZXM6XCIsIGVycm9yKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0U3RvcmllcyA9IGFzeW5jICgpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGIgPSBhd2FpdCBpbml0REIoKTtcclxuICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oXCJzdG9yaWVzXCIsIFwicmVhZG9ubHlcIik7XHJcbiAgICBjb25zdCBzdG9yZSA9IHRyYW5zYWN0aW9uLm9iamVjdFN0b3JlKFwic3Rvcmllc1wiKTtcclxuICAgIGNvbnN0IHJlcXVlc3QgPSBzdG9yZS5nZXRBbGwoKTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZShyZXF1ZXN0LnJlc3VsdCB8fCBbXSk7XHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgc3RvcmllczpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBzYXZlVXNlckRhdGEgPSBhc3luYyAodXNlckRhdGEpID0+IHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgZGIgPSBhd2FpdCBpbml0REIoKTtcclxuICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gZGIudHJhbnNhY3Rpb24oXCJ1c2VyXCIsIFwicmVhZHdyaXRlXCIpO1xyXG4gICAgY29uc3Qgc3RvcmUgPSB0cmFuc2FjdGlvbi5vYmplY3RTdG9yZShcInVzZXJcIik7XHJcblxyXG4gICAgc3RvcmUucHV0KHsgaWQ6IFwiY3VycmVudFVzZXJcIiwgLi4udXNlckRhdGEgfSk7XHJcblxyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgIHRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSAoKSA9PiB7XHJcbiAgICAgICAgcmVzb2x2ZSh0cnVlKTtcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgdXNlciBkYXRhOlwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGdldFVzZXJEYXRhID0gYXN5bmMgKCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkYiA9IGF3YWl0IGluaXREQigpO1xyXG4gICAgY29uc3QgdHJhbnNhY3Rpb24gPSBkYi50cmFuc2FjdGlvbihcInVzZXJcIiwgXCJyZWFkb25seVwiKTtcclxuICAgIGNvbnN0IHN0b3JlID0gdHJhbnNhY3Rpb24ub2JqZWN0U3RvcmUoXCJ1c2VyXCIpO1xyXG4gICAgY29uc3QgcmVxdWVzdCA9IHN0b3JlLmdldChcImN1cnJlbnRVc2VyXCIpO1xyXG5cclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICByZXF1ZXN0Lm9uc3VjY2VzcyA9ICgpID0+IHtcclxuICAgICAgICByZXNvbHZlKHJlcXVlc3QucmVzdWx0IHx8IG51bGwpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gZ2V0IHVzZXIgZGF0YTpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG59O1xyXG5cclxubGV0IGlzV3JpdGluZyA9IGZhbHNlO1xyXG5cclxuZXhwb3J0IGNvbnN0IGFkZFN0b3J5T2ZmbGluZSA9IGFzeW5jIChzdG9yeSkgPT4ge1xyXG4gIGlmIChpc1dyaXRpbmcpIHtcclxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcclxuICAgIHJldHVybiBhZGRTdG9yeU9mZmxpbmUoc3RvcnkpOyAvLyBSZXRyeSByZWN1cnNpdmVcclxuICB9XHJcblxyXG4gIGlzV3JpdGluZyA9IHRydWU7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XHJcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwic3Rvcmllc1wiLCBcInJlYWR3cml0ZVwiKTtcclxuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJzdG9yaWVzXCIpO1xyXG4gICAgc3RvcmUucHV0KHN0b3J5KTtcclxuXHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHtcclxuICAgICAgdHgub25jb21wbGV0ZSA9ICgpID0+IHJlc29sdmUodHJ1ZSk7XHJcbiAgICAgIHR4Lm9uZXJyb3IgPSAoKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlRyYW5zYWN0aW9uIGZhaWxlZDpcIiwgdHguZXJyb3IpO1xyXG4gICAgICAgIHJlc29sdmUoZmFsc2UpO1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gc2F2ZSBzdG9yeSBvZmZsaW5lOlwiLCBlcnJvcik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfSBmaW5hbGx5IHtcclxuICAgIGlzV3JpdGluZyA9IGZhbHNlO1xyXG4gIH1cclxufTtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgZGVsZXRlU3RvcnlPZmZsaW5lID0gYXN5bmMgKGlkKSA9PiB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRiID0gYXdhaXQgaW5pdERCKCk7XHJcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKFwic3Rvcmllc1wiLCBcInJlYWR3cml0ZVwiKTtcclxuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoXCJzdG9yaWVzXCIpO1xyXG4gICAgc3RvcmUuZGVsZXRlKGlkKTtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgICB0eC5vbmNvbXBsZXRlID0gKCkgPT4gcmVzb2x2ZSh0cnVlKTtcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIGRlbGV0ZSBzdG9yeTpcIiwgZXJyb3IpO1xyXG4gICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRPZmZsaW5lU3RvcmllcyA9IGFzeW5jICgpID0+IHtcclxuICBjb25zdCBkYiA9IGF3YWl0IGluaXREQigpO1xyXG4gIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oXCJzdG9yaWVzXCIsIFwicmVhZG9ubHlcIik7XHJcbiAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZShcInN0b3JpZXNcIik7XHJcbiAgY29uc3QgcmVxdWVzdCA9IHN0b3JlLmdldEFsbCgpO1xyXG4gIFxyXG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xyXG4gICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XHJcbiAgICAgIHJlc29sdmUocmVxdWVzdC5yZXN1bHQuZmlsdGVyKHN0b3J5ID0+IHN0b3J5LmlzT2ZmbGluZSkpO1xyXG4gICAgfTtcclxuICB9KTtcclxufTsiLCJpbXBvcnQge1xyXG4gIGdldEFsbFN0b3JpZXMsXHJcbiAgZ2V0U3RvcnlEZXRhaWwsXHJcbiAgYWRkU3RvcnksXHJcbiAgYWRkU3RvcnlHdWVzdCxcclxufSBmcm9tIFwiLi4vZGF0YS9hcGkuanNcIjtcclxuXHJcbmltcG9ydCB7XHJcbiAgc2F2ZVN0b3JpZXMsXHJcbiAgZ2V0U3RvcmllcyxcclxuICBhZGRTdG9yeU9mZmxpbmUsXHJcbiAgZGVsZXRlU3RvcnlPZmZsaW5lLFxyXG59IGZyb20gXCIuLi9kYXRhL2RhdGFiYXNlLmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU3RvcnlNb2RlbCB7XHJcbiAgY29uc3RydWN0b3IoYXV0aE1vZGVsKSB7XHJcbiAgICB0aGlzLmF1dGhNb2RlbCA9IGF1dGhNb2RlbDtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldEFsbFN0b3JpZXMocGFnZSA9IDEsIHNpemUgPSAxMCwgd2l0aExvY2F0aW9uID0gZmFsc2UpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHRva2VuID0gdGhpcy5hdXRoTW9kZWwuZ2V0VG9rZW4oKTtcclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRBbGxTdG9yaWVzKHRva2VuLCBwYWdlLCBzaXplLCB3aXRoTG9jYXRpb24pO1xyXG5cclxuICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikge1xyXG4gICAgICAgIGF3YWl0IHNhdmVTdG9yaWVzKHJlc3BvbnNlLmxpc3RTdG9yeSk7XHJcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgc3RvcmllczogcmVzcG9uc2UubGlzdFN0b3J5IH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IG9mZmxpbmVTdG9yaWVzID0gYXdhaXQgZ2V0U3RvcmllcygpO1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgc3Rvcmllczogb2ZmbGluZVN0b3JpZXMsXHJcbiAgICAgICAgaXNPZmZsaW5lOiB0cnVlLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc3Qgb2ZmbGluZVN0b3JpZXMgPSBhd2FpdCBnZXRTdG9yaWVzKCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogISFvZmZsaW5lU3Rvcmllcy5sZW5ndGgsXHJcbiAgICAgICAgc3Rvcmllczogb2ZmbGluZVN0b3JpZXMgfHwgW10sXHJcbiAgICAgICAgaXNPZmZsaW5lOiB0cnVlLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgZ2V0U3RvcnlEZXRhaWwoaWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHRva2VuID0gdGhpcy5hdXRoTW9kZWwuZ2V0VG9rZW4oKTtcclxuICAgICAgaWYgKCF0b2tlbikgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIG1lc3NhZ2U6IFwiQXV0aGVudGljYXRpb24gcmVxdWlyZWRcIiB9O1xyXG5cclxuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRTdG9yeURldGFpbChpZCwgdG9rZW4pO1xyXG4gICAgICBpZiAoIXJlc3BvbnNlLmVycm9yKSByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzdG9yeTogcmVzcG9uc2Uuc3RvcnkgfTtcclxuXHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXHJcbiAgICAgICAgbWVzc2FnZTogcmVzcG9uc2UubWVzc2FnZSB8fCBcIkZhaWxlZCB0byBmZXRjaCBzdG9yeVwiLFxyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBtZXNzYWdlOiBlcnJvci5tZXNzYWdlIHx8IFwiTmV0d29yayBlcnJvciB3aGlsZSBmZXRjaGluZyBzdG9yeVwiLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgYWRkU3RvcnkoZGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmF1dGhNb2RlbC5nZXRUb2tlbigpO1xyXG4gICAgICBpZiAoIWRhdGE/LmRlc2NyaXB0aW9uIHx8ICFkYXRhPy5waG90bykge1xyXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBtZXNzYWdlOiBcIkRlc2NyaXB0aW9uIGFuZCBwaG90byBhcmUgcmVxdWlyZWRcIiB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCByZXNwb25zZSA9IHRva2VuIFxyXG4gICAgICAgID8gYXdhaXQgYWRkU3RvcnkoZGF0YSwgdG9rZW4pIFxyXG4gICAgICAgIDogYXdhaXQgYWRkU3RvcnlHdWVzdChkYXRhKTtcclxuXHJcbiAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgIG1lc3NhZ2U6IFwiU3RvcnkgYWRkZWQgc3VjY2Vzc2Z1bGx5XCIsXHJcbiAgICAgICAgICBkYXRhOiByZXNwb25zZSxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6IHJlc3BvbnNlLm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gYWRkIHN0b3J5XCIsXHJcbiAgICAgIH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgIG1lc3NhZ2U6IGVycm9yLm1lc3NhZ2UgfHwgXCJOZXR3b3JrIGVycm9yIHdoaWxlIGFkZGluZyBzdG9yeVwiLFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgYWRkU3RvcnlPZmZsaW5lKGRhdGEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN0b3J5SWQgPSBgb2ZmbGluZV8ke0RhdGUubm93KCl9XyR7TWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMCl9YDtcclxuICAgICAgbGV0IHBob3RvVXJsID0gJyc7XHJcbiAgICAgIGxldCBwaG90b0Jhc2U2NCA9ICcnO1xyXG4gICAgICBcclxuICAgICAgaWYgKGRhdGEucGhvdG8gaW5zdGFuY2VvZiBCbG9iIHx8IGRhdGEucGhvdG8gaW5zdGFuY2VvZiBGaWxlKSB7XHJcbiAgICAgICAgcGhvdG9CYXNlNjQgPSBhd2FpdCB0aGlzLnJlYWRGaWxlQXNCYXNlNjQoZGF0YS5waG90byk7XHJcbiAgICAgICAgcGhvdG9VcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGRhdGEucGhvdG8pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBzdG9yeSA9IHtcclxuICAgICAgICBpZDogc3RvcnlJZCxcclxuICAgICAgICBuYW1lOiBcIllvdSAoT2ZmbGluZSlcIixcclxuICAgICAgICBkZXNjcmlwdGlvbjogZGF0YS5kZXNjcmlwdGlvbixcclxuICAgICAgICBwaG90b1VybDogcGhvdG9VcmwgfHwgJy9hc3NldHMvaW1hZ2VzL3BsYWNlaG9sZGVyLW9mZmxpbmUuanBnJyxcclxuICAgICAgICBwaG90b0Jhc2U2NCxcclxuICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBpc09mZmxpbmU6IHRydWUsXHJcbiAgICAgICAgbGF0OiBkYXRhLmxhdCxcclxuICAgICAgICBsb246IGRhdGEubG9uLFxyXG4gICAgICAgIG9yaWdpbmFsUGhvdG86IGRhdGEucGhvdG9cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGF3YWl0IGFkZFN0b3J5T2ZmbGluZShzdG9yeSk7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIHN0b3J5IH07XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRmFpbGVkIHRvIHNhdmUgb2ZmbGluZSBzdG9yeTpcIiwgZXJyb3IpO1xyXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3IgfTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJlYWRGaWxlQXNCYXNlNjQoZmlsZSkge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHJlc29sdmUocmVhZGVyLnJlc3VsdCk7XHJcbiAgICAgIHJlYWRlci5vbmVycm9yID0gcmVqZWN0O1xyXG4gICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChmaWxlKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgc3luY09mZmxpbmVTdG9yaWVzKHN5bmNRdWV1ZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3Qgb2ZmbGluZVN0b3JpZXMgPSBhd2FpdCB0aGlzLmdldE9mZmxpbmVTdG9yaWVzKCk7XHJcbiAgICAgIGNvbnN0IHRva2VuID0gdGhpcy5hdXRoTW9kZWwuZ2V0VG9rZW4oKTtcclxuICAgICAgXHJcbiAgICAgIGlmICghdG9rZW4pIHtcclxuICAgICAgICBjb25zb2xlLmxvZygnTm8gYXV0aCB0b2tlbiAtIHNraXBwaW5nIHN5bmMnKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdBdXRoZW50aWNhdGlvbiByZXF1aXJlZCcgfTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gRmlsdGVyIHN0b3JpZXMgdGhhdCBhcmUgYm90aCBvZmZsaW5lIGFuZCBpbiB0aGUgc3luYyBxdWV1ZVxyXG4gICAgICBjb25zdCB0b1N5bmMgPSBvZmZsaW5lU3Rvcmllc1xyXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShhLmNyZWF0ZWRBdCkgLSBuZXcgRGF0ZShiLmNyZWF0ZWRBdCkpXHJcbiAgICAgICAgLmZpbHRlcihzdG9yeSA9PiBzeW5jUXVldWUuaGFzKHN0b3J5LmlkKSk7XHJcblxyXG4gICAgICBpZiAodG9TeW5jLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdObyBzdG9yaWVzIHRvIHN5bmMnKTtcclxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBzeW5jZWRJZHM6IFtdIH07XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IHN5bmNlZElkcyA9IFtdO1xyXG4gICAgICBcclxuICAgICAgZm9yIChjb25zdCBzdG9yeSBvZiB0b1N5bmMpIHtcclxuICAgICAgICB0cnkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ1N5bmNpbmcgc3Rvcnk6Jywgc3RvcnkuaWQpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICBjb25zdCBwaG90b0Jsb2IgPSBzdG9yeS5waG90b0Jhc2U2NCBcclxuICAgICAgICAgICAgPyBhd2FpdCB0aGlzLmJhc2U2NFRvQmxvYihzdG9yeS5waG90b0Jhc2U2NClcclxuICAgICAgICAgICAgOiBzdG9yeS5vcmlnaW5hbFBob3RvO1xyXG5cclxuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgYWRkU3Rvcnkoe1xyXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogc3RvcnkuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgICAgIHBob3RvOiBwaG90b0Jsb2IsXHJcbiAgICAgICAgICAgIGxhdDogc3RvcnkubGF0LFxyXG4gICAgICAgICAgICBsb246IHN0b3J5LmxvblxyXG4gICAgICAgICAgfSwgdG9rZW4pO1xyXG5cclxuICAgICAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHtcclxuICAgICAgICAgICAgYXdhaXQgZGVsZXRlU3RvcnlPZmZsaW5lKHN0b3J5LmlkKTtcclxuICAgICAgICAgICAgc3luY2VkSWRzLnB1c2goc3RvcnkuaWQpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gc3luYyAke3N0b3J5LmlkfTpgLCBlcnJvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHN5bmNlZElkcy5sZW5ndGggPiAwLFxyXG4gICAgICAgIHN5bmNlZElkc1xyXG4gICAgICB9O1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignU3luYyBlcnJvcjonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvciB9O1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgYmFzZTY0VG9CbG9iKGJhc2U2NCkge1xyXG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChiYXNlNjQpO1xyXG4gICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLmJsb2IoKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGdldE9mZmxpbmVTdG9yaWVzKCkge1xyXG4gICAgY29uc3QgYWxsU3RvcmllcyA9IGF3YWl0IGdldFN0b3JpZXMoKTtcclxuICAgIHJldHVybiBhbGxTdG9yaWVzLmZpbHRlcihzdG9yeSA9PiBzdG9yeS5pc09mZmxpbmUpO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgZGVsZXRlU3RvcnlPZmZsaW5lKGlkKSB7XHJcbiAgICByZXR1cm4gYXdhaXQgZGVsZXRlU3RvcnlPZmZsaW5lKGlkKTtcclxuICB9XHJcbn0iLCJleHBvcnQgY29uc3QgVkFQSURfUFVCTElDX0tFWSA9XHJcbiAgXCJCQ0NzMmVvbk1JLTZIMmN0dkZhV2ctVVlkRHYzODdWbm9fYnpVekFMcEI0NDJyMmxDbnNIbXRyeDhiaXlQaV9FLTFmU0dBQktfUXNfR2x2UG9KSnF4YmtcIjtcclxuIiwiaW1wb3J0IHsgVkFQSURfUFVCTElDX0tFWSB9IGZyb20gXCIuL2NvbmZpZy5qc1wiO1xyXG5pbXBvcnQge1xyXG4gIHN1YnNjcmliZVRvTm90aWZpY2F0aW9ucyxcclxuICB1bnN1YnNjcmliZUZyb21Ob3RpZmljYXRpb25zLFxyXG59IGZyb20gXCIuLi9kYXRhL2FwaS5qc1wiO1xyXG5cclxuZXhwb3J0IGNvbnN0IHJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uID0gYXN5bmMgKCkgPT4ge1xyXG4gIGlmICghKFwiTm90aWZpY2F0aW9uXCIgaW4gd2luZG93KSkge1xyXG4gICAgY29uc29sZS5sb2coXCJUaGlzIGJyb3dzZXIgZG9lcyBub3Qgc3VwcG9ydCBub3RpZmljYXRpb25zLlwiKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJncmFudGVkXCIpIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgcGVybWlzc2lvbiA9IGF3YWl0IE5vdGlmaWNhdGlvbi5yZXF1ZXN0UGVybWlzc2lvbigpO1xyXG4gIHJldHVybiBwZXJtaXNzaW9uID09PSBcImdyYW50ZWRcIjtcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBzdWJzY3JpYmVVc2VyID0gYXN5bmMgKHRva2VuKSA9PiB7XHJcbiAgaWYgKCEoXCJzZXJ2aWNlV29ya2VyXCIgaW4gbmF2aWdhdG9yKSkge1xyXG4gICAgY29uc29sZS5sb2coXCJTZXJ2aWNlIFdvcmtlciBub3Qgc3VwcG9ydGVkXCIpO1xyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgfVxyXG5cclxuICBjb25zdCByZWdpc3RyYXRpb24gPSBhd2FpdCBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWFkeTtcclxuICBsZXQgc3Vic2NyaXB0aW9uID0gYXdhaXQgcmVnaXN0cmF0aW9uLnB1c2hNYW5hZ2VyLmdldFN1YnNjcmlwdGlvbigpO1xyXG5cclxuICBpZiAoIXN1YnNjcmlwdGlvbikge1xyXG4gICAgdHJ5IHtcclxuICAgICAgc3Vic2NyaXB0aW9uID0gYXdhaXQgcmVnaXN0cmF0aW9uLnB1c2hNYW5hZ2VyLnN1YnNjcmliZSh7XHJcbiAgICAgICAgdXNlclZpc2libGVPbmx5OiB0cnVlLFxyXG4gICAgICAgIGFwcGxpY2F0aW9uU2VydmVyS2V5OiB1cmxCYXNlNjRUb1VpbnQ4QXJyYXkoVkFQSURfUFVCTElDX0tFWSksXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gU2VuZCBzdWJzY3JpcHRpb24gdG8gc2VydmVyXHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHN1YnNjcmliZVRvTm90aWZpY2F0aW9ucyhcclxuICAgICAgICB7XHJcbiAgICAgICAgICBlbmRwb2ludDogc3Vic2NyaXB0aW9uLmVuZHBvaW50LFxyXG4gICAgICAgICAga2V5czoge1xyXG4gICAgICAgICAgICBwMjU2ZGg6IGFycmF5QnVmZmVyVG9CYXNlNjQoc3Vic2NyaXB0aW9uLmdldEtleSgncDI1NmRoJykpLFxyXG4gICAgICAgICAgICBhdXRoOiBhcnJheUJ1ZmZlclRvQmFzZTY0KHN1YnNjcmlwdGlvbi5nZXRLZXkoJ2F1dGgnKSlcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0b2tlblxyXG4gICAgICApO1xyXG5cclxuICAgICAgaWYgKCFyZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXIgaXMgc3Vic2NyaWJlZC5cIik7XHJcbiAgICAgICAgcmV0dXJuIHN1YnNjcmlwdGlvbjtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwiU3Vic2NyaXB0aW9uIGZhaWxlZDpcIiwgcmVzdWx0Lm1lc3NhZ2UpO1xyXG4gICAgICAgIGF3YWl0IHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3Igc3Vic2NyaWJpbmcgdXNlcjpcIiwgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHJldHVybiBzdWJzY3JpcHRpb247XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgdW5zdWJzY3JpYmVVc2VyID0gYXN5bmMgKHRva2VuKSA9PiB7XHJcbiAgY29uc3QgcmVnaXN0cmF0aW9uID0gYXdhaXQgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHk7XHJcbiAgY29uc3Qgc3Vic2NyaXB0aW9uID0gYXdhaXQgcmVnaXN0cmF0aW9uLnB1c2hNYW5hZ2VyLmdldFN1YnNjcmlwdGlvbigpO1xyXG5cclxuICBpZiAoc3Vic2NyaXB0aW9uKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB1bnN1YnNjcmliZUZyb21Ob3RpZmljYXRpb25zKFxyXG4gICAgICAgIHN1YnNjcmlwdGlvbi5lbmRwb2ludCxcclxuICAgICAgICB0b2tlblxyXG4gICAgICApO1xyXG5cclxuICAgICAgaWYgKCFyZXN1bHQuZXJyb3IpIHtcclxuICAgICAgICBhd2FpdCBzdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIlVzZXIgaXMgdW5zdWJzY3JpYmVkLlwiKTtcclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdW5zdWJzY3JpYmluZyB1c2VyOlwiLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGZhbHNlO1xyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IHNob3dOb3RpZmljYXRpb25Qcm9tcHQgPSBhc3luYyAoY2FsbGJhY2spID0+IHtcclxuICBpZiAoIShcIk5vdGlmaWNhdGlvblwiIGluIHdpbmRvdykpIHtcclxuICAgIGNvbnNvbGUubG9nKFwiVGhpcyBicm93c2VyIGRvZXMgbm90IHN1cHBvcnQgbm90aWZpY2F0aW9ucy5cIik7XHJcbiAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKGZhbHNlKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcblxyXG4gIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJncmFudGVkXCIpIHtcclxuICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2sodHJ1ZSk7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJkZW5pZWRcIikge1xyXG4gICAgY29uc29sZS5sb2coXCJOb3RpZmljYXRpb24gcGVybWlzc2lvbiBoYXMgYmVlbiBkZW5pZWQuXCIpO1xyXG4gICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjayhmYWxzZSk7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvLyBPbmx5IHNob3cgb3VyIGN1c3RvbSBwcm9tcHQgaWYgaW4gZGVmYXVsdCBzdGF0ZVxyXG4gIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJkZWZhdWx0XCIpIHtcclxuICAgIC8vIFlvdSBjb3VsZCBzaG93IGEgY3VzdG9tIFVJIGhlcmUgZXhwbGFpbmluZyB3aHkgeW91IHdhbnQgbm90aWZpY2F0aW9uc1xyXG4gICAgLy8gRm9yIG5vdyB3ZSdsbCBqdXN0IHRyaWdnZXIgdGhlIGJyb3dzZXIncyBuYXRpdmUgcHJvbXB0XHJcbiAgICBjb25zdCBwZXJtaXNzaW9uID0gYXdhaXQgTm90aWZpY2F0aW9uLnJlcXVlc3RQZXJtaXNzaW9uKCk7XHJcbiAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKHBlcm1pc3Npb24gPT09IFwiZ3JhbnRlZFwiKTtcclxuICAgIHJldHVybiBwZXJtaXNzaW9uID09PSBcImdyYW50ZWRcIjtcclxuICB9XHJcbn07XHJcblxyXG5mdW5jdGlvbiB1cmxCYXNlNjRUb1VpbnQ4QXJyYXkoYmFzZTY0U3RyaW5nKSB7XHJcbiAgY29uc3QgcGFkZGluZyA9ICc9Jy5yZXBlYXQoKDQgLSAoYmFzZTY0U3RyaW5nLmxlbmd0aCAlIDQpKSAlIDQpO1xyXG4gIGNvbnN0IGJhc2U2NCA9IChiYXNlNjRTdHJpbmcgKyBwYWRkaW5nKS5yZXBsYWNlKC8tL2csICcrJykucmVwbGFjZSgvXy9nLCAnLycpO1xyXG4gIGNvbnN0IHJhd0RhdGEgPSBhdG9iKGJhc2U2NCk7XHJcbiAgY29uc3Qgb3V0cHV0QXJyYXkgPSBuZXcgVWludDhBcnJheShyYXdEYXRhLmxlbmd0aCk7XHJcblxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcmF3RGF0YS5sZW5ndGg7ICsraSkge1xyXG4gICAgb3V0cHV0QXJyYXlbaV0gPSByYXdEYXRhLmNoYXJDb2RlQXQoaSk7XHJcbiAgfVxyXG4gIHJldHVybiBvdXRwdXRBcnJheTtcclxufVxyXG5cclxuZnVuY3Rpb24gYXJyYXlCdWZmZXJUb0Jhc2U2NChidWZmZXIpIHtcclxuICBsZXQgYmluYXJ5ID0gJyc7XHJcbiAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShidWZmZXIpO1xyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgYnl0ZXMuYnl0ZUxlbmd0aDsgaSsrKSB7XHJcbiAgICBiaW5hcnkgKz0gU3RyaW5nLmZyb21DaGFyQ29kZShieXRlc1tpXSk7XHJcbiAgfVxyXG4gIHJldHVybiBidG9hKGJpbmFyeSk7XHJcbn0iLCJpbXBvcnQgeyB1cGRhdGVBdXRoVUkgfSBmcm9tIFwiLi4vY29tcG9uZW50cy9IZWFkZXIuanNcIjtcclxuaW1wb3J0IHsgXHJcbiAgc3Vic2NyaWJlVXNlciwgXHJcbiAgdW5zdWJzY3JpYmVVc2VyLFxyXG4gIHJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uIFxyXG59IGZyb20gXCIuLi91dGlscy9ub3RpZmljYXRpb24uanNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBBdXRoUHJlc2VudGVyIHtcclxuICBjb25zdHJ1Y3RvcihhdXRoTW9kZWwsIGF1dGhWaWV3LCByb3V0ZXIpIHtcclxuICAgIHRoaXMuYXV0aE1vZGVsID0gYXV0aE1vZGVsO1xyXG4gICAgdGhpcy5hdXRoVmlldyA9IGF1dGhWaWV3O1xyXG4gICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSBVSSBzdGF0ZVxyXG4gICAgdXBkYXRlQXV0aFVJKHRoaXMuYXV0aE1vZGVsLmlzQXV0aGVudGljYXRlZCgpKTtcclxuXHJcbiAgICBpZiAoYXV0aFZpZXcuYmluZExvZ2luKSB7XHJcbiAgICAgIGF1dGhWaWV3LmJpbmRMb2dpbih0aGlzLmhhbmRsZUxvZ2luLmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhdXRoVmlldy5iaW5kUmVnaXN0ZXIpIHtcclxuICAgICAgYXV0aFZpZXcuYmluZFJlZ2lzdGVyKHRoaXMuaGFuZGxlUmVnaXN0ZXIuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBoYW5kbGVMb2dpbihlbWFpbCwgcGFzc3dvcmQpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5hdXRoTW9kZWwubG9naW4oZW1haWwsIHBhc3N3b3JkKTtcclxuXHJcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgdXBkYXRlQXV0aFVJKHRydWUpOyAvLyBVcGRhdGUgVUkgc3RhdGUgaW1tZWRpYXRlbHlcclxuICAgICAgXHJcbiAgICAgIC8vIFN0YXJ0IGJvdGggb3BlcmF0aW9ucyBidXQgZG9uJ3QgYXdhaXQgbm90aWZpY2F0aW9uIHNldHVwXHJcbiAgICAgIGNvbnN0IG5vdGlmaWNhdGlvblByb21pc2UgPSAoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBwZXJtaXNzaW9uR3JhbnRlZCA9IGF3YWl0IHJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uKCk7XHJcbiAgICAgICAgICBpZiAocGVybWlzc2lvbkdyYW50ZWQpIGF3YWl0IHN1YnNjcmliZVVzZXIocmVzdWx0LnRva2VuKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIk5vdGlmaWNhdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkoKTtcclxuXHJcbiAgICAgIC8vIE5hdmlnYXRlIGltbWVkaWF0ZWx5IHdpdGhvdXQgd2FpdGluZyBmb3Igbm90aWZpY2F0aW9uc1xyXG4gICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvKFwiL3N0b3JpZXNcIik7XHJcbiAgICAgIFxyXG4gICAgICAvLyBMZXQgbm90aWZpY2F0aW9ucyBjb21wbGV0ZSBpbiBiYWNrZ3JvdW5kXHJcbiAgICAgIGF3YWl0IG5vdGlmaWNhdGlvblByb21pc2U7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICB0aGlzLmF1dGhWaWV3LnNob3dFcnJvcj8uKHJlc3VsdC5tZXNzYWdlKTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgdGhpcy5hdXRoVmlldy5zaG93RXJyb3I/LihlcnJvci5tZXNzYWdlKTtcclxuICB9XHJcbn1cclxuXHJcbiAgYXN5bmMgaGFuZGxlTG9nb3V0KCkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVW5zdWJzY3JpYmUgZnJvbSBub3RpZmljYXRpb25zIGJlZm9yZSBsb2dvdXRcclxuICAgICAgY29uc3QgdG9rZW4gPSB0aGlzLmF1dGhNb2RlbC5nZXRUb2tlbigpO1xyXG4gICAgICBpZiAodG9rZW4pIHtcclxuICAgICAgICBhd2FpdCB1bnN1YnNjcmliZVVzZXIodG9rZW4pO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgdW5zdWJzY3JpYmluZzpcIiwgZXJyb3IpO1xyXG4gICAgfSBmaW5hbGx5IHtcclxuICAgICAgdGhpcy5hdXRoTW9kZWwubG9nb3V0KCk7XHJcbiAgICAgIHVwZGF0ZUF1dGhVSShmYWxzZSk7XHJcbiAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlVG8oXCIvbG9naW5cIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBoYW5kbGVSZWdpc3RlcihuYW1lLCBlbWFpbCwgcGFzc3dvcmQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuYXV0aE1vZGVsLnJlZ2lzdGVyKG5hbWUsIGVtYWlsLCBwYXNzd29yZCk7XHJcblxyXG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcclxuICAgICAgICB0aGlzLmF1dGhWaWV3LnNob3dTdWNjZXNzPy4oXCJSZWdpc3RyYXRpb24gc3VjY2Vzc2Z1bC4gUGxlYXNlIGxvZ2luLlwiKTtcclxuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvKFwiL2xvZ2luXCIpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMuYXV0aFZpZXcuc2hvd0Vycm9yPy4ocmVzdWx0Lm1lc3NhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmF1dGhWaWV3LnNob3dFcnJvcj8uKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgfVxyXG4gIH1cclxufSIsImltcG9ydCB7IHNob3dOb3RpZmljYXRpb25Qcm9tcHQgfSBmcm9tIFwiLi4vdXRpbHMvbm90aWZpY2F0aW9uLmpzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgU3RvcnlQcmVzZW50ZXIge1xyXG4gIGNvbnN0cnVjdG9yKHN0b3J5TW9kZWwsIHN0b3J5Vmlldywgcm91dGVyKSB7XHJcbiAgICB0aGlzLnN0b3J5TW9kZWwgPSBzdG9yeU1vZGVsO1xyXG4gICAgdGhpcy5zdG9yeVZpZXcgPSBzdG9yeVZpZXc7XHJcbiAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjtcclxuICAgIHRoaXMuY3VycmVudFN0b3J5SWQgPSBudWxsO1xyXG4gICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgIHRoaXMubWFwSW5pdGlhbGl6ZWQgPSBmYWxzZTtcclxuXHJcbiAgICAvLyBTeW5jIG1hbmFnZW1lbnRcclxuICAgIHRoaXMuaXNTeW5jaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLnBlbmRpbmdTeW5jSWRzID0gbmV3IFNldCgpO1xyXG4gICAgdGhpcy5zeW5jUXVldWUgPSBuZXcgU2V0KCk7XHJcblxyXG4gICAgdGhpcy5pbml0aWFsaXplRXZlbnRCaW5kaW5ncygpO1xyXG4gICAgdGhpcy5pbml0aWFsaXplU3luY0hhbmRsZXJzKCk7XHJcbiAgICB0aGlzLnN0YXJ0U3luY01vbml0b3IoKTtcclxuICB9XHJcblxyXG4gIGluaXRpYWxpemVFdmVudEJpbmRpbmdzKCkge1xyXG4gICAgaWYgKHRoaXMuc3RvcnlWaWV3LmJpbmRMb2FkU3Rvcmllcykge1xyXG4gICAgICB0aGlzLnN0b3J5Vmlldy5iaW5kTG9hZFN0b3JpZXModGhpcy5oYW5kbGVMb2FkU3Rvcmllcy5iaW5kKHRoaXMpKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5zdG9yeVZpZXcuYmluZEFkZFN0b3J5KSB7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LmJpbmRBZGRTdG9yeSh0aGlzLmhhbmRsZUFkZFN0b3J5LmJpbmQodGhpcykpO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICh0aGlzLnN0b3J5Vmlldy5iaW5kTG9hZFN0b3J5RGV0YWlsKSB7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LmJpbmRMb2FkU3RvcnlEZXRhaWwodGhpcy5oYW5kbGVMb2FkU3RvcnlEZXRhaWwuYmluZCh0aGlzKSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBpbml0aWFsaXplU3luY0hhbmRsZXJzKCkge1xyXG4gICAgLy8gTG9hZCBleGlzdGluZyBvZmZsaW5lIHN0b3JpZXMgaW50byBxdWV1ZVxyXG4gICAgdGhpcy5sb2FkT2ZmbGluZVN0b3JpZXNJbnRvUXVldWUoKTtcclxuXHJcbiAgICAvLyBTZXQgdXAgZXZlbnQgbGlzdGVuZXJzXHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignb25saW5lJywgdGhpcy5oYW5kbGVDb25uZWN0aW9uQ2hhbmdlLmJpbmQodGhpcykpO1xyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgdGhpcy5oYW5kbGVGb2N1cy5iaW5kKHRoaXMpKTtcclxuICB9XHJcblxyXG4gIGFzeW5jIGxvYWRPZmZsaW5lU3Rvcmllc0ludG9RdWV1ZSgpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IG9mZmxpbmVTdG9yaWVzID0gYXdhaXQgdGhpcy5zdG9yeU1vZGVsLmdldE9mZmxpbmVTdG9yaWVzKCk7XHJcbiAgICAgIG9mZmxpbmVTdG9yaWVzLmZvckVhY2goc3RvcnkgPT4gdGhpcy5zeW5jUXVldWUuYWRkKHN0b3J5LmlkKSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdJbml0aWFsIHN5bmMgcXVldWU6JywgQXJyYXkuZnJvbSh0aGlzLnN5bmNRdWV1ZSkpO1xyXG4gICAgICBcclxuICAgICAgLy8gVHJpZ2dlciBzeW5jIGlmIHdlJ3JlIGFscmVhZHkgb25saW5lXHJcbiAgICAgIGlmIChuYXZpZ2F0b3Iub25MaW5lKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVPbmxpbmUoKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgb2ZmbGluZSBzdG9yaWVzOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGhhbmRsZUNvbm5lY3Rpb25DaGFuZ2UoKSB7XHJcbiAgICBpZiAobmF2aWdhdG9yLm9uTGluZSkge1xyXG4gICAgICBjb25zb2xlLmxvZygnQ29ubmVjdGlvbiByZXN0b3JlZCAtIHRyaWdnZXJpbmcgc3luYycpO1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaGFuZGxlT25saW5lKCksIDEwMDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgaGFuZGxlRm9jdXMoKSB7XHJcbiAgICBpZiAobmF2aWdhdG9yLm9uTGluZSAmJiB0aGlzLnN5bmNRdWV1ZS5zaXplID4gMCkge1xyXG4gICAgICBjb25zb2xlLmxvZygnV2luZG93IGZvY3VzZWQgLSBjaGVja2luZyBzeW5jJyk7XHJcbiAgICAgIHRoaXMuaGFuZGxlT25saW5lKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBzdGFydFN5bmNNb25pdG9yKCkge1xyXG4gICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xyXG4gICAgICBjb25zb2xlLmxvZygnU3luYyBNb25pdG9yOicsIHtcclxuICAgICAgICBpc1N5bmNpbmc6IHRoaXMuaXNTeW5jaW5nLFxyXG4gICAgICAgIHF1ZXVlU2l6ZTogdGhpcy5zeW5jUXVldWUuc2l6ZSxcclxuICAgICAgICBxdWV1ZUNvbnRlbnRzOiBBcnJheS5mcm9tKHRoaXMuc3luY1F1ZXVlKSxcclxuICAgICAgICBwZW5kaW5nU3luY3M6IEFycmF5LmZyb20odGhpcy5wZW5kaW5nU3luY0lkcylcclxuICAgICAgfSk7XHJcbiAgICB9LCAxMDAwMCk7XHJcbiAgfVxyXG5cclxuICBhc3luYyBoYW5kbGVMb2FkU3RvcmllcyhwYWdlID0gMSwgc2l6ZSA9IDEwKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnN0b3J5TW9kZWwuZ2V0QWxsU3RvcmllcyhwYWdlLCBzaXplKTtcclxuXHJcbiAgICAgIGlmIChyZXN1bHQuaXNPZmZsaW5lKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd09mZmxpbmVXYXJuaW5nPy4oKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuZGlzcGxheVN0b3JpZXM/LihyZXN1bHQuc3RvcmllcyB8fCBbXSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd0Vycm9yPy4ocmVzdWx0Lm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gbG9hZCBzdG9yaWVzXCIpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiTG9hZCBzdG9yaWVzIGVycm9yOlwiLCBlcnJvcik7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiRmFpbGVkIHRvIGxvYWQgc3Rvcmllcy4gUGxlYXNlIHRyeSBhZ2Fpbi5cIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBoYW5kbGVMb2FkU3RvcnlEZXRhaWwoaWQpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh0aGlzLmlzTG9hZGluZyB8fCB0aGlzLmN1cnJlbnRTdG9yeUlkID09PSBpZCkgcmV0dXJuO1xyXG5cclxuICAgICAgdGhpcy5pc0xvYWRpbmcgPSB0cnVlO1xyXG4gICAgICB0aGlzLmN1cnJlbnRTdG9yeUlkID0gaWQ7XHJcblxyXG4gICAgICB0aGlzLnN0b3J5Vmlldy5wcmVwYXJlTWFwQ29udGFpbmVyPy4oKTtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zdG9yeU1vZGVsLmdldFN0b3J5RGV0YWlsKGlkKTtcclxuXHJcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xyXG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUocmVzb2x2ZSkpO1xyXG4gICAgICAgIHRoaXMuc3RvcnlWaWV3LmRpc3BsYXlTdG9yeURldGFpbD8uKHJlc3VsdC5zdG9yeSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd0Vycm9yPy4ocmVzdWx0Lm1lc3NhZ2UgfHwgXCJTdG9yeSBub3QgZm91bmRcIik7XHJcbiAgICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVUbyhcIi9zdG9yaWVzXCIpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKFwiTG9hZCBzdG9yeSBkZXRhaWwgZXJyb3I6XCIsIGVycm9yKTtcclxuICAgICAgdGhpcy5zdG9yeVZpZXcuc2hvd0Vycm9yPy4oXCJGYWlsZWQgdG8gbG9hZCBzdG9yeSBkZXRhaWxzXCIpO1xyXG4gICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZVRvKFwiL3N0b3JpZXNcIik7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlQWRkU3RvcnkoZGF0YSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zdG9yeU1vZGVsLmFkZFN0b3J5KGRhdGEpO1xyXG5cclxuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVBZGRTdWNjZXNzKGRhdGEpO1xyXG4gICAgICB9IGVsc2UgaWYgKCFyZXN1bHQuc3VjY2VzcyAmJiAhbmF2aWdhdG9yLm9uTGluZSkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuaGFuZGxlT2ZmbGluZUFkZChkYXRhKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICB0aGlzLnN0b3J5Vmlldy5zaG93RXJyb3I/LihyZXN1bHQubWVzc2FnZSB8fCBcIkZhaWxlZCB0byBhZGQgc3RvcnlcIik7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMuaGFuZGxlQWRkRXJyb3IoZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlQWRkU3VjY2VzcyhkYXRhKSB7XHJcbiAgICB0aGlzLnN0b3J5Vmlldy5zaG93U3VjY2Vzcz8uKFwiU3RvcnkgYWRkZWQgc3VjY2Vzc2Z1bGx5IVwiKTtcclxuICAgIFxyXG4gICAgYXdhaXQgc2hvd05vdGlmaWNhdGlvblByb21wdChhc3luYyAoZ3JhbnRlZCkgPT4ge1xyXG4gICAgICBpZiAoZ3JhbnRlZCkge1xyXG4gICAgICAgIC8vIG5ldyBOb3RpZmljYXRpb24oXCJTdG9yeSBjcmVhdGVkIChMb2NhbClcIiwge1xyXG4gICAgICAgIC8vICAgYm9keTogYE5ldyBzdG9yeTogJHtkYXRhLmRlc2NyaXB0aW9uLnN1YnN0cmluZygwLCA1MCl9Li4uYCxcclxuICAgICAgICAvLyAgIGljb246IFwiL2Fzc2V0cy9pbWFnZXMvaWNvbi0xOTJ4MTkyLnBuZ1wiLFxyXG4gICAgICAgIC8vIH0pO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLmNsZWFudXAoKTtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICB0aGlzLmhhbmRsZUxvYWRTdG9yaWVzKCk7XHJcbiAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlVG8oXCIvc3Rvcmllc1wiKTtcclxuICAgIH0sIDE1MDApO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgaGFuZGxlT2ZmbGluZUFkZChkYXRhKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCBvZmZsaW5lUmVzdWx0ID0gYXdhaXQgdGhpcy5zdG9yeU1vZGVsLmFkZFN0b3J5T2ZmbGluZShkYXRhKTtcclxuICAgICAgdGhpcy5zeW5jUXVldWUuYWRkKG9mZmxpbmVSZXN1bHQuc3RvcnkuaWQpO1xyXG5cclxuICAgICAgYXdhaXQgc2hvd05vdGlmaWNhdGlvblByb21wdChhc3luYyAoZ3JhbnRlZCkgPT4ge1xyXG4gICAgICAgIGlmIChncmFudGVkKSB7XHJcbiAgICAgICAgICAvLyBuZXcgTm90aWZpY2F0aW9uKFwiU3RvcnkgU2F2ZWQgT2ZmbGluZSAoTG9jYWwpXCIsIHtcclxuICAgICAgICAgIC8vICAgYm9keTogXCJXaWxsIHVwbG9hZCB3aGVuIHlvdSdyZSBiYWNrIG9ubGluZVwiLFxyXG4gICAgICAgICAgLy8gICBpY29uOiBcIi9hc3NldHMvaW1hZ2VzL2ljb24tMTkyeDE5Mi5wbmdcIlxyXG4gICAgICAgICAgLy8gfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dTdWNjZXNzPy4oXCJTdG9yeSBzYXZlZCBvZmZsaW5lLiBXaWxsIHN5bmMgd2hlbiBvbmxpbmUhXCIpO1xyXG4gICAgICBcclxuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVMb2FkU3RvcmllcygpO1xyXG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlVG8oXCIvc3Rvcmllc1wiKTtcclxuICAgICAgfSwgMTUwMCk7XHJcbiAgICB9IGNhdGNoIChvZmZsaW5lRXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihcIk9mZmxpbmUgc2F2ZSBmYWlsZWQ6XCIsIG9mZmxpbmVFcnJvcik7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiRmFpbGVkIHRvIHNhdmUgc3Rvcnkgb2ZmbGluZS5cIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBoYW5kbGVBZGRFcnJvcihlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcihcIkFkZCBzdG9yeSBlcnJvcjpcIiwgZXJyb3IpO1xyXG4gICAgaWYgKCFuYXZpZ2F0b3Iub25MaW5lKSB7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiWW91J3JlIG9mZmxpbmUuIFBsZWFzZSBjb25uZWN0IHRvIHN1Ym1pdCBzdG9yaWVzLlwiKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHRoaXMuc3RvcnlWaWV3LnNob3dFcnJvcj8uKFwiRmFpbGVkIHRvIGFkZCBzdG9yeS4gUGxlYXNlIHRyeSBhZ2Fpbi5cIik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBoYW5kbGVPbmxpbmUoKSB7XHJcbiAgICBpZiAodGhpcy5pc1N5bmNpbmcgfHwgdGhpcy5zeW5jUXVldWUuc2l6ZSA9PT0gMCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnNvbGUubG9nKCdTdGFydGluZyBzeW5jIHdpdGggcXVldWU6JywgQXJyYXkuZnJvbSh0aGlzLnN5bmNRdWV1ZSkpO1xyXG4gICAgdGhpcy5pc1N5bmNpbmcgPSB0cnVlO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHN5bmNSZXN1bHQgPSBhd2FpdCB0aGlzLnN0b3J5TW9kZWwuc3luY09mZmxpbmVTdG9yaWVzKHRoaXMuc3luY1F1ZXVlKTtcclxuICAgICAgY29uc29sZS5sb2coJ1N5bmMgY29tcGxldGVkOicsIHN5bmNSZXN1bHQpO1xyXG5cclxuICAgICAgaWYgKHN5bmNSZXN1bHQuc3VjY2VzcyAmJiBzeW5jUmVzdWx0LnN5bmNlZElkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgc3luY1Jlc3VsdC5zeW5jZWRJZHMuZm9yRWFjaChpZCA9PiB7XHJcbiAgICAgICAgICB0aGlzLnN5bmNRdWV1ZS5kZWxldGUoaWQpO1xyXG4gICAgICAgICAgdGhpcy5wZW5kaW5nU3luY0lkcy5kZWxldGUoaWQpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICB0aGlzLnN0b3J5Vmlldy5zaG93U3VjY2Vzcz8uKGBTeW5jZWQgJHtzeW5jUmVzdWx0LnN5bmNlZElkcy5sZW5ndGh9IHN0b3JpZXMhYCk7XHJcbiAgICAgICAgdGhpcy5oYW5kbGVMb2FkU3RvcmllcygpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdTeW5jIGZhaWxlZDonLCBlcnJvcik7XHJcbiAgICB9IGZpbmFsbHkge1xyXG4gICAgICB0aGlzLmlzU3luY2luZyA9IGZhbHNlO1xyXG4gICAgICBcclxuICAgICAgLy8gUmV0cnkgaWYgdGhlcmUgYXJlIHJlbWFpbmluZyBzdG9yaWVzXHJcbiAgICAgIGlmICh0aGlzLnN5bmNRdWV1ZS5zaXplID4gMCkge1xyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5oYW5kbGVPbmxpbmUoKSwgNTAwMCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIGNsZWFudXAoKSB7XHJcbiAgICBpZiAodHlwZW9mIHRoaXMuc3RvcnlWaWV3LmNsZWFudXAgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICB0aGlzLnN0b3J5Vmlldy5jbGVhbnVwKCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5jdXJyZW50U3RvcnlJZCA9IG51bGw7XHJcbiAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xyXG4gIH1cclxufSIsImV4cG9ydCBjbGFzcyBNYXBQcmVzZW50ZXIge1xyXG4gIGNvbnN0cnVjdG9yKG1hcFZpZXcpIHtcclxuICAgIHRoaXMudmlldyA9IG1hcFZpZXc7XHJcbiAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbiA9IG51bGw7XHJcbiAgfVxyXG5cclxuICBhc3luYyBpbml0aWFsaXplTWFwKGNvbnRhaW5lcklkLCBvcHRpb25zID0ge30pIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IHsgbGF0ID0gMCwgbG5nID0gMCwgem9vbSA9IDEwIH0gPSBvcHRpb25zO1xyXG4gICAgICBhd2FpdCB0aGlzLnZpZXcuaW5pdE1hcChjb250YWluZXJJZCwgbGF0LCBsbmcsIHpvb20pO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ01hcCBpbml0aWFsaXphdGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhc3luYyBnZXRDdXJyZW50TG9jYXRpb24ob3B0aW9ucyA9IHt9KSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICBpZiAoIW5hdmlnYXRvci5nZW9sb2NhdGlvbikge1xyXG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJHZW9sb2NhdGlvbiBpcyBub3Qgc3VwcG9ydGVkIGJ5IHlvdXIgYnJvd3NlclwiKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKFxyXG4gICAgICAgIChwb3NpdGlvbikgPT4ge1xyXG4gICAgICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb24gPSB7XHJcbiAgICAgICAgICAgIGxhdDogcG9zaXRpb24uY29vcmRzLmxhdGl0dWRlLFxyXG4gICAgICAgICAgICBsbmc6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUsXHJcbiAgICAgICAgICAgIGFjY3VyYWN5OiBwb3NpdGlvbi5jb29yZHMuYWNjdXJhY3lcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgICByZXNvbHZlKHRoaXMuY3VycmVudFBvc2l0aW9uKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIChlcnJvcikgPT4ge1xyXG4gICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9wdGlvbnNcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgY2VudGVyVG9DdXJyZW50TG9jYXRpb24oem9vbSA9IDE1KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAoIXRoaXMuY3VycmVudFBvc2l0aW9uKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5nZXRDdXJyZW50TG9jYXRpb24oKTtcclxuICAgICAgfVxyXG4gICAgICB0aGlzLnZpZXcuc2V0Vmlldyh0aGlzLmN1cnJlbnRQb3NpdGlvbi5sYXQsIHRoaXMuY3VycmVudFBvc2l0aW9uLmxuZywgem9vbSk7XHJcbiAgICAgIHJldHVybiB0aGlzLmN1cnJlbnRQb3NpdGlvbjtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBjZW50ZXIgdG8gY3VycmVudCBsb2NhdGlvbjonLCBlcnJvcik7XHJcbiAgICAgIHRocm93IGVycm9yO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgYWRkTWFya2VyKGxhdCwgbG5nLCBwb3B1cENvbnRlbnQgPSBcIlwiLCBvcHRpb25zID0ge30pIHtcclxuICAgIHJldHVybiB0aGlzLnZpZXcuYWRkTWFya2VyKGxhdCwgbG5nLCBwb3B1cENvbnRlbnQsIG9wdGlvbnMpO1xyXG4gIH1cclxuXHJcbiAgYWRkQ3VycmVudExvY2F0aW9uTWFya2VyKHBvcHVwQ29udGVudCA9IFwiXCIpIHtcclxuICAgIGlmICghdGhpcy5jdXJyZW50UG9zaXRpb24pIHtcclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDdXJyZW50IGxvY2F0aW9uIG5vdCBhdmFpbGFibGUnKTtcclxuICAgIH1cclxuICAgIHJldHVybiB0aGlzLmFkZE1hcmtlcihcclxuICAgICAgdGhpcy5jdXJyZW50UG9zaXRpb24ubGF0LFxyXG4gICAgICB0aGlzLmN1cnJlbnRQb3NpdGlvbi5sbmcsXHJcbiAgICAgIHBvcHVwQ29udGVudCxcclxuICAgICAgeyB0aXRsZTogJ1lvdXIgTG9jYXRpb24nIH1cclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjbGVhck1hcmtlcnMoKSB7XHJcbiAgICB0aGlzLnZpZXcuY2xlYXJNYXJrZXJzKCk7XHJcbiAgfVxyXG5cclxuICBzZXRPbk1hcENsaWNrSGFuZGxlcihoYW5kbGVyKSB7XHJcbiAgICB0aGlzLnZpZXcub25NYXBDbGljaygoZSkgPT4ge1xyXG4gICAgICBoYW5kbGVyKGUubGF0bG5nLmxhdCwgZS5sYXRsbmcubG5nKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgY2xlYW51cCgpIHtcclxuICAgIHRoaXMudmlldy5yZW1vdmUoKTtcclxuICB9XHJcblxyXG4gIGhhbmRsZUxvY2F0aW9uU2VsZWN0aW9uKGxhdCwgbG5nKSB7XHJcbiAgdGhpcy5jbGVhck1hcmtlcnMoKTsgLy8gQ2xlYXIgZXhpc3RpbmcgbWFya2Vyc1xyXG4gIHRoaXMuYWRkTWFya2VyKGxhdCwgbG5nLCBcIlNlbGVjdGVkIExvY2F0aW9uXCIsIHtcclxuICAgIGRyYWdnYWJsZTogdHJ1ZSxcclxuICAgIGNvbG9yOiAncmVkJ1xyXG4gIH0pO1xyXG4gIHRoaXMudmlldy5zZXRWaWV3KGxhdCwgbG5nLCAxNSk7XHJcbn1cclxufSIsImxldCBjdXJyZW50U2tpcFRhcmdldCA9IG51bGw7XHJcblxyXG5leHBvcnQgY29uc3QgcmVzZXRTa2lwVG9Db250ZW50ID0gKCkgPT4ge1xyXG4gIGlmIChjdXJyZW50U2tpcFRhcmdldCkge1xyXG4gICAgY3VycmVudFNraXBUYXJnZXQuY2xhc3NMaXN0Py5yZW1vdmUoJ2ZvY3VzLXZpc2libGUnKTtcclxuICAgIGN1cnJlbnRTa2lwVGFyZ2V0LnJlbW92ZUF0dHJpYnV0ZSgndGFiaW5kZXgnKTtcclxuICAgIGN1cnJlbnRTa2lwVGFyZ2V0ID0gbnVsbDtcclxuICB9XHJcbn07XHJcblxyXG5jb25zdCBoYW5kbGVTa2lwVG9Db250ZW50ID0gYXN5bmMgKCkgPT4ge1xyXG4gIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gcmVxdWVzdEFuaW1hdGlvbkZyYW1lKHJlc29sdmUpKTtcclxuICBcclxuICBjb25zdCBtYWluQ29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluLWNvbnRlbnQnKTtcclxuICBpZiAoIW1haW5Db250ZW50KSByZXR1cm47XHJcblxyXG4gIHJlc2V0U2tpcFRvQ29udGVudCgpO1xyXG4gIFxyXG4gIG1haW5Db250ZW50LmNsYXNzTGlzdC5hZGQoJ2ZvY3VzLXZpc2libGUnKTtcclxuICBtYWluQ29udGVudC5mb2N1cyh7IHByZXZlbnRTY3JvbGw6IHRydWUgfSk7XHJcbiAgXHJcbiAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICBtYWluQ29udGVudC5jbGFzc0xpc3QucmVtb3ZlKCdmb2N1cy12aXNpYmxlJyk7XHJcbiAgfSwgMjAwMCk7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgaW5pdGlhbGl6ZVNraXBUb0NvbnRlbnQgPSAoKSA9PiB7XHJcbiAgY29uc3QgZXhpc3RpbmdTa2lwTGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5za2lwLWxpbmsnKTtcclxuICBpZiAoZXhpc3RpbmdTa2lwTGluaykgZXhpc3RpbmdTa2lwTGluay5yZW1vdmUoKTtcclxuXHJcbiAgY29uc3Qgc2tpcExpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgc2tpcExpbmsuaHJlZiA9ICcjbWFpbi1jb250ZW50JztcclxuICBza2lwTGluay5jbGFzc05hbWUgPSAnc2tpcC1saW5rJztcclxuICBza2lwTGluay50ZXh0Q29udGVudCA9ICdTa2lwIHRvIGNvbnRlbnQnO1xyXG4gIFxyXG4gIHNraXBMaW5rLnN0eWxlLmNzc1RleHQgPSBgXHJcbiAgICBwb3NpdGlvbjogZml4ZWQ7XHJcbiAgICB0b3A6IC00MHB4O1xyXG4gICAgbGVmdDogMXJlbTtcclxuICAgIGJhY2tncm91bmQ6ICMwMDA7XHJcbiAgICBjb2xvcjogd2hpdGU7XHJcbiAgICBwYWRkaW5nOiA4cHggMTJweDtcclxuICAgIGJvcmRlci1yYWRpdXM6IDAgMCA0cHggNHB4O1xyXG4gICAgei1pbmRleDogOTk5OTtcclxuICAgIHRyYW5zaXRpb246IHRvcCAwLjNzIGVhc2U7XHJcbiAgYDtcclxuXHJcbiAgc2tpcExpbmsuYWRkRXZlbnRMaXN0ZW5lcignZm9jdXMnLCAoKSA9PiB7XHJcbiAgICBza2lwTGluay5zdHlsZS50b3AgPSAnMCc7XHJcbiAgfSk7XHJcblxyXG4gIHNraXBMaW5rLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCAoKSA9PiB7XHJcbiAgICBza2lwTGluay5zdHlsZS50b3AgPSAnLTQwcHgnO1xyXG4gIH0pO1xyXG5cclxuICBza2lwTGluay5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBhd2FpdCBoYW5kbGVTa2lwVG9Db250ZW50KCk7XHJcbiAgfSk7XHJcblxyXG4gIGRvY3VtZW50LmJvZHkucHJlcGVuZChza2lwTGluayk7XHJcblxyXG4gIHJldHVybiAoKSA9PiB7XHJcbiAgICBza2lwTGluay5yZW1vdmUoKTtcclxuICAgIHJlc2V0U2tpcFRvQ29udGVudCgpO1xyXG4gIH07XHJcbn07IiwiaW1wb3J0IHsgcmVzZXRTa2lwVG9Db250ZW50IH0gZnJvbSAnLi4vdXRpbHMvU2tpcFRvQ29udGVudCc7XHJcblxyXG5leHBvcnQgY29uc3QgQmFzZVZpZXcgPSAoaHRtbENvbnRlbnQpID0+IHtcclxuICBjb25zdCB2aWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgdmlldy5jbGFzc05hbWUgPSAnYXV0aC1mb3JtJztcclxuICB2aWV3LmlubmVySFRNTCA9IGh0bWxDb250ZW50O1xyXG5cclxuICAvLyBDcmVhdGUgYSBNdXRhdGlvbk9ic2VydmVyIHRvIGRldGVjdCB3aGVuIHRoZSB2aWV3IGlzIHJlbW92ZWRcclxuICBjb25zdCBvYnNlcnZlciA9IG5ldyBNdXRhdGlvbk9ic2VydmVyKChtdXRhdGlvbnMpID0+IHtcclxuICAgIG11dGF0aW9ucy5mb3JFYWNoKChtdXRhdGlvbikgPT4ge1xyXG4gICAgICBpZiAoQXJyYXkuZnJvbShtdXRhdGlvbi5yZW1vdmVkTm9kZXMpLmluY2x1ZGVzKHZpZXcpKSB7XHJcbiAgICAgICAgY2xlYW51cCgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcclxuICAgIHJlc2V0U2tpcFRvQ29udGVudCgpO1xyXG4gICAgb2JzZXJ2ZXIuZGlzY29ubmVjdCgpOyAvLyBTdG9wIG9ic2VydmluZyB3aGVuIGNsZWFuaW5nIHVwXHJcbiAgfTtcclxuXHJcbiAgLy8gU3RhcnQgb2JzZXJ2aW5nIHRoZSB2aWV3J3MgcGFyZW50IGZvciByZW1vdmFsXHJcbiAgaWYgKHZpZXcucGFyZW50Tm9kZSkge1xyXG4gICAgb2JzZXJ2ZXIub2JzZXJ2ZSh2aWV3LnBhcmVudE5vZGUsIHsgY2hpbGRMaXN0OiB0cnVlIH0pO1xyXG4gIH1cclxuXHJcbiAgY29uc3QgZ2V0VmlldyA9ICgpID0+IHtcclxuICAgIC8vIFdoZW4gdmlldyBpcyByZXRyaWV2ZWQsIGVuc3VyZSB3ZSBvYnNlcnZlIGl0cyBldmVudHVhbCBwYXJlbnRcclxuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICBpZiAodmlldy5wYXJlbnROb2RlICYmICFvYnNlcnZlci5faXNPYnNlcnZpbmcpIHtcclxuICAgICAgICBvYnNlcnZlci5vYnNlcnZlKHZpZXcucGFyZW50Tm9kZSwgeyBjaGlsZExpc3Q6IHRydWUgfSk7XHJcbiAgICAgICAgb2JzZXJ2ZXIuX2lzT2JzZXJ2aW5nID0gdHJ1ZTtcclxuICAgICAgfVxyXG4gICAgfSwgMCk7XHJcbiAgICByZXR1cm4gdmlldztcclxuICB9O1xyXG5cclxuICBjb25zdCBzaG93RXJyb3IgPSAobWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdmlldy5xdWVyeVNlbGVjdG9yKCcjZXJyb3ItbWVzc2FnZScpIHx8IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJy5lcnJvci1tZXNzYWdlJyk7XHJcbiAgICBpZiAoZXJyb3JFbGVtZW50KSB7XHJcbiAgICAgIGVycm9yRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgICAgIGVycm9yRWxlbWVudC5zdHlsZS5kaXNwbGF5ID0gbWVzc2FnZSA/ICdibG9jaycgOiAnbm9uZSc7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3Qgc2hvd1N1Y2Nlc3MgPSAobWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3Qgc3VjY2Vzc0VsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdWNjZXNzLW1lc3NhZ2UnKSB8fCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJy5zdWNjZXNzLW1lc3NhZ2UnKTtcclxuICAgIGlmIChzdWNjZXNzRWxlbWVudCkge1xyXG4gICAgICBzdWNjZXNzRWxlbWVudC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgICAgIHN1Y2Nlc3NFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBtZXNzYWdlID8gJ2Jsb2NrJyA6ICdub25lJztcclxuICAgIH1cclxuICB9O1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgZ2V0VmlldyxcclxuICAgIHNob3dFcnJvcixcclxuICAgIHNob3dTdWNjZXNzLFxyXG4gICAgY2xlYW51cFxyXG4gIH07XHJcbn07IiwiaW1wb3J0IHsgQmFzZVZpZXcgfSBmcm9tICcuLi9CYXNlVmlldy5qcyc7XHJcblxyXG5leHBvcnQgY29uc3QgTG9naW5WaWV3ID0gKCkgPT4ge1xyXG4gIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2hlYWRlcicpPy5yZW1vdmUoKTtcclxuXHJcbiAgY29uc3QgYmFzZSA9IEJhc2VWaWV3KGBcclxuICAgIDxoMj5Mb2dpbjwvaDI+XHJcbiAgICA8Zm9ybSBpZD1cImxvZ2luLWZvcm1cIj5cclxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cclxuICAgICAgICA8bGFiZWwgZm9yPVwiZW1haWxcIj5FbWFpbDwvbGFiZWw+XHJcbiAgICAgICAgPGlucHV0IHR5cGU9XCJlbWFpbFwiIGlkPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiByZXF1aXJlZD5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XHJcbiAgICAgICAgPGxhYmVsIGZvcj1cInBhc3N3b3JkXCI+UGFzc3dvcmQ8L2xhYmVsPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIiBpZD1cInBhc3N3b3JkXCIgbmFtZT1cInBhc3N3b3JkXCIgcmVxdWlyZWQgbWlubGVuZ3RoPVwiOFwiPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGJ1dHRvbiB0eXBlPVwic3VibWl0XCI+TG9naW48L2J1dHRvbj5cclxuICAgIDwvZm9ybT5cclxuICAgIDxwPkRvbid0IGhhdmUgYW4gYWNjb3VudD8gPGEgaHJlZj1cIiMvcmVnaXN0ZXJcIj5SZWdpc3RlciBoZXJlPC9hPjwvcD5cclxuICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjwvZGl2PlxyXG4gIGApO1xyXG5cclxuICBjb25zdCBiaW5kTG9naW4gPSAoaGFuZGxlcikgPT4ge1xyXG4gICAgY29uc3QgZm9ybSA9IGJhc2UuZ2V0VmlldygpLnF1ZXJ5U2VsZWN0b3IoJyNsb2dpbi1mb3JtJyk7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBiYXNlLmdldFZpZXcoKS5xdWVyeVNlbGVjdG9yKCcjZXJyb3ItbWVzc2FnZScpO1xyXG4gICAgXHJcbiAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFzeW5jIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc3QgZW1haWwgPSBmb3JtLmVtYWlsLnZhbHVlO1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9IGZvcm0ucGFzc3dvcmQudmFsdWU7XHJcbiAgICAgIFxyXG4gICAgICBlcnJvck1lc3NhZ2Uuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgYXdhaXQgaGFuZGxlcihlbWFpbCwgcGFzc3dvcmQpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGdldFZpZXc6IGJhc2UuZ2V0VmlldywgIC8vIEV4cGxpY2l0bHkgZXhwb3NlIGdldFZpZXdcclxuICAgIHNob3dFcnJvcjogYmFzZS5zaG93RXJyb3IsXHJcbiAgICBzaG93U3VjY2VzczogYmFzZS5zaG93U3VjY2VzcyxcclxuICAgIGJpbmRMb2dpblxyXG4gIH07XHJcbn07IiwiaW1wb3J0IHsgQmFzZVZpZXcgfSBmcm9tICcuLi9CYXNlVmlldy5qcyc7XHJcblxyXG5leHBvcnQgY29uc3QgUmVnaXN0ZXJWaWV3ID0gKCkgPT4ge1xyXG4gIGNvbnN0IGJhc2UgPSBCYXNlVmlldyhgXHJcbiAgICA8aDI+UmVnaXN0ZXI8L2gyPlxyXG4gICAgPGZvcm0gaWQ9XCJyZWdpc3Rlci1mb3JtXCI+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XHJcbiAgICAgICAgPGxhYmVsIGZvcj1cIm5hbWVcIj5OYW1lPC9sYWJlbD5cclxuICAgICAgICA8aW5wdXQgdHlwZT1cInRleHRcIiBpZD1cIm5hbWVcIiBuYW1lPVwibmFtZVwiIHJlcXVpcmVkPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cclxuICAgICAgICA8bGFiZWwgZm9yPVwiZW1haWxcIj5FbWFpbDwvbGFiZWw+XHJcbiAgICAgICAgPGlucHV0IHR5cGU9XCJlbWFpbFwiIGlkPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiByZXF1aXJlZD5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XHJcbiAgICAgICAgPGxhYmVsIGZvcj1cInBhc3N3b3JkXCI+UGFzc3dvcmQ8L2xhYmVsPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIiBpZD1cInBhc3N3b3JkXCIgbmFtZT1cInBhc3N3b3JkXCIgcmVxdWlyZWQgbWlubGVuZ3RoPVwiOFwiPlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cclxuICAgICAgICA8bGFiZWwgZm9yPVwiY29uZmlybS1wYXNzd29yZFwiPkNvbmZpcm0gUGFzc3dvcmQ8L2xhYmVsPlxyXG4gICAgICAgIDxpbnB1dCB0eXBlPVwicGFzc3dvcmRcIiBpZD1cImNvbmZpcm0tcGFzc3dvcmRcIiBuYW1lPVwiY29uZmlybS1wYXNzd29yZFwiIHJlcXVpcmVkIG1pbmxlbmd0aD1cIjhcIj5cclxuICAgICAgPC9kaXY+XHJcbiAgICAgIDxidXR0b24gdHlwZT1cInN1Ym1pdFwiPlJlZ2lzdGVyPC9idXR0b24+XHJcbiAgICA8L2Zvcm0+XHJcbiAgICA8cD5BbHJlYWR5IGhhdmUgYW4gYWNjb3VudD8gPGEgaHJlZj1cIiMvbG9naW5cIj5Mb2dpbiBoZXJlPC9hPjwvcD5cclxuICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjwvZGl2PlxyXG4gICAgPGRpdiBpZD1cInN1Y2Nlc3MtbWVzc2FnZVwiIGNsYXNzPVwic3VjY2Vzcy1tZXNzYWdlXCIgc3R5bGU9XCJkaXNwbGF5OiBub25lO1wiPjwvZGl2PlxyXG4gIGApO1xyXG5cclxuICBjb25zdCBiaW5kUmVnaXN0ZXIgPSAoaGFuZGxlcikgPT4ge1xyXG4gICAgY29uc3QgZm9ybSA9IGJhc2UuZ2V0VmlldygpLnF1ZXJ5U2VsZWN0b3IoJyNyZWdpc3Rlci1mb3JtJyk7XHJcbiAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBiYXNlLmdldFZpZXcoKS5xdWVyeVNlbGVjdG9yKCcjZXJyb3ItbWVzc2FnZScpO1xyXG4gICAgXHJcbiAgICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGFzeW5jIChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc3QgbmFtZSA9IGZvcm0ubmFtZS52YWx1ZTtcclxuICAgICAgY29uc3QgZW1haWwgPSBmb3JtLmVtYWlsLnZhbHVlO1xyXG4gICAgICBjb25zdCBwYXNzd29yZCA9IGZvcm0ucGFzc3dvcmQudmFsdWU7XHJcbiAgICAgIGNvbnN0IGNvbmZpcm1QYXNzd29yZCA9IGZvcm1bJ2NvbmZpcm0tcGFzc3dvcmQnXS52YWx1ZTtcclxuICAgICAgXHJcbiAgICAgIGVycm9yTWVzc2FnZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG5cclxuICAgICAgaWYgKHBhc3N3b3JkICE9PSBjb25maXJtUGFzc3dvcmQpIHtcclxuICAgICAgICBiYXNlLnNob3dFcnJvcihcIlBhc3N3b3JkcyBkb24ndCBtYXRjaCFcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBhd2FpdCBoYW5kbGVyKG5hbWUsIGVtYWlsLCBwYXNzd29yZCk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZXR1cm4ge1xyXG4gICAgZ2V0VmlldzogYmFzZS5nZXRWaWV3LFxyXG4gICAgc2hvd0Vycm9yOiBiYXNlLnNob3dFcnJvcixcclxuICAgIHNob3dTdWNjZXNzOiBiYXNlLnNob3dTdWNjZXNzLFxyXG4gICAgYmluZFJlZ2lzdGVyXHJcbiAgfTtcclxufTsiLCJleHBvcnQgY29uc3QgU3Rvcmllc1ZpZXcgPSAoKSA9PiB7XHJcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJtYWluXCIpO1xyXG4gIHZpZXcuaWQgPSBcIm1haW4tY29udGVudFwiO1xyXG4gIHZpZXcuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcIm1haW5cIik7XHJcbiAgdmlldy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiU3RvcmllcyBsaXN0XCIpO1xyXG5cclxuICB2aWV3LmlubmVySFRNTCA9IGBcclxuICAgIDxoMSBpZD1cInN0b3JpZXMtaGVhZGluZ1wiPlN0b3JpZXM8L2gxPlxyXG4gICAgPGRpdiBjbGFzcz1cInN0b3JpZXMtZ3JpZFwiIGlkPVwic3Rvcmllcy1jb250YWluZXJcIiByb2xlPVwibGlzdFwiIGFyaWEtbGFiZWxsZWRieT1cInN0b3JpZXMtaGVhZGluZ1wiPjwvZGl2PlxyXG4gICAgPGRpdiBpZD1cImVycm9yLW1lc3NhZ2VcIiBjbGFzcz1cImVycm9yLW1lc3NhZ2VcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+PC9kaXY+XHJcbiAgICA8ZGl2IGlkPVwibG9hZGluZy1pbmRpY2F0b3JcIiBzdHlsZT1cImRpc3BsYXk6IG5vbmU7XCI+TG9hZGluZyBzdG9yaWVzLi4uPC9kaXY+XHJcbiAgYDtcclxuXHJcbmNvbnN0IGRpc3BsYXlTdG9yaWVzID0gKHN0b3JpZXMpID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjc3Rvcmllcy1jb250YWluZXJcIik7XHJcbiAgY29uc3QgbG9hZGluZyA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nLWluZGljYXRvclwiKTtcclxuXHJcbiAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgY29udGFpbmVyLmlubmVySFRNTCA9IFwiXCI7XHJcblxyXG4gIGlmICghc3RvcmllcyB8fCBzdG9yaWVzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8cCBjbGFzcz1cIm5vLXN0b3JpZXNcIj5ObyBzdG9yaWVzIGZvdW5kPC9wPic7XHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG5cclxuICAvLyBUYW1iYWhrYW4gZmFsbGJhY2sgcGhvdG9VcmwgamlrYSBrb3NvbmdcclxuICBzdG9yaWVzLmZvckVhY2goKHN0b3J5KSA9PiB7XHJcbiAgICBzdG9yeS5waG90b1VybCA9IHN0b3J5LnBob3RvVXJsIHx8ICcvYXNzZXRzL2ltYWdlcy9wbGFjZWhvbGRlci1vZmZsaW5lLmpwZyc7XHJcblxyXG4gICAgY29uc3Qgc3RvcnlFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFydGljbGVcIik7XHJcbiAgICBzdG9yeUVsZW1lbnQuY2xhc3NOYW1lID0gXCJzdG9yeS1jYXJkXCI7XHJcblxyXG4gICAgc3RvcnlFbGVtZW50LmlubmVySFRNTCA9IGBcclxuICAgICAgPGltZyBzcmM9XCIke3N0b3J5LnBob3RvVXJsfVwiIGFsdD1cIiR7c3RvcnkubmFtZX0ncyBzdG9yeVwiIGNsYXNzPVwic3RvcnktaW1hZ2VcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cInN0b3J5LWNvbnRlbnRcIj5cclxuICAgICAgICA8aDM+JHtzdG9yeS5uYW1lfTwvaDM+XHJcbiAgICAgICAgPHA+JHtzdG9yeS5kZXNjcmlwdGlvbi5zdWJzdHJpbmcoMCwgMTAwKX0ke3N0b3J5LmRlc2NyaXB0aW9uLmxlbmd0aCA+IDEwMCA/IFwiLi4uXCIgOiBcIlwifTwvcD5cclxuICAgICAgICA8cCBjbGFzcz1cInN0b3J5LWRhdGVcIj4ke25ldyBEYXRlKHN0b3J5LmNyZWF0ZWRBdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9PC9wPlxyXG4gICAgICAgIDxhIGhyZWY9XCIjL3N0b3JpZXMvJHtzdG9yeS5pZH1cIiBjbGFzcz1cInJlYWQtbW9yZVwiPlJlYWQgbW9yZTwvYT5cclxuICAgICAgPC9kaXY+XHJcbiAgICBgO1xyXG5cclxuICAgIC8vIE1ha2UgZW50aXJlIGNhcmQgY2xpY2thYmxlXHJcbiAgICBzdG9yeUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBgIy9zdG9yaWVzLyR7c3RvcnkuaWR9YDtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEtleWJvYXJkIG5hdmlnYXRpb25cclxuICAgIHN0b3J5RWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCAoZSkgPT4ge1xyXG4gICAgICBpZiAoZS5rZXkgPT09IFwiRW50ZXJcIikge1xyXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gYCMvc3Rvcmllcy8ke3N0b3J5LmlkfWA7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChzdG9yeUVsZW1lbnQpO1xyXG4gIH0pO1xyXG5cclxuICAvLyBGb2N1cyBtYW5hZ2VtZW50IGZvciB0aGUgZW50aXJlIGNvbnRhaW5lclxyXG4gIGNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwiZm9jdXNvdXRcIiwgKGUpID0+IHtcclxuICAgIGlmICghZS5yZWxhdGVkVGFyZ2V0IHx8ICFjb250YWluZXIuY29udGFpbnMoZS5yZWxhdGVkVGFyZ2V0KSkge1xyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN0b3J5LWNhcmRcIikuZm9yRWFjaCgoY2FyZCkgPT4ge1xyXG4gICAgICAgIGNhcmQuY2xhc3NMaXN0LnJlbW92ZShcImNhcmQtZm9jdXNlZFwiKTtcclxuICAgICAgICBjYXJkLnF1ZXJ5U2VsZWN0b3IoXCIucmVhZC1tb3JlXCIpLnRhYkluZGV4ID0gLTE7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuXHJcbiAgY29uc3Qgc2hvd0Vycm9yID0gKG1lc3NhZ2UpID0+IHtcclxuICAgIGNvbnN0IGVycm9yRWwgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjZXJyb3ItbWVzc2FnZVwiKTtcclxuICAgIGVycm9yRWwudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xyXG4gICAgZXJyb3JFbC5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgdmlldy5xdWVyeVNlbGVjdG9yKFwiI2xvYWRpbmctaW5kaWNhdG9yXCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICB9O1xyXG5cclxuICBjb25zdCBzaG93TG9hZGluZyA9ICgpID0+IHtcclxuICAgIHZpZXcucXVlcnlTZWxlY3RvcihcIiNsb2FkaW5nLWluZGljYXRvclwiKS5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG4gICAgdmlldy5xdWVyeVNlbGVjdG9yKFwiI2Vycm9yLW1lc3NhZ2VcIikuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHNob3dPZmZsaW5lV2FybmluZyA9ICgpID0+IHtcclxuICBjb25zdCBjb250YWluZXIgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yaWVzLWNvbnRhaW5lcicpO1xyXG4gIGNvbnN0IHdhcm5pbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICB3YXJuaW5nLmNsYXNzTmFtZSA9ICdvZmZsaW5lLXdhcm5pbmcnO1xyXG4gIHdhcm5pbmcuaW5uZXJIVE1MID0gYFxyXG4gICAgPGkgY2xhc3M9XCJmYXMgZmEtd2lmaS1zbGFzaFwiPjwvaT5cclxuICAgIDxzcGFuPlNob3dpbmcgb2ZmbGluZSBkYXRhLiBTb21lIHN0b3JpZXMgbWF5IG5vdCBiZSB1cC10by1kYXRlLjwvc3Bhbj5cclxuICBgO1xyXG4gIGNvbnRhaW5lci5wcmVwZW5kKHdhcm5pbmcpO1xyXG59O1xyXG5cclxuICBjb25zdCBiaW5kTG9hZFN0b3JpZXMgPSAoaGFuZGxlcikgPT4ge1xyXG4gICAgc2hvd0xvYWRpbmcoKTtcclxuICAgIGhhbmRsZXIoKS5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgc2hvd0Vycm9yKGVycm9yLm1lc3NhZ2UgfHwgXCJGYWlsZWQgdG8gbG9hZCBzdG9yaWVzXCIpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGdldFZpZXc6ICgpID0+IHZpZXcsXHJcbiAgICBkaXNwbGF5U3RvcmllcyxcclxuICAgIHNob3dFcnJvcixcclxuICAgIGJpbmRMb2FkU3RvcmllcyxcclxuICAgIHNob3dMb2FkaW5nLFxyXG4gICAgc2hvd09mZmxpbmVXYXJuaW5nLFxyXG4gIH07XHJcbn07XHJcbiIsImltcG9ydCB7IHN0YXJ0Vmlld1RyYW5zaXRpb24gfSBmcm9tICcuLi8uLi91dGlscy92aWV3LXRyYW5zaXRpb24uanMnO1xyXG5pbXBvcnQgJ2xlYWZsZXQvZGlzdC9sZWFmbGV0LmNzcyc7XHJcbmltcG9ydCBMIGZyb20gJ2xlYWZsZXQnO1xyXG5pbXBvcnQgJ2xlYWZsZXQubWFya2VyY2x1c3Rlci9kaXN0L2xlYWZsZXQubWFya2VyY2x1c3Rlcic7XHJcbmltcG9ydCAnbGVhZmxldC5tYXJrZXJjbHVzdGVyL2Rpc3QvTWFya2VyQ2x1c3Rlci5jc3MnO1xyXG5pbXBvcnQgJ2xlYWZsZXQubWFya2VyY2x1c3Rlci9kaXN0L01hcmtlckNsdXN0ZXIuRGVmYXVsdC5jc3MnO1xyXG5cclxuLy8gRml4IGZvciBkZWZhdWx0IG1hcmtlciBpY29ucyBpbiBMZWFmbGV0XHJcbmRlbGV0ZSBMLkljb24uRGVmYXVsdC5wcm90b3R5cGUuX2dldEljb25Vcmw7XHJcbkwuSWNvbi5EZWZhdWx0Lm1lcmdlT3B0aW9ucyh7XHJcbiAgaWNvblJldGluYVVybDogJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2xlYWZsZXQvMS43LjEvaW1hZ2VzL21hcmtlci1pY29uLTJ4LnBuZycsXHJcbiAgaWNvblVybDogJ2h0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2xlYWZsZXQvMS43LjEvaW1hZ2VzL21hcmtlci1pY29uLnBuZycsXHJcbiAgc2hhZG93VXJsOiAnaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMvbGVhZmxldC8xLjcuMS9pbWFnZXMvbWFya2VyLXNoYWRvdy5wbmcnXHJcbn0pO1xyXG5cclxuZXhwb3J0IGNvbnN0IERldGFpbFN0b3J5VmlldyA9ICgpID0+IHtcclxuICBjb25zdCB2aWV3ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbWFpbicpO1xyXG4gIHZpZXcuaWQgPSAnbWFpbi1jb250ZW50JztcclxuICBcclxuICB2aWV3LmlubmVySFRNTCA9IGBcclxuICAgIDxkaXYgY2xhc3M9XCJkZXRhaWwtc3RvcnlcIj5cclxuICAgICAgPGRpdiBjbGFzcz1cInN0b3J5LWltYWdlLWNvbnRhaW5lclwiPlxyXG4gICAgICAgIDxpbWcgaWQ9XCJzdG9yeS1pbWFnZVwiIGNsYXNzPVwiZGV0YWlsLXN0b3J5LWltYWdlXCIgYWx0PVwiU3RvcnkgaW1hZ2VcIj5cclxuICAgICAgICA8ZGl2IGNsYXNzPVwic3RvcnktbWV0YVwiPlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImF1dGhvci1pbmZvXCI+XHJcbiAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXVzZXItY2lyY2xlXCI+PC9pPlxyXG4gICAgICAgICAgICA8c3BhbiBpZD1cInN0b3J5LWF1dGhvclwiPjwvc3Bhbj5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cImRhdGUtaW5mb1wiPlxyXG4gICAgICAgICAgICA8aSBjbGFzcz1cImZhciBmYS1jYWxlbmRhci1hbHRcIj48L2k+XHJcbiAgICAgICAgICAgIDxzcGFuIGlkPVwic3RvcnktZGF0ZVwiPjwvc3Bhbj5cclxuICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgIDwvZGl2PlxyXG4gICAgICA8L2Rpdj5cclxuICAgICAgXHJcbiAgICAgIDxkaXYgY2xhc3M9XCJzdG9yeS1jb250ZW50XCI+XHJcbiAgICAgICAgPGgxIGlkPVwic3RvcnktdGl0bGVcIiBjbGFzcz1cInN0b3J5LXRpdGxlXCI+PC9oMT5cclxuICAgICAgICA8cCBpZD1cInN0b3J5LWRlc2NyaXB0aW9uXCIgY2xhc3M9XCJzdG9yeS1kZXNjcmlwdGlvblwiPjwvcD5cclxuICAgICAgICBcclxuICAgICAgICA8ZGl2IGNsYXNzPVwibG9jYXRpb24tc2VjdGlvblwiPlxyXG4gICAgICAgICAgPGgzPjxpIGNsYXNzPVwiZmFzIGZhLW1hcC1tYXJrZXItYWx0XCI+PC9pPiBMb2thc2k8L2gzPlxyXG4gICAgICAgICAgPGRpdiBpZD1cInN0b3J5LW1hcC1jb250YWluZXJcIiBjbGFzcz1cImRldGFpbC1tYXAtY29udGFpbmVyXCI+XHJcbiAgICAgICAgICAgIDxkaXYgaWQ9XCJzdG9yeS1tYXBcIiBjbGFzcz1cImRldGFpbC1tYXBcIj48L2Rpdj5cclxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cIm1hcC1jb250cm9sc1wiPlxyXG4gICAgICAgICAgICAgIDxidXR0b24gaWQ9XCJzYXRlbGxpdGUtdmlld1wiIGNsYXNzPVwibWFwLWNvbnRyb2wtYnRuXCI+XHJcbiAgICAgICAgICAgICAgICA8aSBjbGFzcz1cImZhcyBmYS1zYXRlbGxpdGVcIj48L2k+XHJcbiAgICAgICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgICAgICAgPGJ1dHRvbiBpZD1cInN0cmVldC12aWV3XCIgY2xhc3M9XCJtYXAtY29udHJvbC1idG5cIj5cclxuICAgICAgICAgICAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLXJvYWRcIj48L2k+XHJcbiAgICAgICAgICAgICAgPC9idXR0b24+XHJcbiAgICAgICAgICAgIDwvZGl2PlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgIDwvZGl2PlxyXG4gICAgPC9kaXY+XHJcbiAgICBcclxuICAgIDxkaXYgaWQ9XCJlcnJvci1tZXNzYWdlXCIgY2xhc3M9XCJlcnJvci1tZXNzYWdlXCI+XHJcbiAgICAgIDxpIGNsYXNzPVwiZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZVwiPjwvaT5cclxuICAgICAgPHNwYW4gY2xhc3M9XCJlcnJvci10ZXh0XCI+PC9zcGFuPlxyXG4gICAgPC9kaXY+XHJcbiAgYDtcclxuXHJcbiAgbGV0IG1hcEluc3RhbmNlID0gbnVsbDtcclxuICBsZXQgbWFya2VyQ2x1c3RlciA9IG51bGw7XHJcbiAgbGV0IGJhc2VMYXllcnMgPSB7fTtcclxuICBsZXQgY3VycmVudExheWVyID0gbnVsbDtcclxuXHJcbiAgY29uc3QgcHJlcGFyZU1hcENvbnRhaW5lciA9ICgpID0+IHtcclxuICAgIGNvbnN0IGNvbnRhaW5lciA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcC1jb250YWluZXInKTtcclxuICAgIGNvbnN0IG1hcERpdiA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcCcpO1xyXG4gICAgXHJcbiAgICAvLyBDb21wbGV0ZWx5IHJlY3JlYXRlIHRoZSBtYXAgY29udGFpbmVyXHJcbiAgICBpZiAobWFwRGl2KSB7XHJcbiAgICAgIGNvbnN0IG5ld01hcERpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICBuZXdNYXBEaXYuaWQgPSAnc3RvcnktbWFwJztcclxuICAgICAgbmV3TWFwRGl2LmNsYXNzTmFtZSA9ICdkZXRhaWwtbWFwJztcclxuICAgICAgY29udGFpbmVyLnJlcGxhY2VDaGlsZChuZXdNYXBEaXYsIG1hcERpdik7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENsZWFuIHVwIGV4aXN0aW5nIG1hcCBpbnN0YW5jZXNcclxuICAgIGlmIChtYXBJbnN0YW5jZSkge1xyXG4gICAgICBtYXBJbnN0YW5jZS5yZW1vdmUoKTtcclxuICAgICAgbWFwSW5zdGFuY2UgPSBudWxsO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAobWFya2VyQ2x1c3Rlcikge1xyXG4gICAgICBtYXJrZXJDbHVzdGVyLmNsZWFyTGF5ZXJzKCk7XHJcbiAgICAgIG1hcmtlckNsdXN0ZXIgPSBudWxsO1xyXG4gICAgfVxyXG4gIH07XHJcblxyXG4gIGNvbnN0IGluaXRNYXAgPSAobGF0LCBsbmcpID0+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIENoZWNrIGlmIG1hcCBjb250YWluZXIgZXhpc3RzIGFuZCBpc24ndCBhbHJlYWR5IGluaXRpYWxpemVkXHJcbiAgICAgIGNvbnN0IG1hcEVsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1tYXAnKTtcclxuICAgICAgaWYgKCFtYXBFbGVtZW50IHx8IG1hcEVsZW1lbnQuX2xlYWZsZXRfaWQpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ3JlYXRlIG5ldyBtYXAgaW5zdGFuY2VcclxuICAgICAgbWFwSW5zdGFuY2UgPSBMLm1hcChtYXBFbGVtZW50LCB7XHJcbiAgICAgICAgem9vbUNvbnRyb2w6IGZhbHNlLFxyXG4gICAgICAgIHByZWZlckNhbnZhczogdHJ1ZVxyXG4gICAgICB9KS5zZXRWaWV3KFtsYXQsIGxuZ10sIDEzKTtcclxuXHJcbiAgICAgIC8vIEFkZCB6b29tIGNvbnRyb2xcclxuICAgICAgTC5jb250cm9sLnpvb20oe1xyXG4gICAgICAgIHBvc2l0aW9uOiAnYm90dG9tcmlnaHQnXHJcbiAgICAgIH0pLmFkZFRvKG1hcEluc3RhbmNlKTtcclxuXHJcbiAgICAgIC8vIERlZmluZSBiYXNlIGxheWVyc1xyXG4gICAgICBiYXNlTGF5ZXJzID0ge1xyXG4gICAgICAgIFwiU3RyZWV0IFZpZXdcIjogTC50aWxlTGF5ZXIoJ2h0dHBzOi8ve3N9LnRpbGUub3BlbnN0cmVldG1hcC5vcmcve3p9L3t4fS97eX0ucG5nJywge1xyXG4gICAgICAgICAgYXR0cmlidXRpb246ICcmY29weTsgPGEgaHJlZj1cImh0dHBzOi8vd3d3Lm9wZW5zdHJlZXRtYXAub3JnL2NvcHlyaWdodFwiPk9wZW5TdHJlZXRNYXA8L2E+IGNvbnRyaWJ1dG9ycycsXHJcbiAgICAgICAgICBtYXhab29tOiAxOVxyXG4gICAgICAgIH0pLFxyXG4gICAgICAgIFwiU2F0ZWxsaXRlIFZpZXdcIjogTC50aWxlTGF5ZXIoJ2h0dHBzOi8vc2VydmVyLmFyY2dpc29ubGluZS5jb20vQXJjR0lTL3Jlc3Qvc2VydmljZXMvV29ybGRfSW1hZ2VyeS9NYXBTZXJ2ZXIvdGlsZS97en0ve3l9L3t4fScsIHtcclxuICAgICAgICAgIGF0dHJpYnV0aW9uOiAnVGlsZXMgJmNvcHk7IEVzcmkgJm1kYXNoOyBTb3VyY2U6IEVzcmksIGktY3ViZWQsIFVTREEsIFVTR1MsIEFFWCwgR2VvRXllLCBHZXRtYXBwaW5nLCBBZXJvZ3JpZCwgSUdOLCBJR1AsIFVQUi1FR1AsIGFuZCB0aGUgR0lTIFVzZXIgQ29tbXVuaXR5JyxcclxuICAgICAgICAgIG1heFpvb206IDE5XHJcbiAgICAgICAgfSlcclxuICAgICAgfTtcclxuXHJcbiAgICAgIC8vIEFkZCBkZWZhdWx0IGxheWVyXHJcbiAgICAgIGJhc2VMYXllcnNbXCJTdHJlZXQgVmlld1wiXS5hZGRUbyhtYXBJbnN0YW5jZSk7XHJcbiAgICAgIGN1cnJlbnRMYXllciA9IFwiU3RyZWV0IFZpZXdcIjtcclxuXHJcbiAgICAgIC8vIEFkZCBsYXllciBjb250cm9sXHJcbiAgICAgIEwuY29udHJvbC5sYXllcnMoYmFzZUxheWVycywgbnVsbCwge1xyXG4gICAgICAgIHBvc2l0aW9uOiAndG9wcmlnaHQnLFxyXG4gICAgICAgIGNvbGxhcHNlZDogZmFsc2VcclxuICAgICAgfSkuYWRkVG8obWFwSW5zdGFuY2UpO1xyXG5cclxuICAgICAgLy8gSW5pdGlhbGl6ZSBtYXJrZXIgY2x1c3RlclxyXG4gICAgICBtYXJrZXJDbHVzdGVyID0gTC5tYXJrZXJDbHVzdGVyR3JvdXAoe1xyXG4gICAgICAgIHNwaWRlcmZ5T25NYXhab29tOiB0cnVlLFxyXG4gICAgICAgIHNob3dDb3ZlcmFnZU9uSG92ZXI6IGZhbHNlLFxyXG4gICAgICAgIHpvb21Ub0JvdW5kc09uQ2xpY2s6IHRydWUsXHJcbiAgICAgICAgbWF4Q2x1c3RlclJhZGl1czogNDBcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBZGQgY3VzdG9tIGNvbnRyb2wgYnV0dG9uIGV2ZW50c1xyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F0ZWxsaXRlLXZpZXcnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoTGF5ZXIoXCJTYXRlbGxpdGUgVmlld1wiKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RyZWV0LXZpZXcnKT8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XHJcbiAgICAgICAgc3dpdGNoTGF5ZXIoXCJTdHJlZXQgVmlld1wiKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICByZXR1cm4gbWFwSW5zdGFuY2U7XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdNYXAgaW5pdGlhbGl6YXRpb24gZXJyb3I6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBzd2l0Y2hMYXllciA9IChsYXllck5hbWUpID0+IHtcclxuICAgIGlmIChtYXBJbnN0YW5jZSAmJiBjdXJyZW50TGF5ZXIgIT09IGxheWVyTmFtZSkge1xyXG4gICAgICBtYXBJbnN0YW5jZS5yZW1vdmVMYXllcihiYXNlTGF5ZXJzW2N1cnJlbnRMYXllcl0pO1xyXG4gICAgICBiYXNlTGF5ZXJzW2xheWVyTmFtZV0uYWRkVG8obWFwSW5zdGFuY2UpO1xyXG4gICAgICBjdXJyZW50TGF5ZXIgPSBsYXllck5hbWU7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgYWN0aXZlIGJ1dHRvbiBzdGF0ZVxyXG4gICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcubWFwLWNvbnRyb2wtYnRuJykuZm9yRWFjaChidG4gPT4ge1xyXG4gICAgICAgIGJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGFjdGl2ZUJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke2xheWVyTmFtZS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoJyAnLCAnLScpfS12aWV3YCk7XHJcbiAgICAgIGlmIChhY3RpdmVCdG4pIGFjdGl2ZUJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCBkaXNwbGF5U3RvcnlEZXRhaWwgPSBhc3luYyAoc3RvcnkpID0+IHtcclxuICAgIGF3YWl0IHN0YXJ0Vmlld1RyYW5zaXRpb24oYXN5bmMgKCkgPT4ge1xyXG4gICAgICAvLyBQcmVwYXJlIHRoZSB2aWV3IGZpcnN0XHJcbiAgICAgIGNvbnN0IGltYWdlRWxlbWVudCA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LWltYWdlJyk7XHJcbiAgICAgIGltYWdlRWxlbWVudC5zcmMgPSBzdG9yeS5waG90b1VybDtcclxuICAgICAgaW1hZ2VFbGVtZW50LmFsdCA9IGBTdG9yeSBieSAke3N0b3J5Lm5hbWV9YDtcclxuICAgICAgdmlldy5xdWVyeVNlbGVjdG9yKCcjc3RvcnktdGl0bGUnKS50ZXh0Q29udGVudCA9IHN0b3J5Lm5hbWU7XHJcbiAgICAgIHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LWF1dGhvcicpLnRleHRDb250ZW50ID0gc3RvcnkubmFtZTtcclxuICAgICAgdmlldy5xdWVyeVNlbGVjdG9yKCcjc3RvcnktZGVzY3JpcHRpb24nKS50ZXh0Q29udGVudCA9IHN0b3J5LmRlc2NyaXB0aW9uO1xyXG4gICAgICB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1kYXRlJykudGV4dENvbnRlbnQgPSBuZXcgRGF0ZShzdG9yeS5jcmVhdGVkQXQpLnRvTG9jYWxlU3RyaW5nKCdpZC1JRCcsIHtcclxuICAgICAgICB3ZWVrZGF5OiAnbG9uZycsXHJcbiAgICAgICAgeWVhcjogJ251bWVyaWMnLFxyXG4gICAgICAgIG1vbnRoOiAnbG9uZycsXHJcbiAgICAgICAgZGF5OiAnbnVtZXJpYycsXHJcbiAgICAgICAgaG91cjogJzItZGlnaXQnLFxyXG4gICAgICAgIG1pbnV0ZTogJzItZGlnaXQnXHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gSGFuZGxlIG1hcCBkaXNwbGF5XHJcbiAgICAgIGNvbnN0IG1hcENvbnRhaW5lciA9IHZpZXcucXVlcnlTZWxlY3RvcignI3N0b3J5LW1hcC1jb250YWluZXInKTtcclxuICAgICAgaWYgKHN0b3J5LmxhdCAmJiBzdG9yeS5sb24pIHtcclxuICAgICAgICBtYXBDb250YWluZXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gUHJlcGFyZSB0aGUgbWFwIGNvbnRhaW5lclxyXG4gICAgICAgIHByZXBhcmVNYXBDb250YWluZXIoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBXYWl0IGZvciBET00gdG8gYmUgcmVhZHlcclxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHJlcXVlc3RBbmltYXRpb25GcmFtZShyZXNvbHZlKSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gSW5pdGlhbGl6ZSBtYXBcclxuICAgICAgICBjb25zdCBtYXAgPSBpbml0TWFwKHN0b3J5LmxhdCwgc3RvcnkubG9uKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAobWFwKSB7XHJcbiAgICAgICAgICAvLyBBZGQgbWFya2VyIHRvIHRoZSBjbHVzdGVyXHJcbiAgICAgICAgICBjb25zdCBtYXJrZXIgPSBMLm1hcmtlcihbc3RvcnkubGF0LCBzdG9yeS5sb25dKVxyXG4gICAgICAgICAgICAuYmluZFBvcHVwKGBcclxuICAgICAgICAgICAgICA8ZGl2IGNsYXNzPVwibWFwLXBvcHVwXCI+XHJcbiAgICAgICAgICAgICAgICA8aDQ+JHtzdG9yeS5uYW1lfTwvaDQ+XHJcbiAgICAgICAgICAgICAgICA8cD4ke3N0b3J5LmRlc2NyaXB0aW9uLnN1YnN0cmluZygwLCAxMDApfS4uLjwvcD5cclxuICAgICAgICAgICAgICAgIDxzbWFsbD4ke25ldyBEYXRlKHN0b3J5LmNyZWF0ZWRBdCkudG9Mb2NhbGVEYXRlU3RyaW5nKCl9PC9zbWFsbD5cclxuICAgICAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgICAgYCk7XHJcbiAgICAgICAgICBcclxuICAgICAgICAgIG1hcmtlckNsdXN0ZXIuYWRkTGF5ZXIobWFya2VyKTtcclxuICAgICAgICAgIG1hcC5hZGRMYXllcihtYXJrZXJDbHVzdGVyKTtcclxuICAgICAgICAgIG1hcmtlci5vcGVuUG9wdXAoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbWFwQ29udGFpbmVyLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IHNob3dFcnJvciA9IChtZXNzYWdlKSA9PiB7XHJcbiAgICBjb25zdCBlcnJvckVsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoJyNlcnJvci1tZXNzYWdlJyk7XHJcbiAgICBjb25zdCBlcnJvclRleHQgPSBlcnJvckVsZW1lbnQucXVlcnlTZWxlY3RvcignLmVycm9yLXRleHQnKTtcclxuICAgIGVycm9yVGV4dC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XHJcbiAgICBlcnJvckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9ICdmbGV4JztcclxuICAgIFxyXG4gICAgLy8gQW5pbWF0aW9uIGZvciBlcnJvciBtZXNzYWdlXHJcbiAgICBlcnJvckVsZW1lbnQuYW5pbWF0ZShbXHJcbiAgICAgIHsgb3BhY2l0eTogMCwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgtMTBweCknIH0sXHJcbiAgICAgIHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwKScgfVxyXG4gICAgXSwge1xyXG4gICAgICBkdXJhdGlvbjogMzAwLFxyXG4gICAgICBlYXNpbmc6ICdlYXNlLW91dCdcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7XHJcbiAgICBpZiAobWFwSW5zdGFuY2UpIHtcclxuICAgICAgbWFwSW5zdGFuY2UucmVtb3ZlKCk7XHJcbiAgICAgIG1hcEluc3RhbmNlID0gbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChtYXJrZXJDbHVzdGVyKSB7XHJcbiAgICAgIG1hcmtlckNsdXN0ZXIuY2xlYXJMYXllcnMoKTtcclxuICAgICAgbWFya2VyQ2x1c3RlciA9IG51bGw7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgcmV0dXJuIHtcclxuICAgIGdldFZpZXc6ICgpID0+IHZpZXcsXHJcbiAgICBkaXNwbGF5U3RvcnlEZXRhaWwsXHJcbiAgICBzaG93RXJyb3IsXHJcbiAgICBjbGVhbnVwLFxyXG4gICAgcHJlcGFyZU1hcENvbnRhaW5lclxyXG4gIH07XHJcbn07IiwiaW1wb3J0IHtcclxuICBzaG93Tm90aWZpY2F0aW9uUHJvbXB0LFxyXG4gIHN1YnNjcmliZVVzZXIsXHJcbn0gZnJvbSBcIi4uLy4uL3V0aWxzL25vdGlmaWNhdGlvbi5qc1wiO1xyXG5pbXBvcnQgQXV0aE1vZGVsIGZyb20gXCIuLi8uLi9tb2RlbHMvQXV0aE1vZGVsLmpzXCI7IC8vIGFkanVzdCB0aGUgcGF0aCBpZiBuZWVkZWRcclxuXHJcbmV4cG9ydCBjb25zdCBBZGRTdG9yeVZpZXcgPSAoKSA9PiB7XHJcbiAgY29uc3QgdmlldyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJtYWluXCIpO1xyXG4gIHZpZXcuaWQgPSBcIm1haW4tY29udGVudFwiO1xyXG4gIHZpZXcuc2V0QXR0cmlidXRlKFwicm9sZVwiLCBcIm1haW5cIik7XHJcbiAgdmlldy5zZXRBdHRyaWJ1dGUoXCJhcmlhLWxhYmVsXCIsIFwiQWRkIG5ldyBzdG9yeSBmb3JtXCIpO1xyXG5cclxuICB2aWV3LmlubmVySFRNTCA9IGBcclxuXHJcbiAgICA8ZGl2IGNsYXNzPVwiYWRkLXN0b3J5LWZvcm1cIj5cclxuICAgIDxoMj5BZGQgTmV3IFN0b3J5PC9oMj4gXHJcbiAgICA8ZGl2IGNsYXNzPVwibm90aWZpY2F0aW9uLXBlcm1pc3Npb24taW5mb1wiIHN0eWxlPVwiZGlzcGxheTogbm9uZTtcIj5cclxuICAgICAgPHA+V2UnZCBsaWtlIHRvIHNob3cgbm90aWZpY2F0aW9ucyB3aGVuIHlvdSBhZGQgc3Rvcmllcy4gVGhpcyBoZWxwcyB5b3Uga2VlcCB0cmFjayBvZiB5b3VyIGNvbnRyaWJ1dGlvbnMuPC9wPlxyXG4gICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cImVuYWJsZS1ub3RpZmljYXRpb25zXCIgY2xhc3M9XCJidG5cIj5FbmFibGUgTm90aWZpY2F0aW9uczwvYnV0dG9uPlxyXG4gICAgPC9kaXY+XHJcbiAgICAgIDxmb3JtIGlkPVwic3RvcnktZm9ybVwiPlxyXG4gICAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwXCI+XHJcbiAgICAgICAgICA8bGFiZWwgZm9yPVwiZGVzY3JpcHRpb25cIj5EZXNjcmlwdGlvbjwvbGFiZWw+XHJcbiAgICAgICAgICA8dGV4dGFyZWEgaWQ9XCJkZXNjcmlwdGlvblwiIG5hbWU9XCJkZXNjcmlwdGlvblwiIHJvd3M9XCI0XCIgcmVxdWlyZWQ+PC90ZXh0YXJlYT5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICBcclxuICAgICAgICA8ZGl2IGNsYXNzPVwiZm9ybS1ncm91cCBjYW1lcmEtY29udGFpbmVyXCI+XHJcbiAgICAgICAgICA8bGFiZWw+UGhvdG88L2xhYmVsPlxyXG4gICAgICAgICAgPGRpdiBjbGFzcz1cInByZXZpZXctY29udGFpbmVyXCI+XHJcbiAgICAgICAgICAgIDx2aWRlbyBpZD1cImNhbWVyYS1wcmV2aWV3XCIgY2xhc3M9XCJtZWRpYS1wcmV2aWV3XCIgYXV0b3BsYXkgcGxheXNpbmxpbmU+PC92aWRlbz5cclxuICAgICAgICAgICAgPGltZyBpZD1cInBob3RvLXByZXZpZXdcIiBjbGFzcz1cIm1lZGlhLXByZXZpZXdcIiBzdHlsZT1cImRpc3BsYXk6bm9uZTsgb2JqZWN0LWZpdDpjb250YWluO1wiIGFsdD1cIkNhcHR1cmVkIHBob3RvXCI+XHJcbiAgICAgICAgICA8L2Rpdj5cclxuICAgICAgICAgIDxkaXYgY2xhc3M9XCJjYW1lcmEtY29udHJvbHNcIj5cclxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaWQ9XCJzdGFydC1jYW1lcmFcIiBjbGFzcz1cImJ0biBjYW1lcmEtYnRuXCI+U3RhcnQgQ2FtZXJhPC9idXR0b24+XHJcbiAgICAgICAgICAgIDxzZWxlY3QgaWQ9XCJjYW1lcmEtc2VsZWN0XCIgY2xhc3M9XCJjYW1lcmEtc2VsZWN0XCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+PC9zZWxlY3Q+XHJcbiAgICAgICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiIGlkPVwiY2FwdHVyZS1idG5cIiBjbGFzcz1cImJ0biBjYXB0dXJlLWJ0blwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPkNhcHR1cmUgUGhvdG88L2J1dHRvbj5cclxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaWQ9XCJzdG9wLWNhbWVyYVwiIGNsYXNzPVwiYnRuIHN0b3AtYnRuXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+U3RvcCBDYW1lcmE8L2J1dHRvbj5cclxuICAgICAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgaWQ9XCJyZXRha2UtYnRuXCIgY2xhc3M9XCJidG4gcmV0YWtlLWJ0blwiIHN0eWxlPVwiZGlzcGxheTpub25lO1wiPlJldGFrZSBQaG90bzwvYnV0dG9uPlxyXG4gICAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgICA8Y2FudmFzIGlkPVwiY2FudmFzXCIgc3R5bGU9XCJkaXNwbGF5Om5vbmU7XCI+PC9jYW52YXM+XHJcbiAgICAgICAgPC9kaXY+XHJcbiAgICAgICAgXHJcbiAgICAgICAgPGRpdiBjbGFzcz1cImZvcm0tZ3JvdXBcIj5cclxuICAgICAgICAgIDxsYWJlbD5Mb2NhdGlvbjwvbGFiZWw+XHJcbiAgICAgICAgICA8ZGl2IGlkPVwibWFwXCIgY2xhc3M9XCJtYXAtY29udGFpbmVyXCI+PC9kaXY+XHJcbiAgICAgICAgICA8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBpZD1cImdldC1sb2NhdGlvblwiIGNsYXNzPVwiYnRuIGxvY2F0aW9uLWJ0blwiPlVzZSBDdXJyZW50IExvY2F0aW9uPC9idXR0b24+XHJcbiAgICAgICAgICA8aW5wdXQgdHlwZT1cImhpZGRlblwiIGlkPVwibGF0XCIgbmFtZT1cImxhdFwiPlxyXG4gICAgICAgICAgPGlucHV0IHR5cGU9XCJoaWRkZW5cIiBpZD1cImxuZ1wiIG5hbWU9XCJsbmdcIj5cclxuICAgICAgICAgIDxwIGlkPVwibG9jYXRpb24tc3RhdHVzXCIgY2xhc3M9XCJsb2NhdGlvbi1zdGF0dXNcIj5ObyBsb2NhdGlvbiBzZWxlY3RlZDwvcD5cclxuICAgICAgICA8L2Rpdj5cclxuICAgICAgICBcclxuICAgICAgICA8YnV0dG9uIHR5cGU9XCJzdWJtaXRcIiBjbGFzcz1cImJ0biBzdWJtaXQtYnRuXCI+U3VibWl0IFN0b3J5PC9idXR0b24+XHJcbiAgICAgIDwvZm9ybT5cclxuICAgICAgPGRpdiBpZD1cImVycm9yLW1lc3NhZ2VcIiBjbGFzcz1cImVycm9yLW1lc3NhZ2VcIj48L2Rpdj5cclxuICAgICAgPGRpdiBpZD1cInN1Y2Nlc3MtbWVzc2FnZVwiIGNsYXNzPVwic3VjY2Vzcy1tZXNzYWdlXCI+PC9kaXY+XHJcbiAgICA8L2Rpdj5cclxuICBgO1xyXG5cclxuICAvLyBTdGF0ZVxyXG4gIGxldCBzdHJlYW0gPSBudWxsO1xyXG4gIGxldCBwaG90b0ZpbGUgPSBudWxsO1xyXG4gIGxldCBtYXAgPSBudWxsO1xyXG4gIGxldCBhdmFpbGFibGVDYW1lcmFzID0gW107XHJcbiAgbGV0IG1hcE1hcmtlciA9IG51bGw7XHJcbiAgbGV0IGlzVmlld0FjdGl2ZSA9IHRydWU7XHJcblxyXG4gIC8vIERPTSBFbGVtZW50c1xyXG4gIGNvbnN0IGNhbWVyYVByZXZpZXcgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjY2FtZXJhLXByZXZpZXdcIik7XHJcbiAgY29uc3QgcGhvdG9QcmV2aWV3ID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI3Bob3RvLXByZXZpZXdcIik7XHJcbiAgY29uc3Qgc3RhcnRDYW1lcmFCdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjc3RhcnQtY2FtZXJhXCIpO1xyXG4gIGNvbnN0IGNhbWVyYVNlbGVjdCA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNjYW1lcmEtc2VsZWN0XCIpO1xyXG4gIGNvbnN0IGNhcHR1cmVCdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjY2FwdHVyZS1idG5cIik7XHJcbiAgY29uc3Qgc3RvcENhbWVyYUJ0biA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNzdG9wLWNhbWVyYVwiKTtcclxuICBjb25zdCByZXRha2VCdG4gPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjcmV0YWtlLWJ0blwiKTtcclxuICBjb25zdCBjYW52YXMgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjY2FudmFzXCIpO1xyXG4gIGNvbnN0IG1hcENvbnRhaW5lciA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNtYXBcIik7XHJcbiAgY29uc3QgbG9jYXRpb25TdGF0dXMgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjbG9jYXRpb24tc3RhdHVzXCIpO1xyXG5cclxuICBjb25zdCBjaGVja05vdGlmaWNhdGlvblBlcm1pc3Npb24gPSAoKSA9PiB7XHJcbiAgICBjb25zdCBub3RpZmljYXRpb25JbmZvID0gdmlldy5xdWVyeVNlbGVjdG9yKFxyXG4gICAgICBcIi5ub3RpZmljYXRpb24tcGVybWlzc2lvbi1pbmZvXCJcclxuICAgICk7XHJcbiAgICBjb25zdCBlbmFibGVOb3RpZmljYXRpb25zQnRuID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2VuYWJsZS1ub3RpZmljYXRpb25zXCIpO1xyXG5cclxuICAgIGlmIChOb3RpZmljYXRpb24ucGVybWlzc2lvbiA9PT0gXCJkZWZhdWx0XCIpIHtcclxuICAgICAgbm90aWZpY2F0aW9uSW5mby5zdHlsZS5kaXNwbGF5ID0gXCJibG9ja1wiO1xyXG5cclxuICAgICAgZW5hYmxlTm90aWZpY2F0aW9uc0J0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICBjb25zdCBncmFudGVkID0gYXdhaXQgc2hvd05vdGlmaWNhdGlvblByb21wdCgpO1xyXG4gICAgICAgICAgbm90aWZpY2F0aW9uSW5mby5zdHlsZS5kaXNwbGF5ID0gZ3JhbnRlZCA/IFwibm9uZVwiIDogXCJibG9ja1wiO1xyXG5cclxuICAgICAgICAgIGlmIChncmFudGVkKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRva2VuID0gQXV0aE1vZGVsLmdldFRva2VuKCk7IC8vIEltcGxlbWVudCB0aGlzIGluIEF1dGhNb2RlbC5qcyBpZiBtaXNzaW5nXHJcbiAgICAgICAgICAgIGF3YWl0IHN1YnNjcmliZVVzZXIodG9rZW4pOyAvLyB0aGlzIHNlbmRzIHRoZSBwdXNoIHN1YnNjcmlwdGlvbiB0byB0aGUgQVBJXHJcbiAgICAgICAgICAgIHNob3dTdWNjZXNzKFwiTm90aWZpY2F0aW9ucyBlbmFibGVkIVwiKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihcIkVycm9yIHJlcXVlc3Rpbmcgbm90aWZpY2F0aW9uIHBlcm1pc3Npb246XCIsIGVycm9yKTtcclxuICAgICAgICAgIHNob3dFcnJvcihcIkZhaWxlZCB0byBlbmFibGUgbm90aWZpY2F0aW9uc1wiKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbm90aWZpY2F0aW9uSW5mby5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgaW5pdGlhbGl6ZU1hcCA9ICgpID0+IHtcclxuICAgIGlmICghbWFwICYmIG1hcENvbnRhaW5lcikge1xyXG4gICAgICBtYXAgPSBMLm1hcChtYXBDb250YWluZXIpLnNldFZpZXcoWy02LjIsIDEwNi44XSwgMTMpO1xyXG4gICAgICBMLnRpbGVMYXllcihcImh0dHBzOi8ve3N9LnRpbGUub3BlbnN0cmVldG1hcC5vcmcve3p9L3t4fS97eX0ucG5nXCIsIHtcclxuICAgICAgICBhdHRyaWJ1dGlvbjogXCImY29weTsgT3BlblN0cmVldE1hcCBjb250cmlidXRvcnNcIixcclxuICAgICAgfSkuYWRkVG8obWFwKTtcclxuXHJcbiAgICAgIG1hcC5vbihcImNsaWNrXCIsIChlKSA9PiB7XHJcbiAgICAgICAgY29uc3QgeyBsYXQsIGxuZyB9ID0gZS5sYXRsbmc7XHJcbiAgICAgICAgdXBkYXRlTG9jYXRpb24obGF0LCBsbmcpO1xyXG4gICAgICAgIGFkZE1hcE1hcmtlcihsYXQsIGxuZyk7XHJcbiAgICAgICAgc2hvd1N1Y2Nlc3MoXCJMb2NhdGlvbiBzZWxlY3RlZCBvbiBtYXAhXCIpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICAvLyBBZGQgbWFya2VyIHRvIG1hcFxyXG4gIGNvbnN0IGFkZE1hcE1hcmtlciA9IChsYXQsIGxuZykgPT4ge1xyXG4gICAgaWYgKG1hcE1hcmtlcikge1xyXG4gICAgICBtYXAucmVtb3ZlTGF5ZXIobWFwTWFya2VyKTtcclxuICAgIH1cclxuXHJcbiAgICBtYXBNYXJrZXIgPSBMLm1hcmtlcihbbGF0LCBsbmddLCB7XHJcbiAgICAgIGRyYWdnYWJsZTogdHJ1ZSxcclxuICAgICAgdGl0bGU6IFwiU3RvcnkgTG9jYXRpb25cIixcclxuICAgIH0pXHJcbiAgICAgIC5hZGRUbyhtYXApXHJcbiAgICAgIC5iaW5kUG9wdXAoXCJTdG9yeSBsb2NhdGlvblwiKVxyXG4gICAgICAub3BlblBvcHVwKCk7XHJcblxyXG4gICAgbWFwTWFya2VyLm9uKFwiZHJhZ2VuZFwiLCAoZSkgPT4ge1xyXG4gICAgICBjb25zdCBuZXdQb3MgPSBlLnRhcmdldC5nZXRMYXRMbmcoKTtcclxuICAgICAgdXBkYXRlTG9jYXRpb24obmV3UG9zLmxhdCwgbmV3UG9zLmxuZyk7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICAvLyBVcGRhdGUgbG9jYXRpb24gaW5wdXRzIGFuZCBzdGF0dXNcclxuICBjb25zdCB1cGRhdGVMb2NhdGlvbiA9IChsYXQsIGxuZykgPT4ge1xyXG4gICAgdmlldy5xdWVyeVNlbGVjdG9yKFwiI2xhdFwiKS52YWx1ZSA9IGxhdDtcclxuICAgIHZpZXcucXVlcnlTZWxlY3RvcihcIiNsbmdcIikudmFsdWUgPSBsbmc7XHJcbiAgICBsb2NhdGlvblN0YXR1cy50ZXh0Q29udGVudCA9IGBMb2NhdGlvbiBzZXQ6ICR7bGF0LnRvRml4ZWQoXHJcbiAgICAgIDRcclxuICAgICl9LCAke2xuZy50b0ZpeGVkKDQpfWA7XHJcbiAgICBsb2NhdGlvblN0YXR1cy5zdHlsZS5jb2xvciA9IFwiIzRDQUY1MFwiO1xyXG4gIH07XHJcblxyXG4gIC8vIE1lc3NhZ2UgaGFuZGxlcnNcclxuICBjb25zdCBzaG93RXJyb3IgPSAobWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3QgZXJyb3JFbGVtZW50ID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI2Vycm9yLW1lc3NhZ2VcIik7XHJcbiAgICBlcnJvckVsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xyXG4gICAgZXJyb3JFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICBzZXRUaW1lb3V0KCgpID0+IChlcnJvckVsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiKSwgNTAwMCk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3Qgc2hvd1N1Y2Nlc3MgPSAobWVzc2FnZSkgPT4ge1xyXG4gICAgY29uc3Qgc3VjY2Vzc0VsZW1lbnQgPSB2aWV3LnF1ZXJ5U2VsZWN0b3IoXCIjc3VjY2Vzcy1tZXNzYWdlXCIpO1xyXG4gICAgc3VjY2Vzc0VsZW1lbnQudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xyXG4gICAgc3VjY2Vzc0VsZW1lbnQuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgIHNldFRpbWVvdXQoKCkgPT4gKHN1Y2Nlc3NFbGVtZW50LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIiksIDUwMDApO1xyXG4gIH07XHJcblxyXG4gIC8vIENhbWVyYSBmdW5jdGlvbnNcclxuICBjb25zdCBnZXRDYW1lcmFEZXZpY2VzID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgZGV2aWNlcyA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZW51bWVyYXRlRGV2aWNlcygpO1xyXG4gICAgICByZXR1cm4gZGV2aWNlcy5maWx0ZXIoKGRldmljZSkgPT4gZGV2aWNlLmtpbmQgPT09IFwidmlkZW9pbnB1dFwiKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHNob3dFcnJvcihgQ2FtZXJhIGFjY2VzcyBlcnJvcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgfTtcclxuXHJcbiAgY29uc3Qgc3RvcENhbWVyYSA9ICgpID0+IHtcclxuICAgIHN0b3BDYW1lcmFCdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgc3RhcnRDYW1lcmFCdG4uc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XHJcblxyXG4gICAgaWYgKHN0cmVhbSkge1xyXG4gICAgICBzdHJlYW0uZ2V0VHJhY2tzKCkuZm9yRWFjaCgodHJhY2spID0+IHtcclxuICAgICAgICB0cmFjay5zdG9wKCk7XHJcbiAgICAgICAgdHJhY2suZW5hYmxlZCA9IGZhbHNlO1xyXG4gICAgICB9KTtcclxuICAgICAgc3RyZWFtID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICBjYW1lcmFQcmV2aWV3LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgIGNhbWVyYVByZXZpZXcuc3JjT2JqZWN0ID0gbnVsbDtcclxuICAgIGNhcHR1cmVCdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgY2FtZXJhU2VsZWN0LnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICB9O1xyXG5cclxuICBjb25zdCBzdGFydENhbWVyYSA9IGFzeW5jIChkZXZpY2VJZCA9IG51bGwpID0+IHtcclxuICAgIGlmICghaXNWaWV3QWN0aXZlKSByZXR1cm47XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgc3RvcENhbWVyYSgpO1xyXG5cclxuICAgICAgY29uc3QgY29uc3RyYWludHMgPSB7XHJcbiAgICAgICAgdmlkZW86IHtcclxuICAgICAgICAgIHdpZHRoOiB7IGlkZWFsOiAxMjgwIH0sXHJcbiAgICAgICAgICBoZWlnaHQ6IHsgaWRlYWw6IDcyMCB9LFxyXG4gICAgICAgICAgLi4uKGRldmljZUlkICYmIHsgZGV2aWNlSWQ6IHsgZXhhY3Q6IGRldmljZUlkIH0gfSksXHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuXHJcbiAgICAgIHN0cmVhbSA9IGF3YWl0IG5hdmlnYXRvci5tZWRpYURldmljZXMuZ2V0VXNlck1lZGlhKGNvbnN0cmFpbnRzKTtcclxuXHJcbiAgICAgIGlmIChhdmFpbGFibGVDYW1lcmFzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgIGF2YWlsYWJsZUNhbWVyYXMgPSBhd2FpdCBnZXRDYW1lcmFEZXZpY2VzKCk7XHJcbiAgICAgICAgdXBkYXRlQ2FtZXJhU2VsZWN0KCk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNhbWVyYVByZXZpZXcuc3JjT2JqZWN0ID0gc3RyZWFtO1xyXG4gICAgICBjYW1lcmFQcmV2aWV3LnN0eWxlLmRpc3BsYXkgPSBcImJsb2NrXCI7XHJcbiAgICAgIHBob3RvUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgIGNhcHR1cmVCdG4uc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XHJcbiAgICAgIHN0b3BDYW1lcmFCdG4uc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XHJcbiAgICAgIHN0YXJ0Q2FtZXJhQnRuLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuICAgICAgcmV0YWtlQnRuLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcclxuXHJcbiAgICAgIGlmIChhdmFpbGFibGVDYW1lcmFzLmxlbmd0aCA+IDEpIHtcclxuICAgICAgICBjYW1lcmFTZWxlY3Quc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHNob3dFcnJvcihgQ2FtZXJhIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XHJcbiAgICAgIGlmIChkZXZpY2VJZCkge1xyXG4gICAgICAgIHN0YXJ0Q2FtZXJhKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCB1cGRhdGVDYW1lcmFTZWxlY3QgPSAoKSA9PiB7XHJcbiAgICBjYW1lcmFTZWxlY3QuaW5uZXJIVE1MID0gXCJcIjtcclxuICAgIGF2YWlsYWJsZUNhbWVyYXMuZm9yRWFjaCgoY2FtZXJhKSA9PiB7XHJcbiAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJvcHRpb25cIik7XHJcbiAgICAgIG9wdGlvbi52YWx1ZSA9IGNhbWVyYS5kZXZpY2VJZDtcclxuICAgICAgb3B0aW9uLnRleHQgPSBjYW1lcmEubGFiZWwgfHwgYENhbWVyYSAke2NhbWVyYVNlbGVjdC5sZW5ndGggKyAxfWA7XHJcbiAgICAgIGNhbWVyYVNlbGVjdC5hcHBlbmRDaGlsZChvcHRpb24pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY2FtZXJhU2VsZWN0LmFkZEV2ZW50TGlzdGVuZXIoXCJjaGFuZ2VcIiwgKCkgPT4ge1xyXG4gICAgICBzdGFydENhbWVyYShjYW1lcmFTZWxlY3QudmFsdWUpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgY29uc3QgY2FwdHVyZVBob3RvID0gKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgdmlkZW8gPSBjYW1lcmFQcmV2aWV3O1xyXG4gICAgICBjYW52YXMud2lkdGggPSB2aWRlby52aWRlb1dpZHRoO1xyXG4gICAgICBjYW52YXMuaGVpZ2h0ID0gdmlkZW8udmlkZW9IZWlnaHQ7XHJcblxyXG4gICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xyXG4gICAgICBjdHguZHJhd0ltYWdlKHZpZGVvLCAwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xyXG5cclxuICAgICAgcGhvdG9QcmV2aWV3LnNyYyA9IGNhbnZhcy50b0RhdGFVUkwoXCJpbWFnZS9qcGVnXCIpO1xyXG4gICAgICBwaG90b1ByZXZpZXcuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIjtcclxuICAgICAgY2FtZXJhUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcblxyXG4gICAgICBjYW52YXMudG9CbG9iKFxyXG4gICAgICAgIChibG9iKSA9PiB7XHJcbiAgICAgICAgICBwaG90b0ZpbGUgPSBuZXcgRmlsZShbYmxvYl0sIFwic3RvcnktcGhvdG8uanBnXCIsIHtcclxuICAgICAgICAgICAgdHlwZTogXCJpbWFnZS9qcGVnXCIsXHJcbiAgICAgICAgICAgIGxhc3RNb2RpZmllZDogRGF0ZS5ub3coKSxcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgXCJpbWFnZS9qcGVnXCIsXHJcbiAgICAgICAgMC44NVxyXG4gICAgICApO1xyXG5cclxuICAgICAgY2FwdHVyZUJ0bi5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgIHN0b3BDYW1lcmFCdG4uc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICBjYW1lcmFTZWxlY3Quc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xyXG4gICAgICByZXRha2VCdG4uc3R5bGUuZGlzcGxheSA9IFwiaW5saW5lLWJsb2NrXCI7XHJcbiAgICAgIHN0b3BDYW1lcmEoKTtcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHNob3dFcnJvcihgQ2FwdHVyZSBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgIH1cclxuICB9O1xyXG5cclxuICBjb25zdCByZXRha2VQaG90byA9ICgpID0+IHtcclxuICAgIHBob3RvUHJldmlldy5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICBwaG90b1ByZXZpZXcuc3JjID0gXCJcIjtcclxuICAgIHBob3RvRmlsZSA9IG51bGw7XHJcbiAgICBzdGFydENhbWVyYShjYW1lcmFTZWxlY3QudmFsdWUgfHwgbnVsbCk7XHJcbiAgfTtcclxuXHJcbiAgLy8gQ2xlYW4gdXAgd2hlbiB2aWV3IGlzIGRlc3Ryb3llZFxyXG4gIGNvbnN0IGNsZWFudXAgPSAoKSA9PiB7XHJcbiAgICBpc1ZpZXdBY3RpdmUgPSBmYWxzZTtcclxuICAgIHN0b3BDYW1lcmEoKTtcclxuXHJcbiAgICBpZiAobWFwKSB7XHJcbiAgICAgIG1hcC5yZW1vdmUoKTtcclxuICAgICAgbWFwID0gbnVsbDtcclxuICAgICAgbWFwTWFya2VyID0gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZW1vdmUgYWxsIGV2ZW50IGxpc3RlbmVyc1xyXG4gICAgY29uc3Qgc2FmZVJlbW92ZUxpc3RlbmVyID0gKGVsZW1lbnQsIGV2ZW50LCBoYW5kbGVyKSA9PiB7XHJcbiAgICAgIGlmIChlbGVtZW50ICYmIGhhbmRsZXIpIHtcclxuICAgICAgICBlbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIHNhZmVSZW1vdmVMaXN0ZW5lcihzdGFydENhbWVyYUJ0biwgXCJjbGlja1wiLCBzdGFydENhbWVyYSk7XHJcbiAgICBzYWZlUmVtb3ZlTGlzdGVuZXIoc3RvcENhbWVyYUJ0biwgXCJjbGlja1wiLCBzdG9wQ2FtZXJhKTtcclxuICAgIHNhZmVSZW1vdmVMaXN0ZW5lcihjYXB0dXJlQnRuLCBcImNsaWNrXCIsIGNhcHR1cmVQaG90byk7XHJcbiAgICBzYWZlUmVtb3ZlTGlzdGVuZXIocmV0YWtlQnRuLCBcImNsaWNrXCIsIHJldGFrZVBob3RvKTtcclxuICAgIHNhZmVSZW1vdmVMaXN0ZW5lcihjYW1lcmFTZWxlY3QsIFwiY2hhbmdlXCIsIHN0YXJ0Q2FtZXJhKTtcclxuICB9O1xyXG5cclxuICAvLyBJbml0aWFsaXplIG1hcCB3aGVuIHZpZXcgaXMgY3JlYXRlZFxyXG4gIHNldFRpbWVvdXQoaW5pdGlhbGl6ZU1hcCwgMTAwKTtcclxuXHJcbiAgLy8gQmluZCBldmVudCBoYW5kbGVyc1xyXG4gIGNvbnN0IGJpbmRBZGRTdG9yeSA9IChoYW5kbGVyKSA9PiB7XHJcbiAgICBjb25zdCBmb3JtID0gdmlldy5xdWVyeVNlbGVjdG9yKFwiI3N0b3J5LWZvcm1cIik7XHJcbiAgICBjb25zdCBnZXRMb2NhdGlvbkJ0biA9IHZpZXcucXVlcnlTZWxlY3RvcihcIiNnZXQtbG9jYXRpb25cIik7XHJcblxyXG4gICAgY29uc3QgZm9ybVN1Ym1pdEhhbmRsZXIgPSBhc3luYyAoZSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICBpZiAoIXBob3RvRmlsZSkge1xyXG4gICAgICAgIHNob3dFcnJvcihcIlBsZWFzZSB0YWtlIGEgcGhvdG8gZmlyc3RcIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IGZvcm0uZGVzY3JpcHRpb24udmFsdWUudHJpbSgpO1xyXG4gICAgICBpZiAoIWRlc2NyaXB0aW9uKSB7XHJcbiAgICAgICAgc2hvd0Vycm9yKFwiUGxlYXNlIGVudGVyIGEgZGVzY3JpcHRpb25cIik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAoIWZvcm0ubGF0LnZhbHVlIHx8ICFmb3JtLmxuZy52YWx1ZSkge1xyXG4gICAgICAgIHNob3dFcnJvcihcIlBsZWFzZSBzZWxlY3QgYSBsb2NhdGlvblwiKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGNvbnN0IGRhdGEgPSB7XHJcbiAgICAgICAgZGVzY3JpcHRpb24sXHJcbiAgICAgICAgcGhvdG86IHBob3RvRmlsZSxcclxuICAgICAgICBsYXQ6IHBhcnNlRmxvYXQoZm9ybS5sYXQudmFsdWUpLFxyXG4gICAgICAgIGxvbjogcGFyc2VGbG9hdChmb3JtLmxuZy52YWx1ZSksXHJcbiAgICAgIH07XHJcblxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IGhhbmRsZXIoZGF0YSk7XHJcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgc2hvd0Vycm9yKGBTdWJtaXNzaW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIGNvbnN0IGdldExvY2F0aW9uSGFuZGxlciA9ICgpID0+IHtcclxuICAgICAgbmF2aWdhdG9yLmdlb2xvY2F0aW9uLmdldEN1cnJlbnRQb3NpdGlvbihcclxuICAgICAgICAocG9zaXRpb24pID0+IHtcclxuICAgICAgICAgIGNvbnN0IGxhdCA9IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZTtcclxuICAgICAgICAgIGNvbnN0IGxuZyA9IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGU7XHJcblxyXG4gICAgICAgICAgdXBkYXRlTG9jYXRpb24obGF0LCBsbmcpO1xyXG4gICAgICAgICAgYWRkTWFwTWFya2VyKGxhdCwgbG5nKTtcclxuXHJcbiAgICAgICAgICBpZiAobWFwKSB7XHJcbiAgICAgICAgICAgIG1hcC5zZXRWaWV3KFtsYXQsIGxuZ10sIDE1KTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIHNob3dTdWNjZXNzKFwiQ3VycmVudCBsb2NhdGlvbiBvYnRhaW5lZCFcIik7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAoZXJyb3IpID0+IHtcclxuICAgICAgICAgIHNob3dFcnJvcihgTG9jYXRpb24gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIHsgZW5hYmxlSGlnaEFjY3VyYWN5OiB0cnVlLCB0aW1lb3V0OiAxMDAwMCB9XHJcbiAgICAgICk7XHJcbiAgICB9O1xyXG5cclxuICAgIHN0YXJ0Q2FtZXJhQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzdGFydENhbWVyYSk7XHJcbiAgICBzdG9wQ2FtZXJhQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzdG9wQ2FtZXJhKTtcclxuICAgIGNhcHR1cmVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGNhcHR1cmVQaG90byk7XHJcbiAgICByZXRha2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHJldGFrZVBob3RvKTtcclxuICAgIGdldExvY2F0aW9uQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBnZXRMb2NhdGlvbkhhbmRsZXIpO1xyXG4gICAgZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZvcm1TdWJtaXRIYW5kbGVyKTtcclxuXHJcbiAgICAvLyBBZGQgaGVhZGVyIG5hdmlnYXRpb24gbGlzdGVuZXJcclxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwiaGVhZGVyLW5hdmlnYXRpb25cIiwgc3RvcENhbWVyYSk7XHJcbiAgfTtcclxuXHJcbiAgY2hlY2tOb3RpZmljYXRpb25QZXJtaXNzaW9uKCk7XHJcblxyXG4gIHJldHVybiB7XHJcbiAgICBnZXRWaWV3OiAoKSA9PiB2aWV3LFxyXG4gICAgYmluZEFkZFN0b3J5LFxyXG4gICAgc2hvd0Vycm9yLFxyXG4gICAgc2hvd1N1Y2Nlc3MsXHJcbiAgICBnZXRNYXBDb250YWluZXI6ICgpID0+IG1hcENvbnRhaW5lcixcclxuICAgIGNsZWFudXAsXHJcbiAgfTtcclxufTtcclxuIiwiZXhwb3J0IGNvbnN0IGNoZWNrQXV0aCA9IChhdXRoTW9kZWwsIHJvdXRlcikgPT4ge1xyXG4gIGlmICghYXV0aE1vZGVsLmlzQXV0aGVudGljYXRlZCgpKSB7XHJcbiAgICByb3V0ZXIubmF2aWdhdGVUbyhcIi9sb2dpblwiKTtcclxuICAgIHJldHVybiBmYWxzZTtcclxuICB9XHJcbiAgcmV0dXJuIHRydWU7XHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgY2hlY2tHdWVzdCA9IChhdXRoTW9kZWwsIHJvdXRlcikgPT4ge1xyXG4gIGlmIChhdXRoTW9kZWwuaXNBdXRoZW50aWNhdGVkKCkpIHtcclxuICAgIHJvdXRlci5uYXZpZ2F0ZVRvKFwiL3N0b3JpZXNcIik7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG4gIHJldHVybiB0cnVlO1xyXG59O1xyXG5cclxuXHJcbiIsImltcG9ydCB7IEhlYWRlciwgdXBkYXRlQXV0aFVJIH0gZnJvbSAnLi9jb21wb25lbnRzL0hlYWRlci5qcyc7XHJcbmltcG9ydCAnLi4vcHVibGljL2Fzc2V0cy9zdHlsZXMvbWFpbi5jc3MnOyBcclxuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnLi9yb3V0ZXIuanMnO1xyXG5pbXBvcnQgeyBBdXRoTW9kZWwgfSBmcm9tICcuL21vZGVscy9BdXRoTW9kZWwuanMnO1xyXG5pbXBvcnQgeyBTdG9yeU1vZGVsIH0gZnJvbSAnLi9tb2RlbHMvU3RvcnlNb2RlbC5qcyc7XHJcbmltcG9ydCB7IEF1dGhQcmVzZW50ZXIgfSBmcm9tICcuL3ByZXNlbnRlcnMvQXV0aFByZXNlbnRlci5qcyc7XHJcbmltcG9ydCB7IFN0b3J5UHJlc2VudGVyIH0gZnJvbSAnLi9wcmVzZW50ZXJzL1N0b3J5UHJlc2VudGVyLmpzJztcclxuaW1wb3J0IHsgTWFwUHJlc2VudGVyIH0gZnJvbSAnLi9wcmVzZW50ZXJzL01hcFByZXNlbnRlci5qcyc7XHJcbmltcG9ydCB7IExvZ2luVmlldyB9IGZyb20gJy4vdmlld3MvYXV0aC9Mb2dpblZpZXcuanMnO1xyXG5pbXBvcnQgeyBSZWdpc3RlclZpZXcgfSBmcm9tICcuL3ZpZXdzL2F1dGgvUmVnaXN0ZXJWaWV3LmpzJztcclxuaW1wb3J0IHsgU3Rvcmllc1ZpZXcgfSBmcm9tICcuL3ZpZXdzL3N0b3JpZXMvU3Rvcmllc1ZpZXcuanMnO1xyXG5pbXBvcnQgeyBEZXRhaWxTdG9yeVZpZXcgfSBmcm9tICcuL3ZpZXdzL3N0b3JpZXMvRGV0YWlsU3RvcnlWaWV3LmpzJztcclxuaW1wb3J0IHsgQWRkU3RvcnlWaWV3IH0gZnJvbSAnLi92aWV3cy9zdG9yaWVzL0FkZFN0b3J5Vmlldy5qcyc7XHJcbmltcG9ydCB7IEVycm9yVmlldyB9IGZyb20gJy4vdmlld3MvRXJyb3JWaWV3LmpzJztcclxuaW1wb3J0IHsgY2hlY2tBdXRoLCBjaGVja0d1ZXN0IH0gZnJvbSAnLi91dGlscy9hdXRoLmpzJztcclxuaW1wb3J0IHsgcmVxdWVzdE5vdGlmaWNhdGlvblBlcm1pc3Npb24sIHN1YnNjcmliZVVzZXIgfSBmcm9tICcuL3V0aWxzL25vdGlmaWNhdGlvbi5qcyc7XHJcbmltcG9ydCB7IGluaXRpYWxpemVTa2lwVG9Db250ZW50IH0gZnJvbSAnLi91dGlscy9Ta2lwVG9Db250ZW50LmpzJztcclxuXHJcbmluaXRpYWxpemVTa2lwVG9Db250ZW50KCk7XHJcbmNvbnN0IGF1dGhNb2RlbCA9IG5ldyBBdXRoTW9kZWwoKTtcclxuY29uc3Qgc3RvcnlNb2RlbCA9IG5ldyBTdG9yeU1vZGVsKGF1dGhNb2RlbCk7XHJcblxyXG5pbml0aWFsaXplU2tpcFRvQ29udGVudCgpO1xyXG5cclxuY29uc3QgYXBwUm9vdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYXBwXCIpO1xyXG5hcHBSb290LmFwcGVuZENoaWxkKEhlYWRlcigpKTtcclxuXHJcbmxldCBkZWZlcnJlZFByb21wdDtcclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZWluc3RhbGxwcm9tcHQnLCAoZSkgPT4ge1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBkZWZlcnJlZFByb21wdCA9IGU7XHJcblxyXG4gIGNvbnN0IGluc3RhbGxCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaW5zdGFsbC1idXR0b24nKTtcclxuICBpZiAoaW5zdGFsbEJ0bikge1xyXG4gICAgaW5zdGFsbEJ0bi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7XHJcbiAgICBpbnN0YWxsQnRuLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpbnN0YWxsQnRuLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICAgIGRlZmVycmVkUHJvbXB0LnByb21wdCgpO1xyXG4gICAgICBjb25zdCBjaG9pY2UgPSBhd2FpdCBkZWZlcnJlZFByb21wdC51c2VyQ2hvaWNlO1xyXG4gICAgICBkZWZlcnJlZFByb21wdCA9IG51bGw7XHJcbiAgICB9KTtcclxuICB9XHJcbn0pO1xyXG5cclxuY29uc3QgaW5pdE1hcFdpdGhSZXRyeSA9IGFzeW5jIChoYW5kbGVyLCBjb250YWluZXJJZCwgbGF0LCBsbmcsIHpvb20sIGF0dGVtcHRzID0gMCkgPT4ge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChjb250YWluZXJJZCk7XHJcbiAgICBpZiAoIWNvbnRhaW5lciAmJiBhdHRlbXB0cyA8IDMpIHtcclxuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCAqIChhdHRlbXB0cyArIDEpKSk7XHJcbiAgICAgIHJldHVybiBpbml0TWFwV2l0aFJldHJ5KGhhbmRsZXIsIGNvbnRhaW5lcklkLCBsYXQsIGxuZywgem9vbSwgYXR0ZW1wdHMgKyAxKTtcclxuICAgIH1cclxuICAgIHJldHVybiBoYW5kbGVyKGNvbnRhaW5lcklkLCBsYXQsIGxuZywgem9vbSk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIHJldHVybiBudWxsO1xyXG4gIH1cclxufTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2dvdXQnLCAoKSA9PiB7XHJcbiAgYXV0aE1vZGVsLmxvZ291dCgpO1xyXG4gIHVwZGF0ZUF1dGhVSShmYWxzZSk7XHJcbiAgcm91dGVyLm5hdmlnYXRlVG8oJy9sb2dpbicpO1xyXG59KTtcclxuXHJcbmNvbnN0IHJvdXRlcyA9IFtcclxuICB7XHJcbiAgICBwYXRoOiAnL2xvZ2luJyxcclxuICAgIHZpZXc6IGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCFjaGVja0d1ZXN0KGF1dGhNb2RlbCwgcm91dGVyKSkgcmV0dXJuIEVycm9yVmlldygpLmdldFZpZXcoKTtcclxuICAgICAgY29uc3QgdmlldyA9IExvZ2luVmlldygpO1xyXG4gICAgICBuZXcgQXV0aFByZXNlbnRlcihhdXRoTW9kZWwsIHsgYmluZExvZ2luOiB2aWV3LmJpbmRMb2dpbiwgc2hvd0Vycm9yOiB2aWV3LnNob3dFcnJvciB9LCByb3V0ZXIpO1xyXG4gICAgICByZXR1cm4gdmlldy5nZXRWaWV3KCk7XHJcbiAgICB9XHJcbiAgfSxcclxuICB7XHJcbiAgICBwYXRoOiAnL3JlZ2lzdGVyJyxcclxuICAgIHZpZXc6IGFzeW5jICgpID0+IHtcclxuICAgICAgaWYgKCFjaGVja0d1ZXN0KGF1dGhNb2RlbCwgcm91dGVyKSkgcmV0dXJuIEVycm9yVmlldygpLmdldFZpZXcoKTtcclxuICAgICAgY29uc3QgdmlldyA9IFJlZ2lzdGVyVmlldygpO1xyXG4gICAgICBuZXcgQXV0aFByZXNlbnRlcihhdXRoTW9kZWwsIHsgYmluZFJlZ2lzdGVyOiB2aWV3LmJpbmRSZWdpc3Rlciwgc2hvd0Vycm9yOiB2aWV3LnNob3dFcnJvciwgc2hvd1N1Y2Nlc3M6IHZpZXcuc2hvd1N1Y2Nlc3MgfSwgcm91dGVyKTtcclxuICAgICAgcmV0dXJuIHZpZXcuZ2V0VmlldygpO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAge1xyXG4gICAgcGF0aDogJy8nLFxyXG4gICAgdmlldzogYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIWNoZWNrQXV0aChhdXRoTW9kZWwsIHJvdXRlcikpIHJldHVybiBFcnJvclZpZXcoKS5nZXRWaWV3KCk7XHJcbiAgICAgIGNvbnN0IHZpZXcgPSBTdG9yaWVzVmlldygpO1xyXG4gICAgICBuZXcgU3RvcnlQcmVzZW50ZXIoc3RvcnlNb2RlbCwgeyBiaW5kTG9hZFN0b3JpZXM6IHZpZXcuYmluZExvYWRTdG9yaWVzLCBkaXNwbGF5U3Rvcmllczogdmlldy5kaXNwbGF5U3Rvcmllcywgc2hvd0Vycm9yOiB2aWV3LnNob3dFcnJvciB9LCByb3V0ZXIpO1xyXG4gICAgICByZXR1cm4gdmlldy5nZXRWaWV3KCk7XHJcbiAgICB9XHJcbiAgfSxcclxuICB7XHJcbiAgICBwYXRoOiAnL3N0b3JpZXMnLFxyXG4gICAgdmlldzogYXN5bmMgKCkgPT4ge1xyXG4gICAgICBpZiAoIWNoZWNrQXV0aChhdXRoTW9kZWwsIHJvdXRlcikpIHJldHVybiBFcnJvclZpZXcoKS5nZXRWaWV3KCk7XHJcbiAgICAgIGNvbnN0IHZpZXcgPSBTdG9yaWVzVmlldygpO1xyXG4gICAgICBuZXcgU3RvcnlQcmVzZW50ZXIoc3RvcnlNb2RlbCwgeyBiaW5kTG9hZFN0b3JpZXM6IHZpZXcuYmluZExvYWRTdG9yaWVzLCBkaXNwbGF5U3Rvcmllczogdmlldy5kaXNwbGF5U3Rvcmllcywgc2hvd0Vycm9yOiB2aWV3LnNob3dFcnJvciB9LCByb3V0ZXIpO1xyXG4gICAgICByZXR1cm4gdmlldy5nZXRWaWV3KCk7XHJcbiAgICB9XHJcbiAgfSxcclxuICB7XHJcbiAgICBwYXRoOiAnL3N0b3JpZXMvOmlkJyxcclxuICAgIHZpZXc6IGFzeW5jIChwYXJhbXMpID0+IHtcclxuICAgICAgaWYgKCFjaGVja0F1dGgoYXV0aE1vZGVsLCByb3V0ZXIpKSByZXR1cm4gRXJyb3JWaWV3KCk7XHJcbiAgICAgIGNvbnN0IHZpZXcgPSBEZXRhaWxTdG9yeVZpZXcoKTtcclxuICAgICAgY29uc3QgeyBpZCB9ID0gcGFyYW1zO1xyXG4gICAgICBuZXcgU3RvcnlQcmVzZW50ZXIoc3RvcnlNb2RlbCwge1xyXG4gICAgICAgIGJpbmRMb2FkU3RvcnlEZXRhaWw6IChoYW5kbGVyKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBtYXBDb250YWluZXIgPSB2aWV3LmdldFZpZXcoKS5xdWVyeVNlbGVjdG9yKCcjc3RvcnktbWFwLWNvbnRhaW5lcicpO1xyXG4gICAgICAgICAgaWYgKG1hcENvbnRhaW5lcikge1xyXG4gICAgICAgICAgICBtYXBDb250YWluZXIuaW5uZXJIVE1MID0gJzxkaXYgaWQ9XCJzdG9yeS1tYXBcIiBjbGFzcz1cImRldGFpbC1tYXBcIj48L2Rpdj4nO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaGFuZGxlcihpZCk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBkaXNwbGF5U3RvcnlEZXRhaWw6IChzdG9yeSkgPT4ge1xyXG4gICAgICAgICAgdmlldy5kaXNwbGF5U3RvcnlEZXRhaWwoc3RvcnkpO1xyXG4gICAgICAgICAgaWYgKHN0b3J5LmxhdCAmJiBzdG9yeS5sb24pIHtcclxuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgbWFwRWxlbWVudCA9IHZpZXcuZ2V0VmlldygpLnF1ZXJ5U2VsZWN0b3IoJyNzdG9yeS1tYXAnKTtcclxuICAgICAgICAgICAgICBpZiAoIW1hcEVsZW1lbnQgfHwgIW1hcEVsZW1lbnQuX2xlYWZsZXRfaWQpIHtcclxuICAgICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnN0IG1hcCA9IEwubWFwKG1hcEVsZW1lbnQpLnNldFZpZXcoW3N0b3J5LmxhdCwgc3RvcnkubG9uXSwgMTMpO1xyXG4gICAgICAgICAgICAgICAgICBMLnRpbGVMYXllcignaHR0cHM6Ly97c30udGlsZS5vcGVuc3RyZWV0bWFwLm9yZy97en0ve3h9L3t5fS5wbmcnLCB7XHJcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRpb246ICcmY29weTsgT3BlblN0cmVldE1hcCBjb250cmlidXRvcnMnXHJcbiAgICAgICAgICAgICAgICAgIH0pLmFkZFRvKG1hcCk7XHJcbiAgICAgICAgICAgICAgICAgIEwubWFya2VyKFtzdG9yeS5sYXQsIHN0b3J5Lmxvbl0pXHJcbiAgICAgICAgICAgICAgICAgICAgLmFkZFRvKG1hcClcclxuICAgICAgICAgICAgICAgICAgICAuYmluZFBvcHVwKGA8Yj4ke3N0b3J5Lm5hbWV9PC9iPjxicj4ke3N0b3J5LmRlc2NyaXB0aW9uLnN1YnN0cmluZygwLCA1MCl9Li4uYClcclxuICAgICAgICAgICAgICAgICAgICAub3BlblBvcHVwKCk7XHJcbiAgICAgICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge31cclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIDUwKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHNob3dFcnJvcjogdmlldy5zaG93RXJyb3JcclxuICAgICAgfSwgcm91dGVyKTtcclxuICAgICAgcmV0dXJuIHZpZXcuZ2V0VmlldygpO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAge1xyXG4gICAgcGF0aDogJy9hZGQtc3RvcnknLFxyXG4gICAgdmlldzogYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB2aWV3ID0gQWRkU3RvcnlWaWV3KCk7XHJcbiAgICAgIGNvbnN0IGRvbU5vZGUgPSB2aWV3LmdldFZpZXcoKTtcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCBtYXBQcmVzZW50ZXIgPSBuZXcgTWFwUHJlc2VudGVyKHtcclxuICAgICAgICAgIGJpbmRJbml0TWFwOiBhc3luYyAoaGFuZGxlcikgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBpbml0TWFwV2l0aFJldHJ5KGhhbmRsZXIsICdtYXAnLCAtNi4yMDg4LCAxMDYuODQ1NiwgMTIpO1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0Py5tYXApIHtcclxuICAgICAgICAgICAgICByZXN1bHQubWFwLm9uKCdjbGljaycsIChlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IGxhdCwgbG5nIH0gPSBlLmxhdGxuZztcclxuICAgICAgICAgICAgICAgIGRvbU5vZGUucXVlcnlTZWxlY3RvcignI2xhdCcpLnZhbHVlID0gbGF0O1xyXG4gICAgICAgICAgICAgICAgZG9tTm9kZS5xdWVyeVNlbGVjdG9yKCcjbG5nJykudmFsdWUgPSBsbmc7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQuYWRkTWFya2VyKGxhdCwgbG5nLCAnU3RvcnkgbG9jYXRpb24nKTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0Py5tYXA7XHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgYmluZEdldEN1cnJlbnRMb2NhdGlvbjogKGhhbmRsZXIpID0+IHtcclxuICAgICAgICAgICAgZG9tTm9kZS5xdWVyeVNlbGVjdG9yKCcjZ2V0LWxvY2F0aW9uJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2NhdGlvbiA9IGF3YWl0IGhhbmRsZXIoKTtcclxuICAgICAgICAgICAgICAgIGRvbU5vZGUucXVlcnlTZWxlY3RvcignI2xhdCcpLnZhbHVlID0gbG9jYXRpb24ubGF0O1xyXG4gICAgICAgICAgICAgICAgZG9tTm9kZS5xdWVyeVNlbGVjdG9yKCcjbG5nJykudmFsdWUgPSBsb2NhdGlvbi5sbmc7XHJcbiAgICAgICAgICAgICAgICBtYXBQcmVzZW50ZXIuYWRkTWFya2VyKGxvY2F0aW9uLmxhdCwgbG9jYXRpb24ubG5nLCAnQ3VycmVudCBsb2NhdGlvbicpO1xyXG4gICAgICAgICAgICAgICAgbWFwUHJlc2VudGVyLm1hcD8uc2V0VmlldyhbbG9jYXRpb24ubGF0LCBsb2NhdGlvbi5sbmddLCAxNSk7XHJcbiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHZpZXcuc2hvd0Vycm9yKGVycm9yLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIG5ldyBTdG9yeVByZXNlbnRlcihcclxuICAgICAgICAgIHN0b3J5TW9kZWwsXHJcbiAgICAgICAgICB7XHJcbiAgICAgICAgICAgIGJpbmRBZGRTdG9yeTogdmlldy5iaW5kQWRkU3RvcnksXHJcbiAgICAgICAgICAgIHNob3dFcnJvcjogdmlldy5zaG93RXJyb3IsXHJcbiAgICAgICAgICAgIHNob3dTdWNjZXNzOiB2aWV3LnNob3dTdWNjZXNzXHJcbiAgICAgICAgICB9LFxyXG4gICAgICAgICAgcm91dGVyXHJcbiAgICAgICAgKTtcclxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICB2aWV3LnNob3dFcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgZm9ybScpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybiBkb21Ob2RlO1xyXG4gICAgfVxyXG4gIH0sXHJcbiAge1xyXG4gICAgcGF0aDogJy9sb2dvdXQnLFxyXG4gICAgdmlldzogYXN5bmMgKCkgPT4ge1xyXG4gICAgICBhdXRoTW9kZWwubG9nb3V0KCk7XHJcbiAgICAgIHVwZGF0ZUF1dGhVSShmYWxzZSk7XHJcbiAgICAgIHJvdXRlci5uYXZpZ2F0ZVRvKCcvbG9naW4nKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBnZXRWaWV3OiAoKSA9PiBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxyXG4gICAgICB9LmdldFZpZXcoKTtcclxuICAgIH1cclxuICB9LFxyXG4gIHtcclxuICAgIHBhdGg6ICcqJyxcclxuICAgIHZpZXc6ICgpID0+IEVycm9yVmlldygpLmdldFZpZXcoKVxyXG4gIH1cclxuXTtcclxuXHJcbmNvbnN0IHJvdXRlciA9IG5ldyBSb3V0ZXIocm91dGVzKTtcclxuXHJcbnVwZGF0ZUF1dGhVSShhdXRoTW9kZWwuaXNBdXRoZW50aWNhdGVkKCkpO1xyXG5cclxuaWYgKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IpIHtcclxuICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKVxyXG4gICAgICAudGhlbihhc3luYyAocmVnaXN0cmF0aW9uKSA9PiB7XHJcbiAgICAgICAgaWYgKGF1dGhNb2RlbC5pc0F1dGhlbnRpY2F0ZWQoKSkge1xyXG4gICAgICAgICAgdHJ5IHtcclxuICAgICAgICAgICAgY29uc3QgcGVybWlzc2lvbiA9IGF3YWl0IHJlcXVlc3ROb3RpZmljYXRpb25QZXJtaXNzaW9uKCk7XHJcbiAgICAgICAgICAgIGlmIChwZXJtaXNzaW9uKSBhd2FpdCBzdWJzY3JpYmVVc2VyKGF1dGhNb2RlbC5nZXRUb2tlbigpKTtcclxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7fVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICAgLmNhdGNoKGVycm9yID0+IHt9KTtcclxuICB9KTtcclxuXHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIChldmVudCkgPT4ge1xyXG4gICAgaWYgKGV2ZW50LmRhdGE/LnR5cGUgPT09ICdUUklHR0VSX1NZTkMnKSB7XHJcbiAgICAgIGlmICh3aW5kb3cuc3RvcnlQcmVzZW50ZXIgJiYgdHlwZW9mIHdpbmRvdy5zdG9yeVByZXNlbnRlci5oYW5kbGVPbmxpbmUgPT09ICdmdW5jdGlvbicpIHtcclxuICAgICAgICB3aW5kb3cuc3RvcnlQcmVzZW50ZXIuaGFuZGxlT25saW5lKCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KTtcclxufVxyXG4iXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///7427\n')}},n=>{n.O(0,[96,869],(()=>n(n.s=7427))),n.O()}]);